webpackJsonp([57],{"+ANq":function(t,e){},"/1N0":function(t,e,a){"use strict";(function(t){var e=a("mvHQ"),s=(a.n(e),a("7+uW")),i=(a("C331"),a("Do79"));s.a.component("c-reserveTable",i.a)}).call(e,a("7t+N"))},HUfU:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});a("/1N0");var s=a("RI9/"),i={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container",attrs:{id:"schedulingManage"}},[t.isAddScheduling?a("div",{staticClass:"add-scheduling-page"},[a("div",{staticClass:"addScheduling-header"},[a("div",{staticClass:"addScheduling-back pull-left",on:{click:t._back}},[a("i",{staticClass:"maticon back-icon-btn pull-left",domProps:{innerHTML:t._s(t.icons("navigate_before"))}},[t._v("navigate_before")]),t._v(" "),a("div",{staticClass:"back-title"},[t._v("新增排班")])]),t._v(" "),a("div",{staticClass:"search-user"},[t.isShowSearch?a("detect",{attrs:{url:"/api/mentality/teachers/searchResults",placeholder:"咨询师姓名或学工号"},on:{afterSelected:t.addSchedulingAfterSelected}}):a("div",[a("div",{staticClass:"user-info pull-left"},[t._v(t._s(t.userIdAndUserName))]),t._v(" "),a("i",{staticClass:"maticon pull-right",domProps:{innerHTML:t._s(t.icons("edit"))},on:{click:t.changeUserSearch}},[t._v("edit")])])],1)]),t._v(" "),a("div",{staticClass:"addScheduling-content",style:"max-height:"+t.scrollHeight+"px"},[a("c-reserveTable",{attrs:{isShowDateOfDay:!1,tableData:t.newSettingData,tableType:"add",consultantId:t.consultantId,dataType:"setting",timeQuantumArray:t.timeQuantumArray},on:{selectTabelCell:t._selectTabelCell}}),t._v(" "),a("div",{staticClass:"box_flex align_center",on:{click:function(e){t.addhideToStu=!t.addhideToStu}}},[t.addhideToStu?a("i",{staticClass:"maticon active",domProps:{innerHTML:t._s(t.icons("check_box"))}},[t._v("check_box")]):a("i",{staticClass:"maticon",domProps:{innerHTML:t._s(t.icons("check_box_outline_blank"))}},[t._v("check_box_outline_blank")]),t._v(" "),a("span",{staticClass:"icon-title"},[t._v("对学生隐藏排班")])]),t._v(" "),a("div",{staticClass:"tips"},[t._v("注：此排班时间设为每周排班时间段，若需修改请直接在排班表点击人员姓名直接修改；系统将会根据填写的时长与工作时间设置排班时段。")]),t._v(" "),a("div",{staticClass:"psychological-footer"},[a("div",{staticClass:"btn-group"},[a("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:t.submitAddScheduling}},[t._v("提交")])])])],1)]):a("div",{staticClass:"scheduling-manage"},[a("c-reserveTable",{attrs:{tableData:t.schedulingData,isShowDateOfDay:!0,tableType:"manage",timeQuantumArray:t.timeQuantumArray,dataType:"data"},on:{getWeekTime:t._getWeekTime,editConsultant:t._editConsultant}},[a("div",{staticClass:"campus-select",attrs:{slot:"header-select"},slot:"header-select"},[t.schoolData.length>0?a("div",{staticClass:"select-radio"},[a("label",{staticClass:"radio-text"},[t._v("校区")]),t._v(" "),a("span"),t._v(" "),a("div",{staticClass:"info-options"},t._l(t.schoolData,function(e,s){return a("span",{key:s,on:{click:function(a){return t._selectCampus(e)}}},[a("i",{staticClass:"maticon",class:t.selectCampus===e.value?"active":"",domProps:{innerHTML:t._s(t.icons(t.selectCampus===e.value?"radio_button_checked":"radio_button_unchecked"))}}),t._v(t._s(e.label)+"\n          ")])}),0)]):t._e(),t._v(" "),t.isShowSchedulingType?a("div",{staticClass:"select-radio",staticStyle:{"margin-left":"19px"}},[a("label",{staticClass:"radio-text"},[t._v("排班类型")]),t._v(" "),a("span"),t._v(" "),a("div",{staticClass:"info-options"},t._l(t.schedulingTypeData,function(e,s){return a("span",{key:s,on:{click:function(a){return t._selectSchedulingType(e)}}},[a("i",{staticClass:"maticon",class:t.schedulingType===e.value?"active":"",domProps:{innerHTML:t._s(t.icons(t.schedulingType===e.value?"radio_button_checked":"radio_button_unchecked"))}}),t._v(t._s(e.label)+"\n          ")])}),0)]):t._e()]),t._v(" "),a("div",{staticClass:"body-slot",attrs:{slot:"body-slot"},slot:"body-slot"},[a("div",{staticClass:"pull-left"},[a("span",{staticClass:"time-tips"},[t._v(t._s(t.weekTime.weekStartTime)+"-"+t._s(t.weekTime.weekEndTime)+" 排班表")]),t._v(" "),a("span",[a("span",{staticClass:"morning-color"}),t._v(" "),a("span",{staticClass:"morning-name"},[t._v("上午")])]),t._v(" "),a("span",[a("span",{staticClass:"afternoon-color"}),t._v(" "),a("span",{staticClass:"afternoon-name"},[t._v("下午")])])]),t._v(" "),a("div",{staticClass:"btn-group pull-right"},[a("button",{staticClass:"btn table-btn clearBtnBorder",attrs:{type:"button"},on:{click:t._showSettingModal}},[t._v("排班设置")]),t._v(" "),a("button",{staticClass:"btn table-btn clearBtnBorder add-btn",attrs:{type:"button"},on:{click:t.addScheduling}},[a("i",{staticClass:"maticon pull-left add-icon",domProps:{innerHTML:t._s(t.icons("add"))}},[t._v("add")]),t._v(" 新增排班")])])])])],1),t._v(" "),a("v-modal",{attrs:{show:t.showEditModal,effect:"fade",width:"442"}},[a("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[t._v("\n      编辑\n    ")]),t._v(" "),a("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[a("div",{staticClass:"modal-search-user"},[t.showEditModal?a("detect",{attrs:{url:"/api/mentality/teachers/searchResults",placeholder:"咨询师姓名或学工号"},on:{afterSelected:t.editConsultantAfterSelected}}):t._e()],1),t._v(" "),a("div",{staticClass:"consultant-name-list"},t._l(t.consultantArr,function(e,s){return a("div",{key:s,staticClass:"consultant-name",on:{click:function(a){return t.deleteConsultant(e)}}},[a("i",{staticClass:"maticon",domProps:{innerHTML:t._s(t.icons("clear"))}},[t._v("clear")]),t._v("\n          "+t._s(e.name)+"\n        ")])}),0),t._v(" "),a("div",[a("div",{staticClass:"modify-scheduling-options"},[a("span",{on:{click:function(e){t.hideToStu=!t.hideToStu}}},[t.hideToStu?a("i",{staticClass:"maticon active",domProps:{innerHTML:t._s(t.icons("check_box"))}},[t._v("check_box")]):a("i",{staticClass:"maticon",domProps:{innerHTML:t._s(t.icons("check_box_outline_blank"))}},[t._v("check_box_outline_blank")])]),t._v(" "),a("span",{staticClass:"icon-title"},[t._v("对学生隐藏排班")])]),t._v(" "),a("div",{staticClass:"modify-scheduling-options"},[a("span",{on:{click:t.selectScheduling}},[t.isUpdateNext?a("i",{staticClass:"maticon active",domProps:{innerHTML:t._s(t.icons("check_box"))}},[t._v("check_box")]):a("i",{staticClass:"maticon",domProps:{innerHTML:t._s(t.icons("check_box_outline_blank"))}},[t._v("check_box_outline_blank")])]),t._v(" "),a("span",{staticClass:"icon-title"},[t._v("修改当前周之后所有排班")])])])]),t._v(" "),a("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[a("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.showEditModal=!1}}},[t._v("取消")]),t._v(" "),a("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:t.sumbitEditConsultant}},[t._v("确定")])])]),t._v(" "),a("v-modal",{attrs:{show:t.showSettingModal,effect:"fade",width:"512"}},[a("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[a("h5",{staticClass:"modal-title"},[t._v("\n        排班设置\n      ")])]),t._v(" "),a("div",{staticClass:"setting-modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[a("div",{staticClass:"form-list"},[a("div",{staticClass:"form-group marginLeft45px"},[a("label",{staticClass:"form-label"},[a("span",{staticClass:"star"},[t._v("*")]),t._v("排班开始日期")]),t._v(" "),a("v-datepicker",{staticClass:"btn-block time-picker",attrs:{clearButton:!1,showTime:!1},on:{daySelected:t.startTimeSelected},model:{value:t.settingData.startTime,callback:function(e){t.$set(t.settingData,"startTime",e)},expression:"settingData.startTime"}})],1),t._v(" "),a("div",{staticClass:"form-group marginLeft45px"},[a("label",{staticClass:"form-label"},[a("span",{staticClass:"star"},[t._v("*")]),t._v("排班结束日期")]),t._v(" "),a("v-datepicker",{staticClass:"btn-block time-picker",attrs:{clearButton:!1,showTime:!1},on:{daySelected:t.endTimeSelected},model:{value:t.settingData.endTime,callback:function(e){t.$set(t.settingData,"endTime",e)},expression:"settingData.endTime"}})],1),t._v(" "),t._l(t.settingData.timeList,function(e,s){return a("div",{key:s,staticClass:"time-list"},[a("div",{staticClass:"form-group marginLeft75px"},[a("label",{staticClass:"form-label "},[a("span",{staticClass:"star"},[t._v("*")]),t._v("开始时间")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.timeQuantumStart,expression:"item.timeQuantumStart"}],staticClass:"form-control form-input",attrs:{type:"text",placeholder:"时间格式：08:30"},domProps:{value:e.timeQuantumStart},on:{change:function(a){return t.checkTimeQuantumStart(e.timeQuantumStart,s)},input:function(a){a.target.composing||t.$set(e,"timeQuantumStart",a.target.value)}}})]),t._v(" "),a("div",{staticClass:"form-group marginLeft75px"},[a("label",{staticClass:"form-label "},[a("span",{staticClass:"star"},[t._v("*")]),t._v("结束时间")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.timeQuantumEnd,expression:"item.timeQuantumEnd"}],staticClass:"form-control form-input",attrs:{type:"text",placeholder:"时间格式：08:30"},domProps:{value:e.timeQuantumEnd},on:{change:function(a){return t.checkTimeQuantumEnd(e.timeQuantumEnd,s)},input:function(a){a.target.composing||t.$set(e,"timeQuantumEnd",a.target.value)}}})]),t._v(" "),a("div",{staticClass:"delete-btn",on:{click:function(a){return t._deleteTime(e)}}},[t._v("删除")])])}),t._v(" "),a("div",{staticClass:"btn-group add-time-btn"},[a("button",{staticClass:"btn submit-btn",attrs:{type:"button"},on:{click:t._addTime}},[a("i",{staticClass:"maticon pull-left add-icon",domProps:{innerHTML:t._s(t.icons("add"))}},[t._v("add")]),t._v("增加时间段")])])],2),t._v(" "),a("div",{staticClass:"tips"},[t._v("注：此排班时间设为每周排班时间段，若需修改请到排班管理进行修改。")])]),t._v(" "),a("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[a("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.showSettingModal=!1}}},[t._v("取消")]),t._v(" "),a("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:t.sumbitSetting}},[t._v("确定")])])])],1)},staticRenderFns:[]};var n=function(t){a("+ANq")},c=a("VU/8")(s.a,i,!1,n,null,null);e.default=c.exports},"RI9/":function(t,e,a){"use strict";(function(t){var s=a("mvHQ"),i=a.n(s),n=a("7+uW"),c=a("C331"),l=a("Do79");n.a.component("c-reserveTable",l.a),e.a={inject:{windowObj:{default:null}},data:function(){return{showEditModal:!1,showSettingModal:!1,isAddScheduling:!1,hideToStu:!1,addhideToStu:!1,weekTime:{},schoolData:[],selectCampus:"",schedulingType:"RESERVATION",isShowSchedulingType:!1,isUpdateNext:!1,consultantArr:[],settingData:{schedulingId:"",startTime:"",endTime:"",timeList:[{timeId:"timeId",timeQuantumStart:"",timeQuantumEnd:""}]},schedulingSettingType:"add",schedulingTypeData:[{value:"RESERVATION",label:"预约"},{value:"ARRANGE_TALKS",label:"首次访谈"}],consultantId:"",schedulingData:[],selectedTabelCells:[],tableData:[],timeQuantumArray:[],consultantInfoArr:[],dataTimeId:"",changeDate:"",scrollHeight:"",newSettingData:[],isShowSearch:!0,userIdAndUserName:"",lang:"zh-cn"}},computed:{translate:function(){return Object(c.g)(this.lang).employmentUnitManage}},watch:{selectCampus:{deep:!0,handler:function(){this._initTableData(this.weekTime)}},schedulingType:{deep:!0,handler:function(){this._initTableData(this.weekTime)}},windowObj:{deep:!0,handler:function(){var e=t(".add-scheduling-page").height();this.scrollHeight=e-t(".addScheduling-header").height()}}},created:function(){var t=this,e=localStorage.getItem("lang");Object(c.g)(e)&&(this.lang=e),Object(c.e)({url:"/api/system/dicts",dataType:"json",type:"get",data:{dictType:"校区"},success:function(e){e.state?(t.schoolData=e.data,t.selectCampus=e.data[0].value):t.$toast(e.message)}}),Object(c.e)({url:"/api/mentality/config",dataType:"json",type:"get",success:function(e){e.state?e.data&&(t.isShowSchedulingType=e.data.interviewFirst):t.$toast(e.message)}}),this._getWeekTime()},methods:{_back:function(){this.isAddScheduling=!1},_selectCampus:function(t){this.selectCampus=t.value},_selectSchedulingType:function(t){this.schedulingType=t.value},changeUserSearch:function(){this.isShowSearch=!0,this.consultantId="",this.userIdAndUserName=""},addScheduling:function(){var e=this;this.isShowSearch=!0,this.userIdAndUserName="",this.consultantId="",this.selectedTabelCells=[],this.schedulingData=[],Object(c.e)({url:"/api/mentality/teachers/schedulingTeacher/setting?type="+this.schedulingType+"&campus="+this.selectCampus,dataType:"json",type:"get",success:function(t){t.state?t.data&&(e.newSettingData=t.data,e.isAddScheduling=!0):e.$toast(t.message)}}),Object(c.e)({url:"/api/mentality/scheduling/timeSetting?type="+this.schedulingType+"&campus="+this.selectCampus,dataType:"json",type:"get",success:function(t){if(t.state){if(t.data)for(var a in e.timeQuantumArray=[],t.data){var s=t.data[a];e.timeQuantumArray.push({id:s.id,timeQuantum:s.timeQuantumStart+"-"+s.timeQuantumEnd})}}else e.$toast(t.message)}}),setTimeout(function(){var a=t(".add-scheduling-page").height();e.scrollHeight=a-t(".addScheduling-header").height()},100)},_selectTabelCell:function(t){this.selectedTabelCells=t},_editConsultant:function(t){var e=this;this.showEditModal=!0,this.isUpdateNext=!1,this.hideToStu=!!t.data.dayTimeTeacher[0]&&!t.data.dayTimeTeacher[0].isVisual;var a=JSON.parse(i()(t.data.dayTimeTeacher));this.consultantArr=[],this.dataTimeId=t.data.id,this.changeDate=t.data.dateTime,a.forEach(function(t,a){e.consultantArr.push({userId:t.user.teacherBaseInfo.userId,name:t.user.teacherBaseInfo.name})})},_getWeekTime:function(t){t&&(this.weekTime=t,this.selectCampus&&this._initTableData(t))},_initTableData:function(t){var e=this;Object(c.e)({url:"/api/mentality/scheduling/page/week?campus="+this.selectCampus+"&type="+this.schedulingType+"&dateStart="+t.dateStart+"&dateEnd="+t.dateEnd,dataType:"json",type:"get",success:function(t){t.state?t.data&&t.data.length>0?e.schedulingData=t.data:e.schedulingData=[]:e.$toast(t.message)}}),Object(c.e)({url:"/api/mentality/scheduling/timeSettings/thisWeek?type="+this.schedulingType+"&campus="+this.selectCampus+"&dateStart="+t.dateStart+"&dateEnd="+t.dateEnd,dataType:"json",type:"get",success:function(t){if(t.state)if(t.data&&t.data.length>0)for(var a in e.timeQuantumArray=[],t.data){var s=t.data[a];e.timeQuantumArray.push({id:s.id,timeQuantum:s.timeQuantumStart+"-"+s.timeQuantumEnd})}else e.timeQuantumArray=[];else e.$toast(t.message)}})},submitAddScheduling:function(){var t=this,e=[];return 0===this.selectedTabelCells.length?this.$toast("请选择时间段"):this.consultantId?(this.selectedTabelCells.forEach(function(t,a){e.push({dayOfWeek:t.tablex,timeSetting:{id:t.timeSettingId}})}),void Object(c.e)({url:"/api/mentality/scheduling/teachers",dataType:"json",type:"post",data:{campus:this.selectCampus,type:this.schedulingType,userId:this.consultantId,dayTimes:e,isVisual:!this.addhideToStu},success:function(e){e.state?(t.$toast("新增成功"),t.isAddScheduling=!1):t.$toast(e.message)}})):this.$toast("请先检索咨询师")},selectScheduling:function(){this.isUpdateNext=!this.isUpdateNext},sumbitEditConsultant:function(){var t=this,e=[];this.consultantArr.forEach(function(t,a){e.push({user:{teacherBaseInfo:{userId:t.userId}}})}),Object(c.e)({url:"/api/mentality/scheduling/dayTimeTeachers",dataType:"json",type:"post",data:{dataTimeId:this.dataTimeId,isUpdateNext:this.isUpdateNext,changeDate:this.changeDate,dayTimeTeachers:e,isVisual:!this.hideToStu},success:function(e){e.state?(t.$toast("编辑成功"),t._initTableData(t.weekTime),t.showEditModal=!1):t.$toast(e.message)}})},deleteConsultant:function(t){var e=this;this.consultantArr.forEach(function(a,s){a.userId===t.userId&&e.consultantArr.splice(s,1)})},_showSettingModal:function(){var t=this;this.settingData={schedulingId:"",startTime:"",endTime:"",timeList:[{timeId:"timeId",timeQuantumStart:"",timeQuantumEnd:""}]},Object(c.e)({url:"/api/mentality/scheduling?campus="+this.selectCampus+"&type="+this.schedulingType,dataType:"json",type:"get",success:function(e){e.state?e.data?(t.schedulingSettingType="edit",t.settingData={schedulingId:e.data.id,startTime:e.data.startTime,endTime:e.data.endTime,timeList:[]},e.data.timeSetting.forEach(function(e,a){0===a?t.settingData.timeList.push({id:e.id,timeId:"timeId",timeQuantumStart:e.timeQuantumStart,timeQuantumEnd:e.timeQuantumEnd}):t.settingData.timeList.push({id:e.id,timeId:"time_"+e.id,timeQuantumStart:e.timeQuantumStart,timeQuantumEnd:e.timeQuantumEnd})})):t.schedulingSettingType="add":t.$toast(e.message)}}),this.showSettingModal=!0},_deleteTime:function(t){var e=this;this.settingData.timeList.forEach(function(a,s){t.timeId===a.timeId&&e.settingData.timeList.splice(s,1)})},_addTime:function(){this.settingData.timeList.push({timeId:"time_"+Object(c.a)(),timeQuantumStart:"",timeQuantumEnd:""})},startTimeSelected:function(t){var e=this;if(this.settingData.endTime){if(new Date(t.value).getTime()-new Date(this.settingData.endTime).getTime()>0)return this.$nextTick(function(){e.$toast("排班开始日期要在排班结束日期之前"),e.settingData.startTime=""}),!1;this.settingData.startTime=t.value}else this.settingData.startTime=t.value},endTimeSelected:function(t){var e=this;if(this.settingData.startTime){if(new Date(t.value).getTime()-new Date(this.settingData.startTime).getTime()<0)return this.$nextTick(function(){e.$toast("排班结束日期要在排班开始日期之后"),e.settingData.endTime=""}),!1;this.settingData.endTime=t.value}else this.settingData.endTime=t.value},sumbitSetting:function(){var t=this;this.settingData.startTime=/\d{4}-\d{1,2}-\d{1,2}/g.exec(this.settingData.startTime)[0],this.settingData.endTime=/\d{4}-\d{1,2}-\d{1,2}/g.exec(this.settingData.endTime)[0];var e="",a={};"add"===this.schedulingSettingType?(e="post",a={startTime:this.settingData.startTime,endTime:this.settingData.endTime,campus:this.selectCampus,type:this.schedulingType,timeSetting:this.settingData.timeList}):(e="put",a={id:this.settingData.schedulingId,startTime:this.settingData.startTime,endTime:this.settingData.endTime,campus:this.selectCampus,type:this.schedulingType,timeSetting:this.settingData.timeList}),Object(c.e)({url:"/api/mentality/scheduling",dataType:"json",type:e,data:a,success:function(e){e.state?(t.$toast("设置成功"),t.showSettingModal=!1):t.$toast(e.message)}})},addSchedulingAfterSelected:function(t){this.consultantId=t.userId,this.userIdAndUserName=t.name+" ("+t.userNo+")",this.isShowSearch=!1},editConsultantAfterSelected:function(t){var e=this,a=!0;this.consultantArr.forEach(function(s,i){if(t.userId===s.userId)return e.$toast("该咨询师已在列表上"),void(a=!1)}),a&&this.consultantArr.push({name:t.name,userId:t.userId})},checkTimeQuantumStart:function(t,e){if(!/^([01]\d|2[0123]):([0-5]\d|59)$/.test(t))return this.$toast("开始时间格式不对"),void this.settingData.timeList.forEach(function(t,a){e===a&&(t.timeQuantumStart="")})},checkTimeQuantumEnd:function(t,e){if(!/^([01]\d|2[0123]):([0-5]\d|59)$/.test(t))return this.$toast("结束时间格式不对"),void this.settingData.timeList.forEach(function(t,a){e===a&&(t.timeQuantumEnd="")})}}}}).call(e,a("7t+N"))}});