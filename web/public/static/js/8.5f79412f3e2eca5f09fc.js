webpackJsonp([8],{"4mkp":function(e,s){},BrgE:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var i=t("3cXf"),a=t.n(i),n=t("IvJb"),r=t("L7Pj"),o=t.n(r),c=t("C331"),l={props:{departmentId:{default:"1"},appId:{required:!0,default:""},readonly:{default:!1}},created:function(){var e=this,s=localStorage.getItem("lang");Object(c.e)(s)&&(this.lang=s),this.nowTime=(new Date).getTime(),this.backgroundList=[{id:0,background:"linear-gradient(-135deg, #7553E1 0%, #5223DC 100%)"},{id:1,background:"linear-gradient(-135deg, #5067D7 0%, #3F53B8 100%)"},{id:2,background:"linear-gradient(-135deg, #5572FA 0%, #4060FA 100%)"},{id:3,background:"linear-gradient(-135deg, #19AC9D 0%, #159687 100%)"},{id:4,background:"linear-gradient(-135deg, #5AC15F 0%, #49AE4E 100%)"},{id:5,background:"linear-gradient(-135deg, #658899 0%, #4E7384 100%)"},{id:6,background:"linear-gradient(-135deg, #8C6E64 0%, #785549 100%)"}],this.iconList=[{id:0,name:"school"},{id:1,name:"accessibility"},{id:2,name:"account_balance"},{id:3,name:"account_balance_wallet"},{id:4,name:"account_circle"},{id:5,name:"alarm"},{id:6,name:"assignment"},{id:7,name:"book"},{id:8,name:"build"},{id:9,name:"description"},{id:10,name:"explore"},{id:11,name:"extension"},{id:12,name:"face"},{id:13,name:"favorite"},{id:14,name:"flight_land"},{id:15,name:"flight_takeoff"},{id:16,name:"get_app"},{id:17,name:"grade"},{id:18,name:"language"},{id:19,name:"launch"},{id:20,name:"loyalty"},{id:21,name:"perm_contact_calendar"},{id:22,name:"receipt"},{id:23,name:"question_answer"},{id:24,name:"restore"},{id:25,name:"room"},{id:26,name:"schedule"},{id:27,name:"search"},{id:28,name:"shopping_cart"},{id:29,name:"swap_horiz"},{id:30,name:"theaters"},{id:31,name:"update"},{id:32,name:"verified_user"},{id:33,name:"work"},{id:34,name:"visibility"},{id:35,name:"equalizer"},{id:36,name:"business"},{id:37,name:"call"},{id:38,name:"chat"},{id:39,name:"email"},{id:40,name:"create"},{id:41,name:"flag"},{id:42,name:"save"},{id:43,name:"link"},{id:44,name:"send"},{id:45,name:"devices"},{id:46,name:"attach_file"},{id:47,name:"format_quote"},{id:48,name:"cloud"},{id:49,name:"folder"},{id:50,name:"computer"},{id:51,name:"headset"},{id:52,name:"security"},{id:53,name:"sim_card"},{id:54,name:"watch"},{id:55,name:"add_a_photo"},{id:56,name:"camera_alt"},{id:57,name:"directions_railway"},{id:58,name:"directions_bike"},{id:59,name:"local_activity"},{id:60,name:"directions_walk"},{id:61,name:"local_dining"},{id:62,name:"local_hospital"},{id:63,name:"local_library"},{id:64,name:"event_note"},{id:65,name:"map"},{id:66,name:"navigation"},{id:67,name:"wifi"},{id:68,name:"ac_unit"},{id:69,name:"fitness_center"},{id:70,name:"pool"},{id:71,name:"cake"},{id:72,name:"group"},{id:73,name:"location_city"},{id:74,name:"notifications"},{id:75,name:"person"},{id:76,name:"poll"},{id:77,name:"public"},{id:78,name:"share"},{id:79,name:"whatshot"}],this.appState.columns=[{id:"name",title:"姓名",width:200,className:"text-left",hidden:!1},{id:"userNo",title:this.numberDesc,width:200,className:"text-left",hidden:!1,formatter:function(s,t){return"3"===e.curApp.appType.userType?s.account:s.userNo}},{id:"collegeName",title:"学院",width:250,className:"text-left",hidden:!1},{id:"grade",title:"年级",width:100,className:"text-left",hidden:!1},{id:"studentType",title:"学生类型",width:150,className:"text-left",hidden:!0},{id:"inSchoolValue",title:"在校状态",width:150,className:"text-left",hidden:!1},{id:"studentTypeValue",title:"学生类型",width:150,className:"text-left",hidden:!1}],this.appState.inSchoolOptions=[{id:0,label:"不限制"},{id:1,label:"在校"},{id:2,label:"不在校"}],this.appState.infoTypes=[{id:"base",name:"基本信息"},{id:"faceTo",name:"面向人员"},{id:"timeSet",name:"时间设置"},{id:"description",name:"办理指南"},{id:"records",name:"办理记录"}];for(var t=(new Date).getFullYear(),i=t+3;i>t-5;i--)this.appState.gradeOptions.push({id:i+"",label:i+"-"+(i+1)+"学年"});for(var a=t+3;a>t-5;a--)this.appState.gradeOptions2.push({id:a+"",label:a+"级"});Object(c.c)({url:"/api/relationship/getSelectOptions",dataType:"json",type:"get",success:function(s){var t=s.data;s.state&&(e.collegeOptions=t.colleges||[],e.gradeOptions=t.grades||[])}}),this._initAppInfo()},data:function(){return{iconList:["business","assignment","school","person_pin_circle","person_pin","people","local_library","tag_faces","favorite"],saasIconList:["road","book","camera","idcard","tuition","bankcard","list","text","help","layer","package","cap","letter","calendar","menu","menu2","menu3","apply","info","rightcard","drippower","bulb","record","direction","person","envelope","reduce","socialist","star","assets","notebook","location","purse","remark","statisticsbar","building","geography","rotate","manlove","medal","pick","purse2","free","tag","menudone","travel","trophy","medal2","question","excellent","search"],formList:[],curApp:{name:"点击右侧按钮编辑应用名称",imgPath:"",imgType:"1",remark:"应用说明"},nameChangeMsg:"",descChangeMsg:"",appState:{editPart:"",showFormModal:!1,showFlowModal:!1,infoType:"base",flowName:"",formName:"",modelId:"",infoTypes:[],columns:[],recordColumns:[],inSchoolOptions:[],gradeOptions:[],gradeOptions2:[],flowData:{id:"",chart:{}},background:"linear-gradient(-135deg, #5067D7 0%, #3F53B8 100%)"},editorConfig:{initialFrameHeight:520},businessList:[],leftIconShow:!1,rightIconShow:!1,curBusiness:null,curTimeNode:null,timeSet:null,errorMsg:"",nowTime:"",defineSearch:{userNo:"",name:"",status:"",collegeCode:"",grade:""},collegeOptions:[],gradeOptions:[],preview:!1,previewObj:{formData:null,authorities:null,recordData:[],log:null,curBusinessId:"",appId:""},importParams:{parentPageTitle:"人员列表",downloadTemplateUrl:"/app/business/studentExcelTemplate",downloadErrorTemplateUrl:"/app/business/errorBusinessStudentExcel",checkTemplateUrl:"",templateName:"面向人员名单导入模板",importBtnType:null},showImportModal:!1,overriteImport:"覆盖导入",incrementImport:"增量导入",resultMessageJson:{overtime:"申请在{{node}}节点超时",rescissory:"申请者取消申请",disable:"业务期停用，表单废弃",success:"申请已通过",fail:"申请在{{node}}节点不通过",end:"已结束",submit:"待{{node}}节点审核",agree:"待{{node}}节点审核",reject:"申请被驳回至{{node}}节点",countermand:"申请被撤回至{{node}}节点"},timestamp:"",newName:"",releaseBusinessDisabled:!1,annoreleaseBusinessText:"",numberDesc:"",showTime:!1,showIconModal:!1,backgroundList:[],outputList:[],exportFiledArr:[],notAllowOutput:["label","splitLine","attachment"],outputModalShow:!1,formFields:[],reviseSetTimeOut:null,clickCount:0,isReviseBusiness:!1,isReviseData:!1,isChangeGuideInfo:!1,reviseMark:!1,businessTimer:null,blankTemplateId:"",faceToPeopleType:["3","4"],lang:"zh-cn"}},computed:{host:function(){return window.location.host},initDataOfChart:function(){var e=null;return this.appState.flowData.chart&&this.appState.flowData.chart.nodes&&this.appState.flowData.chart.nodes.length>0&&(e={},this.appState.flowData.chart.nodes.forEach(function(s,t){e[s.id]=s})),e},businessIsOn:function(){var e=this,s=!1;return this.curBusiness&&this.businessList.forEach(function(t){t.business.id!==e.curBusiness.business.id&&t.business.isPublic&&t.business.isEnable&&(s=!0)}),s},peopleUrl:function(){return"/table-data/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/users/page?timestamp="+this.timestamp},inputStyleWidth:function(){return this.curApp.name.length<=20?34*this.curApp.name.length:27*this.curApp.name.length},rowsNumber:function(){return this.curApp.remark?this.curApp.remark.length>62&&this.curApp.remark.length<=124?2:this.curApp.remark.length>124&&this.curApp.remark.length<=186?3:this.curApp.remark.length>186?4:1:1}},mounted:function(){},watch:{appId:function(){this._initAppInfo()},errorMsg:function(){var e=this;setTimeout(function(){e.errorMsg=""},1500)},curBusiness:function(){this.curBusiness&&this._loadBusinessTime()},curApp:function(){var e="学号";this.curApp&&this.curApp.appType&&("1"===this.curApp.appType.userType?e="学号":"2"===this.curApp.appType.userType?e="教工号":"3"===this.curApp.appType.userType?e="新生账号":"4"===this.curApp.appType.userType&&(e="学工号")),"4"!==this.curApp.appType.userType?this.appState&&this.appState.columns&&this.appState.columns[1]&&n.a.set(this.appState.columns[1],"title",e):this.appState.columns=[{id:"name",title:"姓名",width:200,className:"text-left",hidden:!1},{id:"userNo",title:"学工号",width:200,className:"text-left",hidden:!1},{id:"collegeName",title:"学院",width:250,className:"text-left",hidden:!1}],this.appState&&this.appState.recordColumns&&this.appState.recordColumns[1]&&n.a.set(this.appState.recordColumns[1],"title",e),this.numberDesc=e}},methods:{_initAppInfo:function(){var e=this;this._initCurApp(function(){e._initBusinessList(),e._initFlowChart()})},_initColumns:function(){var e=this;"4"===this.curApp.appType.userType?this.appState.recordColumns=[{id:"userNo",title:this.numberDesc,width:150,className:"text-left",hidden:!1,search:{type:"input",data:{}},formatter:function(s,t){return"3"===e.curApp.appType.userType?(e.appState.recordColumns[0].id="account",s.applicant.account):s.applicant.userNo}},{id:"name",title:"姓名",width:100,className:"text-left",hidden:!1,search:{type:"input",data:{placeholder:"请输入姓名"}},formatter:function(e,s){return e.applicant.name}},{id:"college",title:"学院",width:150,className:"text-left",hidden:!1,formatter:function(e,s){return e.applicant.collegeCode}},{id:"createTime",title:"发起时间",width:200,search:{type:"datetime",data:{dateFormat:"yyyy-MM-dd hh:ii:ss"}},className:"text-left",hidden:!1},{id:"status",title:"状态",width:150,className:"text-left",hidden:!1,formatter:function(s,t){var i="";return"pending"===s.status.toLowerCase()?i=e.resultMessageJson[s.lastAction]?e.resultMessageJson[s.lastAction].replace("{{node}}",s.currentNode.name):"":"end"===s.status.toLowerCase()&&(i=e.resultMessageJson[s.result.toLowerCase()]?e.resultMessageJson[s.result.toLowerCase()].replace("{{node}}",s.currentNode.name):""),i}},{title:"操作",width:50,className:"text-center",hidden:!1,formatter:function(e,s){var t=this;return[{tag:"a",text:"查看",callback:function(e,s){t.previewObj.curBusinessId=e.businessId,t.previewObj.appId=e.appId,t._getLog(e.id,function(e){t.previewObj.log=e||null}),t._getAuthorityData(e.id,function(e){t.previewObj.authorities=e||[]}),t._getFormLayout(e.businessId,e.currentNode.id,function(s){t.previewObj.formData=s,t.previewObj.formData.components.forEach(function(e){n.a.set(e,"x",e.location.left),n.a.set(e,"y",e.location.top),n.a.set(e,"w",e.size.width),n.a.set(e,"h",e.size.height)}),t._getInitData(e.id,function(e){t.previewObj.recordData=e,t.preview=!0})})}}]}}]:this.appState.recordColumns=[{id:"userNo",title:this.numberDesc,width:150,className:"text-left",hidden:!1,search:{type:"input",data:{}},formatter:function(s,t){return"3"===e.curApp.appType.userType?(e.appState.recordColumns[0].id="account",s.applicant.account):s.applicant.userNo}},{id:"name",title:"姓名",width:150,className:"text-left",hidden:!1,search:{type:"input",data:{placeholder:"请输入姓名"}},formatter:function(e,s){return e.applicant.name}},{id:"grade",title:"年级",width:80,className:"text-left",hidden:!1,search:{type:"input",data:{placeholder:"请输入年级"}},formatter:function(e,s){return e.applicant.grade}},{id:"createTime",title:"发起时间",width:200,search:{type:"datetime",data:{dateFormat:"yyyy-MM-dd hh:ii:ss"}},className:"text-left",hidden:!1},{id:"status",title:"状态",width:150,className:"text-left",hidden:!1,formatter:function(s,t){var i="";return"pending"===s.status.toLowerCase()?i=e.resultMessageJson[s.lastAction]?e.resultMessageJson[s.lastAction].replace("{{node}}",s.currentNode.name):"":"end"===s.status.toLowerCase()&&(i=e.resultMessageJson[s.result.toLowerCase()]?e.resultMessageJson[s.result.toLowerCase()].replace("{{node}}",s.currentNode.name):""),i}},{title:"操作",width:50,className:"text-center",hidden:!1,formatter:function(s,t){return[{tag:"a",text:"查看",callback:function(s,t){e.previewObj.curBusinessId=s.businessId,e.previewObj.appId=s.appId,e._getLog(s.id,function(s){e.previewObj.log=s||null}),e._getAuthorityData(s.id,function(s){e.previewObj.authorities=s||[]}),e._getFormLayout(s.businessId,s.currentNode.id,function(t){e.previewObj.formData=t,e.previewObj.formData.components.forEach(function(e){n.a.set(e,"x",e.location.left),n.a.set(e,"y",e.location.top),n.a.set(e,"w",e.size.width),n.a.set(e,"h",e.size.height)}),e._getInitData(s.id,function(s){e.previewObj.recordData=s,e.preview=!0})})}}]}}]},_initImportTpl:function(){this.curApp&&this.curApp.appType&&"3"===this.curApp.appType.userType&&(this.importParams.downloadTemplateUrl="/app/business/freshmanExcelTemplate")},_releaseApp:function(){var e=this,s="post",t="应用发布后将对用户可见，确定发布吗？",i="发布成功";this.curApp.isPublished&&(s="delete",t="应用下架后将对用户不可见，确定下架吗？",i="下架成功"),confirm(t)&&Object(c.c)({url:"/api/app/"+this.curApp.id+"/public",type:s,success:function(s){s.state?(e.curApp.isPublished=!e.curApp.isPublished,e.$toast(i)):e.$toast(s.message)}})},_limitLength:function(e){this.curApp.name=this._getStrByteLimit(e.target.value,50)},_saveAppName:function(){var e=this;this.curApp.name?Object(c.c)({url:"/api/app/"+this.curApp.id+"/name",type:"put",data:{name:this.curApp.name},success:function(s){s.state?(e.$emit("update",e.curApp),e.nameChangeMsg="修改成功",setTimeout(function(){e.nameChangeMsg=""},2e3)):e.nameChangeMsg="出错啦："+s.message}}):this.nameChangeMsg="出错啦：名称不能为空"},_saveAppDesc:function(){var e=this;Object(c.c)({url:"/api/app/"+this.curApp.id+"/remark",type:"put",data:{remark:this.curApp.remark},success:function(s){s.state?(e.$emit("update",e.curApp),e.descChangeMsg="修改成功",setTimeout(function(){e.descChangeMsg=""},2e3)):e.descChangeMsg="出错啦："+s.message}})},_saveAppIcon:function(){var e=this;Object(c.c)({url:"/api/app/"+this.curApp.id+"/style",type:"put",data:{imgPath:this.appState.imgPath,imgType:this.appState.imgType,background:this.appState.background},success:function(s){s.state?(e._savePart("imgPath"),e._savePart("imgType"),e._savePart("background"),e.$emit("update",e.curApp),e.showIconModal=!1):e.$toast(s.message)}})},_getLog:function(e,s){var t=this;Object(c.c)({url:"/api/processEngine/processInstances/"+e+"/handleLogs",type:"get",success:function(e){e.state?s(e.data):t.$toast(e.message)}})},_getInitData:function(e,s){var t=this;Object(c.c)({url:"/api/processEngine/processInstances/"+e,type:"get",success:function(e){e.state?s(e.data):t.$toast(e.message)}})},_getAuthorityData:function(e,s){var t=this;Object(c.c)({url:"/api/processEngine/processInstances/"+e+"/operations",type:"get",success:function(e){e.state?s(e.data):t.$toast(e.message)}})},_getFormLayout:function(e,s,t){var i=this;Object(c.c)({url:"/api/processEngine/business/"+e+"/formRenderData?nodeId="+s,type:"get",success:function(e){e.state?t(e.data):i.$toast(e.message)}})},_changeBusinessGuide:function(e){this.curBusiness.business.guide=e,this.isChangeGuideInfo=!0},_stateSearch:function(e){this.$refs.recordsTable.tableSearchFields.status=e.val},_tabClick:function(e){var s=this;this.isChangeGuideInfo&&(this.reviseMark?this.isReviseData=!1:this.isReviseData=!0),this.appState.infoType=e.id,this._loadBusinessTime(),"timeSet"===e.id?setTimeout(function(){s.$refs.timeSet.refresh()},500):"records"===e.id&&this._initColumns(),this.importParams.checkTemplateUrl="/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/excel",this.importParams.importBtnType=[{name:this.overriteImport,url:"/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/excel",method:"put",isShowBtn:!0,success:function(e){e.state&&(s.timestamp=new Date)}}]},_changeBusiness:function(e){this.curBusiness=e,this.showImportModal=!1,this.isReviseBusiness=!1,this._getFormFields(this.curBusiness.business.id)},_back:function(){this.$emit("back",this.curApp),this.businessTimer&&clearInterval(this.businessTimer)},_initFlowChart:function(){var e=this;Object(c.c)({url:"/api/apps/"+this.appId+"/settings/flows",type:"get",success:function(s){s.state?s.data&&(e.appState.flowData.id=s.data.id,e.appState.flowData.chart=s.data.chart):e.$toast(s.message)}})},_initFormList:function(){var e=this;""!==this.appId?Object(c.c)({type:"get",url:"/api/departments/"+this.departmentId+"/apps/forms?userType="+this.curApp.appType.userType,success:function(s){s.state?e.formList=s.data:e.$toast(s.message)}}):this.formList=[]},_getFormName:function(e){var s=this;Object(c.c)({url:"/api/apps/"+this.appId+"/settings/forms",type:"get",success:function(e){e.state?e.data&&(s.appState.formName=e.data.name):s.$toast(e.message)}})},_getFlowName:function(e){var s=this;Object(c.c)({url:"/api/apps/"+this.appId+"/settings/flows",type:"get",success:function(e){e.state?e.data&&e.data.settings&&(s.appState.flowName=e.data.settings.name):s.$toast(e.message)}})},_initCurApp:function(e){var s=this;Object(c.c)({type:"get",url:"/api/app/"+this.appId,success:function(t){t.state?(s.curApp=t.data,s.$set(s.appState,"imgType",s.curApp.imgType),s._initFormList(),s._getFormName(),s._getFlowName(),s.curApp&&s.curApp.appType&&("4"===s.curApp.appType.userType?s.blankTemplateId="5c00b20c72877c31752fc75c":s.blankTemplateId="5ae147c265249c38288e9f00"),e&&e()):s.$toast(t.message)}})},_initBusinessList:function(){var e=this;Object(c.c)({type:"get",url:"/api/app/"+this.appId+"/business",success:function(s){s.state?(e.businessList=s.data,e.businessList.forEach(function(s,t){s.business.isPublic&&s.business.isEnable&&(e.curBusiness=s,e._scrollToBusiness(t),e._getFormFields(e.curBusiness.business.id),e.businessTimer&&clearInterval(e.businessTimer)),s.business.isPublishing&&(e.releaseBusinessDisabled=!0,e.annoreleaseBusinessText=e.translate.announcing)})):e.$toast(s.message)}})},_releaseBusiness:function(e){var s=this;if("release"===e){if(this.releaseBusinessDisabled)return;if(!confirm("确认发布本业务吗？业务期一旦开启，为保证申请的正常进行，系统将自动锁定该业务期所关联的流程及表单，业务期内将无法再对流程及表单进行编辑"))return;this.releaseBusinessDisabled=!0,this.annoreleaseBusinessText="发布中...",this._save("business",function(){Object(c.c)({url:"/api/app/"+s.appId+"/business/"+s.curBusiness.business.id+"/publish",type:"put",success:function(e){s.releaseBusinessDisabled=!1,s.annoreleaseBusinessText="",e.state?(e.data.publishing&&!e.data.published&&(s.releaseBusinessDisabled=!0,s.annoreleaseBusinessText="发布中...",s.$toast("业务期发布中，后台运行"),s.businessTimer=setInterval(function(){s._initBusinessList()},3e4)),e.data.published&&(s.curBusiness.business.isPublic=!0,s.$toast("业务期发布成功"))):"31114"===e.code?(s.releaseBusinessDisabled=!0,s.annoreleaseBusinessText="发布中...",confirm("应用未发布情况下无法发布业务期，确定同时发布应用吗？")?Object(c.c)({url:"/api/app/"+s.appId+"/business/"+s.curBusiness.business.id+"/publish?publishApp=true",type:"put",success:function(e){s.releaseBusinessDisabled=!1,s.annoreleaseBusinessText="",e.state?(s.curBusiness.business.isPublic=!0,s.curApp.isPublished=!s.curApp.isPublished,s.$toast("发布成功")):s.$toast(e.message)}}):(s.releaseBusinessDisabled=!1,s.annoreleaseBusinessText="")):s.$toast(e.message)}})})}else confirm("确定要停止此业务期吗？停止后，此业务期的所有数据将作废且不可恢复")&&this._stopOrRemove("stop")},_removeBusiness:function(e){confirm("确定删除该业务期？")&&this._stopOrRemove("remove",e)},_stopOrRemove:function(e,s){var t=this,i="stop"===e?this.curBusiness.business.id:this.businessList[s].business.id;i?Object(c.c)({url:"/api/app/"+this.appId+"/business/"+i,type:"delete",success:function(a){a.state?(t.$toast("操作成功"),"stop"===e?t.curBusiness.business.isEnable=!1:(t.businessList.splice(s,1),t._testIconShow(),t.curBusiness.business.id===i&&(t.curBusiness=null))):t.$toast(a.message)}}):this.businessList.splice(s,1)},_addNewBusiness:function(){if(this.curApp.setting.formId&&this.curApp.setting.flowId){var e=(new Date).getFullYear(),s=e+"-"+(e+1)+"学年"+this.curApp.name,t=s;this.creatNewName(s,t),this.appState.infoType="base",this.curBusiness={business:{name:this.newName,year:e+"",linkUrl:"",guide:"",settingId:"",businessTimeList:[],limitType:0,beginTime:"",endTime:"",isEnable:!1,isLimit:!1,isPublic:!1},flowSetting:null,formSetting:null,businessLimit:{id:"",inSchool:0,grade:0,studentType:0}},this.businessList.push(this.curBusiness),this._scrollToBusiness(this.businessList.length-1),this._save("business",function(){})}else this.$toast("请先设置该应用的表单和流程哟~")},creatNewName:function(e,s){var t=!1;this.businessList.forEach(function(i){if(i.business.name===e){t=!0;var a=e.split(s);if(a[1]){var n=parseInt(a[1])+1;e=s+n}else e=s+1}}),t?this.creatNewName(e,s):this.newName=e},_editPart:function(e){this.showIconModal=!0,this.appState.editPart=e,this.$set(this.appState,e,this.curApp[e]),this.$set(this.appState,"imgPath",this.curApp.imgPath),this.curApp.background&&this.$set(this.appState,"background",this.curApp.background),this.$set(this.appState,"imgPath",this.curApp.imgPath),this.$set(this.appState,"imgType",this.curApp.imgType)},_cancelPart:function(e){this.showIconModal=!1,this.appState.editPart="",this.appState[e]="",this.appState.background=""},_savePart:function(e,s){this.curApp[e]=this.appState[e],this.appState.editPart="",this.appState[e]=""},_setAppForm:function(){this.curApp.setting.formId?this._initWithModel():(n.a.set(this.appState,"form",this.curApp.form),this.appState.showFormModal=!0)},_setAppFlow:function(){this.$emit("setFlow",{modelId:this.curApp.setting.flowId,businessId:""}),this._save("",function(){})},_selectIcon:function(e,s){this.appState.imgPath=e.name,this.appState.imgType=s||"1"},_selectBackground:function(e){this.appState.background=e.background},_initWithModel:function(){this.$emit("setForm",{modelId:this.appState.modelId,type:this.curApp.setting.formId?"edit":"create",businessId:""}),this._save("",function(){})},_scrollLeft:function(){o()("#businessDiv").animate({scrollLeft:o()("#businessDiv").scrollLeft()-500},100),this._testIconShow()},_scrollRight:function(){o()("#businessDiv").animate({scrollLeft:o()("#businessDiv").scrollLeft()+500},100),this._testIconShow()},_scrollToBusiness:function(e){var s=this;setTimeout(function(){o()("#businessDiv").animate({scrollLeft:o()("#businessDiv").scrollLeft()+200*e},100),s._testIconShow()},300)},_testIconShow:function(){var e=this;setTimeout(function(){e.leftIconShow=o()("#businessDiv").scrollLeft()>0,e.rightIconShow=o()(".business-scroll").width()-o()("#businessDiv").scrollLeft()>o()("#businessDiv").width()},300)},_compareTime:function(e,s){var t=new Date(e[s].start).getTime(),i=new Date(e[s].end).getTime();return this.nowTime<t?0===s?"left":this.nowTime>new Date(e[s-1].end).getTime()?"left":"":this.nowTime>t&&this.nowTime<i?"center":""},_changeLimitType:function(e){this.curBusiness.business.isPublic||(this.curBusiness.business.limitType=e)},_afterSelectYear:function(e){this.curBusiness.business.year=e.val,this.isReviseData=!0},_afterSelectStuType:function(e){this.curBusiness.businessLimit||n.a.set(this.curBusiness,"businessLimit",{}),n.a.set(this.curBusiness.businessLimit,"studentType",e.val)},_afterSelectGrade:function(e){this.curBusiness.businessLimit||n.a.set(this.curBusiness,"businessLimit",{}),n.a.set(this.curBusiness.businessLimit,"grade",e.val)},_afterSelectInSchool:function(e){this.curBusiness.businessLimit||n.a.set(this.curBusiness,"businessLimit",{}),n.a.set(this.curBusiness.businessLimit,"inSchool",e.val)},_nodeSelected:function(e){var s=this;if(!this.curBusiness.business.isPublic||this.isReviseBusiness){var t=window.event||e.event;for(var i in this.curTimeNode={},e.target)n.a.set(this.curTimeNode,i,e.target[i]);this.showTime=!0,this.isReviseData=!0,setTimeout(function(){s.$date({dateFormat:"yyyy-MM-dd hh:ii:ss",value:s.curTimeNode.datetime||"",type:"init",event:t,onSelect:function(e){s._daySelectedOfValue({value:e})}})},100)}},_daySelectedOfValue:function(e){var s=this,t=this.$refs.timeSet.setDatetime(this.curTimeNode.id,e.value);t.success?this.curTimeNode=null:this.errorMsg=t.message,this.curBusiness.business.businessTimeList=[],this.$refs.timeSet.export().forEach(function(e){s.curBusiness.business.businessTimeList.push({nodeId:e.id,endDate:s.timeFormat(e.datetime,"yyyy-MM-dd hh:ii:ss"),businessId:s.curBusiness.business.id,isLimit:!1})})},timeFormat:function(e,s){if(!e)return"";var t={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"i+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(var i in/(y+)/.test(s)&&(s=s.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+i+")").test(s)&&(s=s.replace(RegExp.$1,1===RegExp.$1.length?t[i]:("00"+t[i]).substr((""+t[i]).length)));return s},_loadBusinessTime:function(){var e=this;if(!this.curBusiness.business.businessTimeList||0===this.curBusiness.business.businessTimeList.length){if(this.curBusiness.business.businessTimeList=[],!this.appState.flowData.chart.nodes)return!1;this.appState.flowData.chart.nodes.forEach(function(s){"start"!==s.type&&"process"!==s.type||e.curBusiness.business.businessTimeList.push({nodeId:s.id,endDate:"",businessId:e.curBusiness.business.id,isLimit:!1})})}setTimeout(function(){e.$refs.timeSet&&e.$refs.timeSet.load(e._getDatetimeArr(e.curBusiness.business.businessTimeList))},500)},_getDatetimeArr:function(e){var s=[];return e.forEach(function(e){s.push({id:e.nodeId,datetime:e.endDate})}),s},_save:function(e,s){var t=this;if("business"===e){var i=this.curBusiness.business.id?this.$refs.timeSet.exportBeginEndTime():{},a=this.curBusiness.business.id?"put":"post",r="/api/app/"+this.appId+"/business"+(this.curBusiness.business.id?"/"+this.curBusiness.business.id:"");this.curBusiness.business.beginTime=i.beginTime?this.timeFormat(i.beginTime,"yyyy-MM-dd hh:ii:ss"):"",this.curBusiness.business.endTime=i.endTime?this.timeFormat(i.endTime,"yyyy-MM-dd hh:ii:ss"):"","put"===a&&(r+="?formId="+this.curBusiness.formId+"&flowId="+this.curBusiness.flowId),Object(c.c)({url:r,type:a,data:this.curBusiness,success:function(e){if(e.state){if(e.data.business.id&&!t.curBusiness.business.id)for(var i in e.data)n.a.set(t.curBusiness,i,e.data[i]);s?s():t.$toast("业务期保存成功")}else t.$toast(e.message)}})}},showImportPage:function(){this._initImportTpl(),this.showImportModal=!0},backParentPage:function(){this.showImportModal=!1},exportUserInfo:function(){window.location.href="/downloads/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/excel?fileName="+this.curBusiness.business.name+".xlsx"},_changeOutputList:function(e){var s=this,t=this.outputList.indexOf(e.name);t>=0?(this.outputList.splice(t,1),"signature"!==e.componentType&&"image"!==e.componentType||this.exportFiledArr.forEach(function(t,i){t.name===e.name&&s.exportFiledArr.splice(i,1)})):(this.outputList.push(e.name),"signature"!==e.componentType&&"image"!==e.componentType||this.exportFiledArr.push({name:e.name,title:e.title}))},_showOutPutModal:function(){this.outputModalShow=!0},_getFormFields:function(e){var s=this;Object(c.c)({url:"/api/processEngine/business/"+e+"/formSetting/fields",type:"get",success:function(e){e.state?s.formFields=e.data:s.$toast(e.message)}})},_sureToOutput:function(){var e=this,s=[],t=[];(s=JSON.parse(a()(this.outputList))).forEach(function(e,t){(e.indexOf("image")>=0||e.indexOf("signature")>=0)&&s.splice(t,1)}),this.exportFiledArr.forEach(function(e){(e.name.indexOf("image")>=0||e.name.indexOf("signature")>=0)&&t.push(e)});var i=[];if(s.length>0){var n="";this.curApp&&this.curApp.appType&&(n="3"===this.curApp.appType.userType?"/downloads/processEngine/business/"+this.curBusiness.business.id+"/processInstances/excel?fileName="+this.curBusiness.business.name+".xlsx&userNo=&account="+(this.$refs.recordsTable.tableSearchFields.userNo||"")+"&name="+(this.$refs.recordsTable.tableSearchFields.name||"")+"&grade="+(this.$refs.recordsTable.tableSearchFields.grade||"")+"&status="+(this.$refs.recordsTable.tableSearchFields.status||"")+"&exportFields="+this.outputList:"/downloads/processEngine/business/"+this.curBusiness.business.id+"/processInstances/excel?fileName="+this.curBusiness.business.name+".xlsx&userNo="+(this.$refs.recordsTable.tableSearchFields.userNo||"")+"&account=&name="+(this.$refs.recordsTable.tableSearchFields.name||"")+"&grade="+(this.$refs.recordsTable.tableSearchFields.grade||"")+"&status="+(this.$refs.recordsTable.tableSearchFields.status||"")+"&exportFields="+this.outputList),i.push(n)}t.forEach(function(s){var t="";e.curApp&&e.curApp.appType&&(t="3"===e.curApp.appType.userType?"/downloads/processEngine/business/"+e.curBusiness.business.id+"/processInstances/images?fileName="+s.title+".zip&userNo=&account="+(e.$refs.recordsTable.tableSearchFields.userNo||"")+"&name="+(e.$refs.recordsTable.tableSearchFields.name||"")+"&grade="+(e.$refs.recordsTable.tableSearchFields.grade||"")+"&status="+(e.$refs.recordsTable.tableSearchFields.status||"")+"&imageComponentName="+s.name:"/downloads/processEngine/business/"+e.curBusiness.business.id+"/processInstances/images?fileName="+s.title+".zip&userNo="+(e.$refs.recordsTable.tableSearchFields.userNo||"")+"&account=&name="+(e.$refs.recordsTable.tableSearchFields.name||"")+"&grade="+(e.$refs.recordsTable.tableSearchFields.grade||"")+"&status="+(e.$refs.recordsTable.tableSearchFields.status||"")+"&imageComponentName="+s.name),i.push(t)}),i.forEach(function(s,t){e._createIFrame(s,100*t,1e3)})},_createIFrame:function(e,s,t){setTimeout(function(){var s=o()('<iframe style="display: none;" class="multi-download"></iframe>');s.attr("src",e),o()(document.body).after(s)},s)},_openReviseBusiness:function(){var e=this;this.curBusiness.business.isPublic&&(this.clickCount++,this.reviseSetTimeOut||(this.reviseSetTimeOut=setTimeout(function(){e.clickCount>=10&&(e.isReviseBusiness=!0),e.clickCount=0,clearTimeout(e.reviseSetTimeOut),e.reviseSetTimeOut=null},3e3)))},_reviseBusinessData:function(e){this.isReviseBusiness&&(this.isReviseData&&confirm("是否保存修改的数据？不保存会丢失")&&this._reviseBusinessInfo(),"form"===e?this.$emit("setForm",{modelId:this.appState.modelId,type:this.curApp.setting.formId?"edit":"create",businessId:this.curBusiness.business.id}):this.$emit("setFlow",{modelId:this.curApp.setting.flowId,businessId:this.curBusiness.business.id}))},_changeBusinessName:function(){this.isReviseData=!0},_reviseBusinessInfo:function(){var e=this,s={name:this.curBusiness.business.name,year:this.curBusiness.business.year,guide:this.curBusiness.business.guide,businessTimeList:[]},t=this.curBusiness.business.id?this.$refs.timeSet.exportBeginEndTime():{};this.curBusiness.business.beginTime=t.beginTime?this.timeFormat(t.beginTime,"yyyy-MM-dd hh:ii:ss"):"",this.curBusiness.business.endTime=t.endTime?this.timeFormat(t.endTime,"yyyy-MM-dd hh:ii:ss"):"",this.curBusiness.business.businessTimeList.forEach(function(e){s.businessTimeList.push({nodeId:e.nodeId,startDate:null,endDate:e.endDate})}),Object(c.c)({url:"/api/app/"+this.appId+"/publishBusiness/"+this.curBusiness.business.id,type:"put",data:s,success:function(s){s.state?(e.$toast("业务期保存成功"),e.isReviseData=!1,e.reviseMark=!0):e.$toast(s.message)}})},_export:function(){window.location.href="/downloads/app/"+this.appId+"/export"}}},p={render:function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("GeminiScrollbar",{attrs:{scrollX:!1,id:"appInfo"}},[t("div",{staticClass:"header"},[t("i",{staticClass:"maticon pull-left back-link",domProps:{innerHTML:e._s(e.icons("arrow_back"))},on:{click:e._back}},[e._v("arrow_back")]),e._v(" "),t("a",{staticClass:"pull-right app-release",attrs:{href:"javascript:;"},on:{click:e._releaseApp}},[e.curApp.isPublished?t("span",[e._v("下架")]):t("span",[e._v("发布")])]),e._v(" "),t("div",{staticClass:"pull-right release-app",on:{click:e._export}},[e._v("导出")]),e._v(" "),t("div",{staticClass:"title-div"},[t("div",{staticClass:"app-icon-div"},[t("i",{staticClass:"maticon edit-icon",domProps:{innerHTML:e._s(e.icons("edit"))},on:{click:function(s){e._editPart("icon")}}},[e._v("edit")]),e._v(" "),t("div",{style:{"background-image":e.curApp.background}},[e.curApp.imgType&&"1"!==e.curApp.imgType?"2"===e.curApp.imgType?t("i",{staticClass:"app-icon"},[t("span",{staticClass:"saasicon-44px",class:["saasicon-44px-"+e.curApp.imgPath]})]):e._e():t("i",{staticClass:"maticon app-icon",domProps:{innerHTML:e._s(e.icons(e.curApp.imgPath))}},[e._v(e._s(e.curApp.imgPath))])])]),e._v(" "),t("div",{staticClass:"input-group app-name-div info-value",style:{width:e.inputStyleWidth+"px"}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.curApp.name,expression:"curApp.name"}],staticClass:"form-control",attrs:{type:"text",placeholder:"设置应用名称(25字以内)"},domProps:{value:e.curApp.name},on:{input:[function(s){s.target.composing||e.$set(e.curApp,"name",s.target.value)},e._limitLength],change:e._saveAppName}}),e._v(" "),t("div",[t("a",{staticClass:"apartment-link",attrs:{href:"javascript:;"}},[e._v(e._s(e.curApp.department&&e.curApp.department.name))])])]),e._v(" "),e.nameChangeMsg?t("p",{staticClass:"save-tip text-center",class:e.nameChangeMsg.indexOf("出错啦")>=0?"error":""},[e._v(e._s(e.nameChangeMsg))]):e._e(),e._v(" "),t("div",{staticClass:"form-flow-set"},[t("span",{staticClass:"info-set",on:{click:e._setAppForm}},[e._v("表单："+e._s(e.appState.formName||"请设置"))]),e._v(" "),e.appState.formName?t("span",{staticClass:"info-connect"}):e._e(),e._v(" "),e.appState.formName?t("span",{staticClass:"info-set",on:{click:e._setAppFlow}},[e._v("流程："+e._s(e.appState.flowName||"请设置"))]):e._e()]),e._v(" "),t("div",{staticClass:"app-desc info-value"},[t("span",{staticClass:"count-limit"},[e._v(e._s(e.curApp.remark?e.curApp.remark.length:0)+"/200")]),e._v(" "),t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.curApp.remark,expression:"curApp.remark"}],staticClass:"desc-part",attrs:{id:"textarea",rows:e.rowsNumber,maxlength:"200",placeholder:"可以输入对该应用的简单说明，仅管理员可看到此说明"},domProps:{value:e.curApp.remark},on:{change:e._saveAppDesc,input:function(s){s.target.composing||e.$set(e.curApp,"remark",s.target.value)}}})]),e._v(" "),e.descChangeMsg?t("p",{staticClass:"save-tip text-center",class:e.descChangeMsg.indexOf("出错啦")>=0?"error":""},[e._v(e._s(e.descChangeMsg))]):e._e(),e._v(" "),t("div",[t("p",[t("strong",[e._v("应用直接访问地址：")]),e._v(" "),t("span",{staticStyle:{"user-select":"text"}},[e._v(e._s("http://"+e.host+"/"+e.$account.schoolId+"/app/"+e.curApp.id))])])])])]),e._v(" "),t("div",{staticClass:"middle"},[t("label",{staticClass:"head-label pull-left",on:{click:e._openReviseBusiness}},[e._v("业务期")]),e._v(" "),t("a",{staticClass:"add-new pull-right",attrs:{href:"javascript:;"},on:{click:e._addNewBusiness}},[e._v("新增")]),e._v(" "),e.leftIconShow?t("i",{staticClass:"maticon scroll-left",domProps:{innerHTML:e._s(e.icons("chevron_left"))},on:{click:e._scrollLeft}},[e._v("chevron_left")]):e._e(),e._v(" "),e.rightIconShow?t("i",{staticClass:"maticon scroll-right",domProps:{innerHTML:e._s(e.icons("chevron_right"))},on:{click:e._scrollRight}},[e._v("chevron_right")]):e._e(),e._v(" "),t("GeminiScrollbar",{staticClass:"business-div",attrs:{scrollY:!1,id:"businessDiv"}},[t("div",{staticClass:"business-scroll"},e._l(e.businessList,function(s,i){return t("div",{key:i,staticStyle:{display:"inline-block",position:"relative"}},[t("div",{staticClass:"mark-div",class:e._compareTime(e.businessList,i)},[t("span")]),e._v(" "),t("div",{staticClass:"business-tab",class:e.curBusiness&&s.business.name===e.curBusiness.business.name?"active":"",attrs:{title:s.business.name},on:{click:function(t){e._changeBusiness(s)}}},[e._v("\r\n            "+e._s(s.business.name)+" "),s.business.isPublic?e._e():t("i",{staticClass:"maticon remove-icon",domProps:{innerHTML:e._s(e.icons("cancel"))},on:{click:function(s){s.stopPropagation(),e._removeBusiness(i)}}},[e._v("cancel")])])])}))]),e._v(" "),e.curBusiness?t("div",{staticClass:"info-type-tabs"},e._l(e.appState.infoTypes,function(s,i){return e.curBusiness&&e.curBusiness.business.id||"base"===s.id?t("div",{key:i,staticClass:"info-tab text-center",class:s.id===e.appState.infoType?"active":"",on:{click:function(t){e._tabClick(s)}}},[e._v("\r\n        "+e._s(s.name)+"\r\n      ")]):e._e()})):e._e()],1),e._v(" "),e.curBusiness?t("div",{staticClass:"bottom"},[t("span",[t("a",{staticClass:"release-business",attrs:{href:"javascript:;"}},[e.curBusiness.business.isPublic?e.curBusiness.business.isEnable?t("span",{on:{click:function(s){e._releaseBusiness("stop")}}},[e._v("停用本业务期")]):t("span",{staticClass:"disabled"},[e._v("本业务期已停用")]):t("span",{class:e.releaseBusinessDisabled?"disabled":"",on:{click:function(s){e._releaseBusiness("release")}}},[e._v(e._s(e.annoreleaseBusinessText||"发布本业务期"))])])]),e._v(" "),e.curBusiness.business.isPublic?e._e():t("span",{staticClass:"save-business",class:e.isReviseBusiness?"revise":"",on:{click:function(s){e._save("business")}}},[e._v("保存本业务期配置")]),e._v(" "),e.isReviseBusiness?t("span",{staticClass:"save-business revise",on:{click:e._reviseBusinessInfo}},[e._v("保存本业务期配置")]):e._e(),e._v(" "),t("span",{staticClass:"error-tip",class:e.errorMsg?"active":""},[e._v(e._s(e.errorMsg))]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:"base"===e.appState.infoType,expression:"appState.infoType === 'base'"}],staticClass:"info-body container-fluid"},[t("div",{staticClass:"col-sm-6 padding-right"},[t("div",{staticClass:"form-group base-item"},[t("label",[e._v("名称")]),e._v(" "),!e.curBusiness.business.isPublic||e.isReviseBusiness?t("input",{directives:[{name:"model",rawName:"v-model",value:e.curBusiness.business.name,expression:"curBusiness.business.name"}],staticClass:"form-control valid",attrs:{type:"text",placeholder:"请输入业务起名称(30字以内)",maxlength:"30"},domProps:{value:e.curBusiness.business.name},on:{change:e._changeBusinessName,input:function(s){s.target.composing||e.$set(e.curBusiness.business,"name",s.target.value)}}}):t("input",{staticClass:"form-control",attrs:{type:"text",readonly:""},domProps:{value:e.curBusiness.business.name}})])]),e._v(" "),t("div",{staticClass:"col-sm-6 padding-left"},[t("div",{staticClass:"form-group base-item"},[t("label",[e._v("学年")]),e._v(" "),t("v-select",{staticClass:"info-value btn-block",attrs:{options:e.appState.gradeOptions,value:e.curBusiness.business.year||(new Date).getFullYear()+"_0","options-value":"id","options-label":"label","close-on-select":"",disabled:!(!e.curBusiness.business.isPublic||e.isReviseBusiness)},on:{afterSelected:e._afterSelectYear}})],1)]),e._v(" "),t("div",{staticClass:"col-sm-6 padding-right"},[t("div",{staticClass:"form-group base-item",class:e.isReviseBusiness?"active":"",on:{click:function(s){e._reviseBusinessData("form")}}},[t("label",{class:e.isReviseBusiness?"active":""},[e._v("表单(来自应用同步)")]),e._v(" "),t("input",{staticClass:"form-control",class:e.isReviseBusiness?"active":"",attrs:{readonly:""},domProps:{value:e.appState.formName||"未绑定表单"}})])]),e._v(" "),t("div",{staticClass:"col-sm-6 padding-left"},[t("div",{staticClass:"form-group base-item",class:e.isReviseBusiness?"active":"",on:{click:function(s){e._reviseBusinessData("flow")}}},[t("label",{class:e.isReviseBusiness?"active":""},[e._v("流程(来自应用同步)")]),e._v(" "),t("input",{staticClass:"form-control",class:e.isReviseBusiness?"active":"",attrs:{readonly:""},domProps:{value:e.appState.flowName||"未绑定流程"}})])])]),e._v(" "),e.curBusiness.business.id?t("div",{directives:[{name:"show",rawName:"v-show",value:"faceTo"===e.appState.infoType,expression:"appState.infoType === 'faceTo'"}],staticClass:"info-body container-fluid outer-container"},[e.faceToPeopleType.indexOf(e.curApp&&e.curApp.appType&&e.curApp.appType.userType)<0?t("div",{staticClass:"limit-radios"},[t("div",{staticClass:"radio-item small-item",class:"0"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic?"":"active"},[t("span",{staticClass:"check",class:e.curBusiness.business.isPublic?"disable":"",on:{click:function(s){e._changeLimitType("0")}}},["0"!==e.curBusiness.business.limitType?t("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")]):t("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")])]),e._v(" "),t("label",{staticClass:"check-label"},[e._v("无限制")])]),e._v(" "),t("div",{staticClass:"radio-item large-item",class:"1"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic?"":"active"},[t("div",{staticClass:"large-check-part"},[t("span",{staticClass:"check",class:e.curBusiness.business.isPublic?"disable":"",on:{click:function(s){e._changeLimitType("1")}}},["1"!==e.curBusiness.business.limitType?t("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")]):t("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")])]),e._v(" "),t("label",{staticClass:"check-label"},[e._v("按条件筛选")])]),e._v(" "),t("div",{staticClass:"large-select-part"},[t("div",{staticClass:"select-group"},[t("label",[e._v("学生类型")]),e._v(" "),t("v-select",{staticClass:"info-value btn-block",attrs:{url:"/api/system/dictTypes/1004/dicts",value:e.curBusiness.businessLimit?e.curBusiness.businessLimit.studentType:"","options-value":"value","options-label":"label","close-on-select":"",justified:"",disabled:"1"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic},on:{afterSelected:e._afterSelectStuType}})],1)]),e._v(" "),t("div",{staticClass:"large-select-part"},[t("div",{staticClass:"select-group"},[t("label",[e._v("学生年级")]),e._v(" "),t("v-select",{staticClass:"info-value btn-block",attrs:{options:e.appState.gradeOptions2,value:e.curBusiness.businessLimit?e.curBusiness.businessLimit.grade:"","options-value":"id","options-label":"label","close-on-select":"",justified:"",disabled:"1"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic},on:{afterSelected:e._afterSelectGrade}})],1)]),e._v(" "),t("div",{staticClass:"large-select-part"},[t("div",{staticClass:"select-group"},[t("label",[e._v("在校状态")]),e._v(" "),t("v-select",{staticClass:"info-value btn-block",attrs:{options:e.appState.inSchoolOptions,value:e.curBusiness.businessLimit?e.curBusiness.businessLimit.inSchool:"","options-value":"id","options-label":"label","close-on-select":"",justified:"",disabled:"1"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic},on:{afterSelected:e._afterSelectInSchool}})],1)])]),e._v(" "),t("div",{staticClass:"radio-item small-item",class:"2"===e.curBusiness.business.limitType?"active":""},[t("span",{staticClass:"check",class:e.curBusiness.business.isPublic?"disable":"",on:{click:function(s){e._changeLimitType("2")}}},["2"!==e.curBusiness.business.limitType?t("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")]):t("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")])]),e._v(" "),t("label",{staticClass:"check-label"},[e._v("上传名单")]),e._v(" "),"2"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic?e._e():t("div",{staticClass:"pull-right opt-div"},[t("a",{staticClass:"opt-btn",attrs:{href:"javascript:;"},on:{click:e.showImportPage}},[t("span",[e._v("批量上传")])]),e._v(" "),t("a",{staticClass:"opt-btn",attrs:{href:"javascript:;"},on:{click:e.exportUserInfo}},[e._v("导出")])])]),e._v(" "),"2"===e.curBusiness.business.limitType?t("div",{staticClass:"stus-list"},[e.curBusiness.business.id?t("v-table",{attrs:{url:e.peopleUrl,pagesize:"5",idField:"id",columns:e.appState.columns,order:!0}}):t("span",{staticClass:"table-tip"},[e._v("暂无数据")])],1):e._e()]):t("div",{staticClass:"limit-radios"},[t("div",{staticClass:"radio-item small-item",class:"0"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic?"":"active"},[t("span",{staticClass:"check",class:e.curBusiness.business.isPublic?"disable":"",on:{click:function(s){e._changeLimitType("0")}}},["0"!==e.curBusiness.business.limitType?t("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")]):t("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")])]),e._v(" "),e.curApp&&e.curApp.appType&&"3"===e.curApp.appType.userType?t("label",{staticClass:"check-label"},[e._v("所有新生")]):t("label",{staticClass:"check-label"},[e._v("所有辅导员")])]),e._v(" "),t("div",{staticClass:"radio-item small-item",class:"2"===e.curBusiness.business.limitType?"active":""},[t("span",{staticClass:"check",class:e.curBusiness.business.isPublic?"disable":"",on:{click:function(s){e._changeLimitType("2")}}},["2"!==e.curBusiness.business.limitType?t("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")]):t("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")])]),e._v(" "),t("label",{staticClass:"check-label"},[e._v("上传名单")]),e._v(" "),"2"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic?e._e():t("div",{staticClass:"pull-right opt-div"},[t("a",{staticClass:"opt-btn",attrs:{href:"javascript:;"},on:{click:e.showImportPage}},[t("span",[e._v("批量上传")])]),e._v(" "),t("a",{staticClass:"opt-btn",attrs:{href:"javascript:;"},on:{click:e.exportUserInfo}},[e._v("导出")])])]),e._v(" "),"2"===e.curBusiness.business.limitType?t("div",{staticClass:"stus-list"},[e.curBusiness.business.id?t("v-table",{attrs:{url:e.peopleUrl,pagesize:"5",idField:"id",columns:e.appState.columns,order:!0}}):t("span",{staticClass:"table-tip"},[e._v("暂无数据")])],1):e._e()]),e._v(" "),e.showImportModal?t("div",{staticClass:"import-modal"},[t("v-import",e._b({on:{backParentPage:e.backParentPage}},"v-import",e.importParams,!1))],1):e._e()]):e._e(),e._v(" "),e.curBusiness.business.id?t("div",{directives:[{name:"show",rawName:"v-show",value:"timeSet"===e.appState.infoType,expression:"appState.infoType === 'timeSet'"}],staticClass:"info-body"},[t("time-set",{ref:"timeSet",attrs:{data:e.initDataOfChart,height:"300px"},on:{nodeSelected:e._nodeSelected}})],1):e._e(),e._v(" "),e.curBusiness.business.id&&"description"===e.appState.infoType?t("div",{staticClass:"info-body container-fluid"},[!e.curBusiness.business.isPublic||e.isReviseBusiness?t("u-editor",{ref:"description",attrs:{config:e.editorConfig},model:{value:e.curBusiness.business.guide,callback:function(s){e.$set(e.curBusiness.business,"guide",s)},expression:"curBusiness.business.guide"}}):t("div",{domProps:{innerHTML:e._s(e.curBusiness.business.guide)}})],1):e._e(),e._v(" "),e.curBusiness.business.id?t("div",{directives:[{name:"show",rawName:"v-show",value:"records"===e.appState.infoType,expression:"appState.infoType === 'records'"}],staticClass:"info-body"},[t("div",{staticClass:"stus-list"},[t("v-table",{ref:"recordsTable",attrs:{pagesize:"5",idField:"id",url:"/table-data/processEngine/business/"+e.curBusiness.business.id+"/processInstances/pages",columns:e.appState.recordColumns,order:!0,search:!0}},[t("div",{staticClass:"btn-group pull-right",attrs:{slot:"btn-group"},slot:"btn-group"},[t("button",{staticClass:"btn output-btn",attrs:{type:"button"},on:{click:e._showOutPutModal}},[e._v("导出")])])])],1)]):e._e()]):e._e(),e._v(" "),t("v-modal",{attrs:{show:e.outputModalShow,effect:"fade",width:"450"}},[t("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[t("h5",{staticClass:"modal-title"},[e._v("\r\n        导出——字段选择\r\n    ")])]),e._v(" "),t("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[t("ul",{staticClass:"list-group"},e._l(e.formFields,function(s,i){return e.notAllowOutput.indexOf(s.componentType)<0?t("li",{staticClass:"list-group-item field-item",class:e.outputList.indexOf(s.name)<0?"":"output-active",on:{click:function(t){e._changeOutputList(s)}}},[e.outputList.indexOf(s.name)<0?t("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")]):t("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")]),e._v(" "),t("span",[e._v(e._s(s.title))])]):e._e()}))]),e._v(" "),t("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[t("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(s){e.outputModalShow=!1}}},[e._v("取消")]),e._v(" "),t("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:e._sureToOutput}},[e._v("确定")])])]),e._v(" "),e.readonly?e._e():t("v-modal",{attrs:{show:e.appState.showFormModal,effect:"fade",width:"374"}},[t("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[t("h5",{staticClass:"modal-title"},[e._v("\r\n        选择模板\r\n      ")])]),e._v(" "),t("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[t("label",[e._v("请选择对应模板初始化表单")]),e._v(" "),t("ul",{staticClass:"list-group"},[t("li",{staticClass:"list-group-item",class:e.appState.modelId===e.blankTemplateId?"active":"",on:{click:function(s){e.appState.modelId=e.blankTemplateId}}},[e._v("\r\n          空白表单模板\r\n        ")]),e._v(" "),e._l(e.formList,function(s,i){return t("li",{key:i,staticClass:"list-group-item",class:e.appState.modelId===s.id?"active":"",on:{click:function(t){e.appState.modelId=s.id}}},[e._v("\r\n          "+e._s(s.name)+"模板\r\n        ")])})],2)]),e._v(" "),t("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[t("a",{attrs:{href:"javascript:;"},on:{click:function(s){e.appState.showFormModal=!1}}},[e._v("取消")]),e._v(" "),t("a",{staticClass:"sure-btn",attrs:{href:"javascript:;"},on:{click:e._initWithModel}},[e._v("确定")])])]),e._v(" "),t("v-modal",{attrs:{show:e.showIconModal,effect:"fade",width:"446"}},[t("div",{staticClass:"modal-header iconModal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[t("h5",{staticClass:"modal-title"},[e._v("\r\n        修改图标\r\n      ")])]),e._v(" "),t("div",{staticClass:"modal-body iconModal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[t("div",{staticClass:"background-container"},e._l(e.backgroundList,function(s,i){return t("span",{key:i,staticClass:"background",style:{background:s.background},on:{click:function(t){e._selectBackground(s)}}},[e.appState.background===s.background?t("i",{staticClass:"maticon icon-done",domProps:{innerHTML:e._s(e.icons("done"))}},[e._v("done")]):e._e()])})),e._v(" "),t("div",{staticClass:"icon-list"},[e._l(e.iconList,function(s,i){return t("i",{key:i,staticClass:"maticon",class:{active:"1"===e.appState.imgType&&e.appState.imgPath===s.name},domProps:{innerHTML:e._s(e.icons(s.name))},on:{click:function(t){e._selectIcon(s)}}},[e._v(e._s(s.name))])}),e._v(" "),e._l(e.saasIconList,function(s,i){return t("i",{key:i,class:{active:"2"===e.appState.imgType&&e.appState.imgPath===s},on:{click:function(t){e._selectIcon({name:s},"2")}}},[t("span",{staticClass:"saasicon",class:["saasicon-"+s+"-black"]})])})],2)]),e._v(" "),t("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[t("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(s){e._cancelPart("icon")}}},[e._v("取消")]),e._v(" "),t("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:e._saveAppIcon}},[e._v("确定")])])]),e._v(" "),e.preview?t("div",{staticClass:"preview-container"},[t("preview",{attrs:{data:e.previewObj.formData.components,title:e.previewObj.formData.name,script:e.previewObj.formData.property.script,authorities:e.previewObj.authorities,defaultData:e.previewObj.recordData,log:e.previewObj.log,previewType:"flow",fileServer:e.uploadFile},on:{back:function(s){e.preview=!1}}})],1):e._e()],1)},staticRenderFns:[]};var u=t("C7Lr")(l,p,!1,function(e){t("cqZ5")},null,null).exports,d=t("7CEZ"),m=t("lh7w"),h={props:{departmentId:{default:"1"},appId:{required:!0,default:""},readonly:{default:!1},curCheckRoutes:{default:""}},created:function(){var e=this,s=localStorage.getItem("lang");Object(c.e)(s)&&(this.lang=s),this._initCurApp(),this._initBusinessList(),this._initPlayersData(),this.curRoute=this.curCheckRoutes,this.nowTime=(new Date).getTime(),this.backgroundList=[{id:0,background:"linear-gradient(-135deg, #7553E1 0%, #5223DC 100%)"},{id:1,background:"linear-gradient(-135deg, #5067D7 0%, #3F53B8 100%)"},{id:2,background:"linear-gradient(-135deg, #5572FA 0%, #4060FA 100%)"},{id:3,background:"linear-gradient(-135deg, #19AC9D 0%, #159687 100%)"},{id:4,background:"linear-gradient(-135deg, #5AC15F 0%, #49AE4E 100%)"},{id:5,background:"linear-gradient(-135deg, #658899 0%, #4E7384 100%)"},{id:6,background:"linear-gradient(-135deg, #8C6E64 0%, #785549 100%)"}],this.iconList=[{id:0,name:"school"},{id:1,name:"accessibility"},{id:2,name:"account_balance"},{id:3,name:"account_balance_wallet"},{id:4,name:"account_circle"},{id:5,name:"alarm"},{id:6,name:"assignment"},{id:7,name:"book"},{id:8,name:"build"},{id:9,name:"description"},{id:10,name:"explore"},{id:11,name:"extension"},{id:12,name:"face"},{id:13,name:"favorite"},{id:14,name:"flight_land"},{id:15,name:"flight_takeoff"},{id:16,name:"get_app"},{id:17,name:"grade"},{id:18,name:"language"},{id:19,name:"launch"},{id:20,name:"loyalty"},{id:21,name:"perm_contact_calendar"},{id:22,name:"receipt"},{id:23,name:"question_answer"},{id:24,name:"restore"},{id:25,name:"room"},{id:26,name:"schedule"},{id:27,name:"search"},{id:28,name:"shopping_cart"},{id:29,name:"swap_horiz"},{id:30,name:"theaters"},{id:31,name:"update"},{id:32,name:"verified_user"},{id:33,name:"work"},{id:34,name:"visibility"},{id:35,name:"equalizer"},{id:36,name:"business"},{id:37,name:"call"},{id:38,name:"chat"},{id:39,name:"email"},{id:40,name:"create"},{id:41,name:"flag"},{id:42,name:"save"},{id:43,name:"link"},{id:44,name:"send"},{id:45,name:"devices"},{id:46,name:"attach_file"},{id:47,name:"format_quote"},{id:48,name:"cloud"},{id:49,name:"folder"},{id:50,name:"computer"},{id:51,name:"headset"},{id:52,name:"security"},{id:53,name:"sim_card"},{id:54,name:"watch"},{id:55,name:"add_a_photo"},{id:56,name:"camera_alt"},{id:57,name:"directions_railway"},{id:58,name:"directions_bike"},{id:59,name:"local_activity"},{id:60,name:"directions_walk"},{id:61,name:"local_dining"},{id:62,name:"local_hospital"},{id:63,name:"local_library"},{id:64,name:"event_note"},{id:65,name:"map"},{id:66,name:"navigation"},{id:67,name:"wifi"},{id:68,name:"ac_unit"},{id:69,name:"fitness_center"},{id:70,name:"pool"},{id:71,name:"cake"},{id:72,name:"group"},{id:73,name:"location_city"},{id:74,name:"notifications"},{id:75,name:"person"},{id:76,name:"poll"},{id:77,name:"public"},{id:78,name:"share"},{id:79,name:"whatshot"}],this.appState.columns=[{id:"name",title:this.translate.name,width:200,className:"text-left",hidden:!1},{id:"userNo",title:this.numberDesc,width:200,className:"text-left",hidden:!1},{id:"collegeName",title:this.translate.college,width:250,className:"text-left",hidden:!1},{id:"grade",title:this.translate.grade,width:100,className:"text-left",hidden:!1},{id:"studentType",title:this.translate.studentType,width:150,className:"text-left",hidden:!0},{id:"inSchoolValue",title:this.translate.inSchoolStatus,width:150,className:"text-left",hidden:!1},{id:"studentTypeValue",title:this.translate.studentType,width:150,className:"text-left",hidden:!1}],this.appState.inSchoolOptions=[{id:0,label:this.translate.unlimited},{id:1,label:this.translate.inSchool},{id:2,label:this.translate.notAtSchool}],this.appState.infoTypes=[{id:"base",name:this.translate.baseInfo},{id:"faceTo",name:this.translate.facePeople},{id:"timeSet",name:this.translate.timeSet},{id:"description",name:this.translate.description}];for(var t=(new Date).getFullYear(),i=t+3;i>t-5;i--)this.appState.gradeOptions.push({id:i+"",label:i+"-"+(i+1)+this.translate.schoolYear});for(var a=t+3;a>t-5;a--)this.appState.gradeOptions2.push({id:a+"",label:a+this.translate.level});Object(c.c)({url:"/api/relationship/getSelectOptions",dataType:"json",type:"get",success:function(s){s.state&&(e.collegeOptions=s.data.colleges||[],e.gradeOptions=s.data.grades||[])}})},data:function(){return{iconList:[],saasIconList:["road","book","camera","idcard","tuition","bankcard","list","text","help","layer","package","cap","letter","calendar","menu","menu2","menu3","apply","info","rightcard","drippower","bulb","record","direction","person","envelope","reduce","socialist","star","assets","notebook","location","purse","remark","statisticsbar","building","geography","rotate","manlove","medal","pick","purse2","free","tag","menudone","travel","trophy","medal2","question","excellent","search"],formList:[],curApp:{name:"点击右侧按钮编辑应用名称",imgPath:"",remark:"应用说明"},editorConfig:{initialFrameHeight:520},nameChangeMsg:"",descChangeMsg:"",appState:{editPart:"",showFormModal:!1,showFlowModal:!1,infoType:"base",flowName:"",formName:"",modelId:"",infoTypes:[],columns:[],recordColumns:[],inSchoolOptions:[],gradeOptions:[],gradeOptions2:[],flowData:{id:"",chart:{}},background:"linear-gradient(-135deg, #5067D7 0%, #3F53B8 100%)"},businessList:[],leftIconShow:!1,rightIconShow:!1,curBusiness:null,timeSet:null,errorMsg:"",nowTime:"",defineSearch:{status:"",collegeCode:"",grade:""},collegeOptions:[],gradeOptions:[],preview:!1,previewObj:{formData:null,authorities:null,recordData:[],curBusinessId:"",appId:""},importParams:{parentPageTitle:"人员列表",downloadTemplateUrl:"/app/business/studentExcelTemplate",downloadErrorTemplateUrl:"/app/business/errorBusinessStudentExcel",checkTemplateUrl:"",templateName:"面向人员名单导入模板",importBtnType:null},showImportModal:!1,overriteImport:"覆盖导入",incrementImport:"增量导入",timestamp:"",players:[],timeNodeId:"",timeType:"",curSelectedTime:"",timeSetData:[],releaseAppDisabled:!1,releaseBusinessDisabled:!1,annoreleaseBusinessText:"",formTimeName:"",newName:"",numberDesc:"",showIconModal:!1,backgroundList:[],reviseSetTimeOut:null,clickCount:0,isReviseBusiness:!1,isReviseData:!1,curRoute:"",businessTimer:null,blankTemplateId:"",faceToPeopleType:["3","4"],lang:"zh-cn"}},computed:{host:function(){return window.location.host},translate:function(){return Object(c.e)(this.lang).formEngineInfo},businessIsOn:function(){var e=this,s=!1;return this.curBusiness&&this.businessList.forEach(function(t){t.business.id!==e.curBusiness.business.id&&t.business.isPublic&&t.business.isEnable&&(s=!0)}),s},peopleUrl:function(){return"/table-data/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/users/page?timestamp="+this.timestamp},inputStyleWidth:function(){return this.curApp.name.length<=20?34*this.curApp.name.length:27*this.curApp.name.length},rowsNumber:function(){return this.curApp.remark?this.curApp.remark.length>62&&this.curApp.remark.length<=124?2:this.curApp.remark.length>124&&this.curApp.remark.length<=186?3:this.curApp.remark.length>186?4:1:1}},watch:{appId:function(){this._initCurApp()},errorMsg:function(){var e=this;setTimeout(function(){e.errorMsg=""},1500)},curBusiness:function(){this.curBusiness&&this._loadBusinessTime("clickBusiness")},curApp:function(){var e="";this.curApp&&this.curApp.appType&&("1"===this.curApp.appType.userType?e=this.translate.userNo:"2"===this.curApp.appType.userType?(e=this.translate.teacherNo,this.appState&&this.appState.columns&&this.appState.columns[1]&&(this.appState.columns[1].title=e)):"3"===this.curApp.appType.userType?(e=this.translate.freshmanNo,this.appState&&this.appState.columns&&this.appState.columns[1]&&(this.appState.columns[1].title=e)&&(this.appState.columns[1].id="account")):"4"===this.curApp.appType.userType&&(this.appState.columns=[{id:"name",title:this.translate.name,width:200,className:"text-left",hidden:!1},{id:"userNo",title:this.translate.instructorNo,width:200,className:"text-left",hidden:!1},{id:"collegeName",title:this.translate.college,width:250,className:"text-left",hidden:!1}])),this.numberDesc=e}},methods:{_initImportTpl:function(){this.curApp&&this.curApp.appType&&"3"===this.curApp.appType.userType&&(this.importParams.downloadTemplateUrl="/app/business/freshmanExcelTemplate")},_changeBusinessGuide:function(e){this.curBusiness.business.guide=e,this.isReviseData=!0},_collegeSearch:function(e){this.defineSearch.collegeCode=e.val},_stateSearch:function(e){this.defineSearch.status=e.val},_tabClick:function(e){var s=this;this.appState.infoType=e.id,this.timeType="",this._loadBusinessTime(),this.importParams.checkTemplateUrl="/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/excel",this.importParams.importBtnType=[{name:this.overriteImport,url:"/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/excel",method:"put",isShowBtn:!0,success:function(e){e.state&&(s.timestamp=new Date)}}]},_changeBusiness:function(e){this.curBusiness=e,this.showImportModal=!1,this.isReviseBusiness=!1},_back:function(){this.$emit("back"),this.businessTimer&&clearInterval(this.businessTimer)},_initPlayersData:function(){var e=this;Object(c.c)({url:"/api/apps/"+this.appId+"/settings/players",type:"get",success:function(s){s.state?s.data&&(e.players=s.data.players):e.$toast(s.message)}})},_initFormList:function(){var e=this;""!==this.appId?Object(c.c)({type:"get",url:"/api/departments/"+this.departmentId+"/apps/forms?userType="+this.curApp.appType.userType,success:function(s){s.state?e.formList=s.data:e.$toast(s.message)}}):this.formList=[]},_getFormName:function(e){var s=this;Object(c.c)({url:"/api/apps/"+this.appId+"/settings/forms",type:"get",success:function(e){e.state?e.data&&(s.appState.formName=e.data.name):s.$toast(e.message)}})},_initCurApp:function(){var e=this;Object(c.c)({type:"get",url:"/api/app/"+this.appId,success:function(s){s.state?(e.curApp=s.data,e.$set(e.appState,"imgType",e.curApp.imgType),e.curApp&&e.curApp.appType&&("4"===e.curApp.appType.userType?e.blankTemplateId="5c00b20c72877c31752fc75c":e.blankTemplateId="5ae147c265249c38288e9f00"),e._initFormList(),"formEngine"===e.curRoute&&e._getFormName()):e.$toast(s.message)}})},_initBusinessList:function(){var e=this;Object(c.c)({type:"get",url:"/api/app/"+this.appId+"/business",success:function(s){s.state?(e.businessList=s.data,e.businessList.forEach(function(s,t){s.business.isPublic&&s.business.isEnable&&(e.curBusiness=s,e._scrollToBusiness(t),e.businessTimer&&clearInterval(e.businessTimer)),s.business.isPublishing&&(e.releaseBusinessDisabled=!0,e.annoreleaseBusinessText=e.translate.announcing)})):e.$toast(s.message)}})},_releaseBusiness:function(e){var s=this;if("release"===e){if(this.releaseBusinessDisabled)return;if(!confirm("确认发布本业务吗？业务期一旦开启，为保证申请的正常进行，系统将自动锁定该业务期所关联的流程及表单，业务期内将无法再对流程及表单进行编辑"))return;this.releaseBusinessDisabled=!0,this.annoreleaseBusinessText=this.translate.announcing,this._save("business",function(){Object(c.c)({url:"/api/app/"+s.appId+"/business/"+s.curBusiness.business.id+"/publish",type:"put",success:function(e){s.releaseBusinessDisabled=!1,s.annoreleaseBusinessText="",e.state?(e.data.publishing&&!e.data.published&&(s.releaseBusinessDisabled=!0,s.annoreleaseBusinessText=s.translate.announcing,s.$toast("业务期发布中，后台运行"),s.businessTimer=setInterval(function(){s._initBusinessList()},3e4)),e.data.published&&(s.curBusiness.business.isPublic=!0,s.$toast(s.translate.releaseBusinessSuccess))):"31114"===e.code?(s.releaseBusinessDisabled=!0,s.annoreleaseBusinessText=s.translate.announcing,confirm("应用未发布情况下无法发布业务期，确定同时发布应用吗？")?Object(c.c)({url:"/api/app/"+s.appId+"/business/"+s.curBusiness.business.id+"/publish?publishApp=true",type:"put",success:function(e){s.releaseBusinessDisabled=!1,s.annoreleaseBusinessText="",e.state?(s.curBusiness.business.isPublic=!0,s.curApp.isPublished=!s.curApp.isPublished,s.$toast(s.translate.release+s.translate.success)):s.$toast(e.message)}}):(s.releaseBusinessDisabled=!1,s.annoreleaseBusinessText="")):s.$toast(e.message)}})})}else confirm("确定要停止此业务期吗？停止后，此业务期的所有数据将作废且不可恢复")&&this._stopOrRemove("stop")},_removeBusiness:function(e){confirm(this.translate.removeBusinessConfirm)&&this._stopOrRemove("remove",e)},_stopOrRemove:function(e,s){var t=this,i="stop"===e?this.curBusiness.business.id:this.businessList[s].business.id;i?Object(c.c)({url:"/api/app/"+this.appId+"/business/"+i,type:"delete",success:function(a){t.$toast("操作成功"),a.state?"stop"===e?t.curBusiness.business.isEnable=!1:(t.businessList.splice(s,1),t._testIconShow(),t.curBusiness.business.id===i&&(t.curBusiness=null)):t.$toast(a.message)}}):(this.businessList.splice(s,1),this.$toast(this.translate.removeSuccessTip))},_addNewBusiness:function(){if(this.showImportModal=!1,"formEngine"!==this.curRoute||this.curApp.setting.formId&&this.curApp.setting.playerSettingId){var e=(new Date).getFullYear(),s=e+"-"+(e+1)+this.translate.schoolYear+this.curApp.name,t=s;this.creatNewName(s,t),this.appState.infoType="base",this.curBusiness={business:{name:this.newName,year:e+"",linkUrl:"",guide:"",settingId:"",businessTimeList:[],limitType:0,beginTime:"",endTime:"",isEnable:!1,isLimit:!1},businessLimit:{inSchool:0,grade:0,studentType:0}},this.businessList.push(this.curBusiness),this._scrollToBusiness(this.businessList.length-1),this.timeSetData=[],this._save("business",function(){})}else this.$toast(this.translate.addNewTip)},creatNewName:function(e,s){var t=!1;this.businessList.forEach(function(i){if(i.business.name===e){t=!0;var a=e.split(s);if(a[1]){var n=parseInt(a[1])+1;e=s+n}else e=s+1}}),t?this.creatNewName(e,s):this.newName=e},_editPart:function(e){this.showIconModal=!0,this.appState.editPart=e,this.$set(this.appState,e,this.curApp[e]),this.$set(this.appState,"imgPath",this.curApp.imgPath),this.curApp.background&&this.$set(this.appState,"background",this.curApp.background),this.$set(this.appState,"imgPath",this.curApp.imgPath)},_cancelPart:function(e){this.showIconModal=!1,this.appState.editPart="",this.appState[e]="",this.appState.background=""},_savePart:function(e){this.curApp[e]=this.appState[e],this.appState.editPart="",this.appState[e]=""},_selectIcon:function(e,s){this.appState.imgPath=e.name,this.appState.imgType=s||"1"},_selectBackground:function(e){this.appState.background=e.background},_saveAppIcon:function(){var e=this;Object(c.c)({url:"/api/app/"+this.curApp.id+"/style",type:"put",data:{imgPath:this.appState.imgPath,imgType:this.appState.imgType,background:this.appState.background},success:function(s){s.state?(e._savePart("imgPath"),e._savePart("imgType"),e._savePart("background"),e.$emit("update",e.curApp),e.showIconModal=!1):e.$toast(s.message)}})},_setAppForm:function(){this.curApp.setting.formId?this._initWithModel():(this.$set(this.appState,"form",this.curApp.form),this.appState.showFormModal=!0)},_setJoinRole:function(){this.$emit("setJoinRole",{businessId:""}),this._save("",function(){})},_initWithModel:function(){this.$emit("setForm",{modelId:this.appState.modelId,type:this.curApp.setting.formId?"edit":"create",businessId:""}),this._save("",function(){})},_scrollLeft:function(){o()("#businessDiv").animate({scrollLeft:o()("#businessDiv").scrollLeft()-500},100),this._testIconShow()},_scrollRight:function(){o()("#businessDiv").animate({scrollLeft:o()("#businessDiv").scrollLeft()+500},100),this._testIconShow()},_scrollToBusiness:function(e){var s=this;setTimeout(function(){o()("#businessDiv").animate({scrollLeft:o()("#businessDiv").scrollLeft()+200*e},100),s._testIconShow()},300)},_testIconShow:function(){var e=this;setTimeout(function(){e.leftIconShow=o()("#businessDiv").scrollLeft()>0,e.rightIconShow=o()(".business-scroll").width()-o()("#businessDiv").scrollLeft()>o()("#businessDiv").width()},300)},_compareTime:function(e,s){var t=new Date(e[s].start).getTime(),i=new Date(e[s].end).getTime();return this.nowTime<t?0===s?"left":this.nowTime>new Date(e[s-1].end).getTime()?"left":"":this.nowTime>t&&this.nowTime<i?"center":""},_changeLimitType:function(e){this.curBusiness.business.isPublic||(this.curBusiness.business.limitType=e)},_afterSelectYear:function(e){this.curBusiness.business.year=e.value,this.isReviseData=!0},_afterSelectStuType:function(e){this.curBusiness.businessLimit||this.$set(this.curBusiness,"businessLimit",{}),this.$set(this.curBusiness.businessLimit,"studentType",e.value)},_afterSelectGrade:function(e){this.curBusiness.businessLimit||this.$set(this.curBusiness,"businessLimit",{}),this.$set(this.curBusiness.businessLimit,"grade",e.value)},_afterSelectInSchool:function(e){this.curBusiness.businessLimit||this.$set(this.curBusiness,"businessLimit",{}),this.$set(this.curBusiness.businessLimit,"inSchool",e.value)},_changeLinkUseBusiness:function(e){var s=this;this.curApp.setting.useBusiness="use"===e,Object(c.c)({url:"/api/app/"+this.appId+"/useBusiness",type:"put",data:{useBusiness:this.curApp.setting.useBusiness},success:function(e){e.state?s.$toast(s.translate.modifySuccess):s.$toast(e.message)}})},_saveLink:function(){var e=this;Object(c.c)({url:"/api/app/"+this.appId+"/url",type:"put",data:{linkUrl:this.curApp.setting.linkUrl},success:function(s){s.state?e.$toast(e.translate.modifySuccess):e.$toast(s.message)}})},_linkBusinessTime:function(e){var s=this,t=window.event;this.timeType=e,this.isReviseData=!0,setTimeout(function(){s.$date({dateFormat:"yyyy-MM-dd hh:ii:ss",value:s.curSelectedTime||"",type:"init",event:t,onSelect:function(e){s._linkSelectBusinessTime({value:e})}})},100)},_linkSelectBusinessTime:function(e){if(e.value){if("startTime"===this.timeType){if(this.curBusiness.business.endTime&&this.curBusiness.business.endTime<e.value)return this.errorMsg=this.translate.startTimeTip,this.curBusiness.business.beginTime="",!1;this.curBusiness.business.beginTime=e.value}if("endTime"===this.timeType){if(this.curBusiness.business.beginTime&&this.curBusiness.business.beginTime>e.value)return this.errorMsg=this.translate.endTimeTip,this.curBusiness.business.endTime="",!1;this.curBusiness.business.endTime=e.value}this.errorMsg=""}},_nodeSelected:function(e,s,t,i){var a=this;if(!this.curBusiness.business.isPublic||this.isReviseBusiness){var n=window.event||e;this.timeNodeId=s,this.timeType=t,this.formTimeName=i,this.timeSetData.forEach(function(e){a.timeNodeId===e.nodeId&&(a.curSelectedTime=e[a.timeType])}),this.isReviseData=!0,setTimeout(function(){a.$date({dateFormat:"yyyy-MM-dd hh:ii:ss",value:a.curSelectedTime||"",type:"init",event:n,onSelect:function(e){a._daySelectedOfValue({value:e})}})},100)}},_daySelectedOfValue:function(e){var s=this;e.value&&this.timeSetData.forEach(function(t){if(s.timeNodeId===t.nodeId){if("startDate"===s.timeType&&t.endDate&&t.endDate<e.value)return s.errorMsg=s.formTimeName+s.translate.startTimeTip,!1;if("endDate"===s.timeType&&t.startDate&&t.startDate>e.value)return s.errorMsg=s.formTimeName+s.translate.endTimeTip,!1;s.errorMsg="",t[s.timeType]=e.value}})},timeFormat:function(e,s){if(!e)return"";var t={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(var i in/(y+)/.test(s)&&(s=s.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+i+")").test(s)&&(s=s.replace(RegExp.$1,1===RegExp.$1.length?t[i]:("00"+t[i]).substr((""+t[i]).length)));return s},_loadBusinessTime:function(e){var s=this;this.curBusiness.business.businessTimeList&&0!==this.curBusiness.business.businessTimeList.length?"formEngine"===this.curRoute&&(0!==this.timeSetData.length&&"clickBusiness"!==e||(this.timeSetData=JSON.parse(a()(this.curBusiness.business.businessTimeList))),this.timeSetData.forEach(function(e,t){s.players[t]&&e.nodeId===s.players[t].id&&(s.$set(e,"title",""),e.title=s.players[t].name)})):(this.curBusiness.business.businessTimeList=[],this.players.forEach(function(e){s.curBusiness.business.businessTimeList.push({nodeId:e.id,startDate:"",endDate:"",isLimit:!1})}))},_getDatetimeArr:function(e){var s=[];return e.forEach(function(e){s.push({id:e.nodeId,datetime:e.endDate})}),s},_getBusinessTime:function(){var e=this,s=[],t=[],i=[],n=[];for(var r in this.timeSetData.forEach(function(r,o){if(e.curBusiness.business.businessTimeList[o].nodeId===r.nodeId){if(e.curBusiness.business.businessTimeList[o].startDate=JSON.parse(a()(r.startDate)),e.curBusiness.business.businessTimeList[o].endDate=JSON.parse(a()(r.endDate)),r.startDate){s.push(r.startDate);var c=new Date(r.startDate.replace(/-/g,"/"));i.push(Date.parse(c))}if(r.endDate){t.push(r.endDate);c=new Date(r.endDate.replace(/-/g,"/"));n.push(Date.parse(c))}}}),s){var o=new Date(s[r].replace(/-/g,"/"));Date.parse(o)===Math.min.apply(null,i)&&(this.curBusiness.business.beginTime=s[r])}for(var r in t){o=new Date(t[r].replace(/-/g,"/"));Date.parse(o)===Math.max.apply(null,n)&&(this.curBusiness.business.endTime=t[r])}this.curBusiness.business.beginTime=this.curBusiness.business.beginTime?this.curBusiness.business.beginTime:"",this.curBusiness.business.endTime=this.curBusiness.business.endTime?this.curBusiness.business.endTime:""},_save:function(e,s){var t=this;if("business"===e){if(!this.curBusiness.business.name)return this.$toast(this.translate.nameError),!1;var i=this.curBusiness.business.id?"put":"post",a="/api/app/"+this.appId+"/business"+(this.curBusiness.business.id?"/"+this.curBusiness.business.id:"");"put"===i&&"formEngine"===this.curRoute&&(a+="?formId="+this.curBusiness.formId+"&playerSettingId="+this.curBusiness.playerSettingId),"formEngine"===this.curRoute?this._getBusinessTime():(this.curBusiness.business.beginTime=this.curBusiness.business.beginTime?this.curBusiness.business.beginTime:"",this.curBusiness.business.endTime=this.curBusiness.business.endTime?this.curBusiness.business.endTime:""),Object(c.c)({url:a,type:i,data:this.curBusiness,success:function(e){if(e.state){if(e.data.business.id&&!t.curBusiness.business.id)for(var i in e.data)t.$set(t.curBusiness,i,e.data[i]);s?s():t.$toast(t.translate.saveBusinessSuccess)}else t.$toast(e.message)}})}},showImportPage:function(){this._initImportTpl(),this.showImportModal=!0},backParentPage:function(){this.showImportModal=!1},exportUserInfo:function(){window.location.href="/downloads/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/excel?fileName="+this.curBusiness.business.name+".xlsx"},releaseApp:function(e){var s=this;if(this.releaseAppDisabled)return!1;this.releaseAppDisabled=!0;var t="",i="",a="";"release"===e?(t=this.translate.releaseTip,i=this.translate.release,a="post"):(t=this.translate.dropOffTip,i=this.translate.dropOff,a="delete"),confirm(t)?Object(c.c)({url:"/api/app/"+this.appId+"/public",type:a,success:function(e){s.releaseAppDisabled=!1,e.state?(s.$toast(i+s.translate.success),s.curApp.isPublished=!s.curApp.isPublished):s.$toast(e.message)}}):this.releaseAppDisabled=!1},_limitLength:function(e){this.curApp.name=this._getStrByteLimit(e.target.value,50)},_saveAppName:function(){var e=this;if(!this.curApp.name)return this.nameChangeMsg=this.translate.nameError,!1;Object(c.c)({url:"/api/app/"+this.curApp.id+"/name",type:"put",data:{name:this.curApp.name},success:function(s){s.state?(e.$emit("update",e.curApp),e.nameChangeMsg=e.translate.modifySuccess,setTimeout(function(){e.nameChangeMsg=""},2e3)):e.nameChangeMsg=e.translate.error+"："+s.message}})},_saveAppDesc:function(){var e=this;Object(c.c)({url:"/api/app/"+this.curApp.id+"/remark",type:"put",data:{remark:this.curApp.remark},success:function(s){s.state?(e.$emit("update",e.curApp),e.descChangeMsg=e.translate.modifySuccess,setTimeout(function(){e.descChangeMsg=""},2e3)):e.descChangeMsg=e.translate.error+"："+s.message}})},_openReviseBusiness:function(){var e=this;if("link"===this.curRoute)return!1;this.curBusiness.business.isPublic&&(this.clickCount++,this.reviseSetTimeOut||(this.reviseSetTimeOut=setTimeout(function(){e.clickCount>=10&&(e.isReviseBusiness=!0),e.clickCount=0,clearTimeout(e.reviseSetTimeOut),e.reviseSetTimeOut=null},3e3)))},_reviseBusinessData:function(e){this.isReviseBusiness&&(this.isReviseData&&confirm("是否保存修改的数据？不保存会丢失")&&this._reviseBusinessInfo(),"form"===e?this.$emit("setForm",{modelId:this.appState.modelId,type:this.curApp.setting.formId?"edit":"create",businessId:this.curBusiness.business.id}):this.$emit("setJoinRole",{businessId:this.curBusiness.business.id}))},_changeBusinessName:function(){this.isReviseData=!0},_reviseBusinessInfo:function(){var e=this;this._getBusinessTime();var s={name:this.curBusiness.business.name,year:this.curBusiness.business.year,guide:this.curBusiness.business.guide,beginTime:this.curBusiness.business.beginTime,endTime:this.curBusiness.business.endTime,businessTimeList:[]};this.curBusiness.business.businessTimeList.forEach(function(e){s.businessTimeList.push({nodeId:e.nodeId,startDate:e.startDate,endDate:e.endDate})}),Object(c.c)({url:"/api/app/"+this.appId+"/publishBusiness/"+this.curBusiness.business.id,type:"put",data:s,success:function(s){e.isReviseData=!1,s.state?e.$toast("业务期保存成功"):e.$toast(s.message)}})},_export:function(){window.location.href="/downloads/app/"+this.appId+"/export"}}},b={render:function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("GeminiScrollbar",{attrs:{scrollX:!1,id:"formEngineInfo"}},[t("div",{staticClass:"header"},[t("i",{staticClass:"maticon pull-left back-link",domProps:{innerHTML:e._s(e.icons("arrow_back"))},on:{click:e._back}},[e._v("arrow_back")]),e._v(" "),e.curApp.isPublished?t("div",{staticClass:"pull-right release-app",class:e.releaseAppDisabled?"release-app-disabled":"",on:{click:function(s){e.releaseApp("delete")}}},[e._v(e._s(e.translate.dropOff))]):t("div",{staticClass:"pull-right release-app",class:e.releaseAppDisabled?"release-app-disabled":"",on:{click:function(s){e.releaseApp("release")}}},[e._v(e._s(e.translate.release))]),e._v(" "),t("div",{staticClass:"pull-right release-app",on:{click:e._export}},[e._v(e._s(e.translate.export))]),e._v(" "),t("div",{staticClass:"title-div"},[t("div",{staticClass:"app-icon-div"},[t("i",{staticClass:"maticon edit-icon",domProps:{innerHTML:e._s(e.icons("edit"))},on:{click:function(s){e._editPart("icon")}}},[e._v("edit")]),e._v(" "),t("div",{style:{"background-image":e.curApp.background}},[e.curApp.imgType&&"1"!==e.curApp.imgType?"2"===e.curApp.imgType?t("i",{staticClass:"app-icon"},[t("span",{staticClass:"saasicon-44px",class:["saasicon-44px-"+e.curApp.imgPath]})]):e._e():t("i",{staticClass:"maticon app-icon",domProps:{innerHTML:e._s(e.icons(e.curApp.imgPath))}},[e._v(e._s(e.curApp.imgPath))])])]),e._v(" "),t("div",{staticClass:"input-group app-name-div info-value",style:{width:e.inputStyleWidth+"px"}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.curApp.name,expression:"curApp.name"}],staticClass:"form-control",attrs:{type:"text",placeholder:e.translate.applyNamePlaceholder},domProps:{value:e.curApp.name},on:{input:[function(s){s.target.composing||e.$set(e.curApp,"name",s.target.value)},e._limitLength],change:e._saveAppName}}),e._v(" "),t("div",[t("a",{staticClass:"apartment-link",attrs:{href:"javascript:;"}},[e._v(e._s(e.curApp.department&&e.curApp.department.name))])])]),e._v(" "),e.nameChangeMsg?t("p",{staticClass:"save-tip text-center",class:e.nameChangeMsg.indexOf(e.translate.error)>=0?"error":""},[e._v(e._s(e.nameChangeMsg))]):e._e(),e._v(" "),"formEngine"===e.curRoute?t("div",{staticClass:"form-flow-set"},[t("span",{staticClass:"info-set",on:{click:e._setAppForm}},[e._v(e._s(e.translate.form)+"："+e._s(e.appState.formName||e.translate.pleaseSet))]),e._v(" "),e.appState.formName?t("span",{staticClass:"info-connect"}):e._e(),e._v(" "),e.appState.formName?t("span",{staticClass:"info-set",on:{click:e._setJoinRole}},[e._v(e._s(e.translate.playersSet))]):e._e()]):e._e(),e._v(" "),t("div",{staticClass:"app-desc info-value"},[t("span",{staticClass:"count-limit"},[e._v(e._s(e.curApp.remark?e.curApp.remark.length:0)+"/200")]),e._v(" "),t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.curApp.remark,expression:"curApp.remark"}],staticClass:"desc-part",attrs:{rows:e.rowsNumber,maxlength:"200",placeholder:e.translate.remarkPlaceholder},domProps:{value:e.curApp.remark},on:{change:e._saveAppDesc,input:function(s){s.target.composing||e.$set(e.curApp,"remark",s.target.value)}}})]),e._v(" "),e.descChangeMsg?t("p",{staticClass:"save-tip text-center",class:e.descChangeMsg.indexOf(e.translate.error)>=0?"error":""},[e._v(e._s(e.descChangeMsg))]):e._e(),e._v(" "),t("div",[t("p",[t("strong",[e._v("应用直接访问地址：")]),e._v(" "),t("span",{staticStyle:{"user-select":"text"}},[e._v(e._s("http://"+e.host+"/"+e.$account.schoolId+"/app/"+e.curApp.id))])])])])]),e._v(" "),"link"===e.curRoute?t("div",{staticClass:"middle-link-info"},[t("div",{staticClass:"select-link-manner"},[t("div",{staticClass:"radio-item"},[t("span",{staticClass:"check",on:{click:function(s){e._changeLinkUseBusiness("noUse")}}},[e.curApp&&e.curApp.setting&&!e.curApp.setting.useBusiness?t("i",{staticClass:"maticon active",domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")]):t("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")])]),e._v(" "),t("label",{staticClass:"check-label",class:e.curApp&&e.curApp.setting&&!e.curApp.setting.useBusiness?"active":""},[e._v(e._s(e.translate.directJump))])]),e._v(" "),t("div",{staticClass:"radio-item"},[t("span",{staticClass:"check",on:{click:function(s){e._changeLinkUseBusiness("use")}}},[e.curApp&&e.curApp.setting&&e.curApp.setting.useBusiness?t("i",{staticClass:"maticon active",domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")]):t("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")])]),e._v(" "),t("label",{staticClass:"check-label",class:e.curApp&&e.curApp.setting&&e.curApp.setting.useBusiness?"active":""},[e._v(e._s(e.translate.useBusiness))])])]),e._v(" "),t("div",{staticClass:"set-link input-group info-value"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.curApp&&e.curApp.setting&&e.curApp.setting.linkUrl,expression:"curApp&&curApp.setting&&curApp.setting.linkUrl"}],staticClass:"form-control",attrs:{type:"text",placeholder:e.translate.linkUrlPlaceholder},domProps:{value:e.curApp&&e.curApp.setting&&e.curApp.setting.linkUrl},on:{change:e._saveLink,input:function(s){s.target.composing||e.$set(e.curApp&&e.curApp.setting&&e.curApp.setting,"linkUrl",s.target.value)}}})])]):e._e(),e._v(" "),e.curApp&&e.curApp.setting&&!1!==e.curApp.setting.useBusiness?t("div",{staticClass:"middle"},[t("label",{staticClass:"head-label pull-left",on:{click:e._openReviseBusiness}},[e._v(e._s(e.translate.businessPeriod))]),e._v(" "),t("a",{staticClass:"add-new pull-right",attrs:{href:"javascript:;"},on:{click:e._addNewBusiness}},[e._v(e._s(e.translate.addNew))]),e._v(" "),e.leftIconShow?t("i",{staticClass:"maticon scroll-left",domProps:{innerHTML:e._s(e.icons("chevron_left"))},on:{click:e._scrollLeft}},[e._v("chevron_left")]):e._e(),e._v(" "),e.rightIconShow?t("i",{staticClass:"maticon scroll-right",domProps:{innerHTML:e._s(e.icons("chevron_right"))},on:{click:e._scrollRight}},[e._v("chevron_right")]):e._e(),e._v(" "),t("GeminiScrollbar",{staticClass:"business-div",attrs:{id:"businessDiv",scrollY:!1}},[t("div",{staticClass:"business-scroll"},e._l(e.businessList,function(s,i){return t("div",{key:i,staticStyle:{display:"inline-block",position:"relative"}},[t("div",{staticClass:"mark-div",class:e._compareTime(e.businessList,i)},[t("span")]),e._v(" "),t("div",{staticClass:"business-tab",class:e.curBusiness&&s.business.name===e.curBusiness.business.name?"active":"",attrs:{title:s.business.name},on:{click:function(t){e._changeBusiness(s)}}},[e._v("\n            "+e._s(s.business.name)+" "),s.business.isPublic?e._e():t("i",{staticClass:"maticon remove-icon",domProps:{innerHTML:e._s(e.icons("cancel"))},on:{click:function(s){s.stopPropagation(),e._removeBusiness(i)}}},[e._v("cancel")])])])}))]),e._v(" "),e.curBusiness?t("div",{staticClass:"info-type-tabs"},e._l(e.appState.infoTypes,function(s,i){return e.curBusiness&&e.curBusiness.business.id||"base"===s.id?t("div",{key:i,staticClass:"info-tab text-center",class:s.id===e.appState.infoType?"active":"",on:{click:function(t){e._tabClick(s)}}},[e._v("\n        "+e._s(s.name)+"\n      ")]):e._e()})):e._e()],1):e._e(),e._v(" "),e.curBusiness&&e.curApp.setting&&!1!==e.curApp.setting.useBusiness?t("div",{staticClass:"bottom"},[t("span",[t("a",{staticClass:"release-business",attrs:{href:"javascript:;"}},[e.curBusiness.business.isPublic?e.curBusiness.business.isEnable?t("span",{on:{click:function(s){e._releaseBusiness("stop")}}},[e._v(e._s(e.translate.stopBusinessPeriod))]):t("span",{staticClass:"disabled"},[e._v(e._s(e.translate.businessPeriodDisabled))]):t("span",{class:e.releaseBusinessDisabled?"disabled":"",on:{click:function(s){e._releaseBusiness("release")}}},[e._v(e._s(e.annoreleaseBusinessText||e.translate.releaseBusinessPeriod))])])]),e._v(" "),e.curBusiness.business.isPublic?e._e():t("span",{staticClass:"save-business",on:{click:function(s){e._save("business")}}},[e._v(e._s(e.translate.saveBusinessDeploy))]),e._v(" "),e.isReviseBusiness?t("span",{staticClass:"save-business revise",on:{click:e._reviseBusinessInfo}},[e._v(e._s(e.translate.saveBusinessDeploy))]):e._e(),e._v(" "),t("span",{staticClass:"error-tip",class:e.errorMsg?"active":""},[e._v(e._s(e.errorMsg))]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:"base"===e.appState.infoType,expression:"appState.infoType === 'base'"}],staticClass:"info-body container-fluid"},[t("div",{staticClass:"col-sm-6 padding-right"},[t("div",{staticClass:"form-group base-item"},[t("label",[e._v(e._s(e.translate.businessName))]),e._v(" "),!e.curBusiness.business.isPublic||e.isReviseBusiness?t("input",{directives:[{name:"model",rawName:"v-model",value:e.curBusiness.business.name,expression:"curBusiness.business.name"}],staticClass:"form-control valid",attrs:{type:"text",placeholder:e.translate.businessNamePlaceholder,maxlength:"30"},domProps:{value:e.curBusiness.business.name},on:{change:e._changeBusinessName,input:function(s){s.target.composing||e.$set(e.curBusiness.business,"name",s.target.value)}}}):t("input",{staticClass:"form-control",attrs:{type:"text",readonly:""},domProps:{value:e.curBusiness.business.name}})])]),e._v(" "),t("div",{staticClass:"col-sm-6 padding-left"},[t("div",{staticClass:"form-group base-item"},[t("label",[e._v(e._s(e.translate.schoolYear))]),e._v(" "),t("v-select",{staticClass:"info-value btn-block",attrs:{options:e.appState.gradeOptions,value:e.curBusiness.business.year||(new Date).getFullYear()+"_0","options-value":"id","options-label":"label","close-on-select":"",disabled:!(!e.curBusiness.business.isPublic||e.isReviseBusiness),search:""},on:{afterSelected:e._afterSelectYear}})],1)]),e._v(" "),"formEngine"===e.curRoute?t("div",{staticClass:"col-sm-6 padding-right"},[t("div",{staticClass:"form-group base-item",class:e.isReviseBusiness?"active":"",on:{click:function(s){e._reviseBusinessData("form")}}},[t("label",{class:e.isReviseBusiness?"active":""},[e._v(e._s(e.translate.form)+"("+e._s(e.translate.basicInfoTip)+")")]),e._v(" "),t("input",{staticClass:"form-control",class:e.isReviseBusiness?"active":"",attrs:{readonly:""},domProps:{value:e.appState.formName||e.translate.unboundForm}})])]):e._e(),e._v(" "),"formEngine"===e.curRoute?t("div",{staticClass:"col-sm-6 padding-left"},[t("div",{staticClass:"form-group base-item",class:e.isReviseBusiness?"active":"",on:{click:function(s){e._reviseBusinessData("players")}}},[t("label",{class:e.isReviseBusiness?"active":""},[e._v(e._s(e.translate.playersSet)+"("+e._s(e.translate.basicInfoTip)+")")]),e._v(" "),t("input",{staticClass:"form-control",class:e.isReviseBusiness?"active":"",attrs:{readonly:""}})])]):e._e()]),e._v(" "),e.curBusiness.business.id?t("div",{directives:[{name:"show",rawName:"v-show",value:"faceTo"===e.appState.infoType,expression:"appState.infoType === 'faceTo'"}],staticClass:"info-body container-fluid outer-container"},[e.faceToPeopleType.indexOf(e.curApp&&e.curApp.appType&&e.curApp.appType.userType)<0?t("div",{staticClass:"limit-radios"},[t("div",{staticClass:"radio-item small-item",class:"0"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic?"":"active"},[t("span",{staticClass:"check",class:e.curBusiness.business.isPublic?"disable":"",on:{click:function(s){e._changeLimitType("0")}}},["0"!==e.curBusiness.business.limitType?t("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")]):t("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")])]),e._v(" "),t("label",{staticClass:"check-label"},[e._v(e._s(e.translate.unlimited))])]),e._v(" "),t("div",{staticClass:"radio-item large-item",class:"1"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic?"":"active"},[t("div",{staticClass:"large-check-part"},[t("span",{staticClass:"check",class:e.curBusiness.business.isPublic?"disable":"",on:{click:function(s){e._changeLimitType("1")}}},["1"!==e.curBusiness.business.limitType?t("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")]):t("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")])]),e._v(" "),t("label",{staticClass:"check-label"},[e._v(e._s(e.translate.filterByCondition))])]),e._v(" "),t("div",{staticClass:"large-select-part"},[t("div",{staticClass:"select-group"},[t("label",[e._v(e._s(e.translate.studentType))]),e._v(" "),t("v-select",{staticClass:"info-value btn-block",attrs:{url:"/api/system/dictTypes/1004/dicts",value:e.curBusiness.businessLimit?e.curBusiness.businessLimit.studentType:"","options-value":"value","options-label":"label","close-on-select":"",justified:"",disabled:"1"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic},on:{afterSelected:e._afterSelectStuType}})],1)]),e._v(" "),t("div",{staticClass:"large-select-part"},[t("div",{staticClass:"select-group"},[t("label",[e._v(e._s(e.translate.studentGrade))]),e._v(" "),t("v-select",{staticClass:"info-value btn-block",attrs:{options:e.appState.gradeOptions2,value:e.curBusiness.businessLimit?e.curBusiness.businessLimit.grade:"","options-value":"id","options-label":"label","close-on-select":"",justified:"",disabled:"1"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic},on:{afterSelected:e._afterSelectGrade}})],1)]),e._v(" "),t("div",{staticClass:"large-select-part"},[t("div",{staticClass:"select-group"},[t("label",[e._v(e._s(e.translate.inSchoolStatus))]),e._v(" "),t("v-select",{staticClass:"info-value btn-block",attrs:{options:e.appState.inSchoolOptions,value:e.curBusiness.businessLimit?parseInt(e.curBusiness.businessLimit.inSchool):"","options-value":"id","options-label":"label","close-on-select":"",justified:"",disabled:"1"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic},on:{afterSelected:e._afterSelectInSchool}})],1)])]),e._v(" "),t("div",{staticClass:"radio-item small-item",class:"2"===e.curBusiness.business.limitType?"active":""},[t("span",{staticClass:"check",class:e.curBusiness.business.isPublic?"disable":"",on:{click:function(s){e._changeLimitType("2")}}},["2"!==e.curBusiness.business.limitType?t("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")]):t("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")])]),e._v(" "),t("label",{staticClass:"check-label"},[e._v(e._s(e.translate.uploadList))]),e._v(" "),"2"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic?e._e():t("div",{staticClass:"pull-right opt-div"},[t("a",{staticClass:"opt-btn",attrs:{href:"javascript:;"},on:{click:e.showImportPage}},[t("span",[e._v(e._s(e.translate.batchUpload))])]),e._v(" "),t("a",{staticClass:"opt-btn",attrs:{href:"javascript:;"},on:{click:e.exportUserInfo}},[e._v(e._s(e.translate.export))])])]),e._v(" "),"2"===e.curBusiness.business.limitType?t("div",{staticClass:"stus-list"},[e.curBusiness.business.id?t("v-table",{attrs:{url:e.peopleUrl,pagesize:"5",idField:"id",columns:e.appState.columns,order:!0}}):t("span",{staticClass:"table-tip"},[e._v(e._s(e.translate.noData))])],1):e._e()]):t("div",{staticClass:"limit-radios"},[t("div",{staticClass:"radio-item small-item",class:"0"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic?"":"active"},[t("span",{staticClass:"check",class:e.curBusiness.business.isPublic?"disable":"",on:{click:function(s){e._changeLimitType("0")}}},["0"!==e.curBusiness.business.limitType?t("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")]):t("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")])]),e._v(" "),e.curApp&&e.curApp.appType&&"3"===e.curApp.appType.userType?t("label",{staticClass:"check-label"},[e._v(e._s(e.translate.allFreshmen))]):t("label",{staticClass:"check-label"},[e._v(e._s(e.translate.allInstructor))])]),e._v(" "),t("div",{staticClass:"radio-item small-item",class:"2"===e.curBusiness.business.limitType?"active":""},[t("span",{staticClass:"check",class:e.curBusiness.business.isPublic?"disable":"",on:{click:function(s){e._changeLimitType("2")}}},["2"!==e.curBusiness.business.limitType?t("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")]):t("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")])]),e._v(" "),t("label",{staticClass:"check-label"},[e._v(e._s(e.translate.uploadList))]),e._v(" "),"2"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic?e._e():t("div",{staticClass:"pull-right opt-div"},[t("a",{staticClass:"opt-btn",attrs:{href:"javascript:;"},on:{click:e.showImportPage}},[t("span",[e._v(e._s(e.translate.batchUpload))])]),e._v(" "),t("a",{staticClass:"opt-btn",attrs:{href:"javascript:;"},on:{click:e.exportUserInfo}},[e._v(e._s(e.translate.export))])])]),e._v(" "),"2"===e.curBusiness.business.limitType?t("div",{staticClass:"stus-list"},[e.curBusiness.business.id?t("v-table",{attrs:{url:e.peopleUrl,pagesize:"5",idField:"id",columns:e.appState.columns,order:!0}}):t("span",{staticClass:"table-tip"},[e._v(e._s(e.translate.noData))])],1):e._e()]),e._v(" "),e.showImportModal?t("div",{staticClass:"import-modal"},[t("v-import",e._b({on:{backParentPage:e.backParentPage}},"v-import",e.importParams,!1))],1):e._e()]):e._e(),e._v(" "),e.curBusiness.business.id?t("div",{directives:[{name:"show",rawName:"v-show",value:"timeSet"===e.appState.infoType,expression:"appState.infoType === 'timeSet'"}],staticClass:"info-body"},["formEngine"===e.curRoute?t("div",{staticClass:"time-set-info"},e._l(e.timeSetData,function(s,i){return t("div",{key:i,staticClass:"time-set-group"},[t("div",{staticClass:"start-time-group",class:e.timeNodeId===s.nodeId&&"startDate"===e.timeType?"active":"",on:{click:function(t){e._nodeSelected(t,s.nodeId,"startDate",s.title)}}},[t("label",{staticClass:"role-name"},[t("span",{staticClass:"role-title"},[e._v(e._s(s.title))]),t("span",{staticClass:"time-tip"},[e._v(e._s(e.translate.startTime))])]),e._v(" "),t("p",{staticClass:"time-info"},[e._v(e._s(s.startDate||e.translate.noSet)+" ")])]),e._v(" "),t("div",{staticClass:"end-time-group",class:e.timeNodeId===s.nodeId&&"endDate"===e.timeType?"active":"",on:{click:function(t){e._nodeSelected(t,s.nodeId,"endDate",s.title)}}},[t("label",{staticClass:"role-name"},[t("span",{staticClass:"role-title"},[e._v(e._s(s.title))]),t("span",{staticClass:"time-tip"},[e._v(e._s(e.translate.endTime))])]),e._v(" "),t("p",{staticClass:"time-info"},[e._v(e._s(s.endDate||e.translate.noSet))])])])})):t("div",{staticClass:"time-set-info"},[t("div",{staticClass:"start-time-group",class:"startTime"===e.timeType?"active":"",on:{click:function(s){e._linkBusinessTime("startTime")}}},[t("label",{staticClass:"role-name"},[t("span",{staticClass:"time-tip"},[e._v(e._s(e.translate.startTime))])]),e._v(" "),t("p",{staticClass:"time-info"},[e._v(e._s(e.curBusiness.business.beginTime||e.translate.noSet)+" ")])]),e._v(" "),t("div",{staticClass:"end-time-group",class:"endTime"===e.timeType?"active":"",on:{click:function(s){e._linkBusinessTime("endTime")}}},[t("label",{staticClass:"role-name"},[t("span",{staticClass:"time-tip"},[e._v(e._s(e.translate.endTime))])]),e._v(" "),t("p",{staticClass:"time-info"},[e._v(e._s(e.curBusiness.business.endTime||e.translate.noSet))])])])]):e._e(),e._v(" "),e.curBusiness.business.id&&"description"===e.appState.infoType?t("div",{staticClass:"info-body container-fluid"},[!e.curBusiness.business.isPublic||e.isReviseBusiness?t("u-editor",{ref:"description",attrs:{config:e.editorConfig},model:{value:e.curBusiness.business.guide,callback:function(s){e.$set(e.curBusiness.business,"guide",s)},expression:"curBusiness.business.guide"}}):t("div",{domProps:{innerHTML:e._s(e.curBusiness.business.guide)}})],1):e._e()]):e._e(),e._v(" "),e.readonly?e._e():t("v-modal",{attrs:{show:e.appState.showFormModal,effect:"fade",width:"374"}},[t("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[t("h5",{staticClass:"modal-title"},[e._v("\n        "+e._s(e.translate.selectModal)+"\n      ")])]),e._v(" "),t("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[t("label",[e._v(e._s(e.translate.modalTip))]),e._v(" "),t("ul",{staticClass:"list-group"},[t("li",{staticClass:"list-group-item",class:e.appState.modelId===e.blankTemplateId?"active":"",on:{click:function(s){e.appState.modelId=e.blankTemplateId}}},[e._v("\n          "+e._s(e.translate.blankFormTemplate)+"\n        ")]),e._v(" "),e._l(e.formList,function(s,i){return t("li",{key:i,staticClass:"list-group-item",class:e.appState.modelId===s.id?"active":"",on:{click:function(t){e.appState.modelId=s.id}}},[e._v("\n          "+e._s(s.name)+e._s(e.translate.modal)+"\n        ")])})],2)]),e._v(" "),t("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[t("a",{attrs:{href:"javascript:;"},on:{click:function(s){e.appState.showFormModal=!1}}},[e._v(e._s(e.translate.cancel))]),e._v(" "),t("a",{staticClass:"sure-btn",attrs:{href:"javascript:;"},on:{click:e._initWithModel}},[e._v(e._s(e.translate.confirm))])])]),e._v(" "),t("v-modal",{attrs:{show:e.showIconModal,effect:"fade",width:"446"}},[t("div",{staticClass:"modal-header iconModal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[t("h5",{staticClass:"modal-title"},[e._v("\n       "+e._s(e.translate.editIcon)+"\n      ")])]),e._v(" "),t("div",{staticClass:"modal-body iconModal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[t("div",{staticClass:"background-container"},e._l(e.backgroundList,function(s,i){return t("span",{key:i,staticClass:"background",style:{background:s.background},on:{click:function(t){e._selectBackground(s)}}},[e.appState.background===s.background?t("i",{staticClass:"maticon icon-done",domProps:{innerHTML:e._s(e.icons("done"))}},[e._v("done")]):e._e()])})),e._v(" "),t("div",{staticClass:"icon-list"},[e._l(e.iconList,function(s,i){return t("i",{key:i,staticClass:"maticon",class:{active:"1"===e.appState.imgType&&e.appState.imgPath===s.name},domProps:{innerHTML:e._s(e.icons(s.name))},on:{click:function(t){e._selectIcon(s)}}},[e._v(e._s(s.name))])}),e._v(" "),e._l(e.saasIconList,function(s,i){return t("i",{key:i,class:{active:"2"===e.appState.imgType&&e.appState.imgPath===s},on:{click:function(t){e._selectIcon({name:s},"2")}}},[t("span",{staticClass:"saasicon",class:["saasicon-"+s+"-black"]})])})],2)]),e._v(" "),t("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[t("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(s){e._cancelPart("icon")}}},[e._v(e._s(e.translate.cancel))]),e._v(" "),t("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:e._saveAppIcon}},[e._v(e._s(e.translate.confirm))])])])],1)},staticRenderFns:[]};var v=t("C7Lr")(h,b,!1,function(e){t("4mkp")},null,null).exports,_=t("bTp3"),g=t("9r/T");n.a.component("v-flow",_.a);n.a.component("v-flow",_.a);var f={inject:{windowObj:{default:null}},props:{departmentId:{default:"1"},appId:{default:"1"},readonly:{default:!1},businessId:{default:null},appName:{default:null},roleSetting:{default:null},userType:{default:null}},created:function(){var e=this,s=localStorage.getItem("lang");Object(c.e)(s)&&(this.lang=s),this.roleSetting&&(this.isConfig=!0),"4"===this.userType&&this.distributaryData.splice(1,2),this.isConfig?(this.$waiting.show(),Object(c.c)({url:"/api/information/components/"+this.roleSetting.type,type:"get",data:{educationLevel:this.roleSetting.educationLevel},success:function(s){s.state?(s.data.forEach(function(s,t){s.components.forEach(function(t,i){e.components.push({name:t.name,title:t.title+"("+s.name+")",componentType:t.componentType,checked:!1}),e.ownerData.dataAuthorities.push({componentName:t.name,authority:"readonly"})})}),e.copyDataAuthorities=JSON.parse(a()(e.ownerData.dataAuthorities)),Object(c.c)({url:"/api/information/player/"+e.roleSetting.type,type:"get",data:{educationLevel:e.roleSetting.educationLevel},success:function(s){s.state?(s.data&&s.data.players.forEach(function(s,t){if("owner"===s.category){e.ownerData=s,(i=JSON.parse(a()(e.copyDataAuthorities))).forEach(function(s,t){e.ownerData.dataAuthorities.forEach(function(e,t){s.componentName===e.componentName&&(s.authority=e.authority)})}),e.ownerData.dataAuthorities=i}else{var i,n={};e.$set(n,"palyerForm",{}),n.palyerForm=s,(i=JSON.parse(a()(e.copyDataAuthorities))).forEach(function(e,s){n.palyerForm.dataAuthorities.forEach(function(s,t){e.componentName===s.componentName&&(e.authority=s.authority)})}),n.palyerForm.dataAuthorities=i,e.$set(n,"roleEditing",!1),e.$set(n,"newRoleName",""),e.$set(n,"roleAddErrorMsg",""),e.$set(n,"curComponentsCount",0),e.$set(n,"curPlayerCount",0),e.$set(n,"AllComponents",[]),e.$set(n,"roleSetData",[]),e.$set(n,"batchCheck",""),e.$set(n,"playerName",""),e.$set(n,"searchName",""),n.curPlayerCount=s.operators.length,n.AllComponents=JSON.parse(a()(e.components)),e.palyers.push(n)}}),Object(g.setTimeout)(function(){var s=o()(".col").height();e.ownerContentHeight=s-190},300),e.monitorScroll()):e.$toast(s.message)}}).always(function(){e.$waiting.close()})):e.$toast(s.message)}}).always(function(){e.$waiting.close()})):(this.businessId?(this.formUrl="/api/app/"+this.appId+"/publishBusiness/"+this.businessId+"/formSetting",this.playersUrl="/api/app/"+this.appId+"/publishBusiness/"+this.businessId+"/playerSetting"):(this.formUrl="/api/apps/"+this.appId+"/settings/forms",this.playersUrl="/api/apps/"+this.appId+"/settings/players"),Object(c.c)({url:this.formUrl,type:"get",success:function(s){if(s.state){e.components=s.data.components;e.components.forEach(function(s,t){e.$set(s,"checked",!1),e.ownerData.dataAuthorities.push({componentName:s.name,authority:"readonly"})}),e.copyDataAuthorities=JSON.parse(a()(e.ownerData.dataAuthorities)),e.$set(e.curForm,"formSettingName",s.data.name),e.$set(e.curForm,"formSettingId",s.data.id),Object(c.c)({url:e.playersUrl,type:"get",success:function(s){s.state?(s.data&&(e.playersId=s.data.id,e.multiForm=!!s.data.multiForm,s.data.players.forEach(function(s,t){if("owner"===s.category){e.ownerData=s,(i=JSON.parse(a()(e.copyDataAuthorities))).forEach(function(s,t){e.ownerData.dataAuthorities.forEach(function(e,t){s.componentName===e.componentName&&(s.authority=e.authority)})}),e.ownerData.dataAuthorities=i}else{var i,n={};e.$set(n,"palyerForm",{}),n.palyerForm=s,(i=JSON.parse(a()(e.copyDataAuthorities))).forEach(function(e,s){n.palyerForm.dataAuthorities.forEach(function(s,t){e.componentName===s.componentName&&(e.authority=s.authority)})}),n.palyerForm.dataAuthorities=i,e.$set(n,"roleEditing",!1),e.$set(n,"newRoleName",""),e.$set(n,"roleAddErrorMsg",""),e.$set(n,"curComponentsCount",0),e.$set(n,"curPlayerCount",0),e.$set(n,"AllComponents",[]),e.$set(n,"roleSetData",[]),e.$set(n,"batchCheck",""),e.$set(n,"playerName",""),e.$set(n,"searchName",""),e.$set(n,"roleSetSearchName",""),n.curPlayerCount=s.operators.length,n.AllComponents=JSON.parse(a()(e.components)),e.palyers.push(n),e._initRoleList(t-1)}})),Object(g.setTimeout)(function(){var s=o()(".col").height().toFixed(1);e.ownerContentHeight=s-190},300),e.monitorScroll()):e.$toast(s.message)}})}else e.$toast(s.message)}})),this.operatorData.forEach(function(s,t){s.name=e.translate.operatorData[s.id]})},data:function(){return{positionLeft:null,newDistributaryData:[],distributaryData:[{id:"bySchool",name:"全校统一汇总"},{id:"byClass",name:"以班级关系分配"},{id:"byTeacher",name:"以带生关系分配"},{id:"byCollege",name:"以学院关系分配"}],roleList:[],components:[],operatorData:[{id:"required",name:"必填",coms:["input","number","select","checkbox","radio","datetime","address","table","attachment","image","signature","map"]},{id:"optional",name:"选填",coms:["input","number","select","checkbox","radio","datetime","address","table","attachment","image","signature","map"]},{id:"readonly",name:"只读",coms:["input","number","select","checkbox","radio","datetime","address","table","attachment","image","signature","splitLine","label","map"]},{id:"hide",name:"隐藏",coms:["input","number","select","checkbox","radio","datetime","address","table","attachment","image","signature","splitLine","label","map"]}],permission:{reject:{usable:!1,properties:{rejectTo:"lastNode",rejectBackTo:"flowWay"}},revocation:{usable:!1},deliverTo:{usable:!1},sendTo:{usable:!1},batch:{usable:!1},cancelByUser:{usable:!1}},batchCheck:"",roleEditing:!1,curNode:{distributary:"",operators:[],dataAuthorities:[{authority:null}]},curLink:{},otherLink:{nextNodeId:""},curForm:{formSettingId:"",formSettingName:""},isApplyNode:!1,isChange:!1,isSelectBatchSet:!1,palyers:[],ownerData:{id:"owner",name:"",category:"owner",distributary:"",operators:[],dataAuthorities:[],batch:!1},copyDataAuthorities:[],curComponentsCount:{},nameIsNull:!0,roleNameArray:[],nameChangeMsg:"",noRoleSetAfaterHeight:"",scrollAreaHeight:"",newAuthorityMaxHeight:"",roleSetContentHeight:"",headerIsFixed:"",batchHeadIsFixed:"",ownerHeaderIsFixed:"",ownerContentHeight:0,scrollIndex:0,formUrl:"",playersUrl:"",playersId:"",configurationArray:["infoConfig"],isConfig:!1,owenrSearchName:"",multiForm:!1,lang:"zh-cn"}},computed:{translate:function(){return Object(c.e)(this.lang).joinRoleSetManage},componentsCheckAllCount:function(){var e=0;return this.components.forEach(function(s){s.checked&&e++}),e},setColStyle:function(){return this.palyers.length<=1?{"text-align":"center","padding-left":"105px"}:{"text-align":"left","padding-left":"0"}}},watch:{headerIsFixed:{handler:function(){this.headerIsFixed?o()("#readWriteContent"+this.scrollIndex).css("padding-bottom","50px"):o()("#readWriteContent"+this.scrollIndex).css("padding-bottom","0")},deep:!0},batchHeadIsFixed:{handler:function(){this.batchHeadIsFixed?o()("#readWriteContent"+this.scrollIndex).css("padding-bottom","100px"):o()("#readWriteContent"+this.scrollIndex).css("padding-bottom","0")},deep:!0},ownerHeaderIsFixed:{handler:function(){this.ownerHeaderIsFixed?this.ownerContentHeight=this.ownerContentHeight-60:this.ownerContentHeight=this.ownerContentHeight+60},deep:!0},windowObj:{deep:!0,handler:function(e){var s=o()(".col").height();this.roleSetContentHeight=s-268,this.ownerContentHeight=s-190,this.scrollAreaHeight=s-238,this.noRoleSetAfaterHeight=s-190,this.newAuthorityMaxHeight=s-83}}},mounted:function(){var e=this;Object(g.setTimeout)(function(){var s=o()(".col").height().toFixed(1);e.isConfig?e.newAuthorityMaxHeight=s-263:e.newAuthorityMaxHeight=s-228},300),o()("#joinRolePage").keydown(function(s){return 1!=s.ctrlKey||83!=s.keyCode||(e._saveJoinSet(),e.$emit("back"),s.preventDefault(),!1)})},methods:{getContentHeight:function(e){return this.isConfig?this.newAuthorityMaxHeight+"px":"byTeacher"!==this.palyers[e].palyerForm.distributary&&""!=this.palyers[e].palyerForm.distributary?"":this.newAuthorityMaxHeight+"px"},monitorScroll:function(){var e=this,s=!1,t=!1,i=!1;this.isConfig||Object(g.setTimeout)(function(){o()(".scroll-area").scroll(function(){var i=o()(this).attr("data-id");e.scrollIndex=i;var a=o()(this).children().find(".participant-readWrite-content").position().top,n=o()(".col").height().toFixed(1);a<=50?(o()(this).children().find(".participant-readWrite-header").css("display","none"),o()(this).siblings(".fiexd-header").css("display","block"),o()("#scrollArea"+i).css("height",n-288),e.headerIsFixed=!0,s=!0):(o()(this).children().find(".participant-readWrite-header").css("display","block"),o()(this).siblings(".fiexd-header").css("display","none"),o()("#scrollArea"+i).css("height",n-238),s&&(e.headerIsFixed=!1)),a<=-78?(o()(this).children(".participant-readWrite-content").find(".batch-head").css("display","none"),o()(this).siblings(".fiexd-batch-head").css("display","block"),e.palyers[i].curComponentsCount>0&&(o()(this).siblings(".fiexd-header").children(".participant-readWrite-header").css("box-shadow","none"),o()(this).siblings(".fiexd-batch-head").children(".batch-head").css("box-shadow","0 0 0 0 rgba(0,0,0,0.12), 0 4px 4px 0 rgba(0,0,0,0.12)"),e.batchHeadIsFixed=!0,t=!0)):(o()(this).children(".participant-readWrite-content").find(".batch-head").css("display","block"),o()(this).siblings(".fiexd-batch-head").css("display","none"),o()(this).siblings(".fiexd-header").children(".participant-readWrite-header").css("box-shadow"," 0 0 0 0 rgba(0,0,0,0.12), 0 4px 4px 0 rgba(0,0,0,0.12)"),o()(this).siblings(".fiexd-batch-head").children(".batch-head").css("box-shadow","none"),t&&(e.batchHeadIsFixed=!1))}),o()(".owner-readWrite-content").scroll(function(){var s=o()(this).children(".role-list").position().top;e.componentsCheckAllCount>0&&(s<=-4?(o()(this).children(".batch-head").css("display","none"),o()(this).siblings(".owner-batch-head").css("display","block"),e.ownerHeaderIsFixed=!0,i=!0):(o()(this).children(".batch-head").css("display","block"),o()(this).siblings(".owner-batch-head").css("display","none"),i&&(e.ownerHeaderIsFixed=!1)))})},300)},_allowWriteMultipleForm:function(){this.multiForm=!this.multiForm},_back:function(){if(this.isChange&&confirm(this.translate.backTip)&&this._saveJoinSet(),!this.nameIsNull)return!1;this.$emit("back")},_saveJoinSet:function(){var e=this,s=[];if(s.push(this.ownerData),this.palyers.forEach(function(e,t){s.push(e.palyerForm)}),s.forEach(function(s,t){"owner"===s.category?s.name?e.nameIsNull=!0:(e.$toast("表单所属人名称不能为空"),e.nameIsNull=!1):s.name?e.nameIsNull=!0:(e.$toast("参与者名称不能为空"),e.nameIsNull=!1)}),!this.nameIsNull)return!1;this.isConfig?this.$emit("submit",{players:s,educationLevel:this.roleSetting.educationLevel,type:this.roleSetting.type}):this.businessId?this.$emit("submit",{id:this.playersId,multiForm:this.multiForm,players:s}):this.$emit("submit",{multiForm:this.multiForm,players:s})},_addRole:function(){this.isChange=!0;(new Date).getTime();var e={};this.$set(e,"palyerForm",{}),this.$set(e,"roleEditing",!1),this.$set(e,"newRoleName",""),this.$set(e,"roleAddErrorMsg",""),this.$set(e,"curComponentsCount",0),this.$set(e,"AllComponents",[]),this.$set(e,"roleSetData",[]),this.$set(e,"batchCheck",""),this.$set(e,"curPlayerCount",0),this.$set(e,"playerName",""),this.$set(e,"searchName",""),this.$set(e,"roleSetSearchName",""),this.$set(e.palyerForm,"id",""),this.$set(e.palyerForm,"name",""),this.$set(e.palyerForm,"category","participant"),this.$set(e.palyerForm,"distributary",""),this.$set(e.palyerForm,"operators",[]),this.$set(e.palyerForm,"dataAuthorities",[]),this.$set(e.palyerForm,"batch",!1),e.palyerForm.id="player_"+(new Date).getTime();this.components.forEach(function(s,t){e.palyerForm.dataAuthorities.push({componentName:s.name,authority:"readonly"})}),e.AllComponents=JSON.parse(a()(this.components)),this.palyers.push(e)},_deletePlayers:function(e){this.palyers.splice(e,1)},_getAuthorityOf:function(e,s){var t="";return s.dataAuthorities&&s.dataAuthorities.forEach(function(s){e.name===s.componentName&&(t=s.authority)}),t},_setAuthorityOf:function(e,s,t){var i=this,a=!1;t.dataAuthorities&&t.dataAuthorities.forEach(function(t){e.name===t.componentName&&(a=!0,i.$set(t,"authority",s))}),a||t.dataAuthorities.push({componentName:e.name,authority:s})},_batchSure:function(e,s){var t=this;this.isChange=!0,"participant"===e?(this.palyers[s].AllComponents.forEach(function(e,i){e.checked&&(t._getAuthorityOf(e,t.palyers[s].palyerForm)?t._setAuthorityOf(e,t._verifyBatch(e,t.palyers[s].batchCheck),t.palyers[s].palyerForm):t.palyers[s].palyerForm.dataAuthorities.push({authority:t._verifyBatch(e,t.palyers[s].batchCheck),componentName:e.name}),e.checked=!1)}),this.palyers[s].batchCheck="",this._componentsCheckAllCount(s)):(this.components.forEach(function(e,s){e.checked&&(t._getAuthorityOf(e,t.ownerData)?t._setAuthorityOf(e,t._verifyBatch(e,t.batchCheck),t.ownerData):t.ownerData.dataAuthorities.push({authority:t._verifyBatch(e,t.batchCheck),componentName:e.name}),e.checked=!1)}),this.batchCheck="")},_verifyBatch:function(e,s){var t=!1;return this.operatorData.forEach(function(i){i.id===s&&i.coms.indexOf(e.componentType)>=0&&(t=!0)}),t?s:""},_afterSelectedDis:function(e){var s=parseInt(e.target.$attrs["data-index"]);this.isChange=!0,this.palyers[s].roleEditing=!1,this.palyers[s].palyerForm.operators=[],this.palyers[s].curPlayerCount=0,this.isConfig||this._initRoleList(s)},_initRoleList:function(e){var s=this;"bySchool"===this.palyers[e].palyerForm.distributary||"byCollege"===this.palyers[e].palyerForm.distributary?Object(c.c)({url:"/api/approveRoles",type:"get",data:{level:"bySchool"===this.palyers[e].palyerForm.distributary?"SCHOOL":"COLLEGE",departmentId:this.departmentId},success:function(t){if(t.state){s.palyers[e].roleSetData=t.data.reverse();var i=null;i&&clearTimeout(i),i=Object(g.setTimeout)(function(){var e=o()(".col").height().toFixed(1);s.roleSetContentHeight=e-268,s.scrollAreaHeight=e-238,s.noRoleSetAfaterHeight=e-170,s.newAuthorityMaxHeight=e-83},300)}else s.$toast(t.message)}}):"byClass"===this.palyers[e].palyerForm.distributary&&Object(c.c)({url:"/api/relClass/classCommittees",type:"get",success:function(t){if(t.state){t.data.forEach(function(e){e.name=e.text}),s.palyers[e].roleSetData=t.data.reverse();var i=null;i&&clearTimeout(i),i=Object(g.setTimeout)(function(){var e=o()(".col").height().toFixed(1);s.roleSetContentHeight=e-268,s.scrollAreaHeight=e-238,s.noRoleSetAfaterHeight=e-170,s.newAuthorityMaxHeight=e-83},300)}else s.$toast(t.message)}})},_checkOperators:function(e,s){this.isChange=!0;var t=this.palyers[s].palyerForm.operators.indexOf(parseInt(e.id));t>=0?this.palyers[s].palyerForm.operators.splice(t,1):this.palyers[s].palyerForm.operators.push(parseInt(e.id)),this._roleCheckAllCount(s)},_changeCheckState:function(e,s,t,i){var a=this;this.isChange=!0;var n=!1;0===s&&(n=!0),this.isConfig?("dataAuthorities"===t&&e.forEach(function(e){e.title.indexOf(a.palyers[i].searchName)>=0&&(e.checked=n)}),"owner"===t&&e.forEach(function(e){e.title.indexOf(a.owenrSearchName)>=0&&(e.checked=n)})):"operators"===t?e.forEach(function(e){e.name.indexOf(a.palyers[i].roleSetSearchName)>=0&&(e.checked=n)}):e.forEach(function(e){e.checked=n}),"operators"===t?(this.palyers[i].palyerForm[t]=[],e.forEach(function(e){e.checked&&a.palyers[i].palyerForm[t].push(parseInt(e.id))}),this._roleCheckAllCount(i)):"dataAuthorities"===t&&this._componentsCheckAllCount(i)},_afterSelectedOperator:function(e){var s=parseInt(e.target.$attrs["data-index"]);this.isChange=!0,this.palyers[s].batchCheck=e.val,this._componentsCheckAllCount(s)},_afterSelectedOwner:function(e){this.isChange=!0,this.batchCheck=e.val},_creatNewRole:function(e){this.palyers[e].roleEditing=!0,o()("#roleContent"+e).animate({scrollTop:"0px"},300)},_saveNewRole:function(e,s){var t=this;this.isChange=!0;o()(this);if(!e)return this.palyers[s].roleAddErrorMsg="角色名不能为空",Object(g.setTimeout)(function(){t.palyers[s].roleAddErrorMsg=""},1500),!1;""===e.replace(/\s/g,"")&&(this.palyers[s].roleAddErrorMsg=this.roleEmptyTip),this.palyers[s].roleSetData.forEach(function(i){e===i.name&&(t.palyers[s].roleAddErrorMsg&&(t.palyers[s].roleAddErrorMsg+=","),t.palyers[s].roleAddErrorMsg+=t.translate.roleExistTip)}),this.palyers[s].roleAddErrorMsg?Object(g.setTimeout)(function(){t.palyers[s].roleAddErrorMsg=""},1500):Object(c.c)({url:"/api/approveRoles",type:"post",data:{name:e,level:"bySchool"===this.palyers[s].palyerForm.distributary?"SCHOOL":"COLLEGE",departmentId:this.departmentId},success:function(i){i.state?(t.palyers[s].roleSetData.unshift({id:i.data,name:e}),t.palyers[s].palyerForm.operators.push(parseInt(i.data)),t.palyers[s].roleEditing=!1):t.$toast(i.message)}})},_changeBatchSet:function(e){this.palyers[e].palyerForm.batch?this.palyers[e].palyerForm.batch=!1:this.palyers[e].palyerForm.batch=!0},_roleCheckAllCount:function(e){var s=this;return this.palyers[e].curPlayerCount=0,this.palyers[e].palyerForm&&this.palyers[e].palyerForm.operators&&this.palyers[e].roleSetData.forEach(function(t){s.palyers[e].palyerForm.operators.indexOf(parseInt(t.id))>=0&&s.palyers[e].curPlayerCount++}),this.palyers[e].curPlayerCount},_componentsCheckAllCount:function(e){var s=this;return this.palyers[e].curComponentsCount=0,this.palyers[e].AllComponents.forEach(function(t){t.checked&&s.palyers[e].curComponentsCount++}),this.palyers[e].curComponentsCount},_changeComSelect:function(e,s){e.checked=!e.checked,this._componentsCheckAllCount(s)},_changeNameInput:function(){this.isChange=!0},_newRowInputFocus:function(e){this.palyers[e].newRoleName=this.appName+this.palyers[e].palyerForm.name+"管理员"}},destroyed:function(){o()(window).off("keydown")}},y={render:function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"container-fluid",attrs:{id:"joinRolePage",tabindex:"1"}},[t("div",{staticClass:"head text-center"},[t("div",{staticClass:"pull-left back-div"},[t("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("arrow_back"))},on:{click:e._back}},[e._v("arrow_back")])]),e._v(" "),t("div",{staticClass:"flow-title"},[e._m(0),e._v(" "),t("a",{attrs:{href:"javascript:;"}},[e.curForm.formSettingId?t("span",[e._v("关联表单："+e._s(e.curForm.formSettingName))]):t("span",[e._v(e._s(e.translate.relevanceTip))])])]),e._v(" "),t("div",{staticClass:"pull-right opt-div"},[t("a",{staticClass:"opt-btn",attrs:{href:"javascript:;"},on:{click:e._back}},[e._v("取消")]),e._v(" "),t("button",{staticClass:"btn save",on:{click:e._saveJoinSet}},[e._v("保存")])])]),e._v(" "),t("div",{staticClass:"joinSet-content"},[t("GeminiScrollbar",{staticClass:"info-container",style:e.setColStyle,attrs:{scrollY:!1,autoshow:!0}},[t("div",{staticClass:"col first-col"},[t("div",{staticClass:"owner-header"},[t("div",{staticClass:"form-group clear-bord-bottom"},[t("i",{staticClass:"maticon pull-left app-icon white-color",domProps:{innerHTML:e._s(e.icons("label"))}},[e._v("label")]),e._v(" "),t("div",{staticClass:"form-group-input pull-left"},[t("label",{staticClass:"name-label light-white-color"},[e._v("表单所属人名称")]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.ownerData.name,expression:"ownerData.name"}],staticClass:"form-control name-input white-color border-bottom-white",attrs:{type:"text",disabled:e.isConfig,maxlength:"25"},domProps:{value:e.ownerData.name},on:{change:e._changeNameInput,input:function(s){s.target.composing||e.$set(e.ownerData,"name",s.target.value)}}}),e._v(" "),e.nameChangeMsg?t("p",{staticClass:"name-error-tip text-center"},[e._v(e._s(e.nameChangeMsg))]):e._e()])]),e._v(" "),e.isConfig?e._e():t("div",{staticClass:"input-group allow-write-multiple-form"},[t("span",{on:{click:e._allowWriteMultipleForm}},[e.multiForm?t("i",{staticClass:"maticon role-icon white-color",domProps:{innerHTML:e._s(e.icons("check_box"))}},[e._v("check_box")]):t("i",{staticClass:"maticon role-icon white-color",domProps:{innerHTML:e._s(e.icons("check_box_outline_blank"))}},[e._v("check_box_outline_blank")])]),e._v(" "),t("span",{staticClass:"role-name white-color"},[e._v("允许填写多个表单")])])]),e._v(" "),t("div",{staticClass:"form-group clear-bord-bottom"},[t("div",{staticClass:"owner-readWrite-header",style:{height:e.isConfig?"85px":"50px"}},[t("i",{staticClass:"maticon app-icon white-color",domProps:{innerHTML:e._s(e.icons("visibility"))}},[e._v("visibility")]),e._v(" "),t("label",{staticClass:"read-write-label light-white-color"},[e._v("读写权限")]),e._v(" "),e.isConfig?t("div",{staticClass:"form-group-input pull-right",staticStyle:{"margin-right":"16px"}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.owenrSearchName,expression:"owenrSearchName"}],staticClass:"form-control search-input white-color border-bottom-white",attrs:{type:"text",placeholder:"请输入需要设置权限的字段名称"},domProps:{value:e.owenrSearchName},on:{input:function(s){s.target.composing||(e.owenrSearchName=s.target.value)}}})]):e._e()]),e._v(" "),e.componentsCheckAllCount>0?t("div",{staticClass:"batch-head owner-batch-head"},[t("span",{staticClass:"batch-tip light-white-color"},[e._v("已选 "+e._s(e.componentsCheckAllCount)+" 项，设置为")]),e._v(" "),t("v-select",{attrs:{options:e.operatorData,"options-value":"id","options-label":"name"},on:{afterSelected:e._afterSelectedOwner}}),e._v(" "),t("button",{staticClass:"btn pull-right sure clearBtnBorder white-color",on:{click:function(s){e._batchSure("owner")}}},[e._v("确定")])],1):e._e(),e._v(" "),t("div",{staticClass:"owner-readWrite-content",style:"max-height:"+e.ownerContentHeight+"px"},[e.componentsCheckAllCount>0?t("div",{staticClass:"batch-head"},[t("span",{staticClass:"batch-tip light-white-color"},[e._v("已选 "+e._s(e.componentsCheckAllCount)+" 项，设置为")]),e._v(" "),t("v-select",{attrs:{options:e.operatorData,"options-value":"id","options-label":"name"},on:{afterSelected:e._afterSelectedOwner}}),e._v(" "),t("button",{staticClass:"btn pull-right sure clearBtnBorder white-color",on:{click:function(s){e._batchSure("owner")}}},[e._v("确定")])],1):e._e(),e._v(" "),t("div",{staticClass:"role-list",style:{"padding-top":e.isConfig?"15px":""}},[t("div",{staticClass:"role-list-item margin-bottom-5px"},[t("div",{staticClass:"margin-left-70px"},[t("div",{staticClass:"input-group"},[t("span",{on:{click:function(s){e._changeCheckState(e.components,e.componentsCheckAllCount,"owner")}}},[0===e.componentsCheckAllCount?t("i",{staticClass:"maticon role-icon white-color",domProps:{innerHTML:e._s(e.icons("check_box_outline_blank"))}},[e._v("check_box_outline_blank")]):e.componentsCheckAllCount===e.components.length?t("i",{staticClass:"maticon role-icon white-color",domProps:{innerHTML:e._s(e.icons("check_box"))}},[e._v("check_box")]):t("i",{staticClass:"maticon role-icon white-color",domProps:{innerHTML:e._s(e.icons("indeterminate_check_box"))}},[e._v("indeterminate_check_box")])]),e._v(" "),t("span",{staticClass:"role-name white-color"},[e._v("全选")])])])]),e._v(" "),e._l(e.components,function(s,i){return s.title.indexOf(e.owenrSearchName)>=0?t("div",{key:i,staticClass:"role-list-item"},[t("div",{staticClass:"margin-left-70px"},[t("div",{staticClass:"col-xs-5"},[t("div",{staticClass:"input-group"},[t("span",{on:{click:function(e){s.checked=!s.checked}}},[s.checked?t("i",{staticClass:"maticon role-icon white-color",domProps:{innerHTML:e._s(e.icons("check_box"))}},[e._v("check_box")]):t("i",{staticClass:"maticon role-icon white-color",domProps:{innerHTML:e._s(e.icons("check_box_outline_blank"))}},[e._v("check_box_outline_blank")])]),e._v(" "),t("span",{staticClass:"dataAuthorities-name white-color",attrs:{title:s.title}},[e._v(e._s(s.title))])])]),e._v(" "),0===e.componentsCheckAllCount?t("div",{staticClass:"col-xs-7"},e._l(e.operatorData,function(i,a){return i.coms.indexOf(s.componentType)>=0?t("span",{key:a,staticClass:"operator",class:e._getAuthorityOf(s,e.ownerData)===i.id?"active":"",on:{click:function(t){e._setAuthorityOf(s,i.id,e.ownerData)}}},[e._v(e._s(i.name))]):t("span",{staticClass:"operator disabled"},[e._v(e._s(i.name))])})):e._e()])]):e._e()})],2)])])]),e._v(" "),e._l(e.palyers,function(s,i){return t("div",{key:i,staticClass:"col other-col"},[t("div",{staticClass:"form-group"},[t("i",{staticClass:"maticon pull-left app-icon black-color",domProps:{innerHTML:e._s(e.icons("label"))}},[e._v("label")]),e._v(" "),t("div",{staticClass:"form-group-input pull-left"},[t("label",{staticClass:"name-label light-black-color"},[e._v("参与者名称")]),e._v(" "),e.isConfig?e._e():t("i",{staticClass:"maticon pull-right more-icon black-color dropdown-toggle",attrs:{"data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"true"},domProps:{innerHTML:e._s(e.icons("more_vert"))}},[e._v("more_vert")]),e._v(" "),t("ul",{staticClass:"dropdown-menu more-opt-menu"},[t("li",{on:{click:function(s){e._deletePlayers(i)}}},[t("a",{attrs:{href:"#"}},[e._v("删除")])])]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.palyers[i].palyerForm.name,expression:"palyers[i].palyerForm.name"}],staticClass:"form-control name-input border-bottom-blue black-color",attrs:{type:"text",disabled:e.isConfig,maxlength:"25"},domProps:{value:e.palyers[i].palyerForm.name},on:{change:e._changeNameInput,input:function(s){s.target.composing||e.$set(e.palyers[i].palyerForm,"name",s.target.value)}}}),e._v(" "),e.palyers[i].playerName?t("p",{staticClass:"name-error-tip text-center"},[e._v(e._s(e.palyers[i].playerName))]):e._e()])]),e._v(" "),t("div",{staticClass:"form-group"},[t("i",{staticClass:"maticon pull-left app-icon black-color",domProps:{innerHTML:e._s(e.icons("call_split"))}},[e._v("call_split")]),e._v(" "),t("div",{staticClass:"form-group-input pull-left"},[t("label",{staticClass:"name-label light-black-color"},[e._v("分配方式")]),e._v(" "),t("div",{staticClass:"distribution-select"},[t("v-select",{attrs:{autoSelect:!1,options:e.distributaryData,"options-value":"id","options-label":"name","data-index":i,disabled:e.isConfig},on:{afterSelected:e._afterSelectedDis},model:{value:e.palyers[i].palyerForm.distributary,callback:function(s){e.$set(e.palyers[i].palyerForm,"distributary",s)},expression:"palyers[i].palyerForm.distributary"}})],1)])]),e._v(" "),"byTeacher"===e.palyers[i].palyerForm.distributary||""==e.palyers[i].palyerForm.distributary||e.isConfig?e._e():t("div",{staticClass:"form-group clear-padding-bottom clear-bord-bottom"},[t("div",{staticClass:"role-set-head"},[t("i",{staticClass:"maticon pull-left app-icon black-color",domProps:{innerHTML:e._s(e.icons("people"))}},[e._v("people")]),e._v(" "),t("div",{staticClass:"form-group-input pull-left",staticStyle:{height:"35px"}},[t("label",{staticClass:"name-label light-black-color"},[e._v("角色设置")]),e._v(" "),"byClass"===e.palyers[i].palyerForm.distributary||e.palyers[i].roleEditing?e._e():t("span",{staticClass:"creat-new-role blue-color",on:{click:function(s){e._creatNewRole(i)}}},[e._v("创建新的角色")])])])]),e._v(" "),t("div",{staticClass:"form-group clear-padding-bottom clear-bord-bottom fiexd-header"},[t("div",{staticClass:"participant-readWrite-header",style:{height:e.isConfig?"85px":"50px"}},[t("i",{staticClass:"maticon app-icon black-color",domProps:{innerHTML:e._s(e.icons("visibility"))}},[e._v("visibility")]),e._v(" "),t("label",{staticClass:"read-write-label light-black-color"},[e._v("读写权限")])])]),e._v(" "),t("div",{staticClass:"form-group clear-padding-bottom clear-bord-bottom fiexd-batch-head"},[e.palyers[i].curComponentsCount>0?t("div",{staticClass:"batch-head"},[t("span",{staticClass:"batch-tip light-black-color"},[e._v("已选 "+e._s(e.palyers[i].curComponentsCount)+" 项，设置为")]),e._v(" "),t("v-select",{attrs:{options:e.operatorData,"options-value":"id","options-label":"name","data-index":i},on:{afterSelected:e._afterSelectedOperator}}),e._v(" "),t("button",{staticClass:"btn pull-right sure clearBtnBorder blue-color",on:{click:function(s){e._batchSure("participant",i)}}},[e._v("确定")])],1):e._e()]),e._v(" "),t("div",{staticClass:"scroll-area",style:{height:"byTeacher"!==e.palyers[i].palyerForm.distributary&&""!=e.palyers[i].palyerForm.distributary?e.scrollAreaHeight+"px":e.noRoleSetAfaterHeight+"px"},attrs:{id:"scrollArea"+i,"data-id":i}},["byTeacher"!==e.palyers[i].palyerForm.distributary&&""!=e.palyers[i].palyerForm.distributary?t("div",{staticClass:"form-group clear-padding-bottom"},[t("div",{staticClass:"role-set-content",style:"max-height:"+e.roleSetContentHeight+"px",attrs:{id:"roleContent"+i}},[e.palyers[i].roleEditing?t("div",{staticClass:"creat-role-input"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.palyers[i].newRoleName,expression:"palyers[i].newRoleName"},{name:"focus",rawName:"v-focus"}],staticClass:"form-control name-input border-bottom-blue black-color padding-right-70px",attrs:{type:"text",maxlength:"25",placeholder:"应用名称+参与者名称+管理员"},domProps:{value:e.palyers[i].newRoleName},on:{focus:function(s){e._newRowInputFocus(i)},input:function(s){s.target.composing||e.$set(e.palyers[i],"newRoleName",s.target.value)}}}),e._v(" "),t("div",{staticClass:"pull-right creat-btn-group"},[t("button",{staticClass:"btn creat-cancle clearBtnBorder",on:{click:function(s){e.palyers[i].roleEditing=!1}}},[e._v("取消")]),e._v(" "),t("button",{staticClass:"btn creat-sure blue-color clearBtnBorder",on:{click:function(s){e._saveNewRole(e.palyers[i].newRoleName,i)}}},[e._v("确定")])]),e._v(" "),e.palyers[i].roleEditing?t("p",{staticClass:"errorMsg",class:e.palyers[i].roleAddErrorMsg?"show":""},[e._v(e._s(e.palyers[i].roleAddErrorMsg))]):e._e()]):t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isConfig,expression:"!isConfig"}],staticClass:"form-group-input",staticStyle:{margin:"0 0 15px 72px"}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.palyers[i].roleSetSearchName,expression:"palyers[i].roleSetSearchName"}],staticClass:"form-control search-input border-bottom-blue black-color",attrs:{type:"text",placeholder:"搜索角色名称"},domProps:{value:e.palyers[i].roleSetSearchName},on:{input:function(s){s.target.composing||e.$set(e.palyers[i],"roleSetSearchName",s.target.value)}}})]),e._v(" "),e.isConfig?e._e():t("div",{staticClass:"role-list",attrs:{id:"roleList"+i}},[t("div",{staticClass:"role-list-item margin-bottom-5px"},[t("div",{staticClass:"margin-left-70px"},[t("div",{staticClass:"input-group"},[t("span",{on:{click:function(s){e._changeCheckState(e.palyers[i].roleSetData,e.palyers[i].curPlayerCount,"operators",i)}}},[0===e.palyers[i].curPlayerCount?t("i",{staticClass:"maticon role-icon light-black-color",domProps:{innerHTML:e._s(e.icons("check_box_outline_blank"))}},[e._v("check_box_outline_blank")]):e.palyers[i].curPlayerCount===e.palyers[i].roleSetData.length?t("i",{staticClass:"maticon role-icon light-black-color",domProps:{innerHTML:e._s(e.icons("check_box"))}},[e._v("check_box")]):t("i",{staticClass:"maticon role-icon light-black-color",domProps:{innerHTML:e._s(e.icons("indeterminate_check_box"))}},[e._v("indeterminate_check_box")])]),e._v(" "),t("span",{staticClass:"role-name light-black-color"},[e._v("全选")])])])]),e._v(" "),e._l(e.palyers[i].roleSetData,function(s,a){return s.name.indexOf(e.palyers[i].roleSetSearchName)>=0?t("div",{key:a,staticClass:"role-list-item"},[t("div",{staticClass:"margin-left-70px"},[t("div",{staticClass:"input-group"},[t("span",{on:{click:function(t){e._checkOperators(s,i)}}},[e.palyers[i].palyerForm.operators.indexOf(parseInt(s.id))>=0?t("i",{staticClass:"maticon role-icon light-black-color",domProps:{innerHTML:e._s(e.icons("check_box"))}},[e._v("check_box")]):t("i",{staticClass:"maticon role-icon light-black-color",domProps:{innerHTML:e._s(e.icons("check_box_outline_blank"))}},[e._v("check_box_outline_blank")])]),e._v(" "),t("span",{staticClass:"role-name",class:e.palyers[i].palyerForm.operators.indexOf(parseInt(s.id))>=0?"black-color":"light-black-color",attrs:{title:s.name}},[e._v(e._s(s.name))])])])]):e._e()})],2)])]):e._e(),e._v(" "),t("div",{staticClass:"form-group clear-bord-bottom clear-padding-bottom"},[t("div",{staticClass:"participant-readWrite-header",style:{height:e.isConfig?"85px":"50px"}},[t("i",{staticClass:"maticon app-icon black-color",domProps:{innerHTML:e._s(e.icons("visibility"))}},[e._v("visibility")]),e._v(" "),t("label",{staticClass:"read-write-label light-black-color"},[e._v("读写权限")]),e._v(" "),e.isConfig?t("div",{staticClass:"form-group-input pull-right",staticStyle:{"margin-right":"16px"}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.palyers[i].searchName,expression:"palyers[i].searchName"}],staticClass:"form-control search-input border-bottom-blue black-color",attrs:{type:"text",placeholder:"请输入需要设置权限的字段名称"},domProps:{value:e.palyers[i].searchName},on:{input:function(s){s.target.composing||e.$set(e.palyers[i],"searchName",s.target.value)}}})]):e._e(),e._v(" "),e.isConfig?e._e():t("div",{staticClass:"dividing-line"})]),e._v(" "),t("div",{staticClass:"participant-readWrite-content",style:{"max-height":e.getContentHeight(i)},attrs:{id:"readWriteContent"+i}},[e.isConfig?e._e():t("div",{staticClass:"role-list role-list-batch"},[t("div",{staticClass:"role-list-item margin-bottom-5px"},[t("div",{staticClass:"margin-left-70px"},[t("div",{staticClass:"input-group"},[t("span",{on:{click:function(s){e._changeBatchSet(i)}}},[e.palyers[i].palyerForm.batch?t("i",{staticClass:"maticon role-icon light-black-color",domProps:{innerHTML:e._s(e.icons("check_box"))}},[e._v("check_box")]):t("i",{staticClass:"maticon role-icon light-black-color",domProps:{innerHTML:e._s(e.icons("check_box_outline_blank"))}},[e._v("check_box_outline_blank")])]),e._v(" "),t("span",{staticClass:"role-name light-black-color"},[e._v("允许批量操作")])])])]),e._v(" "),t("div",{staticClass:"batch-dividing-line"})]),e._v(" "),e.palyers[i].curComponentsCount>0?t("div",{staticClass:"batch-head"},[t("span",{staticClass:"batch-tip light-black-color"},[e._v("已选 "+e._s(e.palyers[i].curComponentsCount)+" 项，设置为")]),e._v(" "),t("v-select",{attrs:{options:e.operatorData,"options-value":"id","options-label":"name","data-index":i},on:{afterSelected:e._afterSelectedOperator}}),e._v(" "),t("button",{staticClass:"btn pull-right sure clearBtnBorder blue-color",on:{click:function(s){e._batchSure("participant",i)}}},[e._v("确定")])],1):e._e(),e._v(" "),t("div",{staticClass:"role-list set-margin-top-15px"},[t("div",{staticClass:"role-list-item margin-bottom-5px"},[t("div",{staticClass:"margin-left-70px"},[t("div",{staticClass:"input-group"},[t("span",{on:{click:function(s){e._changeCheckState(e.palyers[i].AllComponents,e.palyers[i].curComponentsCount,"dataAuthorities",i)}}},[0===e.palyers[i].curComponentsCount?t("i",{staticClass:"maticon role-icon light-black-color",domProps:{innerHTML:e._s(e.icons("check_box_outline_blank"))}},[e._v("check_box_outline_blank")]):e.palyers[i].curComponentsCount===e.palyers[i].AllComponents.length?t("i",{staticClass:"maticon role-icon light-black-color",domProps:{innerHTML:e._s(e.icons("check_box"))}},[e._v("check_box")]):t("i",{staticClass:"maticon role-icon light-black-color",domProps:{innerHTML:e._s(e.icons("indeterminate_check_box"))}},[e._v("indeterminate_check_box")])]),e._v(" "),t("span",{staticClass:"role-name light-black-color"},[e._v("全选")])])])]),e._v(" "),e._l(e.palyers[i].AllComponents,function(s,a){return s.title.indexOf(e.palyers[i].searchName)>=0?t("div",{key:a,staticClass:"role-list-item"},[t("div",{staticClass:"margin-left-70px"},[t("div",{staticClass:"col-xs-5"},[t("div",{staticClass:"input-group"},[t("span",{on:{click:function(t){e._changeComSelect(s,i)}}},[s.checked?t("i",{staticClass:"maticon role-icon light-black-color",domProps:{innerHTML:e._s(e.icons("check_box"))}},[e._v("check_box")]):t("i",{staticClass:"maticon role-icon light-black-color",domProps:{innerHTML:e._s(e.icons("check_box_outline_blank"))}},[e._v("check_box_outline_blank")])]),e._v(" "),t("span",{staticClass:"dataAuthorities-name",class:s.checked?"black-color":"light-black-color",attrs:{title:s.title}},[e._v(e._s(s.title))])])]),e._v(" "),0===e.palyers[i].curComponentsCount?t("div",{staticClass:"col-xs-7"},e._l(e.operatorData,function(a,n){return a.coms.indexOf(s.componentType)>=0?t("span",{key:n,staticClass:"operator",class:e._getAuthorityOf(s,e.palyers[i].palyerForm)===a.id?"active":"",on:{click:function(t){e._setAuthorityOf(s,a.id,e.palyers[i].palyerForm)}}},[e._v(e._s(a.name))]):t("span",{staticClass:"operator disabled"},[e._v(e._s(a.name))])})):e._e()])]):e._e()})],2)])])])])}),e._v(" "),e.isConfig?e._e():t("div",{staticClass:"add-role"},[t("button",{staticClass:"add-btn clearBtnBorder",on:{click:e._addRole}},[e._v("添加参与者")])])],2)],1)])},staticRenderFns:[function(){var e=this.$createElement,s=this._self._c||e;return s("div",{staticClass:"input-group"},[s("label",{staticClass:"page-name"},[this._v("参与者设置")])])}]};var C=t("C7Lr")(f,y,!1,function(e){t("G2p1")},null,null).exports;n.a.component("app-info",u),n.a.component("FormSetManage",d.default),n.a.component("FlowSetManage",m.default),n.a.component("FormEngineInfo",v),n.a.component("JoinRoleSetManage",C);n.a.component("app-info",u),n.a.component("FormSetManage",d.default),n.a.component("FlowSetManage",m.default),n.a.component("FormEngineInfo",v),n.a.component("JoinRoleSetManage",C);var T={props:{role:""},created:function(){var e=localStorage.getItem("lang");Object(c.e)(e)&&(this.lang=e),this._initDepartmentList()},data:function(){return{departmentList:[],departmentId:0,appList:[],typeList:{student:{userType:"1",bigType:"student",dragging:!1,types:[]},teacher:{userType:"2",bigType:"teacher",dragging:!1,types:[]},freshman:{userType:"3",bigType:"freshman",dragging:!1,types:[]},instructor:{userType:"4",bigType:"instructor",dragging:!1,types:[]}},dragData:{name:"",icon:""},dragType:{},appInfo:{w:0,h:0},newType:{name:"",userType:""},miniRoutes:"appManage",curCheckRoutes:"",dragContainer:null,dragTarget:null,dropTarget:null,editType:"",newApp:{name:"",imgPath:"school",imgType:1,remark:"",settingType:"",appTypeId:"",departmentId:"",sort:0},appCats:[{appTypeId:"1",settingType:"WORKFLOW",name:"workflow"},{appTypeId:"2",settingType:"LINK",name:"link"},{appTypeId:"3",settingType:"FORM",name:"form"}],newAppName:"",curApp:null,modelId:"",initWay:"create",showTypeModal:!1,showAddModal:!1,selectAppType:"1",addAppType:"",parentPage:"",searchName:"",businessId:null,appName:"",showImportModal:!1,clearInputShow:!0,selectFileName:"",fileData:"",formData:null,appUserType:"",lang:"zh-cn"}},computed:{translate:function(){return Object(c.e)(this.lang).appManage}},mounted:function(){var e=this;this.$dragging.$on("dragged",function(s){var t=s.draged;s.value;e.dragType=t})},methods:{_saveTypeOrder:function(e){var s=this;e.types.forEach(function(e,s){e.sort=s}),e.dragging?Object(c.c)({url:"/api/app/type/sort",type:"put",data:e.types,success:function(t){e.dragging=!1,t.state?s.$toast("排序成功！"):s.$toast(t.message)}}):e.dragging=!0},_containsSearchName:function(e){var s=this,t=!1;return e.forEach(function(e){(e.name&&e.name.indexOf(s.searchName)>=0||e.app&&e.app.name.indexOf(s.searchName)>=0)&&(t=!0)}),t},_updateApp:function(e){this.curApp.name=e.name,this.curApp.imgPath=e.imgPath,this.curApp.background=e.background},_initDepartmentList:function(){if("manager"===this.role)this.departmentId="",this._initPopular(),this._initTypes("1"),this._initTypes("2"),this._initTypes("3"),this._initTypes("4");else{var e=this;Object(c.c)({url:"/api/currentUser/approverDepartment?rule=应用管理",type:"get",success:function(s){s.state?(e.departmentList=s.data,e.departmentId=s.data[0]?s.data[0].id:""):e.$toast(s.message)}})}},_changeDepartment:function(e){this.departmentId&&(this._initTypes("1"),this._initTypes("2"),this._initTypes("3"),this._initTypes("4"))},_initPopular:function(){var e=this;Object(c.c)({url:"/api/app/popular",type:"get",success:function(s){s.state?e.appList=s.data:e.$toast(s.message)}})},_initTypes:function(e){var s=this,t=[];"1"===e?t=s.typeList.student:"2"===e?t=s.typeList.teacher:"3"===e?t=s.typeList.freshman:"4"===e&&(t=s.typeList.instructor),t.types=[],Object(c.c)({url:"/api/app/type",type:"get",data:{userType:e},success:function(i){i.state?(i.data.forEach(function(e,s){var i={};for(var a in e)n.a.set(i,a,e[a]);n.a.set(i,"appList",[]),t.types.push(i)}),t.types=s._resort(t.types),s._initAppList(s.departmentId,e)):s.$toast(i.message)}})},_resort:function(e){var s=[];return e.forEach(function(e){(e.sort||0)>=s.length?s.splice(s.length,0,e):s.splice(e.sort,0,e)}),s.forEach(function(e,s){e.sort=s}),s},_initAppList:function(e,s){var t=this,i=null;"1"===s?i=t.typeList.student:"2"===s?i=t.typeList.teacher:"3"===s?i=t.typeList.freshman:"4"===s&&(i=t.typeList.instructor),Object(c.c)({url:"/api/app",type:"get",data:{departmentId:e,userType:s},success:function(e){e.state?e.data.forEach(function(e,s){i.types.forEach(function(s,t){s.id===e.appType.id&&s.appList.push(e)})}):t.$toast(e.message)}})},_draggable:function(){return!(!this.dropTarget||!this.dragTarget||"manager"!==this.role)&&((!this.dragTarget.attr("data-bigtype")||!this.dropTarget.attr("data-bigtype")||this.dropTarget.attr("data-bigtype")===this.dragTarget.attr("data-bigtype"))&&("total"===this.dropTarget.attr("data-type")||"total"!==this.dragTarget.attr("data-type")))},_dragStart:function(e){this.dragTarget=o()(e.target).parents(".app"),this.dragTarget.addClass("dragging");var s=0;if("total"===this.dragTarget.attr("data-type"))s=this.dragTarget.attr("data-key"),this.dragData=this.appList[s];else{var t=this.dragTarget.attr("data-bigtype"),i=this.dragTarget.attr("data-index");s=this.dragTarget.attr("data-key"),this.dragData=this.typeList[t].types[i].appList[s]}},_dragEnd:function(e){var s=this;if(this._draggable()){var t,i,n,r,c,l="",p="";if("total"===this.dropTarget.attr("data-type"))if(t=this.dragTarget.attr("data-key"),i=this.dropTarget.attr("data-key"),l=parseInt(this.dragTarget.attr("data-id")),c=JSON.parse(a()(this.dragData)),"total"===this.dragTarget.attr("data-type"))this.appList.splice(t,1),this.appList.splice(i,0,c),this._saveOrder(this,"popular");else{var u=!1;this.appList.forEach(function(e,s){e.app.id===l&&(u=!0)}),u||this._addPopular(i||this.appList.length,function(e){s.appList.splice(i,0,e)})}else t=parseInt(this.dragTarget.attr("data-key")),n=parseInt(this.dragTarget.attr("data-index")),i=parseInt(this.dropTarget.attr("data-key")),r=parseInt(this.dropTarget.attr("data-index")),p=this.dragTarget.attr("data-bigtype"),c=JSON.parse(a()(this.dragData)),this.typeList[p].types[n].appList.splice(t,1),this.typeList[p].types[r].appList.splice(i,0,c),this._saveOrder(this.typeList[p].types[n]),n!==r&&this._saveOrder(this.typeList[p].types[r])}this.dragTarget.removeClass("dragging"),o()(".drag.active").removeClass("active"),this.dragTarget=null,this.dropTarget=null},_dragOver:function(e){this._draggable()&&e.preventDefault()},_dragEnter:function(e){o()(e.target).is(".drag")?this.dropTarget=o()(e.target):this.dropTarget=o()(e.target).parents(".drag"),o()(".drag.active").removeClass("active"),this._draggable()&&(o()(".drag.active").removeClass("active"),this.dropTarget.addClass("active"))},_dragLeave:function(e){this.dropTarget.removeClass("active")},_saveOrder:function(e,s){var t=this;e.appList.forEach(function(t,i){t.sort=i,"popular"!==s&&(t.appType={id:e.id,name:e.name,sort:e.sort,userType:e.userType})});var i="";i="popular"===s?"/api/app/popular/sort":"/api/app/sort",Object(c.c)({url:i,type:"put",data:e.appList,success:function(e){e.state||t.$toast(e.message)}})},_editAppType:function(e){this.editType=e.id,this.newAppName=e.name},_saveAppType:function(e,s){var t=this;Object(c.c)({url:"/api/app/type/"+e.id,type:"put",data:{id:e.id,name:this.newAppName,userType:e.userType,sort:e.sort},success:function(s){s.state?(t.editType="",e.name=t.newAppName):t.$toast(s.message)}})},_removeAppType:function(e,s,t){var i=this;e.appList.length>0?this.$toast(this.translate.appExistTip):confirm(this.translate.appTypeRemoveConfirm)&&(this.$waiting.show(),Object(c.c)({url:"/api/app/type/"+e.id,type:"delete",success:function(e){e.state?(t.types.splice(s,1),i.$toast("",0,"check")):i.$toast(e.message)}}).always(function(){i.$waiting.close()}))},_createAppType:function(){var e=this;if(""!==this.newType.name)if(""!==this.newType.userType){var s=null;for(var t in this.typeList)this.typeList[t].userType===this.newType.userType&&(s=this.typeList[t]);this.$waiting.show(),Object(c.c)({url:"/api/app/type",type:"post",data:{name:this.newType.name,userType:this.newType.userType,sort:s.types.length},success:function(t){t.state?(e.showTypeModal=!1,s.types.push({id:t.data.id,name:e.newType.name,appList:[],userType:e.newType.userType,sort:0}),e.$toast("",0,"check")):e.$toast(t.message)}}).always(function(){e.$waiting.close()})}else this.$toast(this.translate.appAddTip2);else this.$toast(this.translate.appAddTip1)},_removeApp:function(e,s,t){var i=this,a="";a=t?"/api/app/popular/"+e[s].id:"/api/app/"+e[s].id,confirm(this.translate.appRemoveConfirm)&&Object(c.c)({url:a,type:"delete",success:function(t){t.state?(e.splice(s,1),i._initPopular(),i.$toast("",0,"check")):i.$toast(t.message)}})},_editApp:function(e,s){var t=this;if("department"===this.role)if(e)this.$waiting.show(),this.curApp=e,this.appName=this.curApp.name,e.appType&&e.appType.userType&&(this.appUserType=e.appType.userType),"WORKFLOW"===e.setting.type?this.miniRoutes="appInfo":"LINK"===e.setting.type?(this.miniRoutes="link",this.curCheckRoutes="link"):(this.miniRoutes="formEngine",this.curCheckRoutes="formEngine"),this.$waiting.close();else{if(""===this.newApp.name||!this.newApp.settingType||!this.newApp.appTypeId)return void this.$toast(this.translate.editTip2);this.$waiting.show(),this.appName=this.newApp.name,this.newApp.departmentId=this.departmentId,this.newApp.sort=s.appList.length,this.showAddModal=!1,Object(c.c)({url:"/api/app",type:"post",data:this.newApp,success:function(e){e.state?(t.appUserType=e.data.appType.userType,t.curApp={id:e.data.id,name:e.data.name,imgPath:e.data.imgPath,setting:{type:e.data.setting.type}},setTimeout(function(){"WORKFLOW"===e.data.setting.type?t.miniRoutes="appInfo":"LINK"===e.data.setting.type?(t.miniRoutes="link",t.curCheckRoutes="link"):(t.miniRoutes="formEngine",t.curCheckRoutes="formEngine")},600),s.appList.push(t.curApp),t.$toast("",0,"check")):t.$toast(e.message)}}).always(function(){t.$waiting.close()}),this.curApp=null}},_addPopular:function(e,s){var t=this;Object(c.c)({url:"/api/app/popular",type:"post",data:{app:this.dragData,sort:e},success:function(e){e.state?s(e.data):t.$toast(t.translate.appAddTip3)}})},_saveFormInfo:function(e){var s=this,t="";t=this.businessId?"/api/app/"+this.curApp.id+"/publishBusiness/"+this.businessId+"/formSetting":"/api/apps/"+this.curApp.id+"/settings/forms",this.$waiting.show(),Object(c.c)({url:t,type:"put",data:e,success:function(e){e.state?(s.$toast(s.translate.saveSuccessTip1,0,"check"),s._backToPage(s.parentPage)):s.$toast(e.message)}}).always(function(){s.$waiting.close()})},_saveFlowInfo:function(e){var s=this,t="";t=this.businessId?"/api/app/"+this.curApp.id+"/publishBusiness/"+this.businessId+"/flowSetting":"/api/apps/"+this.curApp.id+"/settings/flows",this.$waiting.show(),Object(c.c)({url:t,type:"put",data:e,success:function(e){e.state?(s.$toast(s.translate.saveSuccessTip2,0,"check"),s._backToPage("appInfo")):s.$toast(e.message)}}).always(function(){s.$waiting.close()})},_savePlayers:function(e){var s=this,t="";t=this.businessId?"/api/app/"+this.curApp.id+"/publishBusiness/"+this.businessId+"/playerSetting":"/api/apps/"+this.curApp.id+"/settings/players",this.$waiting.show(),Object(c.c)({url:t,type:"put",data:e,success:function(e){e.state?(s.$toast(s.translate.saveSuccessTip3,0,"check"),s._backToPage("formEngine")):s.$toast(e.message)}}).always(function(){s.$waiting.close()})},_setForm:function(e,s){this.miniRoutes="formSetManage",this.parentPage=s,this.modelId=e.modelId,this.initWay=e.type,this.businessId=e.businessId,this.$emit("fullScreen",!0)},_setFlow:function(e){this.miniRoutes="flowSetManage",this.modelId=e.modelId,this.businessId=e.businessId,this.$emit("fullScreen",!0)},_setJoinRole:function(e){this.miniRoutes="joinRoleSet",this.businessId=e.businessId,this.$emit("fullScreen",!0)},_backToPage:function(e){this.miniRoutes=e,this.$emit("fullScreen",!1)},_createApp:function(){this.showAddModal=!0,o()(".app-type-content").animate({scrollTop:"0px"},100),this.newApp.name="",this.newApp.settingType="",this.newApp.appTypeId=""},_showImportModal:function(){this.showImportModal=!0,o()(".app-type-content").animate({scrollTop:"0px"},100),this.newApp.appTypeId="",this.selectFileName=this.translate.selectFile},getFile:function(e){this.formData=new FormData,this.fileData=null,this.fileData=e.target.files[0],this.formData.append("file",this.fileData),this.clearInputShow=!1,this.fileData&&(this.selectFileName=this.fileData.name,this.clearInputShow=!0)},_importApp:function(e){var s=this;if(!this.fileData)return this.$toast("请选择文件");this.newApp.appTypeId?(this.formData.append("appTypeId",this.newApp.appTypeId),this.formData.append("departmentId",this.departmentId),this.$waiting.show(),Object(c.c)({url:"/upload/app/import",dataType:"json",data:this.formData,processData:!1,contentType:!1,type:"post",success:function(t){s.showImportModal=!1,"88888"===t.code?(s.curApp={id:t.data.id,name:t.data.name,imgPath:t.data.imgPath,setting:{type:t.data.setting.type}},setTimeout(function(){"WORKFLOW"===t.data.setting.type?s.miniRoutes="appInfo":"LINK"===t.data.setting.type?(s.miniRoutes="link",s.curCheckRoutes="link"):(s.miniRoutes="formEngine",s.curCheckRoutes="formEngine")},600),e.appList.push(s.curApp),s.$toast("",0,"check")):s.$toast(t.message)}}).always(function(){s.$waiting.close()})):this.$toast(this.translate.editTip2)}},beforeDestroy:function(){this.$dragging.$off("dragged")}},k={render:function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"app-page",class:{"container-fluid":["formSetManage","flowSetManage","joinRoleSet"].indexOf(e.miniRoutes)<0,"layout-manage":"department"!==e.role}},[t("div",{directives:[{name:"show",rawName:"v-show",value:"appManage"===e.miniRoutes,expression:"miniRoutes === 'appManage'"}],staticClass:"row",attrs:{id:"appManage"}},[t("div",{staticClass:"head"},[t("h3",{staticClass:"pull-left"},[e._v(e._s(e.translate.appManage)+"\n        "),"department"===e.role&&e.departmentId?t("v-select",{staticClass:"info-value",attrs:{options:e.departmentList,required:!0,"options-value":"id","options-label":"name","close-on-select":""},on:{afterSelected:e._changeDepartment},model:{value:e.departmentId,callback:function(s){e.departmentId=s},expression:"departmentId"}}):e._e()],1),e._v(" "),t("button",{staticClass:"btn pull-right import-file-btn",on:{click:e._showImportModal}},[e._v(e._s(e.translate.import))]),e._v(" "),"department"===e.role?t("button",{staticClass:"btn pull-right",on:{click:e._createApp}},[t("i",{staticClass:"maticon pull-left",domProps:{innerHTML:e._s(e.icons("create"))}}),e._v(e._s(e.translate.createApp))]):t("button",{staticClass:"btn pull-right",on:{click:function(s){e.showTypeModal=!0}}},[t("i",{staticClass:"maticon pull-left",domProps:{innerHTML:e._s(e.icons("playlist_add"))}}),e._v(e._s(e.translate.createAppType))]),e._v(" "),"department"===e.role?t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchName,expression:"searchName"}],staticClass:"form-control pull-right app-search",attrs:{type:"text",placeholder:"搜索..."},domProps:{value:e.searchName},on:{input:function(s){s.target.composing||(e.searchName=s.target.value)}}}):e._e()]),e._v(" "),t("GeminiScrollbar",{staticClass:"body",attrs:{scrollX:!1}},["department"!==e.role&&e._containsSearchName(e.appList)?t("div",{staticClass:"container-fluid type-group"},[t("label",{staticClass:"pull-left type-head"},[e._v(e._s(e.translate.hot))]),e._v(" "),t("div",{staticClass:"apps-container"},e._l(e.appList,function(s,i){return s.app.name.indexOf(e.searchName)>=0?t("div",{key:i,staticClass:"app drag",attrs:{"data-key":i,"data-id":s.id,"data-type":"total"},on:{dragover:e._dragOver,dragenter:e._dragEnter,click:function(t){e._editApp(s)}}},[t("div",{staticClass:"active-show"}),e._v(" "),"department"!==e.role?t("i",{staticClass:"maticon remove-app",domProps:{innerHTML:e._s(e.icons("cancel"))},on:{click:function(s){s.stopPropagation(),e._removeApp(e.appList,i,"popular")}}},[e._v("cancel")]):e._e(),e._v(" "),t("div",{staticClass:"app-icon-div",style:{background:s.background}},[s.app.imgType&&"1"!==s.app.imgType?"2"===s.app.imgType?t("i",{staticClass:"maticon app-icon-style theme-icon-application",class:s.app.isPublished?"":"disabled",attrs:{draggable:""},on:{dragstart:e._dragStart,dragenter:e._dragEnter,dragend:e._dragEnd}},[t("span",{staticClass:"saasicon-44px",class:["saasicon-44px-"+s.app.imgPath]})]):e._e():t("i",{staticClass:"maticon app-icon-style theme-icon-application",class:s.app.isPublished?"":"disabled",attrs:{draggable:""},domProps:{innerHTML:e._s(e.icons(s.app.imgPath||"school"))},on:{dragstart:e._dragStart,dragenter:e._dragEnter,dragend:e._dragEnd}},[e._v(e._s(s.app.imgPath||"school"))])]),e._v(" "),t("p",{staticClass:"text-center"},[e._v(e._s(s.app.name))])]):e._e()}))]):e._e(),e._v(" "),e._l(e.typeList,function(s,i){return"department"===e.role&&e.departmentId||"department"!==e.role?t("div",{key:i,staticClass:"bigtype"},[t("div",{staticClass:"bigtype-header"},[t("span",{staticClass:"pull-left",staticStyle:{"margin-right":"8px"}},[t("i",{staticClass:"maticon pull-left",domProps:{innerHTML:e._s(e.icons("list"))}},[e._v("list")]),e._v(e._s(e.translate[s.bigType]))]),e._v(" "),"department"!==e.role?t("span",{staticClass:"pull-right move-icon",class:{active:s.dragging},on:{click:function(t){e._saveTypeOrder(s)}}},[t("i",{staticClass:"maticon pull-left",staticStyle:{"margin-right":"0"},domProps:{innerHTML:e._s(e.icons("swap_vert"))}},[e._v("swap_vert")]),e._v("\n            "+e._s(s.dragging?"完成":"排序")+"\n          ")]):e._e()]),e._v(" "),e._l(s.types,function(i,a){return e._containsSearchName(i.appList)||"department"!==e.role?t("div",{directives:[{name:"show",rawName:"v-show",value:!s.dragging,expression:"!bigtype.dragging"}],key:a,staticClass:"container-fluid type-group"},[e.editType!==i.id?t("label",{staticClass:"pull-left type-head"},[e._v("\n            "+e._s(i.name)+"\n            "),"department"!==e.role?t("i",{staticClass:"maticon pull-right",domProps:{innerHTML:e._s(e.icons("cancel"))},on:{click:function(t){t.stopPropagation(),e._removeAppType(i,a,s)}}},[e._v("cancel")]):e._e(),e._v(" "),"department"!==e.role?t("i",{staticClass:"maticon pull-right",domProps:{innerHTML:e._s(e.icons("edit"))},on:{click:function(s){e._editAppType(i)}}},[e._v("edit")]):e._e()]):t("div",{staticClass:"pull-left type-head type-edit"},[t("div",{staticClass:"input-group"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.newAppName,expression:"newAppName"}],staticClass:"form-control type-name",attrs:{type:"text",maxlength:"16",placeholder:"请输入16字内的应用分类名称"},domProps:{value:e.newAppName},on:{input:function(s){s.target.composing||(e.newAppName=s.target.value)}}}),e._v(" "),t("span",{staticClass:"input-group-addon",on:{click:function(s){e.editType=""}}},[e._v(e._s(e.translate.cancel))]),e._v(" "),t("span",{staticClass:"input-group-addon sure",on:{click:function(s){e._saveAppType(i,a)}}},[e._v(e._s(e.translate.sure))])])]),e._v(" "),t("div",{staticClass:"apps-container"},e._l(i.appList,function(n,r){return n.name.indexOf(e.searchName)>=0?t("div",{key:r,staticClass:"app",class:{drag:"department"!==e.role},attrs:{"data-key":r,"data-type":"type","data-index":a,"data-id":n.id,"data-bigtype":s.bigType},on:{dragover:e._dragOver,dragenter:e._dragEnter,click:function(s){e._editApp(n)}}},[t("div",{staticClass:"active-show"}),e._v(" "),"department"===e.role?t("i",{staticClass:"maticon remove-app",domProps:{innerHTML:e._s(e.icons("cancel"))},on:{click:function(s){s.stopPropagation(),e._removeApp(i.appList,r)}}},[e._v("cancel")]):e._e(),e._v(" "),t("div",{staticClass:"app-icon-div",style:{background:n.background}},[n.imgType&&"1"!==n.imgType?"2"===n.imgType?t("i",{staticClass:"maticon app-icon-style theme-icon-application",class:n.isPublished?"":"disabled",attrs:{draggable:""},on:{dragstart:e._dragStart,dragenter:e._dragEnter,dragend:e._dragEnd}},[t("span",{staticClass:"saasicon-44px",class:["saasicon-44px-"+n.imgPath]})]):e._e():t("i",{staticClass:"maticon app-icon-style theme-icon-application",class:n.isPublished?"":"disabled",attrs:{draggable:""},domProps:{innerHTML:e._s(e.icons(n.imgPath||"school"))},on:{dragstart:e._dragStart,dragenter:e._dragEnter,dragend:e._dragEnd}},[e._v(e._s(n.imgPath||"school"))])]),e._v(" "),t("p",{staticClass:"text-center"},[e._v(e._s(n.name))])]):e._e()}))]):e._e()}),e._v(" "),e._l(s.types,function(a,n){return"department"!==e.role?t("div",{directives:[{name:"dragging",rawName:"v-dragging",value:{item:a,list:s.types,group:i},expression:"{ item: moveType, list: bigtype.types, group: bIndex }"},{name:"show",rawName:"v-show",value:s.dragging,expression:"bigtype.dragging"}],key:n,staticClass:"container-fluid type-group dragging-div",class:{active:a.id===e.dragType.id}},[t("label",{staticClass:"pull-left type-head"},[e._v("\n            "+e._s(a.name)+"\n          ")])]):e._e()})],2):e._e()})],2),e._v(" "),t("v-modal",{attrs:{show:e.showAddModal,width:"400"}},[t("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[t("h5",{staticClass:"modal-title"},[e._v("\n          "+e._s(e.translate.createApp)+"\n        ")])]),e._v(" "),t("div",{staticClass:"modal-body container-fluid creat-app-body",staticStyle:{"max-height":"300px"},attrs:{slot:"modal-body"},slot:"modal-body"},[t("div",{staticClass:"form-group"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.newApp.name,expression:"newApp.name"}],staticClass:"form-control modal-input",attrs:{type:"text",maxlength:"25",placeholder:e.translate.createAppPlaceholder},domProps:{value:e.newApp.name},on:{input:function(s){s.target.composing||e.$set(e.newApp,"name",s.target.value)}}})]),e._v(" "),t("div",{staticClass:"type-div row"},e._l(e.appCats,function(s,i){return t("span",{key:i,staticClass:"type-span",class:e.newApp.settingType===s.settingType?"active":"",on:{click:function(t){e.newApp.settingType=s.settingType}}},[t("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("done"))}}),e._v("\n            "+e._s(e.translate[s.name])+"\n          ")])})),e._v(" "),t("div",{staticClass:"type-div row"},[t("div",{staticClass:"app-type-text"},[e._v(e._s(e.translate.selectAppType))]),e._v(" "),t("div",{staticClass:"app-type-content"},e._l(e.typeList,function(s,i){return t("div",{key:i},e._l(s.types,function(s,i){return t("p",{key:i,staticClass:"type-p",class:e.newApp.appTypeId===s.id?"active":"",on:{click:function(t){e.newApp.appTypeId=s.id,e.addAppType=s}}},[t("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("done"))}}),e._v("\n                "+e._s(s.name)+"\n              ")])}))}))])]),e._v(" "),t("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[t("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(s){e.showAddModal=!1}}},[e._v(e._s(e.translate.cancel))]),e._v(" "),t("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(s){e._editApp(null,e.addAppType)}}},[e._v(e._s(e.translate.sure))])])]),e._v(" "),t("v-modal",{attrs:{show:e.showTypeModal,width:"460"}},[t("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[t("h5",{staticClass:"modal-title"},[e._v("\n          "+e._s(e.translate.createAppType)+"\n        ")])]),e._v(" "),t("div",{staticClass:"modal-body container-fluid",attrs:{slot:"modal-body"},slot:"modal-body"},[t("div",{staticClass:"form-group"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.newType.name,expression:"newType.name"}],staticClass:"form-control modal-input",attrs:{type:"text",maxlength:"16",placeholder:e.translate.createAppTypePlaceholder},domProps:{value:e.newType.name},on:{input:function(s){s.target.composing||e.$set(e.newType,"name",s.target.value)}}})]),e._v(" "),t("div",{staticClass:"type-div row"},e._l(e.typeList,function(s,i){return t("span",{key:i,staticClass:"type-span",class:e.newType.userType===s.userType?"active":"",on:{click:function(t){e.newType.userType=s.userType}}},[t("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("done"))}}),e._v("\n            "+e._s(e.translate[s.bigType])+"\n          ")])}))]),e._v(" "),t("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[t("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(s){e.showTypeModal=!1}}},[e._v(e._s(e.translate.cancel))]),e._v(" "),t("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:e._createAppType}},[e._v(e._s(e.translate.sure))])])]),e._v(" "),t("v-modal",{attrs:{show:e.showImportModal,width:"400"}},[t("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[t("h5",{staticClass:"modal-title"},[e._v("\n          "+e._s(e.translate.importApp)+"\n        ")])]),e._v(" "),t("div",{staticClass:"modal-body container-fluid creat-app-body",staticStyle:{"max-height":"300px"},attrs:{slot:"modal-body"},slot:"modal-body"},[t("div",{staticClass:"button-group"},[t("button",{staticClass:"btn clearBtnBorder import-btn",attrs:{type:"button"}},[t("label",{staticClass:"upload-text",attrs:{for:"upload-file",title:e.selectFileName}},[e._v(e._s(e.selectFileName))])]),e._v(" "),e.clearInputShow?t("input",{staticClass:"upload-template",attrs:{type:"file",id:"upload-file"},on:{change:e.getFile}}):e._e()]),e._v(" "),t("div",{staticClass:"type-div row"},[t("div",{staticClass:"app-type-text"},[e._v(e._s(e.translate.selectAppType))]),e._v(" "),t("div",{staticClass:"app-type-content"},e._l(e.typeList,function(s,i){return t("div",{key:i},e._l(s.types,function(s,i){return t("p",{key:i,staticClass:"type-p",class:e.newApp.appTypeId===s.id?"active":"",on:{click:function(t){e.newApp.appTypeId=s.id,e.addAppType=s}}},[t("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("done"))}}),e._v("\n                "+e._s(s.name)+"\n              ")])}))}))])]),e._v(" "),t("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[t("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(s){e.showImportModal=!1}}},[e._v(e._s(e.translate.cancel))]),e._v(" "),t("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(s){e._importApp(e.addAppType)}}},[e._v(e._s(e.translate.sure))])])])],1),e._v(" "),e.curApp&&"appInfo"===e.miniRoutes?t("app-info",{staticClass:"row",attrs:{departmentId:e.departmentId,appId:e.curApp?e.curApp.id:"",readonly:"manager"===e.role},on:{setForm:function(s){e._setForm(s,"appInfo")},setFlow:e._setFlow,update:e._updateApp,back:function(s){e.miniRoutes="appManage"}}}):e._e(),e._v(" "),e.curApp&&e.miniRoutes===e.curCheckRoutes?t("FormEngineInfo",{staticClass:"row",attrs:{departmentId:e.departmentId,curCheckRoutes:e.curCheckRoutes,appId:e.curApp?e.curApp.id:"",readonly:"manager"===e.role},on:{setForm:function(s){e._setForm(s,"formEngine")},setJoinRole:e._setJoinRole,update:e._updateApp,back:function(s){e.miniRoutes="appManage"}}}):e._e(),e._v(" "),"formSetManage"===e.miniRoutes&&e.curApp&&e.curApp.id?t("FormSetManage",{attrs:{departmentId:e.departmentId,appId:e.curApp?e.curApp.id:"",app:e.curApp,readonly:"manager"===e.role,initWay:e.initWay,formId:e.modelId,businessId:e.businessId},on:{back:function(s){e._backToPage(e.parentPage)},submit:e._saveFormInfo}}):e._e(),e._v(" "),"flowSetManage"===e.miniRoutes&&e.curApp&&e.curApp.id?t("FlowSetManage",{attrs:{departmentId:e.departmentId,userType:e.appUserType,appName:e.appName,appId:e.curApp?e.curApp.id:"",readonly:"manager"===e.role,flowId:e.modelId,businessId:e.businessId},on:{back:function(s){e._backToPage("appInfo")},submit:e._saveFlowInfo}}):e._e(),e._v(" "),"joinRoleSet"===e.miniRoutes&&e.curApp&&e.curApp.id?t("JoinRoleSetManage",{attrs:{departmentId:e.departmentId,userType:e.appUserType,appName:e.appName,appId:e.curApp?e.curApp.id:"",readonly:"manager"===e.role,businessId:e.businessId},on:{back:function(s){e._backToPage("formEngine")},submit:e._savePlayers}}):e._e()],1)},staticRenderFns:[]};var w=t("C7Lr")(T,k,!1,function(e){t("o90Q")},null,null);s.default=w.exports},G2p1:function(e,s){},cqZ5:function(e,s){},o90Q:function(e,s){}});