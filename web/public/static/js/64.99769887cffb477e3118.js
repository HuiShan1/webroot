webpackJsonp([64],{c3X4:function(t,a){},k4om:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=e("IvJb"),o=e("C331"),n=e("7CEZ");s.a.component("FormSetManage",n.default);s.a.component("FormSetManage",n.default);var i={props:{data:{default:null},role:{default:""}},created:function(){var t=localStorage.getItem("lang");Object(o.e)(t)&&(this.lang=t),this._initColumns()},data:function(){return{columns:[],url:"/table-data/instructors",tableName:"辅导员信息",method:"get",lang:"zh-cn",student:{name:""},layoutManageJson:{infoTypes:[],route:"main",layoutsJson:{},logJson:{},instanceJson:{},preview:!1,curInfoId:""},showAddModal:!1,instructor:{message:"",userId:"",userNo:"",userName:""},timeStamp:"",curRouter:"instructorInfoList",importParams:{parentPageTitle:"辅导员信息列表",downloadTemplateUrl:"/instructors/batch/template",checkTemplateUrl:"/instructors/excel",downloadErrorTemplateUrl:"/instructors/batch/error",templateName:"批量导入辅导员信息",importBtnType:null}}},computed:{translate:function(){return Object(o.e)(this.lang).infoManage}},methods:{_addInstructor:function(){this.showAddModal=!0,this.instructor={message:"",userId:"",userNo:"",userName:""}},_batchInstructor:function(){var t=this;this.curRouter="importPag",this.importParams.importBtnType=[{url:"/instructors/batch/create",method:"put",isShowBtn:!0,name:"增量导入",success:function(a){a.state&&(t.timeStamp=Object(o.a)())}}]},checkAddUser:function(){var t=this;Object(o.c)({url:"/api/users/"+this.instructor.userNo,type:"GET",success:function(a){a.state?(t.instructor.userId=a.data.userId,t.instructor.userName=a.data.name,t.instructor.errorMessage=""):(t.instructor.errorMessage="用户不存在",t.instructor.userId="",t.instructor.userName="")}})},sureAddInstructor:function(){var t=this;Object(o.c)({url:"/api/instructors",type:"post",data:{userId:this.instructor.userId},success:function(a){a.state?(t.showAddModal=!1,t.$toast("新增成功"),t.timeStamp=Object(o.a)()):"50003"===a.code?t.$toast("该辅导员已存在"):t.$toast(a.message)}})},_initColumns:function(){var t=this;this.columns=[{id:"userNo",title:this.translate.teacherFields.teacherId,className:"text-left",width:150,hidden:!1,search:{type:"input",data:{placeholder:this.translate.teacherFields.teacherId}}},{id:"name",title:this.translate.infoFields.name,className:"text-left",hidden:!1,search:{type:"input",data:{placeholder:this.translate.infoFields.name}}},{id:"opt",title:this.translate.opt,className:"text-center",width:120,hidden:!1,formatter:function(){return[{tag:"a",text:t.translate.show,className:"opt-btn",callback:function(a,e){t._resetLayoutManageJson(),t.student=a,t.layoutManageJson.infoTypes.length>0?t._initInfoType(t.layoutManageJson.infoTypes[0]):(t.$waiting.show(),t._getInfoTypes(function(){t.$waiting.close(),t._initInfoType(t.layoutManageJson.infoTypes[0])}))}},{tag:"a",text:"删除",className:"opt-btn",callback:function(a,e){window.confirm("确定删除吗？")&&Object(o.c)({url:"/api/instructors/"+a.userId,type:"DELETE",success:function(a){a.state?(t.$toast("删除成功"),t.timeStamp=Object(o.a)()):"50003"===a.code?t.$toast("当前辅导员仍有带生关系，请到带生关系设置中解除"):t.$toast(a.message)}})}}]}}]},_resetLayoutManageJson:function(){this.layoutManageJson.layoutsJson={},this.layoutManageJson.logsJson={},this.layoutManageJson.instanceJson={},this.layoutManageJson.curInfoId=""},_setLayout:function(){var t=this;0===this.layoutManageJson.infoTypes.length?(this.$waiting.show(),this._getInfoTypes(function(){t.$waiting.close(),t.layoutManageJson.route="formSetManage",t.$emit("fullScreen",!0)})):(this.layoutManageJson.route="formSetManage",this.$emit("fullScreen",!0))},_getInfoTypes:function(t,a){var e=this;Object(o.c)({url:"/api/information/columnTypes/INSTRUCTOR",type:"get",data:{searchContent:a},success:function(a){a.state?a.data&&a.data.length>0?(e.layoutManageJson.infoTypes=a.data||[],e.layoutManageJson.infoTypes.forEach(function(t){e.$set(t,"title",t.text)}),t&&t()):e.$toast(e.translate.nullColumnTypesTip):e.$toast(a.message)}}).always(function(){})},_closeFormSetting:function(){this.layoutManageJson.route="main",this.$emit("fullScreen",!1)},_saveFormInfo:function(t){var a=this;t.length>0?(this.$waiting.show(),Object(o.c)({url:"/api/information/infoSettings/INSTRUCTOR",type:"put",data:{infoTypes:t},success:function(t){t.state?(a.layoutManageJson.route="main",a.$toast(a.translate.successTip)):a.$toast(t.message)}}).always(function(){a.$waiting.close()})):(this.layoutManageJson.route="main",this.$toast(this.translate.successTip))},_initInfoType:function(t){var a=this;this.layoutManageJson.layoutsJson[t.id]&&this.layoutManageJson.logsJson[t.id]?this.layoutManageJson.curInfoId=t.id:(this.$waiting.show({container:".preview-container"}),Object(o.c)({url:"/api/information/infoSetting/INSTRUCTOR/"+t.id,type:"get",data:{userId:this.student.userId,distributary:"bySchool"},success:function(e){e.state?(e.data||(e.data=[]),e.data.components.forEach(function(t){s.a.set(t,"x",t.location.left),s.a.set(t,"y",t.location.top),s.a.set(t,"w",t.size.width),s.a.set(t,"h",t.size.height)}),a.$set(a.layoutManageJson.layoutsJson,t.id,e.data),Object(o.c)({url:"/api/information/infoInstance/changeLogs/INSTRUCTOR/"+t.id,type:"get",data:{userId:a.student.userId},success:function(e){e.state?(a.$set(a.layoutManageJson.logsJson,t.id,e.data||[]),a.layoutManageJson.curInfoId=t.id,a.layoutManageJson.preview=!0):a.$toast(e.message)}})):a.$toast(e.message)}}).always(function(){a.$waiting.close()}))},_getInfoValue:function(t){this.$set(this.layoutManageJson.instanceJson,this.layoutManageJson.curInfoId,t)},_submitAll:function(){var t=this,a=[];for(var e in this.layoutManageJson.instanceJson)a.push({infoId:e,formData:this.layoutManageJson.instanceJson[e].formData});0!==a.length?(this.$waiting.show(),Object(o.c)({url:"/api/information/infoInstance/INSTRUCTOR/bySchool/"+this.student.userId,type:"put",data:{typesValue:a},success:function(a){a.state?(t.$toast(t.translate.successTip),t.layoutManageJson.instanceJson={},t.layoutManageJson.preview=!1):t.$toast(a.message)}}).always(function(){t.$waiting.close()})):this.$toast("暂无需保存记录")},_saveRoles:function(t){var a=this;Object(o.c)({url:"/api/information/player/"+t.type,type:"put",data:{players:t.players,educationLevel:t.educationLevel},success:function(t){t.state?(a.$toast(a.translate.successTip),a.layoutManageJson.route="formSetManage"):a.$toast(t.message)}})}}},r={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return"instructorInfoList"===t.curRouter?e("div",{staticClass:"info-set-container"},[e("div",{directives:[{name:"show",rawName:"v-show",value:"main"===t.layoutManageJson.route,expression:"layoutManageJson.route === 'main'"}],staticClass:"instructor-info-page"},[e("div",{staticClass:"content text-center"},[e("v-table",{ref:"studentTable",attrs:{title:t.tableName,url:t.url+"?timeStamp="+t.timeStamp,method:t.method,pagesize:"10",idField:"id",columns:t.columns,search:!1,order:!0}},[e("div",{staticClass:"btn-group pull-right",attrs:{slot:"btn-group",role:"group"},slot:"btn-group"},[e("button",{staticClass:"btn btn-bgColor-style clearBtnBorder",on:{click:t._setLayout}},[t._v(t._s(t.translate.layoutManage))]),t._v(" "),e("button",{staticClass:"btn btn-bgColor-style clearBtnBorder",on:{click:t._addInstructor}},[t._v("新增人员")]),t._v(" "),e("button",{staticClass:"btn btn-bgColor-style clearBtnBorder",on:{click:t._batchInstructor}},[t._v("批量新增人员")])])])],1)]),t._v(" "),"main"!==t.layoutManageJson.route?e("FormSetManage",{directives:[{name:"show",rawName:"v-show",value:"formSetManage"===t.layoutManageJson.route,expression:"layoutManageJson.route === 'formSetManage'"}],attrs:{infoSetting:{type:"INSTRUCTOR",tabs:t.layoutManageJson.infoTypes}},on:{back:t._closeFormSetting,submit:t._saveFormInfo,gotoRoleSet:function(a){t.layoutManageJson.route="joinRoleSet"}}}):t._e(),t._v(" "),"joinRoleSet"===t.layoutManageJson.route?e("JoinRoleSetManage",{attrs:{roleSetting:{type:"INSTRUCTOR",educationLevel:t.layoutManageJson.educationLevel}},on:{back:function(a){t.layoutManageJson.route="formSetManage"},submit:t._saveRoles}}):t._e(),t._v(" "),t.layoutManageJson.preview?e("div",{staticClass:"preview-container"},[e("preview",{attrs:{data:t.layoutManageJson.layoutsJson[t.layoutManageJson.curInfoId]&&t.layoutManageJson.layoutsJson[t.layoutManageJson.curInfoId].components,defaultData:t.layoutManageJson.instanceJson[t.layoutManageJson.curInfoId],log:t.layoutManageJson.logsJson[t.layoutManageJson.curInfoId],script:t.layoutManageJson.layoutsJson[t.layoutManageJson.curInfoId]&&t.layoutManageJson.layoutsJson[t.layoutManageJson.curInfoId].property&&t.layoutManageJson.layoutsJson[t.layoutManageJson.curInfoId].property.script,previewType:"form",infoSetting:{tabs:t.layoutManageJson.infoTypes,curInfoId:t.layoutManageJson.curInfoId}},on:{tabExchange:t._initInfoType,submit:t._getInfoValue,submitAll:t._submitAll,search:function(a){t._getInfoTypes(null,a)},back:function(a){t.layoutManageJson.preview=!1}}})],1):t._e(),t._v(" "),e("v-modal",{attrs:{show:t.showAddModal,effect:"fade",width:"500"}},[e("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[e("h5",{staticClass:"modal-title"},[t._v("\n        新增人员\n      ")])]),t._v(" "),e("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[e("div",{staticClass:"form-group"},[e("label",{staticClass:"input-label"},[t._v("教工号")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.instructor.userNo,expression:"instructor.userNo"}],staticClass:"form-control search-input modal-form-style",attrs:{id:"user-no",type:"text"},domProps:{value:t.instructor.userNo},on:{change:t.checkAddUser,input:function(a){a.target.composing||t.$set(t.instructor,"userNo",a.target.value)}}}),t._v(" "),e("button",{staticClass:"btn check-btn clearBtnBorder",attrs:{type:"button"},on:{click:t.checkAddUser}},[t._v("检测")]),t._v(" "),e("p",{staticClass:"error-message"},[t._v(t._s(t.instructor.errorMessage))])]),t._v(" "),e("div",{staticClass:"form-group"},[e("label",{staticClass:"input-label",staticStyle:{"margin-left":"15px"}},[t._v("姓名")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.instructor.userName,expression:"instructor.userName"}],staticClass:"form-control search-input modal-form-style",attrs:{type:"text",disabled:"disabled"},domProps:{value:t.instructor.userName},on:{input:function(a){a.target.composing||t.$set(t.instructor,"userName",a.target.value)}}})])]),t._v(" "),e("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[e("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(a){t.showAddModal=!1}}},[t._v("取消")]),t._v(" "),e("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:t.sureAddInstructor}},[t._v("确定")])])])],1):e("v-import",t._b({on:{backParentPage:function(a){t.curRouter="instructorInfoList"}}},"v-import",t.importParams,!1))},staticRenderFns:[]};var u=e("C7Lr")(i,r,!1,function(t){e("c3X4")},null,null);a.default=u.exports}});