webpackJsonp([64],{"1IlA":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("3cXf"),s=i.n(a),n=i("C331"),r={props:{data:{default:null}},data:function(){return{formFields:{name:"",activityPictures:[],applyAuditNeeded:!0,applyEndTime:"",applyStartTime:"",endTime:"",startTime:""},pageStatus:{pageLayout:{groups:[{title:"",cells:[{title:"活动名称",name:"name",type:"input",required:!0},{title:"活动定位",name:"activityCategory",type:"radio",required:!0}]},{title:"",cells:[{title:"发布方",name:"publisher",type:"radio",required:!0},{title:"主办方",name:"holder",type:"checkbox",required:!0},{title:"承办方（选填）",name:"organizer",type:"checkbox"},{title:"协办方（选填）",name:"coOrganizer",type:"checkbox"}]},{title:"",cells:[{title:"活动封面",name:"activityCover",type:"image",required:!0},{title:"活动图片（选填）",name:"activityPictures",type:"images"},{title:"活动简介",name:"introduction",type:"textarea",max:1e3,required:!0},{title:"活动类型",name:"activityType",type:"tree",required:!0}]},{title:"",cells:[{title:"报名开始时间",name:"applyStartTime",type:"datetime",start:"",end:"applyEndTime",required:!0},{title:"报名结束时间",name:"applyEndTime",type:"datetime",start:"applyStartTime",end:"endTime",required:!0},{title:"活动开始时间",name:"startTime",type:"datetime",start:"applyStartTime",end:"endTime",required:!0},{title:"活动结束时间",name:"endTime",type:"datetime",start:"startTime",end:"",required:!0},{title:"活动地点",name:"place",type:"textarea",max:50,required:!0},{title:"联系方式",name:"telephoneNumber",type:"input",required:!0}]},{title:"",cells:[{title:"面向群体",name:"studentOriented",type:"checkbox"},{title:"人数上限（选填）",name:"userLimit",type:"number"},{title:"报名是否审核",name:"applyAuditNeeded",type:"radio"}]}]},pageOptions:{applyAuditNeeded:[{key:!0,value:"是"},{key:!1,value:"否"}]},editingField:{},checkShow:!1,myCroppa:{},imageCut:{width:360,height:130,start:!1,imageUrl:"",cell:{}}},isChange:!1}},computed:{republish:function(){return!!this.data.data.initData},historyForm:function(){return s()(this.formFields)}},created:function(){this._getPublishers(),this._getHolders(),this._getGroups(),this._getContentTypes(),this._getActivityTypes(),this.republish&&this._initPublish(this.data.data.initData)},methods:{_initPublish:function(t){var e=this;for(var i in t)this.$set(this.formFields,i,t[i]);t.organizations.forEach(function(t){"PUBLISHER"===t.type?e.$set(e.formFields,"publisher",t.organizationId):"SPONSOR"===t.type?(e.formFields.holder||e.$set(e.formFields,"holder",[]),e.formFields.holder.push(t.organizationId)):"PURVEYOR"===t.type?(e.formFields.organizer||e.$set(e.formFields,"organizer",[]),e.formFields.organizer.push(t.organizationId)):"ASSISTANT"===t.type&&(e.formFields.coOrganizer||e.$set(e.formFields,"coOrganizer",[]),e.formFields.coOrganizer.push(t.organizationId))}),this.$set(this.formFields,"studentOriented",[]),t.studentOriented.forEach(function(t){e.formFields.studentOriented.push(t.code+"")}),t.images.forEach(function(t){t.isCover?e.$set(e.formFields,"activityCover",t.image):(e.formFields.activityPictures||e.$set(e.formFields,"activityPictures",[]),e.formFields.activityPictures.push(t.image))}),this.$set(this.formFields,"activityType",[t.contentTypeParentId+"",t.contentTypeId+""]),this.$set(this.formFields,"activityCategory",t.typeId),this.$set(this.formFields,"telephoneNumber",t.contactWay),this.$set(this.formFields,"id",t.id+"")},_checkVal:function(t){/^\d+(\.{0,1}\d+){0,1}$/.test(this.formFields[t.name])||(this.formFields[t.name]="")},_getHourMinuteList:function(t){for(var e=0,i=0,a=this.formFields[t.start],s=this.formFields[t.end],n={hourList:[],minuteList:[]},r=0;r<24;r++)n.hourList.push(("0"+r).slice(-2));for(var o=0;o<24;o++)n.minuteList.push(("0"+o).slice(-2));if(!a)return n;if(e=parseInt(a.slice(10,13)),i=parseInt(a.slice(13,16)),a=new Date(a.replace(/\-\g/,"/")).getTime(),!s)return n;parseInt(s.slice(10,13)),parseInt(a.slice(13,16));var l=((s=new Date(s.replace(/\-\g/,"/")).getTime())-a)/36e5,p=(s-a)/6e4;if(l<24){n.hourList=[];for(var u=0;u<l;u++)n.hourList.push(("0"+(e+u>23?e+u-24:e+u)).slice(-2))}if(p<60){n.minuteList=[];for(var c=0;c<p;c++)n.minuteList.push(("0"+(i+c>59?i+c-60:i+c)).slice(-2))}return n},_valueChange:function(t,e){var i=this,a=this.formFields[e.start],s=this.formFields[e.end],n=0,r=0,o=new Date(t.replace(/\-\g/,"/")).getTime(),l="";if(a&&(n=new Date(a.replace(/\-\g/,"/")).getTime()),s&&(r=new Date(s.replace(/\-\g/,"/")).getTime()),a&&o<=n&&(l="选择的时间要在"+a+"之后！"),s&&o>=r&&(l="选择的时间要在"+s+"之前！"),"endTime"===e.name){var p=this.formFields.applyEndTime,u=p?new Date(p.replace(/\-\g/,"/")).getTime():0;u&&o<=u&&(l="选择的时间要在"+p+"之后！")}l&&(setTimeout(function(){i.formFields[e.name]=""},100),this.$vux.alert.show({title:l}))},_startCut:function(t,e){if(t.target.files[0]){var i=this;this.pageStatus.imageCut.start=!0,this.pageStatus.imageCut.cell=e;var a=new FileReader;a.onloadend=function(t){i.pageStatus.imageCut.imageUrl=t.target.result},a.readAsDataURL(t.target.files[0]),t.target.value=""}},_endCut:function(t){if(t){var e=this.pageStatus.myCroppa.generateDataUrl("image/jpeg",.8);this._uploadImages(e,this.pageStatus.imageCut.cell,"base64")}this.pageStatus.imageCut.start=!1,this.pageStatus.imageCut.imageUrl="",this.pageStatus.cell={}},_removeImage:function(t,e){var i=this;this.$vux.confirm.show({title:"确定删除该图片吗？",onConfirm:function(){i.formFields[t].splice(e,1)}})},_uploadImages:function(t,e,i){var a=this,s="",r={};"base64"===i?(r.data=t,s=this.uploadBase64):((r=new FormData).append("file",t.target.files[0]),t.target.value="",s=this.uploadImage),Object(n.c)({url:s,type:"post",data:r,processData:"base64"===i,contentType:"base64"===i,success:function(t){"88888"===t.code||t.state?"images"===e.type?(a.formFields[e.name]||a.$set(a.formFields,e.name,[]),a.formFields[e.name].push(t.data.hash)):"image"===e.type&&a.$set(a.formFields,e.name,t.data.hash):a._toast(t.message)}})},_getNameStr:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"value",s="";return this.pageStatus.pageOptions[t.name]&&this.pageStatus.pageOptions[t.name].length>0&&this.formFields[t.name]&&this.formFields[t.name].forEach(function(n){e.pageStatus.pageOptions[t.name].forEach(function(t){n===t[i]&&(s+=" "+t[a])})}),s},_focus:function(t){this.pageStatus.editingField=t,["checkbox"].indexOf(t.type)>=0&&(this.pageStatus.checkShow=!0)},_back:function(t){var e=this;this.isChange?this.$vux.confirm.show({title:"返回将会丢失编辑内容，是否返回？",onConfirm:function(){e.$emit("removeBread",e.data)}}):this.$emit("removeBread",this.data)},_submit:function(){var t=this;this._verify().length>0?this._toast("请完善活动信息！"):this.$vux.confirm.show({title:"确定提交活动内容等候审核?",onConfirm:function(){var e=t._format(t.formFields);Object(n.c)({url:"/api/sc/activities"+(t.republish?"/"+t.formFields.id:""),type:t.republish?"put":"post",data:e,success:function(e){e.state?t._toast("发布成功",function(){t.data.isUpdateLastPage=!0,t.$emit("removeBread",t.data)}):t._toast(e.message)}})}})},_verify:function(){var t=this,e=[];return this.pageStatus.pageLayout.groups.forEach(function(i){i.cells.forEach(function(i){i.required&&(t.formFields[i.name]||e.push(i.title))})}),e},_format:function(t){var e=JSON.parse(s()(t));e.organizations=[],e.publisher&&e.organizations.push({organizationId:e.publisher,type:"PUBLISHER"}),delete e.publisher,e.holder&&e.holder.forEach(function(t){var i={organizationId:t,type:"SPONSOR"};e.organizations.push(i)}),delete e.holder,e.organizer&&e.organizer.forEach(function(t){var i={organizationId:t,type:"PURVEYOR"};e.organizations.push(i)}),delete e.organizer,e.coOrganizer&&e.coOrganizer.forEach(function(t){var i={organizationId:t,type:"ASSISTANT"};e.organizations.push(i)}),delete e.coOrganizer;var i=[];return e.studentOriented&&e.studentOriented.forEach(function(t){i.push({code:t})}),e.studentOriented=i,e.images=[],e.activityCover&&e.images.push({image:e.activityCover,isCover:!0}),delete e.activityCover,e.activityPictures&&e.activityPictures.forEach(function(t){e.images.push({image:t,isCover:!1})}),delete e.activityPictures,e.activityType&&(e.contentTypeId=e.activityType[1]),delete e.activityType,e.activityCategory&&(e.typeId=e.activityCategory),delete e.activityCategory,e.telephoneNumber&&(e.contactWay=e.telephoneNumber),delete e.telephoneNumber,e},_getPublishers:function(){var t=this;this.pageStatus.pageOptions.publisher||this.$set(this.pageStatus.pageOptions,"publisher",[]),this.data.data&&this.data.data.publishers&&this.data.data.publishers.forEach(function(e){var i={key:e.id,value:e.name};t.pageStatus.pageOptions.publisher.push(i)})},_getHolders:function(){var t=this;Object(n.c)({url:"/api/sc/organizations/list/brief",type:"get",success:function(e){if(e.state){if(t.pageStatus.pageOptions.holder||t.$set(t.pageStatus.pageOptions,"holder",[]),t.pageStatus.pageOptions.organizer||t.$set(t.pageStatus.pageOptions,"organizer",[]),t.pageStatus.pageOptions.coOrganizer||t.$set(t.pageStatus.pageOptions,"coOrganizer",[]),e.data){var i=[];e.data.forEach(function(t){var e={key:t.id,value:t.name};i.push(e)}),t.pageStatus.pageOptions.holder=i,t.pageStatus.pageOptions.organizer=i,t.pageStatus.pageOptions.coOrganizer=i}}else t._toast("举办方列表获取失败")}})},_getGroups:function(){var t=this;Object(n.c)({url:"/api/colleges",type:"get",success:function(e){e.state?(t.pageStatus.pageOptions.studentOriented||t.$set(t.pageStatus.pageOptions,"studentOriented",[]),e.data&&e.data.forEach(function(e){var i={key:e.code,value:e.name};t.pageStatus.pageOptions.studentOriented.push(i)})):t._toast("群体列表获取失败")}}),this.pageStatus.pageOptions},_getContentTypes:function(){var t=this;Object(n.c)({url:"/api/sc/activityContentType",type:"get",success:function(e){e.state?(t.pageStatus.pageOptions.activityType||t.$set(t.pageStatus.pageOptions,"activityType",[]),e.data&&e.data.forEach(function(e){var i={value:e.id+"",name:e.typeName,parent:0};t.pageStatus.pageOptions.activityType.push(i),e.childType&&e.childType.forEach(function(i){var a={value:i.id+"",name:i.typeName,parent:e.id+""};t.pageStatus.pageOptions.activityType.push(a)})})):t._toast("活动类型列表获取失败")}})},_getActivityTypes:function(){var t=this;Object(n.c)({url:"/api/sc/activities/types",type:"get",success:function(e){e.state?(t.pageStatus.pageOptions.activityCategory||t.$set(t.pageStatus.pageOptions,"activityCategory",[]),e.data&&e.data.forEach(function(e){var i={key:e.id,value:e.name};t.pageStatus.pageOptions.activityCategory.push(i)})):t.$vux.toast.show({text:e.message,position:"bottom",type:"text"})}})},_toast:function(t,e){this.$vux.toast.show({text:t,position:"bottom",type:"text",time:1500,onHide:e})}},watch:{historyForm:{handler:function(t,e){t!==e&&(this.isChange=!0)},deep:!0}},mounted:function(){var t=this;this.$nextTick(function(){t.$refs.name_input[0].focus()})}},o={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"activityPublish"}},[i("view-box",[i("x-header",[i("i",{staticClass:"maticon back-icon",attrs:{slot:"overwrite-left"},domProps:{innerHTML:t._s(t.icons("navigate_before"))},on:{click:t._back},slot:"overwrite-left"},[t._v("navigate_before")])]),t._v(" "),i("div",{staticClass:"publish-content"},[t._l(t.pageStatus.pageLayout.groups,function(e,a){return i("group",{key:a,staticClass:"info-group",attrs:{title:e.title,"label-width":"8em","label-margin-right":"2em","label-align":"left"}},t._l(e.cells,function(e,a){return["input"].indexOf(e.type)>=0?i("x-input",{key:a,ref:e.name+"_input",refInFor:!0,attrs:{title:e.title,placeholder:"请填写",max:e.max,"text-align":"right"},model:{value:t.formFields[e.name],callback:function(i){t.$set(t.formFields,e.name,i)},expression:"formFields[cell.name]"}}):["number"].indexOf(e.type)>=0?i("x-input",{attrs:{title:e.title,placeholder:"请填写","text-align":"right",type:"text",debounce:500},nativeOn:{change:function(i){t._checkVal(e)}},model:{value:t.formFields[e.name],callback:function(i){t.$set(t.formFields,e.name,i)},expression:"formFields[cell.name]"}}):["tel"].indexOf(e.type)>=0?i("x-input",{attrs:{title:e.title,placeholder:"请填写","text-align":"right","is-type":"china-mobile"},model:{value:t.formFields[e.name],callback:function(i){t.$set(t.formFields,e.name,i)},expression:"formFields[cell.name]"}}):["textarea"].indexOf(e.type)>=0?i("x-textarea",{attrs:{title:e.title,placeholder:"请填写",max:e.max},model:{value:t.formFields[e.name],callback:function(i){t.$set(t.formFields,e.name,i)},expression:"formFields[cell.name]"}}):"datetime"===e.type?i("datetime",{attrs:{title:e.title,placeholder:"请选择","value-text-align":"right",format:"YYYY-MM-DD HH:mm"},on:{"on-change":function(i){t._valueChange(i,e)}},model:{value:t.formFields[e.name],callback:function(i){t.$set(t.formFields,e.name,i)},expression:"formFields[cell.name]"}}):"radio"===e.type?i("popup-radio",{attrs:{title:e.title,options:t.pageStatus.pageOptions[e.name]||[],placeholder:"请选择","value-text-align":"right"},model:{value:t.formFields[e.name],callback:function(i){t.$set(t.formFields,e.name,i)},expression:"formFields[cell.name]"}}):"tree"===e.type?i("popup-picker",{ref:e.name+"_picker",refInFor:!0,attrs:{title:e.title,data:t.pageStatus.pageOptions[e.name]||[],columns:2,placeholder:"请选择","value-text-align":"right","show-name":""},model:{value:t.formFields[e.name],callback:function(i){t.$set(t.formFields,e.name,i)},expression:"formFields[cell.name]"}}):["checkbox"].indexOf(e.type)>=0?i("x-input",{attrs:{title:e.title,readonly:"",placeholder:"studentOriented"===e.name?"全校":"请选择",value:t._getNameStr(e),"text-align":"right"},on:{"on-focus":function(i){t._focus(e)}}}):"image"===e.type?i("x-input",{staticClass:"img-input",attrs:{title:e.title},model:{value:t.formFields[e.name],callback:function(i){t.$set(t.formFields,e.name,i)},expression:"formFields[cell.name]"}},[i("span",{attrs:{slot:"right"},slot:"right"},[i("span",{staticClass:"img-control pull-right"},[t.formFields[e.name]?i("x-img",{staticClass:"img-item-cover",attrs:{src:t.imageUrlPrefix+t.formFields[e.name]}}):i("i",{staticClass:"maticon",domProps:{innerHTML:t._s(t.icons("add_a_photo"))}}),t._v(" "),i("input",{attrs:{type:"file"},on:{change:function(i){t._startCut(i,e)}}})],1)])]):"images"===e.type?i("x-input",{attrs:{title:e.title,readonly:""}},[i("span",{attrs:{slot:"right"},slot:"right"},[t._l(t.formFields[e.name],function(a,s){return i("x-img",{key:s,staticClass:"img-item",attrs:{src:t.imageUrlPrefix+a},nativeOn:{click:function(i){i.stopPropagation(),t._removeImage(e.name,s)}}})}),t._v(" "),i("span",{staticClass:"img-control pull-right"},[i("i",{staticClass:"maticon",domProps:{innerHTML:t._s(t.icons("add_a_photo"))}}),t._v(" "),i("input",{attrs:{type:"file"},on:{change:function(i){t._uploadImages(i,e)}}})])],2)]):t._e()}),1)}),t._v(" "),i("box",{staticClass:"submit-box"},[i("x-button",{staticClass:"custom-primary-blue",attrs:{plain:"",type:"primary"},nativeOn:{click:function(e){return t._submit(e)}}},[t._v("提交")])],1),t._v(" "),i("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[i("popup",{attrs:{position:"bottom","max-height":"70%"},model:{value:t.pageStatus.checkShow,callback:function(e){t.$set(t.pageStatus,"checkShow",e)},expression:"pageStatus.checkShow"}},[i("group",{attrs:{title:t.formFields[t.pageStatus.editingField.name]&&t.formFields[t.pageStatus.editingField.name].length>0?"已选择"+t.formFields[t.pageStatus.editingField.name].length+"项":t.pageStatus.editingField.title}},[t.pageStatus.checkShow?i("checklist",{attrs:{options:t.pageStatus.pageOptions[t.pageStatus.editingField.name]||[]},model:{value:t.formFields[t.pageStatus.editingField.name],callback:function(e){t.$set(t.formFields,t.pageStatus.editingField.name,e)},expression:"formFields[pageStatus.editingField.name]"}}):t._e()],1)],1)],1),t._v(" "),i("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[i("popup",{attrs:{height:"100%"},model:{value:t.pageStatus.imageCut.start,callback:function(e){t.$set(t.pageStatus.imageCut,"start",e)},expression:"pageStatus.imageCut.start"}},[i("croppa",{staticStyle:{"margin-top":"30px","text-align":"center",overflow:"hidden"},attrs:{width:t.pageStatus.imageCut.width,height:t.pageStatus.imageCut.width/2,"initial-image":t.pageStatus.imageCut.imageUrl,"show-remove-button":!1,"disable-click-to-choose":!1},model:{value:t.pageStatus.myCroppa,callback:function(e){t.$set(t.pageStatus,"myCroppa",e)},expression:"pageStatus.myCroppa"}},[i("img",{attrs:{slot:"initial",src:t.pageStatus.imageCut.imageUrl},slot:"initial"})]),t._v(" "),i("x-button",{style:"width:"+t.pageStatus.imageCut.width+"px;",attrs:{type:"warn"},nativeOn:{click:function(e){t._endCut(!1)}}},[t._v("取消")]),t._v(" "),i("x-button",{style:"width:"+t.pageStatus.imageCut.width+"px;",attrs:{type:"primary"},nativeOn:{click:function(e){t._endCut(!0)}}},[t._v("确定")])],1)],1)],2)],1)],1)},staticRenderFns:[]};var l=i("C7Lr")(r,o,!1,function(t){i("Xk0l")},null,null);e.default=l.exports},Xk0l:function(t,e){}});