webpackJsonp([28],{"1m23":function(e,t){},BlTJ:function(e,t){},BrgE:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s("mvHQ"),a=s.n(i),n=s("7+uW"),r=s("7t+N"),o=s.n(r),c=s("C331"),l=s("//Fk"),u=s.n(l),p=s("tjnL"),d=(p.a,{mixins:[p.a],data:function(){return{countWayList:[{label:"求和",value:"sum"},{label:"平均值",value:"avg"},{label:"最大值",value:"max"},{label:"最小值",value:"min"}],tableNameList:[],selectCtrl:"",editTable:{},editCom:"",nodeList:[],computedList:[{name:"计算1",value:1,noEdit:!1},{name:"计算2",value:2,noEdit:!1}],ctrlList:[],searchList:[]}},props:{appId:{required:!0,default:""}},mounted:function(){},methods:{getInOptionsTableSet:function(e){for(var t in this.nodeList)if(this.nodeList[t].name===e)return this.nodeList[t].properties.basic.options.map(function(e){return{label:e,value:e}})},nodeSelected:function(e){var t=this,s="/api/report/"+this.appId+"/formTable?component="+e.val;Object(c.d)(s).then(function(e){t.nodeList=e.data})},countSelected:function(){},addSearch:function(){0==this.searchList.length&&this.searchList.push({value:null,andOr:"a",advancedSearchParams:"",conditionVal:"",condition:[],province:null,city:null,area:null})},onShow:function(){this.getCtrlList(),this.getTableNameList()},editReport:function(e,t){if(this.editCom="",e.noEdit){this.advancedSearch.searchItems=[],this.titleName;var s=this.tableNameList.map(function(e){return e.appReportCountVO.forEach(function(e){e.noEdit=!0}),e.noEdit=!0,e});this.editTable=e,this.editTable.index=t,s[t].noEdit=!1,this.tableNameList=s}else e.noEdit=!0},deleteTable:function(e,t){this.tableNameList.splice(t,1)},deleteReport:function(e,t){this.editTable.appReportCountVO.splice(t,1)},editComputed:function(e,t){var s=this;if(e.noEdit){this.editTable.appReportCountVO.map(function(e){return e.noEdit=!0,e});this.advancedSearch.searchItems=[],this.editCom=e,e.appReportCountConditionVO&&e.appReportCountConditionVO.forEach(function(e){s.advancedSearch.searchItems.push({values:e.value,table:e.tableChildName,andOr:"AND"==e.relation?"a":"o",advancedSearchParams:"",conditionVal:e.type.toLowerCase(),condition:[],province:null,tableChild:"",city:null,area:null})}),this.editCom.index=t,this.editCom.noEdit=!1}else e.noEdit=!0},addTable:function(){this.tableNameList.push({reportName:"",appReportCountVO:[],value:"",noEdit:!0}),this.editReport(this.tableNameList[this.tableNameList.length-1],this.tableNameList.length-1)},addComputed:function(){(this.editTable.appReportCountVO||this.editTable.appReportCountVO==[])&&(this.editTable.appReportCountVO.push({component:"",countName:"",countResult:"",countValue:!1,countWay:"",noEdit:!0}),this.editComputed(this.editTable.appReportCountVO[this.editTable.appReportCountVO.length-1],this.editTable.appReportCountVO.length-1))},getCtrlList:function(){var e=this,t="api/report/"+this.appId+"/component";Object(c.d)(t).then(function(t){e.ctrlList=t.data}).catch(function(e){})},getTableNameList:function(){var e=this,t="api/report/"+this.appId+"/report/install ";Object(c.d)(t).then(function(t){t.data&&(e.tableNameList=t.data.map(function(e){return e.appReportCountVO=e.appReportCountVO.map(function(e){return e.noEdit=!0,e}),e.noEdit=!0,e}))}).catch(function(e){})},save:function(){var e=this;return new u.a(function(t,s){var i="api/report/"+e.appId+"/addReport ";Object(c.d)(i,e.tableNameList).then(function(e){t(e)}).catch(function(e){s(e)})})}}}),_={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"tableSet"}},[s("div",[e._l(e.tableNameList,function(t,i){return s("div",{key:i,staticClass:"row center"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.reportName,expression:"item.reportName"}],staticClass:"hideInput",attrs:{placeholder:"请输入"},domProps:{value:t.reportName},on:{input:function(s){s.target.composing||e.$set(t,"reportName",s.target.value)}}}),e._v(" "),s("i",{staticClass:"maticon pull-right",class:{active:!t.noEdit},attrs:{title:"编辑"},domProps:{innerHTML:e._s(e.icons("edit"))},on:{click:function(s){return e.editReport(t,i)}}}),e._v(" "),s("i",{staticClass:"maticon pull-right",attrs:{title:"删除"},domProps:{innerHTML:e._s(e.icons("delete"))},on:{click:function(s){return e.deleteTable(t,i)}}})])}),e._v(" "),s("div",{staticClass:"row center"},[s("i",{staticClass:"maticon pull-right add",attrs:{title:"新增报表"},domProps:{innerHTML:e._s(e.icons("add"))},on:{click:e.addTable}})])],2),e._v(" "),s("div",[e._l(e.editTable.appReportCountVO,function(t,i){return s("div",{key:i,staticClass:"row center"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.countName,expression:"item.countName"}],staticClass:"hideInput",attrs:{placeholder:"请输入"},domProps:{value:t.countName},on:{input:function(s){s.target.composing||e.$set(t,"countName",s.target.value)}}}),e._v(" "),s("i",{staticClass:"maticon pull-right",class:{active:!t.noEdit},attrs:{title:"编辑"},domProps:{innerHTML:e._s(e.icons("edit"))},on:{click:function(s){return e.editComputed(t,i)}}}),e._v(" "),s("i",{staticClass:"maticon pull-right",attrs:{title:"删除"},domProps:{innerHTML:e._s(e.icons("delete"))},on:{click:function(s){return e.deleteReport(t,i)}}})])}),e._v(" "),s("div",{staticClass:"row center"},[s("i",{staticClass:"maticon pull-right add",attrs:{title:"新增计算"},domProps:{innerHTML:e._s(e.icons("add"))},on:{click:e.addComputed}})])],2),e._v(" "),e.editCom?s("div",{staticClass:"editCom"},[s("div",{staticClass:"row box_flex box_between"},[s("div",{staticClass:"left"},[e._v("选择控件")]),e._v(" "),s("v-select",{attrs:{options:e.ctrlList,"options-value":"component","options-label":"label"},on:{afterSelected:e.nodeSelected},model:{value:e.editCom.component,callback:function(t){e.$set(e.editCom,"component",t)},expression:"editCom.component"}})],1),e._v(" "),s("div",{staticClass:"row box_flex box_between"},[s("div",{staticClass:"left"},[e._v("计算方式")]),e._v(" "),s("v-select",{attrs:{options:e.countWayList,"options-value":"value","options-label":"label"},model:{value:e.editCom.countWay,callback:function(t){e.$set(e.editCom,"countWay",t)},expression:"editCom.countWay"}})],1),e._v(" "),s("div",{staticClass:"row box_flex box_between"},[s("div",{staticClass:"left"},[e._v("是否计算空值")]),e._v(" "),s("div",{staticClass:"switch box_flex align_center",on:{click:function(t){e.editCom.countValue=!e.editCom.countValue}}},[s("div",{staticClass:"slider",class:e.editCom.countValue?"on":"off"},[s("div",{staticClass:"pipe",class:e.editCom.countValue?"right":""})])])]),e._v(" "),e._l(e.advancedSearch.searchItems,function(t,i){return s("div",{key:i,staticClass:"row box_flex box_between advanced"},[s("v-select",{attrs:{options:e.nodeList,search:!0,"options-value":"name","options-label":"title","data-index":i},on:{afterSelected:function(s){return e.advanceSelected("table",t)}},model:{value:t.table,callback:function(s){e.$set(t,"table",s)},expression:"searchItem.table"}}),e._v(" "),s("v-select",{attrs:{options:t.condition,search:!0},on:{afterSelected:e.advanceSelected},model:{value:t.conditionVal,callback:function(s){e.$set(t,"conditionVal",s)},expression:"searchItem.conditionVal"}}),e._v(" "),"empty"!==t.conditionVal&&"filled"!==t.conditionVal?s("div",{staticClass:"box_flex align_center"},[!(t.table&&-1!==t.table.indexOf("select")||t.table&&-1!==t.table.indexOf("radio"))||"eq"!==t.conditionVal&&"ne"!==t.conditionVal?"in"===t.conditionVal||"nin"===t.conditionVal||t.table&&-1!==t.table.indexOf("checkbox")&&("eq"===t.conditionVal||"ne"===t.conditionVal)?s("v-select",{attrs:{options:e.getInOptionsTableSet(t.table),search:!0,multiple:"true"},on:{afterSelected:e.advanceSelected},model:{value:t.values,callback:function(s){e.$set(t,"values",s)},expression:"searchItem.values"}}):t.table&&-1===t.table.indexOf("address")?s("input",{directives:[{name:"model",rawName:"v-model",value:t.values,expression:"searchItem.values"}],staticClass:"value-input",staticStyle:{"margin-left":"16px"},attrs:{type:"text"},domProps:{value:t.values},on:{change:e.advanceSelected,input:function(s){s.target.composing||e.$set(t,"values",s.target.value)}}}):e._e():s("v-select",{attrs:{options:e.getInOptionsTableSet(t.table),search:!0},on:{afterSelected:e.advanceSelected},model:{value:t.values,callback:function(s){e.$set(t,"values",s)},expression:"searchItem.values"}})],1):e._e()],1)}),e._v(" "),e.nodeList.length?s("button",{staticClass:"submit-btn btn",staticStyle:{"margin-left":"16px"},on:{click:function(t){return e.addSearchItem()}}},[e._v("新增")]):e._e()],2):e._e()])},staticRenderFns:[]};var h=s("VU/8")(d,_,!1,function(e){s("Rmvn"),s("b50i"),s("BsgA")},"data-v-121d711e",null).exports,m={props:{departmentId:{default:"1"},appId:{required:!0,default:""},readonly:{default:!1}},created:function(){var e=this,t=localStorage.getItem("lang");Object(c.g)(t)&&(this.lang=t),Object(c.e)({url:"/api/system/dictTypes/1003/dicts?lang=",type:"get",async:!1,success:function(t){e.schoolStatus=t.data}}),Object(c.e)({url:"/api/system/dicts?dictType=培养层次",type:"get",async:!1,success:function(t){e.educationLevel=t.data}}),this.nowTime=(new Date).getTime(),this.backgroundList=[{id:0,background:"linear-gradient(-135deg, #3F87E7 0%, #377EEB 100%)"},{id:1,background:"linear-gradient(-135deg, #F4A23F 0%, #F4A441 100%)"},{id:2,background:"linear-gradient(-135deg, #EF5E36 0%, #EF5E36 100%)"},{id:3,background:"linear-gradient(-135deg, #59CAAD 0%, #59C9AC 100%)"},{id:4,background:"linear-gradient(-135deg, #8489D8  0%, #888ACA 100%)"},{id:5,background:"linear-gradient(-135deg, #51B590 0%, #51B590 100%)"},{id:6,background:"linear-gradient(-135deg, #CEA44D 0%, #E0C37A 100%)"}],this.iconList=[{id:0,name:"school"},{id:1,name:"accessibility"},{id:2,name:"account_balance"},{id:3,name:"account_balance_wallet"},{id:4,name:"account_circle"},{id:5,name:"alarm"},{id:6,name:"assignment"},{id:7,name:"book"},{id:8,name:"build"},{id:9,name:"description"},{id:10,name:"explore"},{id:11,name:"extension"},{id:12,name:"face"},{id:13,name:"favorite"},{id:14,name:"flight_land"},{id:15,name:"flight_takeoff"},{id:16,name:"get_app"},{id:17,name:"grade"},{id:18,name:"language"},{id:19,name:"launch"},{id:20,name:"loyalty"},{id:21,name:"perm_contact_calendar"},{id:22,name:"receipt"},{id:23,name:"question_answer"},{id:24,name:"restore"},{id:25,name:"room"},{id:26,name:"schedule"},{id:27,name:"search"},{id:28,name:"shopping_cart"},{id:29,name:"swap_horiz"},{id:30,name:"theaters"},{id:31,name:"update"},{id:32,name:"verified_user"},{id:33,name:"work"},{id:34,name:"visibility"},{id:35,name:"equalizer"},{id:36,name:"business"},{id:37,name:"call"},{id:38,name:"chat"},{id:39,name:"email"},{id:40,name:"create"},{id:41,name:"flag"},{id:42,name:"save"},{id:43,name:"link"},{id:44,name:"send"},{id:45,name:"devices"},{id:46,name:"attach_file"},{id:47,name:"format_quote"},{id:48,name:"cloud"},{id:49,name:"folder"},{id:50,name:"computer"},{id:51,name:"headset"},{id:52,name:"security"},{id:53,name:"sim_card"},{id:54,name:"watch"},{id:55,name:"add_a_photo"},{id:56,name:"camera_alt"},{id:57,name:"directions_railway"},{id:58,name:"directions_bike"},{id:59,name:"local_activity"},{id:60,name:"directions_walk"},{id:61,name:"local_dining"},{id:62,name:"local_hospital"},{id:63,name:"local_library"},{id:64,name:"event_note"},{id:65,name:"map"},{id:66,name:"navigation"},{id:67,name:"wifi"},{id:68,name:"ac_unit"},{id:69,name:"fitness_center"},{id:70,name:"pool"},{id:71,name:"cake"},{id:72,name:"group"},{id:73,name:"location_city"},{id:74,name:"notifications"},{id:75,name:"person"},{id:76,name:"poll"},{id:77,name:"public"},{id:78,name:"share"},{id:79,name:"whatshot"}],this.appState.columns=[{id:"name",title:"姓名",width:130,className:"text-left",hidden:!1},{id:"userNo",title:"学号",width:150,className:"text-left",hidden:!1,formatter:function(t,s){return"3"===e.curApp.appType.userType?t.account:t.userNo}},{id:"collegeName",title:"学院",width:150,className:"text-left",hidden:!1},{id:"grade",title:"年级",width:80,className:"text-left",hidden:!1},{id:"studentType",title:"学生类型",width:100,className:"text-left",hidden:!0},{id:"inSchoolValue",title:"在校状态",width:100,className:"text-left",hidden:!1},{id:"studentTypeValue",title:"学生类型",width:100,className:"text-left",hidden:!1},{id:"opt",title:"操作",className:"text-left",width:80,hidden:!1,formatter:function(t){return[{tag:"a",text:"删除",callback:function(t,s){confirm("确定要删除吗？")&&Object(c.e)({url:"/api/app/"+e.appId+"/business/"+e.curBusiness.business.id+"/"+t.userId,dataType:"json",type:"delete",success:function(t){t.state?(e.$toast("删除成功"),e.timestamp=new Date):e.$toast(t.message)}})}}]}}],this.JiekouColumns=[{id:"name",title:"姓名",width:130,className:"text-left",hidden:!1},{id:"userNo",title:"学号",width:150,className:"text-left",hidden:!1,formatter:function(t,s){return"3"===e.curApp.appType.userType?t.account:t.userNo}},{id:"collegeName",title:"学院",width:150,className:"text-left",hidden:!1},{id:"grade",title:"年级",width:80,className:"text-left",hidden:!1},{id:"educetionLevel",title:"培养层次",width:100,className:"text-left",hidden:!0},{id:"createTime",title:"更新时间",width:100,className:"text-left",hidden:!1}],this.appState.inSchoolOptions=[{id:0,label:"不限制"},{id:1,label:"在校"},{id:2,label:"不在校"}],this.appState.infoTypes=[{id:"base",name:"基本信息"},{id:"faceTo",name:"面向人员"},{id:"timeSet",name:"时间设置"},{id:"description",name:"办理指南"},{id:"records",name:"办理记录"}];for(var s=(new Date).getFullYear(),i=s+3;i>s-5;i--)this.appState.gradeOptions.push({id:i+"",label:i+"-"+(i+1)+"学年"});for(var a=s+3;a>s-5;a--)this.appState.gradeOptions2.push({id:a+"",label:a+"级"});Object(c.e)({url:"/api/relationship/getSelectOptions",dataType:"json",type:"get",success:function(t){var s=t.data;t.state&&(e.collegeOptions=s.colleges||[],e.gradeOptions=s.grades||[])}}),this._initAppInfo()},data:function(){return{JiekouColumns:[],typeL:"",schoolStatus:[],educationLevel:[],notInSchoolStatus:[],inSchoolStatus:[],iconList:["business","assignment","school","person_pin_circle","person_pin","people","local_library","tag_faces","favorite"],saasIconList:["road","book","camera","idcard","tuition","bankcard","list","text","help","layer","package","cap","letter","calendar","menu","menu2","menu3","apply","info","rightcard","drippower","bulb","record","direction","person","envelope","reduce","socialist","star","assets","notebook","location","purse","remark","statisticsbar","building","geography","rotate","manlove","medal","pick","purse2","free","tag","menudone","travel","trophy","medal2","question","excellent","search"],formList:[],curApp:{name:"点击右侧按钮编辑应用名称",imgPath:"",imgType:"1",remark:"应用说明"},nameChangeMsg:"",descChangeMsg:"",appState:{editPart:"",showFormModal:!1,showFlowModal:!1,infoType:"base",flowName:"",formName:"",modelId:"",infoTypes:[],columns:[],recordColumns:[],inSchoolOptions:[],gradeOptions:[],gradeOptions2:[],flowData:{id:"",chart:{}},background:"linear-gradient(-135deg, #5067D7 0%, #3F53B8 100%)"},editorConfig:{initialFrameHeight:520},businessList:[],leftIconShow:!1,rightIconShow:!1,curBusiness:null,curTimeNode:null,timeSet:null,errorMsg:"",nowTime:"",defineSearch:{userNo:"",name:"",status:"",collegeCode:"",grade:""},collegeOptions:[],gradeOptions:[],preview:!1,previewObj:{formData:null,authorities:null,recordData:[],log:null,curBusinessId:"",appId:""},importParams:{parentPageTitle:"人员列表",downloadTemplateUrl:"/app/business/studentExcelTemplate",downloadErrorTemplateUrl:"/app/business/errorBusinessStudentExcel",checkTemplateUrl:"",templateName:"面向人员名单导入模板",importBtnType:null},showImportModal:!1,overriteImport:"覆盖导入",incrementImport:"增量导入",resultMessageJson:{overtime:"申请在{{node}}节点超时",rescissory:"申请者取消申请",disable:"业务期停用，表单废弃",success:"申请已通过",fail:"申请在{{node}}节点不通过",end:"已结束",submit:"待{{node}}节点审核",agree:"待{{node}}节点审核",reject:"申请被驳回至{{node}}节点",countermand:"申请被撤回至{{node}}节点"},timestamp:"",newName:"",releaseBusinessDisabled:!1,annoreleaseBusinessText:"",numberDesc:"",showTime:!1,showIconModal:!1,showTableModal:!1,backgroundList:[],outputList:[],exportFiledArr:[],notAllowOutput:["label","splitLine","attachment"],outputModalShow:!1,formFields:[],reviseSetTimeOut:null,clickCount:0,isReviseBusiness:!1,isReviseData:!1,isChangeGuideInfo:!1,reviseMark:!1,businessTimer:null,blankTemplateId:"",faceToPeopleType:["2","3","4"],lang:"zh-cn"}},computed:{host:function(){return window.location.host},initDataOfChart:function(){var e=null;return this.appState.flowData.chart&&this.appState.flowData.chart.nodes&&this.appState.flowData.chart.nodes.length>0&&(e={},this.appState.flowData.chart.nodes.forEach(function(t,s){e[t.id]=t})),e},businessIsOn:function(){var e=this,t=!1;return this.curBusiness&&this.businessList.forEach(function(s){s.business.id!==e.curBusiness.business.id&&s.business.isPublic&&s.business.isEnable&&(t=!0)}),t},peopleUrl:function(){return"/table-data/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/users/page?timestamp="+this.timestamp},peopleUrlJiekou:function(){return"/table-data/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/api/users/page?timestamp="+this.timestamp},inputStyleWidth:function(){return this.curApp.name.length<=20?34*this.curApp.name.length:27*this.curApp.name.length},rowsNumber:function(){return this.curApp.remark?this.curApp.remark.length>62&&this.curApp.remark.length<=124?2:this.curApp.remark.length>124&&this.curApp.remark.length<=186?3:this.curApp.remark.length>186?4:1:1}},mounted:function(){},watch:{appId:function(){this._initAppInfo()},errorMsg:function(){var e=this;setTimeout(function(){e.errorMsg=""},1500)},curBusiness:function(){this.curBusiness&&this._loadBusinessTime()},curApp:function(){var e=this,t="学号";this.curApp&&this.curApp.appType&&("1"===this.curApp.appType.userType?t="学号":"2"===this.curApp.appType.userType?t="教工号":"3"===this.curApp.appType.userType?t="新生账号":"4"===this.curApp.appType.userType&&(t="学工号")),"4"!==this.curApp.appType.userType?this.appState&&this.appState.columns&&this.appState.columns[1]&&n.a.set(this.appState.columns[1],"title",t):this.appState.columns=[{id:"name",title:"姓名",width:150,className:"text-left",hidden:!1},{id:"userNo",title:"学工号",width:150,className:"text-left",hidden:!1},{id:"collegeName",title:"学院",width:150,className:"text-left",hidden:!1},{id:"opt",title:"操作",className:"text-left",width:100,hidden:!1,formatter:function(t){return[{tag:"a",text:"删除",callback:function(t,s){confirm("确定要删除吗？")&&Object(c.e)({url:"/api/app/"+e.appId+"/business/"+e.curBusiness.business.id+"/"+t.userId,dataType:"json",type:"delete",success:function(t){t.state?(e.$toast("删除成功"),e.timestamp=new Date):e.$toast(t.message)}})}}]}}],this.appState&&this.appState.recordColumns&&this.appState.recordColumns[1]&&n.a.set(this.appState.recordColumns[1],"title",t),this.numberDesc=t}},methods:{updateHand:function(){var e=this;Object(c.e)({url:"/api/app/business/updateUserByApi/"+this.curBusiness.business.id,dataType:"json",type:"get",success:function(t){t.state&&(e.$toast("更新成功"),e.timestamp=new Date)}})},_initAppInfo:function(){var e=this;this._initCurApp(function(){e._initBusinessList(),e._initFlowChart()})},_initColumns:function(){var e=this;"4"===this.curApp.appType.userType?this.appState.recordColumns=[{id:"userNo",title:this.numberDesc,width:150,className:"text-left",hidden:!1,search:{type:"input",data:{}},formatter:function(t,s){return"3"===e.curApp.appType.userType?(e.appState.recordColumns[0].id="account",t.applicant.account):t.applicant.userNo}},{id:"name",title:"姓名",width:100,className:"text-left",hidden:!1,search:{type:"input",data:{placeholder:"请输入姓名"}},formatter:function(e,t){return e.applicant.name}},{id:"college",title:"学院",width:150,className:"text-left",hidden:!1,formatter:function(e,t){return e.applicant.collegeCode}},{id:"createTime",title:"发起时间",width:200,search:{type:"datetime",data:{dateFormat:"yyyy-MM-dd hh:ii:ss"}},className:"text-left",hidden:!1},{id:"status",title:"状态",width:150,className:"text-left",hidden:!1,formatter:function(t,s){var i="";return"pending"===t.status.toLowerCase()?i=e.resultMessageJson[t.lastAction]?e.resultMessageJson[t.lastAction].replace("{{node}}",t.currentNode.name):" ":"end"===t.status.toLowerCase()&&(i=e.resultMessageJson[t.result.toLowerCase()]?e.resultMessageJson[t.result.toLowerCase()].replace("{{node}}",t.currentNode.name):" "),i}},{title:"操作",width:50,className:"text-center",hidden:!1,formatter:function(t,s){return[{tag:"a",text:"查看",callback:function(t,s){e.previewObj.curBusinessId=t.businessId,e.previewObj.appId=t.appId,e._getLog(t.id,function(t){e.previewObj.log=t||null}),e._getAuthorityData(t.id,function(t){e.previewObj.authorities=t||[]}),e._getFormLayout(t.businessId,t.currentNode.id,function(s){e.previewObj.formData=s,e.previewObj.formData.components.forEach(function(e){n.a.set(e,"x",e.location.left),n.a.set(e,"y",e.location.top),n.a.set(e,"w",e.size.width),n.a.set(e,"h",e.size.height)}),e._getInitData(t.id,function(t){e.previewObj.recordData=t,e.preview=!0})})}}]}}]:this.appState.recordColumns=[{id:"userNo",title:this.numberDesc,width:150,className:"text-left",hidden:!1,search:{type:"input",data:{}},formatter:function(t,s){return"3"===e.curApp.appType.userType?(e.appState.recordColumns[0].id="account",t.applicant.account):t.applicant.userNo}},{id:"name",title:"姓名",width:150,className:"text-left",hidden:!1,search:{type:"input",data:{placeholder:"请输入姓名"}},formatter:function(e,t){return e.applicant.name}},{id:"grade",title:"年级",width:80,className:"text-left",hidden:!1,search:{type:"input",data:{placeholder:"请输入年级"}},formatter:function(e,t){return e.applicant.grade}},{id:"createTime",title:"发起时间",width:200,search:{type:"datetime",data:{dateFormat:"yyyy-MM-dd hh:ii:ss"}},className:"text-left",hidden:!1},{id:"status",title:"状态",width:150,className:"text-left",hidden:!1,formatter:function(t,s){var i="";return"pending"===t.status.toLowerCase()?i=e.resultMessageJson[t.lastAction]?e.resultMessageJson[t.lastAction].replace("{{node}}",t.currentNode.name):" ":"end"===t.status.toLowerCase()&&(i=e.resultMessageJson[t.result.toLowerCase()]?e.resultMessageJson[t.result.toLowerCase()].replace("{{node}}",t.currentNode.name):" "),i}},{title:"操作",width:50,className:"text-center",hidden:!1,formatter:function(t,s){return[{tag:"a",text:"查看",callback:function(t,s){e.previewObj.curBusinessId=t.businessId,e.previewObj.appId=t.appId,e._getLog(t.id,function(t){e.previewObj.log=t||null}),e._getAuthorityData(t.id,function(t){e.previewObj.authorities=t||[]}),e._getFormLayout(t.businessId,t.currentNode.id,function(s){e.previewObj.formData=s,e.previewObj.formData.components.forEach(function(e){n.a.set(e,"x",e.location.left),n.a.set(e,"y",e.location.top),n.a.set(e,"w",e.size.width),n.a.set(e,"h",e.size.height)}),e._getInitData(t.id,function(t){e.previewObj.recordData=t,e.preview=!0})})}}]}}]},_initImportTpl:function(){this.curApp&&this.curApp.appType&&"3"===this.curApp.appType.userType&&(this.importParams.downloadTemplateUrl="/app/business/freshmanExcelTemplate")},_releaseApp:function(){var e=this,t="post",s="应用发布后将对用户可见，确定发布吗？",i="发布成功";this.curApp.isPublished&&(t="delete",s="应用下架后将对用户不可见，确定下架吗？",i="下架成功"),confirm(s)&&Object(c.e)({url:"/api/app/"+this.curApp.id+"/public",type:t,success:function(t){t.state?(e.curApp.isPublished=!e.curApp.isPublished,e.$toast(i)):e.$toast(t.message)}})},_limitLength:function(e){this.curApp.name=this._getStrByteLimit(e.target.value,50)},_saveAppName:function(){var e=this;this.curApp.name?Object(c.e)({url:"/api/app/"+this.curApp.id+"/name",type:"put",data:{name:this.curApp.name},success:function(t){t.state?(e.$emit("update",e.curApp),e.nameChangeMsg="修改成功",setTimeout(function(){e.nameChangeMsg=""},2e3)):e.nameChangeMsg="出错啦："+t.message}}):this.nameChangeMsg="出错啦：名称不能为空"},_saveAppDesc:function(){var e=this;Object(c.e)({url:"/api/app/"+this.curApp.id+"/remark",type:"put",data:{remark:this.curApp.remark},success:function(t){t.state?(e.$emit("update",e.curApp),e.descChangeMsg="修改成功",setTimeout(function(){e.descChangeMsg=""},2e3)):e.descChangeMsg="出错啦："+t.message}})},_saveAppIcon:function(){var e=this;Object(c.e)({url:"/api/app/"+this.curApp.id+"/style",type:"put",data:{imgPath:this.appState.imgPath,imgType:this.appState.imgType,background:this.appState.background},success:function(t){t.state?(e._savePart("imgPath"),e._savePart("imgType"),e._savePart("background"),e.$emit("update",e.curApp),e.showIconModal=!1):e.$toast(t.message)}})},_saveTableSet:function(){var e=this;this.$refs.tableset.save().then(function(t){t.state?(e.showTableModal=!1,e.$toast("保存成功")):e.$toast("错误:"+t.message)}).catch(function(t){e.$toast("错误:"+t.message)})},_getLog:function(e,t){var s=this;Object(c.e)({url:"/api/processEngine/processInstances/"+e+"/handleLogs",type:"get",success:function(e){e.state?t(e.data):s.$toast(e.message)}})},_getInitData:function(e,t){var s=this;Object(c.e)({url:"/api/processEngine/processInstances/"+e,type:"get",success:function(e){e.state?t(e.data):s.$toast(e.message)}})},_getAuthorityData:function(e,t){var s=this;Object(c.e)({url:"/api/processEngine/processInstances/"+e+"/operations",type:"get",success:function(e){e.state?t(e.data):s.$toast(e.message)}})},_getFormLayout:function(e,t,s){var i=this;Object(c.e)({url:"/api/processEngine/business/"+e+"/formRenderData?nodeId="+t,type:"get",success:function(e){e.state?s(e.data):i.$toast(e.message)}})},_changeBusinessGuide:function(e){this.curBusiness.business.guide=e,this.isChangeGuideInfo=!0},_stateSearch:function(e){this.$refs.recordsTable.tableSearchFields.status=e.val},_tabClick:function(e){var t=this;this.isChangeGuideInfo&&(this.reviseMark?this.isReviseData=!1:this.isReviseData=!0),this.appState.infoType=e.id,this._loadBusinessTime(),"timeSet"===e.id?setTimeout(function(){t.$refs.timeSet.refresh()},500):"records"===e.id&&this._initColumns(),this.importParams.checkTemplateUrl="/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/excel",this.importParams.importBtnType=[{name:this.overriteImport,url:"/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/excel",method:"put",isShowBtn:!0,success:function(e){e.state&&(t.timestamp=new Date)}}]},_changeBusiness:function(e,t){this.typeL=t,this.curBusiness=e,this.showImportModal=!1,this.isReviseBusiness=!1,this._getFormFields(this.curBusiness.business.id)},_back:function(){this.$emit("back",this.curApp),this.businessTimer&&clearInterval(this.businessTimer)},_initFlowChart:function(){var e=this;Object(c.e)({url:"/api/apps/"+this.appId+"/settings/flows",type:"get",success:function(t){t.state?t.data&&(e.appState.flowData.id=t.data.id,e.appState.flowData.chart=t.data.chart):e.$toast(t.message)}})},_initFormList:function(){var e=this;""!==this.appId?Object(c.e)({type:"get",url:"/api/departments/"+this.departmentId+"/apps/forms?userType="+this.curApp.appType.userType,success:function(t){t.state?e.formList=t.data:e.$toast(t.message)}}):this.formList=[]},_getFormName:function(e){var t=this;Object(c.e)({url:"/api/apps/"+this.appId+"/settings/forms",type:"get",success:function(e){e.state?e.data&&(t.appState.formName=e.data.name):t.$toast(e.message)}})},_getFlowName:function(e){var t=this;Object(c.e)({url:"/api/apps/"+this.appId+"/settings/flows",type:"get",success:function(e){e.state?e.data&&e.data.settings&&(t.appState.flowName=e.data.settings.name):t.$toast(e.message)}})},_initCurApp:function(e){var t=this;Object(c.e)({type:"get",url:"/api/app/"+this.appId,success:function(s){s.state?(t.curApp=s.data,t.$set(t.appState,"imgType",t.curApp.imgType),t._initFormList(),t._getFormName(),t._getFlowName(),t.curApp&&t.curApp.appType&&("4"===t.curApp.appType.userType||"2"===t.curApp.appType.userType?t.blankTemplateId="5c00b20c72877c31752fc75c":t.blankTemplateId="5ae147c265249c38288e9f00"),e&&e()):t.$toast(s.message)}})},_initBusinessList:function(){var e=this;Object(c.e)({type:"get",url:"/api/app/"+this.appId+"/business",success:function(t){t.state?(e.businessList=t.data,e.businessList.forEach(function(t,s){t.business.isPublic&&t.business.isEnable&&(e.curBusiness=t,e.typeL=t.business.limitType,e._scrollToBusiness(s),e._getFormFields(e.curBusiness.business.id),e.businessTimer&&clearInterval(e.businessTimer)),t.business.isPublishing&&(e.releaseBusinessDisabled=!0,e.annoreleaseBusinessText=e.translate.announcing)})):e.$toast(t.message)}})},_releaseBusiness:function(e){var t=this;if("release"===e){if(this.releaseBusinessDisabled)return;if(!confirm("确认发布本业务吗？业务期一旦开启，为保证申请的正常进行，系统将自动锁定该业务期所关联的流程及表单，业务期内将无法再对流程及表单进行编辑"))return;this.releaseBusinessDisabled=!0,this.annoreleaseBusinessText="发布中...",this._save("business",function(){Object(c.e)({url:"/api/app/"+t.appId+"/business/"+t.curBusiness.business.id+"/publish",type:"put",success:function(e){t.releaseBusinessDisabled=!1,t.annoreleaseBusinessText="",e.state?(e.data.publishing&&!e.data.published&&(t.releaseBusinessDisabled=!0,t.annoreleaseBusinessText="发布中...",t.$toast("业务期发布中，后台运行"),t.businessTimer=setInterval(function(){t._initBusinessList()},3e4)),e.data.published&&(t.curBusiness.business.isPublic=!0,t.$toast("业务期发布成功"),"3"==t.curBusiness.business.limitType&&(t.typeL=3))):"31114"===e.code?(t.releaseBusinessDisabled=!0,t.annoreleaseBusinessText="发布中...",confirm("应用未发布情况下无法发布业务期，确定同时发布应用吗？")?Object(c.e)({url:"/api/app/"+t.appId+"/business/"+t.curBusiness.business.id+"/publish?publishApp=true",type:"put",success:function(e){t.releaseBusinessDisabled=!1,t.annoreleaseBusinessText="",e.state?(t.curBusiness.business.isPublic=!0,t.curApp.isPublished=!t.curApp.isPublished,t.$toast("发布成功")):t.$toast(e.message)}}):(t.releaseBusinessDisabled=!1,t.annoreleaseBusinessText="")):t.$toast(e.message)}})})}else confirm("确定要停止此业务期吗？停止后，此业务期的所有数据将作废且不可恢复")&&this._stopOrRemove("stop")},_removeBusiness:function(e){confirm("确定删除该业务期？")&&this._stopOrRemove("remove",e)},_stopOrRemove:function(e,t){var s=this,i="stop"===e?this.curBusiness.business.id:this.businessList[t].business.id;i?Object(c.e)({url:"/api/app/"+this.appId+"/business/"+i,type:"delete",success:function(a){a.state?(s.$toast("操作成功"),"stop"===e?s.curBusiness.business.isEnable=!1:(s.businessList.splice(t,1),s._testIconShow(),s.curBusiness.business.id===i&&(s.curBusiness=null))):s.$toast(a.message)}}):this.businessList.splice(t,1)},_addNewBusiness:function(){if(this.typeL="",this.curApp.setting.formId&&this.curApp.setting.flowId){var e,t,s=(new Date).getFullYear();(new Date).getMonth()>=8?(e=s+"-"+(s+1)+"学年"+this.curApp.name,t=s):(e=s-1+"-"+s+"学年"+this.curApp.name,t=s-1);var i=e;this.creatNewName(e,i),this.appState.infoType="base",this.curBusiness={business:{name:this.newName,year:t+"",linkUrl:"",guide:"",settingId:"",businessTimeList:[],limitType:0,beginTime:"",endTime:"",isEnable:!1,isLimit:!1,isPublic:!1},flowSetting:null,formSetting:null,businessLimit:{id:"",inSchool:0,grade:[],studentType:[],schoolStatus:[],educationLevel:[],url:"",updateType:"COVER",cron:""}},this.businessList.push(this.curBusiness),this._scrollToBusiness(this.businessList.length-1),this._save("business",function(){})}else this.$toast("请先设置该应用的表单和流程哟~")},creatNewName:function(e,t){var s=!1;this.businessList.forEach(function(i){if(i.business.name===e){s=!0;var a=e.split(t);if(a[1]){var n=parseInt(a[1])+1;e=t+n}else e=t+1}}),s?this.creatNewName(e,t):this.newName=e},_editPart:function(e){this.showIconModal=!0,this.appState.editPart=e,this.$set(this.appState,e,this.curApp[e]),this.$set(this.appState,"imgPath",this.curApp.imgPath),this.curApp.background&&this.$set(this.appState,"background",this.curApp.background),this.$set(this.appState,"imgPath",this.curApp.imgPath),this.$set(this.appState,"imgType",this.curApp.imgType)},_cancelPart:function(e){this.showIconModal=!1,this.appState.editPart="",this.appState[e]="",this.appState.background=""},_savePart:function(e,t){this.curApp[e]=this.appState[e],this.appState.editPart="",this.appState[e]=""},_setAppForm:function(){this.curApp.setting.formId?this._initWithModel():(n.a.set(this.appState,"form",this.curApp.form),this.appState.showFormModal=!0)},_setAppFlow:function(){this.$emit("setFlow",{modelId:this.curApp.setting.flowId,businessId:""}),this._save("",function(){})},_selectIcon:function(e,t){this.appState.imgPath=e.name,this.appState.imgType=t||"1"},_selectBackground:function(e){this.appState.background=e.background},_initWithModel:function(){this.$emit("setForm",{modelId:this.appState.modelId,type:this.curApp.setting.formId?"edit":"create",businessId:""}),this._save("",function(){})},_scrollLeft:function(){o()("#businessDiv").animate({scrollLeft:o()("#businessDiv").scrollLeft()-500},100),this._testIconShow()},_scrollRight:function(){o()("#businessDiv").animate({scrollLeft:o()("#businessDiv").scrollLeft()+500},100),this._testIconShow()},_scrollToBusiness:function(e){var t=this;setTimeout(function(){o()("#businessDiv").animate({scrollLeft:o()("#businessDiv").scrollLeft()+200*e},100),t._testIconShow()},300)},_testIconShow:function(){var e=this;setTimeout(function(){e.leftIconShow=o()("#businessDiv").scrollLeft()>0,e.rightIconShow=o()(".business-scroll").width()-o()("#businessDiv").scrollLeft()>o()("#businessDiv").width()},300)},_compareTime:function(e,t){var s=new Date(e[t].start).getTime(),i=new Date(e[t].end).getTime();return this.nowTime<s?0===t?"left":this.nowTime>new Date(e[t-1].end).getTime()?"left":"":this.nowTime>s&&this.nowTime<i?"center":""},_changeLimitType:function(e){this.curBusiness.business.isPublic||(this.curBusiness.business.limitType=e)},_afterSelectYear:function(e){this.curBusiness.business.year=e.val,this.isReviseData=!0},_afterSelectSchoolStatus:function(e){this.curBusiness.businessLimit||n.a.set(this.curBusiness,"businessLimit",{}),n.a.set(this.curBusiness.businessLimit,"schoolStatus",e.val)},_afterSelectEducationLevelStatus:function(e){this.curBusiness.businessLimit||n.a.set(this.curBusiness,"businessLimit",{}),n.a.set(this.curBusiness.businessLimit,"educationLevel",e.val)},_afterSelectStuType:function(e){this.curBusiness.businessLimit||n.a.set(this.curBusiness,"businessLimit",{}),n.a.set(this.curBusiness.businessLimit,"studentType",e.val)},_afterSelectGrade:function(e){this.curBusiness.businessLimit||n.a.set(this.curBusiness,"businessLimit",{}),n.a.set(this.curBusiness.businessLimit,"grade",e.val)},_afterSelectInSchool:function(e){this.curBusiness.businessLimit||n.a.set(this.curBusiness,"businessLimit",{}),n.a.set(this.curBusiness.businessLimit,"inSchool",e.val)},_nodeSelected:function(e){var t=this;if(!this.curBusiness.business.isPublic||this.isReviseBusiness){var s=window.event||e.event;for(var i in this.curTimeNode={},e.target)n.a.set(this.curTimeNode,i,e.target[i]);this.showTime=!0,this.isReviseData=!0,setTimeout(function(){t.$date({dateFormat:"yyyy-MM-dd hh:ii:ss",value:t.curTimeNode.datetime||"",type:"init",event:s,onSelect:function(e){t._daySelectedOfValue({value:e})}})},100)}},_daySelectedOfValue:function(e){var t=this,s=this.$refs.timeSet.setDatetime(this.curTimeNode.id,e.value);s.success?this.curTimeNode=null:this.errorMsg=s.message,this.curBusiness.business.businessTimeList=[],this.$refs.timeSet.export().forEach(function(e){t.curBusiness.business.businessTimeList.push({nodeId:e.id,endDate:t.timeFormat(e.datetime,"yyyy-MM-dd hh:ii:ss"),businessId:t.curBusiness.business.id,isLimit:!1})})},timeFormat:function(e,t){if(!e)return"";var s={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"i+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(var i in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),s)new RegExp("("+i+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?s[i]:("00"+s[i]).substr((""+s[i]).length)));return t},_loadBusinessTime:function(){var e=this;if(!this.curBusiness.business.businessTimeList||0===this.curBusiness.business.businessTimeList.length){if(this.curBusiness.business.businessTimeList=[],!this.appState.flowData.chart.nodes)return!1;this.appState.flowData.chart.nodes.forEach(function(t){"start"!==t.type&&"process"!==t.type||e.curBusiness.business.businessTimeList.push({nodeId:t.id,endDate:"",businessId:e.curBusiness.business.id,isLimit:!1})})}setTimeout(function(){e.$refs.timeSet&&e.$refs.timeSet.load(e._getDatetimeArr(e.curBusiness.business.businessTimeList))},500)},_getDatetimeArr:function(e){var t=[];return e.forEach(function(e){t.push({id:e.nodeId,datetime:e.endDate})}),t},_save:function(e,t){var s=this;if(this.curBusiness&&this.curBusiness.businessLimit&&this.curBusiness.businessLimit.schoolStatus&&!(this.curBusiness.businessLimit.schoolStatus instanceof Array))if(""==this.curBusiness.businessLimit.schoolStatus)this.curBusiness.businessLimit.schoolStatus=[];else if(""!==this.curBusiness.businessLimit.schoolStatus&&-1==this.curBusiness.businessLimit.schoolStatus.indexOf(",")){var i=[];i.push(this.curBusiness.businessLimit.schoolStatus),this.curBusiness.businessLimit.schoolStatus=i}else""!==this.curBusiness.businessLimit.schoolStatus&&this.curBusiness.businessLimit.schoolStatus.indexOf(",")>-1&&(this.curBusiness.businessLimit.schoolStatus=this.curBusiness.businessLimit.schoolStatus.split(","));if(this.curBusiness&&this.curBusiness.businessLimit&&this.curBusiness.businessLimit.educationLevel&&!(this.curBusiness.businessLimit.educationLevel instanceof Array))if(""==this.curBusiness.businessLimit.educationLevel)this.curBusiness.businessLimit.educationLevel=[];else if(""!==this.curBusiness.businessLimit.educationLevel&&-1==this.curBusiness.businessLimit.educationLevel.indexOf(",")){var a=[];a.push(this.curBusiness.businessLimit.educationLevel),this.curBusiness.businessLimit.educationLevel=a}else""!==this.curBusiness.businessLimit.educationLevel&&this.curBusiness.businessLimit.educationLevel.indexOf(",")>-1&&(this.curBusiness.businessLimit.educationLevel=this.curBusiness.businessLimit.educationLevel.split(","));if(this.curBusiness&&this.curBusiness.businessLimit&&this.curBusiness.businessLimit.studentType&&!(this.curBusiness.businessLimit.studentType instanceof Array))if(""==this.curBusiness.businessLimit.studentType)this.curBusiness.businessLimit.studentType=[];else if(""!==this.curBusiness.businessLimit.studentType&&-1==this.curBusiness.businessLimit.studentType.indexOf(",")){var r=[];r.push(this.curBusiness.businessLimit.studentType),this.curBusiness.businessLimit.studentType=r}else""!==this.curBusiness.businessLimit.studentType&&this.curBusiness.businessLimit.studentType.indexOf(",")>-1&&(this.curBusiness.businessLimit.studentType=this.curBusiness.businessLimit.studentType.split(","));if(this.curBusiness&&this.curBusiness.businessLimit&&this.curBusiness.businessLimit.grade&&!(this.curBusiness.businessLimit.grade instanceof Array))if(""==this.curBusiness.businessLimit.grade)this.curBusiness.businessLimit.grade=[];else if(""!==this.curBusiness.businessLimit.grade&&-1==this.curBusiness.businessLimit.grade.indexOf(",")){var o=[];o.push(this.curBusiness.businessLimit.grade),this.curBusiness.businessLimit.grade=o}else""!==this.curBusiness.businessLimit.grade&&this.curBusiness.businessLimit.grade.indexOf(",")>-1&&(this.curBusiness.businessLimit.grade=this.curBusiness.businessLimit.grade.split(","));if("3"==this.curBusiness.business.limitType&&(!new RegExp("(((^([0-9]|[0-5][0-9])(\\,|\\-|\\/){1}([0-9]|[0-5][0-9]) )|^([0-9]|[0-5][0-9]) |^(\\* ))((([0-9]|[0-5][0-9])(\\,|\\-|\\/){1}([0-9]|[0-5][0-9]) )|([0-9]|[0-5][0-9]) |(\\* ))((([0-9]|[01][0-9]|2[0-3])(\\,|\\-|\\/){1}([0-9]|[01][0-9]|2[0-3]) )|([0-9]|[01][0-9]|2[0-3]) |(\\* ))((([0-9]|[0-2][0-9]|3[01])(\\,|\\-|\\/){1}([0-9]|[0-2][0-9]|3[01]) )|(([0-9]|[0-2][0-9]|3[01]) )|(\\? )|(\\* )|(([1-9]|[0-2][0-9]|3[01])L )|([1-7]W )|(LW )|([1-7]\\#[1-4] ))((([1-9]|0[1-9]|1[0-2])(\\,|\\-|\\/){1}([1-9]|0[1-9]|1[0-2]) )|([1-9]|0[1-9]|1[0-2]) |(\\* ))(([1-7](\\,|\\-|\\/){1}[1-7])|([1-7])|(\\?)|(\\*)|(([1-7]L)|([1-7]\\#[1-4]))))|(((^([0-9]|[0-5][0-9])(\\,|\\-|\\/){1}([0-9]|[0-5][0-9]) )|^([0-9]|[0-5][0-9]) |^(\\* ))((([0-9]|[0-5][0-9])(\\,|\\-|\\/){1}([0-9]|[0-5][0-9]) )|([0-9]|[0-5][0-9]) |(\\* ))((([0-9]|[01][0-9]|2[0-3])(\\,|\\-|\\/){1}([0-9]|[01][0-9]|2[0-3]) )|([0-9]|[01][0-9]|2[0-3]) |(\\* ))((([0-9]|[0-2][0-9]|3[01])(\\,|\\-|\\/){1}([0-9]|[0-2][0-9]|3[01]) )|(([0-9]|[0-2][0-9]|3[01]) )|(\\? )|(\\* )|(([1-9]|[0-2][0-9]|3[01])L )|([1-7]W )|(LW )|([1-7]\\#[1-4] ))((([1-9]|0[1-9]|1[0-2])(\\,|\\-|\\/){1}([1-9]|0[1-9]|1[0-2]) )|([1-9]|0[1-9]|1[0-2]) |(\\* ))(([1-7](\\,|\\-|\\/){1}[1-7] )|([1-7] )|(\\? )|(\\* )|(([1-7]L )|([1-7]\\#[1-4]) ))((19[789][0-9]|20[0-9][0-9])\\-(19[789][0-9]|20[0-9][0-9])))").test(this.curBusiness.businessLimit.cron)||!this.curBusiness.businessLimit.url))return void this.$toast("请正确输入接口信息!");if("business"===e){var l=this.curBusiness.business.id?this.$refs.timeSet.exportBeginEndTime():{},u=this.curBusiness.business.id?"put":"post",p="/api/app/"+this.appId+"/business"+(this.curBusiness.business.id?"/"+this.curBusiness.business.id:"");this.curBusiness.business.beginTime=l.beginTime?this.timeFormat(l.beginTime,"yyyy-MM-dd hh:ii:ss"):"",this.curBusiness.business.endTime=l.endTime?this.timeFormat(l.endTime,"yyyy-MM-dd hh:ii:ss"):"","put"===u&&(p+="?formId="+this.curBusiness.formId+"&flowId="+this.curBusiness.flowId),Object(c.e)({url:p,type:u,data:this.curBusiness,success:function(e){if(e.state){if(e.data.business.id&&!s.curBusiness.business.id)for(var i in e.data)n.a.set(s.curBusiness,i,e.data[i]);t?t():(s.$toast("业务期保存成功"),"3"==s.curBusiness.business.limitType&&(s.typeL=3))}else s.$toast(e.message)}})}},showImportPage:function(){this._initImportTpl(),this.showImportModal=!0},backParentPage:function(){this.showImportModal=!1},exportUserInfo:function(){window.location.href="/downloads/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/excel?fileName="+this.curBusiness.business.name+".xlsx"},_changeOutputList:function(e){var t=this,s=this.outputList.indexOf(e.name);s>=0?(this.outputList.splice(s,1),"signature"!==e.componentType&&"image"!==e.componentType||this.exportFiledArr.forEach(function(s,i){s.name===e.name&&t.exportFiledArr.splice(i,1)})):(this.outputList.push(e.name),"signature"!==e.componentType&&"image"!==e.componentType||this.exportFiledArr.push({name:e.name,title:e.title}))},_showOutPutModal:function(){this.outputModalShow=!0},_getFormFields:function(e){var t=this;Object(c.e)({url:"/api/processEngine/business/"+e+"/formSetting/fields",type:"get",success:function(e){e.state?t.formFields=e.data:t.$toast(e.message)}})},_sureToOutput:function(){var e=this,t=[],s=[];(t=JSON.parse(a()(this.outputList))).forEach(function(e,s){(e.indexOf("image")>=0||e.indexOf("signature")>=0)&&t.splice(s,1)}),this.exportFiledArr.forEach(function(e){(e.name.indexOf("image")>=0||e.name.indexOf("signature")>=0)&&s.push(e)});var i=[];if(t.length>0){var n="";this.curApp&&this.curApp.appType&&(n="3"===this.curApp.appType.userType?"/downloads/processEngine/business/"+this.curBusiness.business.id+"/processInstances/excel?fileName="+this.curBusiness.business.name+".xlsx&userNo=&account="+(this.$refs.recordsTable.tableSearchFields.userNo||"")+"&name="+(this.$refs.recordsTable.tableSearchFields.name||"")+"&grade="+(this.$refs.recordsTable.tableSearchFields.grade||"")+"&status="+(this.$refs.recordsTable.tableSearchFields.status||"")+"&exportFields="+this.outputList:"/downloads/processEngine/business/"+this.curBusiness.business.id+"/processInstances/excel?fileName="+this.curBusiness.business.name+".xlsx&userNo="+(this.$refs.recordsTable.tableSearchFields.userNo||"")+"&account=&name="+(this.$refs.recordsTable.tableSearchFields.name||"")+"&grade="+(this.$refs.recordsTable.tableSearchFields.grade||"")+"&status="+(this.$refs.recordsTable.tableSearchFields.status||"")+"&exportFields="+this.outputList),i.push(n)}s.forEach(function(t){var s="";e.curApp&&e.curApp.appType&&(s="3"===e.curApp.appType.userType?"/downloads/processEngine/business/"+e.curBusiness.business.id+"/processInstances/images?fileName="+t.title+".zip&userNo=&account="+(e.$refs.recordsTable.tableSearchFields.userNo||"")+"&name="+(e.$refs.recordsTable.tableSearchFields.name||"")+"&grade="+(e.$refs.recordsTable.tableSearchFields.grade||"")+"&status="+(e.$refs.recordsTable.tableSearchFields.status||"")+"&imageComponentName="+t.name:"/downloads/processEngine/business/"+e.curBusiness.business.id+"/processInstances/images?fileName="+t.title+".zip&userNo="+(e.$refs.recordsTable.tableSearchFields.userNo||"")+"&account=&name="+(e.$refs.recordsTable.tableSearchFields.name||"")+"&grade="+(e.$refs.recordsTable.tableSearchFields.grade||"")+"&status="+(e.$refs.recordsTable.tableSearchFields.status||"")+"&imageComponentName="+t.name),i.push(s)}),i.forEach(function(t,s){e._createIFrame(t,100*s,1e3)})},_createIFrame:function(e,t,s){setTimeout(function(){var t=o()('<iframe style="display: none;" class="multi-download"></iframe>');t.attr("src",e),o()(document.body).after(t)},t)},_openReviseBusiness:function(){var e=this;this.curBusiness.business.isPublic&&(this.clickCount++,this.reviseSetTimeOut||(this.reviseSetTimeOut=setTimeout(function(){e.clickCount>=10&&(e.isReviseBusiness=!0),e.clickCount=0,clearTimeout(e.reviseSetTimeOut),e.reviseSetTimeOut=null},3e3)))},_reviseBusinessData:function(e){this.isReviseBusiness&&(this.isReviseData&&confirm("是否保存修改的数据？不保存会丢失")&&this._reviseBusinessInfo(),"form"===e?this.$emit("setForm",{modelId:this.appState.modelId,type:this.curApp.setting.formId?"edit":"create",businessId:this.curBusiness.business.id}):this.$emit("setFlow",{modelId:this.curApp.setting.flowId,businessId:this.curBusiness.business.id}))},_changeBusinessName:function(){this.isReviseData=!0},_reviseBusinessInfo:function(){var e=this,t={name:this.curBusiness.business.name,year:this.curBusiness.business.year,guide:this.curBusiness.business.guide,businessTimeList:[]},s=this.curBusiness.business.id?this.$refs.timeSet.exportBeginEndTime():{};this.curBusiness.business.beginTime=s.beginTime?this.timeFormat(s.beginTime,"yyyy-MM-dd hh:ii:ss"):"",this.curBusiness.business.endTime=s.endTime?this.timeFormat(s.endTime,"yyyy-MM-dd hh:ii:ss"):"",this.curBusiness.business.businessTimeList.forEach(function(e){t.businessTimeList.push({nodeId:e.nodeId,startDate:null,endDate:e.endDate})}),Object(c.e)({url:"/api/app/"+this.appId+"/publishBusiness/"+this.curBusiness.business.id,type:"put",data:t,success:function(t){t.state?(e.$toast("业务期保存成功"),e.isReviseData=!1,e.reviseMark=!0):e.$toast(t.message)}})},_export:function(){window.location.href="/downloads/app/"+this.appId+"/export"},_setTable:function(){this.showTableModal=!0,this.$refs.tableset.onShow()}},components:{tableset:h}},b={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("GeminiScrollbar",{attrs:{scrollX:!1,id:"appInfo"}},[s("div",{staticClass:"header"},[s("i",{staticClass:"maticon pull-left back-link",domProps:{innerHTML:e._s(e.icons("arrow_back"))},on:{click:e._back}},[e._v("arrow_back")]),e._v(" "),s("a",{staticClass:"pull-right app-release",attrs:{href:"javascript:;"},on:{click:e._releaseApp}},[e.curApp.isPublished?s("span",[e._v("下架")]):s("span",[e._v("发布")])]),e._v(" "),s("div",{staticClass:"pull-right release-app",on:{click:e._export}},[e._v("导出")]),e._v(" "),s("div",{staticClass:"pull-right release-app",on:{click:e._setTable}},[e._v("报表设置")]),e._v(" "),s("div",{staticClass:"title-div"},[s("div",{staticClass:"app-icon-div"},[s("i",{staticClass:"maticon edit-icon",domProps:{innerHTML:e._s(e.icons("edit"))},on:{click:function(t){return e._editPart("icon")}}},[e._v("edit")]),e._v(" "),s("div",{style:{"background-image":e.curApp.background}},[e.curApp.imgType&&"1"!==e.curApp.imgType?"2"===e.curApp.imgType?s("i",{staticClass:"app-icon"},[s("span",{staticClass:"saasicon-44px",class:["saasicon-44px-"+e.curApp.imgPath]})]):e._e():s("i",{staticClass:"maticon app-icon",domProps:{innerHTML:e._s(e.icons(e.curApp.imgPath))}},[e._v(e._s(e.curApp.imgPath))])])]),e._v(" "),s("div",{staticClass:"input-group app-name-div info-value",style:{width:e.inputStyleWidth+"px"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.curApp.name,expression:"curApp.name"}],staticClass:"form-control",attrs:{type:"text",placeholder:"设置应用名称(25字以内)"},domProps:{value:e.curApp.name},on:{input:[function(t){t.target.composing||e.$set(e.curApp,"name",t.target.value)},e._limitLength],change:e._saveAppName}}),e._v(" "),s("div",[s("a",{staticClass:"apartment-link",attrs:{href:"javascript:;"}},[e._v(e._s(e.curApp.department&&e.curApp.department.name))])])]),e._v(" "),e.nameChangeMsg?s("p",{staticClass:"save-tip text-center",class:e.nameChangeMsg.indexOf("出错啦")>=0?"error":""},[e._v(e._s(e.nameChangeMsg))]):e._e(),e._v(" "),s("div",{staticClass:"form-flow-set"},[s("span",{staticClass:"info-set",on:{click:e._setAppForm}},[e._v("表单："+e._s(e.appState.formName||"请设置"))]),e._v(" "),e.appState.formName?s("span",{staticClass:"info-connect"}):e._e(),e._v(" "),e.appState.formName?s("span",{staticClass:"info-set",on:{click:e._setAppFlow}},[e._v("流程："+e._s(e.appState.flowName||"请设置"))]):e._e()]),e._v(" "),s("div",{staticClass:"app-desc info-value"},[s("span",{staticClass:"count-limit"},[e._v(e._s(e.curApp.remark?e.curApp.remark.length:0)+"/200")]),e._v(" "),s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.curApp.remark,expression:"curApp.remark"}],staticClass:"desc-part",attrs:{id:"textarea",rows:e.rowsNumber,maxlength:"200",placeholder:"可以输入对该应用的简单说明，仅管理员可看到此说明"},domProps:{value:e.curApp.remark},on:{change:e._saveAppDesc,input:function(t){t.target.composing||e.$set(e.curApp,"remark",t.target.value)}}})]),e._v(" "),e.descChangeMsg?s("p",{staticClass:"save-tip text-center",class:e.descChangeMsg.indexOf("出错啦")>=0?"error":""},[e._v(e._s(e.descChangeMsg))]):e._e(),e._v(" "),s("div",[s("p",[s("strong",[e._v("应用直接访问地址：")]),e._v(" "),s("span",{staticStyle:{"user-select":"text"}},[e._v(e._s("http://"+e.host+"/"+e.$account.schoolId+"/app/"+e.curApp.id))])])])])]),e._v(" "),s("div",{staticClass:"middle"},[s("label",{staticClass:"head-label pull-left",on:{click:e._openReviseBusiness}},[e._v("业务期")]),e._v(" "),s("a",{staticClass:"add-new pull-right",attrs:{href:"javascript:;"},on:{click:e._addNewBusiness}},[e._v("新增")]),e._v(" "),e.leftIconShow?s("i",{staticClass:"maticon scroll-left",domProps:{innerHTML:e._s(e.icons("chevron_left"))},on:{click:e._scrollLeft}},[e._v("chevron_left")]):e._e(),e._v(" "),e.rightIconShow?s("i",{staticClass:"maticon scroll-right",domProps:{innerHTML:e._s(e.icons("chevron_right"))},on:{click:e._scrollRight}},[e._v("chevron_right")]):e._e(),e._v(" "),s("GeminiScrollbar",{staticClass:"business-div",attrs:{scrollY:!1,id:"businessDiv"}},[s("div",{staticClass:"business-scroll"},e._l(e.businessList,function(t,i){return s("div",{key:i,staticStyle:{display:"inline-block",position:"relative"}},[s("div",{staticClass:"mark-div",class:e._compareTime(e.businessList,i)},[s("span")]),e._v(" "),s("div",{staticClass:"business-tab",class:e.curBusiness&&t.business.name===e.curBusiness.business.name?"active":"",attrs:{title:t.business.name},on:{click:function(s){return e._changeBusiness(t,t.business.limitType)}}},[e._v("\n            "+e._s(t.business.name)+" "),t.business.isPublic?e._e():s("i",{staticClass:"maticon remove-icon",domProps:{innerHTML:e._s(e.icons("cancel"))},on:{click:function(t){return t.stopPropagation(),e._removeBusiness(i)}}},[e._v("cancel")])])])}),0)]),e._v(" "),e.curBusiness?s("div",{staticClass:"info-type-tabs"},e._l(e.appState.infoTypes,function(t,i){return e.curBusiness&&e.curBusiness.business.id||"base"===t.id?s("div",{key:i,staticClass:"info-tab text-center",class:t.id===e.appState.infoType?"active":"",on:{click:function(s){return e._tabClick(t)}}},[e._v("\n        "+e._s(t.name)+"\n      ")]):e._e()}),0):e._e()],1),e._v(" "),e.curBusiness?s("div",{staticClass:"bottom"},[s("span",[s("a",{staticClass:"release-business",attrs:{href:"javascript:;"}},[e.curBusiness.business.isPublic?e.curBusiness.business.isEnable?s("span",{on:{click:function(t){return e._releaseBusiness("stop")}}},[e._v("停用本业务期")]):s("span",{staticClass:"disabled"},[e._v("本业务期已停用")]):s("span",{class:e.releaseBusinessDisabled?"disabled":"",on:{click:function(t){return e._releaseBusiness("release")}}},[e._v(e._s(e.annoreleaseBusinessText||"发布本业务期"))])])]),e._v(" "),e.curBusiness.business.isPublic?e._e():s("span",{staticClass:"save-business",class:e.isReviseBusiness?"revise":"",on:{click:function(t){return e._save("business")}}},[e._v("保存本业务期配置")]),e._v(" "),e.isReviseBusiness?s("span",{staticClass:"save-business revise",on:{click:e._reviseBusinessInfo}},[e._v("保存本业务期配置")]):e._e(),e._v(" "),s("span",{staticClass:"error-tip",class:e.errorMsg?"active":""},[e._v(e._s(e.errorMsg))]),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:"base"===e.appState.infoType,expression:"appState.infoType === 'base'"}],staticClass:"info-body container-fluid"},[s("div",{staticClass:"col-sm-6 padding-right"},[s("div",{staticClass:"form-group base-item"},[s("label",[e._v("名称")]),e._v(" "),!e.curBusiness.business.isPublic||e.isReviseBusiness?s("input",{directives:[{name:"model",rawName:"v-model",value:e.curBusiness.business.name,expression:"curBusiness.business.name"}],staticClass:"form-control valid",attrs:{type:"text",placeholder:"请输入业务起名称(30字以内)",maxlength:"30"},domProps:{value:e.curBusiness.business.name},on:{change:e._changeBusinessName,input:function(t){t.target.composing||e.$set(e.curBusiness.business,"name",t.target.value)}}}):s("input",{staticClass:"form-control",attrs:{type:"text",readonly:""},domProps:{value:e.curBusiness.business.name}})])]),e._v(" "),s("div",{staticClass:"col-sm-6 padding-left"},[s("div",{staticClass:"form-group base-item"},[s("label",[e._v("学年")]),e._v(" "),s("v-select",{staticClass:"info-value btn-block",attrs:{options:e.appState.gradeOptions,value:e.curBusiness.business.year||(new Date).getFullYear()+"_0","options-value":"id","options-label":"label","close-on-select":"",disabled:!(!e.curBusiness.business.isPublic||e.isReviseBusiness)},on:{afterSelected:e._afterSelectYear}})],1)]),e._v(" "),s("div",{staticClass:"col-sm-6 padding-right"},[s("div",{staticClass:"form-group base-item",class:e.isReviseBusiness?"active":"",on:{click:function(t){return e._reviseBusinessData("form")}}},[s("label",{class:e.isReviseBusiness?"active":""},[e._v("表单(来自应用同步)")]),e._v(" "),s("input",{staticClass:"form-control",class:e.isReviseBusiness?"active":"",attrs:{readonly:""},domProps:{value:e.appState.formName||"未绑定表单"}})])]),e._v(" "),s("div",{staticClass:"col-sm-6 padding-left"},[s("div",{staticClass:"form-group base-item",class:e.isReviseBusiness?"active":"",on:{click:function(t){return e._reviseBusinessData("flow")}}},[s("label",{class:e.isReviseBusiness?"active":""},[e._v("流程(来自应用同步)")]),e._v(" "),s("input",{staticClass:"form-control",class:e.isReviseBusiness?"active":"",attrs:{readonly:""},domProps:{value:e.appState.flowName||"未绑定流程"}})])])]),e._v(" "),e.curBusiness.business.id?s("div",{directives:[{name:"show",rawName:"v-show",value:"faceTo"===e.appState.infoType,expression:"appState.infoType === 'faceTo'"}],staticClass:"info-body container-fluid outer-container"},[e.faceToPeopleType.indexOf(e.curApp&&e.curApp.appType&&e.curApp.appType.userType)<0?s("div",{staticClass:"limit-radios"},[s("div",{staticClass:"radio-item small-item",class:"0"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic?"":"active"},[s("span",{staticClass:"check",class:e.curBusiness.business.isPublic?"disable":"",on:{click:function(t){return e._changeLimitType("0")}}},["0"!==e.curBusiness.business.limitType?s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")]):s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")])]),e._v(" "),s("label",{staticClass:"check-label"},[e._v("无限制")])]),e._v(" "),s("div",{staticClass:"radio-item large-item",class:"1"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic?"":"active"},[s("div",{staticClass:"large-check-part"},[s("span",{staticClass:"check",class:e.curBusiness.business.isPublic?"disable":"",on:{click:function(t){return e._changeLimitType("1")}}},["1"!==e.curBusiness.business.limitType?s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")]):s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")])]),e._v(" "),s("label",{staticClass:"check-label"},[e._v("按条件筛选")])]),e._v(" "),s("div",{staticClass:"large-select-part"},[s("div",{staticClass:"select-group"},[s("label",[e._v("学生类型")]),e._v(" "),s("v-select",{staticClass:"info-value btn-block",attrs:{url:"/api/system/dictTypes/1004/dicts",multiple:!0,value:e.curBusiness.businessLimit?e.curBusiness.businessLimit.studentType:"","options-value":"value","options-label":"label","close-on-select":"",justified:"",disabled:"1"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic},on:{afterSelected:e._afterSelectStuType}})],1)]),e._v(" "),s("div",{staticClass:"large-select-part"},[s("div",{staticClass:"select-group"},[s("label",[e._v("学生年级")]),e._v(" "),s("v-select",{staticClass:"info-value btn-block",attrs:{options:e.appState.gradeOptions2,multiple:!0,value:e.curBusiness.businessLimit?e.curBusiness.businessLimit.grade:"","options-value":"id","options-label":"label","close-on-select":"",justified:"",disabled:"1"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic},on:{afterSelected:e._afterSelectGrade}})],1)]),e._v(" "),s("div",{staticClass:"large-select-part"},[s("div",{staticClass:"select-group"},[s("label",[e._v("在校状态")]),e._v(" "),s("v-select",{staticClass:"info-value btn-block",attrs:{options:e.appState.inSchoolOptions,value:e.curBusiness.businessLimit?e.curBusiness.businessLimit.inSchool:"","options-value":"id","options-label":"label","close-on-select":"",justified:"",disabled:"1"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic},on:{afterSelected:e._afterSelectInSchool}})],1)]),e._v(" "),s("div",{staticClass:"large-select-part"},[s("div",{staticClass:"select-group"},[s("label",[e._v("当前状态")]),e._v(" "),s("v-select",{staticClass:"info-value btn-block",attrs:{options:e.schoolStatus,multiple:!0,value:e.curBusiness.businessLimit?e.curBusiness.businessLimit.schoolStatus:"","options-value":"value","options-label":"label","close-on-select":"",justified:"",disabled:"1"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic},on:{afterSelected:e._afterSelectSchoolStatus}})],1)]),e._v(" "),s("div",{staticClass:"large-select-part"},[s("div",{staticClass:"select-group"},[s("label",[e._v("培养层次")]),e._v(" "),s("v-select",{staticClass:"info-value btn-block",attrs:{options:e.educationLevel,multiple:!0,value:e.curBusiness.businessLimit?e.curBusiness.businessLimit.educationLevel:"","options-value":"value","options-label":"label","close-on-select":"",justified:"",disabled:"1"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic},on:{afterSelected:e._afterSelectEducationLevelStatus}})],1)])]),e._v(" "),s("div",{staticClass:"radio-item small-item",class:"2"===e.curBusiness.business.limitType?"active":""},[s("span",{staticClass:"check",class:e.curBusiness.business.isPublic?"disable":"",on:{click:function(t){return e._changeLimitType("2")}}},["2"!==e.curBusiness.business.limitType?s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")]):s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")])]),e._v(" "),s("label",{staticClass:"check-label"},[e._v("上传名单")]),e._v(" "),"2"===e.curBusiness.business.limitType?s("div",{staticClass:"pull-right opt-div"},[s("a",{staticClass:"opt-btn",attrs:{href:"javascript:;"},on:{click:e.showImportPage}},[s("span",[e._v("批量上传")])]),e._v(" "),e.curBusiness.business.isPublic?e._e():s("a",{staticClass:"opt-btn",attrs:{href:"javascript:;"},on:{click:e.exportUserInfo}},[e._v("导出")])]):e._e()]),e._v(" "),"2"===e.curBusiness.business.limitType?s("div",{staticClass:"stus-list"},[e.curBusiness.business.id?s("v-table",{attrs:{url:e.peopleUrl,pagesize:"5",idField:"id",columns:e.appState.columns,order:!0}}):s("span",{staticClass:"table-tip"},[e._v("暂无数据")])],1):e._e(),e._v(" "),s("div",{staticClass:"radio-item large-item",class:"3"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic?"":"active",staticStyle:{height:"198px"}},[s("div",{staticClass:"large-check-part"},[s("span",{staticClass:"check",class:e.curBusiness.business.isPublic?"disable":"",on:{click:function(t){return e._changeLimitType("3")}}},["3"!==e.curBusiness.business.limitType?s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")]):s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")])]),e._v(" "),s("label",{staticClass:"check-label"},[e._v("接口对接")])]),e._v(" "),s("div",{staticClass:"large-select-part"},[s("div",{staticClass:"select-group",staticStyle:{width:"550px",padding:"20px 20px 5px 20px"}},[s("label",{staticStyle:{color:"#000"}},[e._v("接口地址：")]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.curBusiness.businessLimit.url,expression:"curBusiness.businessLimit.url"}],staticClass:"form-control",staticStyle:{display:"inline-block",width:"400px"},attrs:{type:"text",disabled:"3"!==e.curBusiness.business.limitType,placeholder:"请提供接口地址",name:"",id:""},domProps:{value:e.curBusiness.businessLimit.url},on:{input:function(t){t.target.composing||e.$set(e.curBusiness.businessLimit,"url",t.target.value)}}})]),e._v(" "),s("div",{staticClass:"select-group",staticStyle:{width:"550px",padding:"5px 20px"}},[s("label",{staticStyle:{color:"#000"}},[e._v("更新频率：")]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.curBusiness.businessLimit.cron,expression:"curBusiness.businessLimit.cron"}],staticClass:"form-control",staticStyle:{display:"inline-block",width:"400px"},attrs:{type:"text",disabled:"3"!==e.curBusiness.business.limitType,placeholder:"CRON表达式",name:"",id:""},domProps:{value:e.curBusiness.businessLimit.cron},on:{input:function(t){t.target.composing||e.$set(e.curBusiness.businessLimit,"cron",t.target.value)}}})]),e._v(" "),s("div",{staticClass:"select-group",staticStyle:{width:"550px",padding:"5px 20px"}},[s("label",{staticStyle:{color:"#000"}},[e._v("更新方式：")]),e._v(" "),s("p",{staticStyle:{display:"inline-block","vertical-align":"bottom",margin:"0","margin-top":"5px"}},[s("span",{staticClass:"check",on:{click:function(t){e.curBusiness.businessLimit.updateType="COVER"}}},["COVER"!==e.curBusiness.businessLimit.updateType||""===e.curBusiness.businessLimit.updateType?s("i",{staticClass:"maticon",staticStyle:{"line-height":"15px"},attrs:{disabled:"3"!==e.curBusiness.business.limitType},domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")]):s("i",{staticClass:"maticon",staticStyle:{"line-height":"15px"},attrs:{disabled:"3"!==e.curBusiness.business.limitType},domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")])]),e._v(" "),s("label",{staticClass:"check-label",attrs:{disabled:"3"===e.curBusiness.business.limitType}},[e._v("增量")])]),e._v(" "),s("p",{staticStyle:{display:"inline-block","vertical-align":"bottom",margin:"0","margin-top":"5px"}},[s("span",{staticClass:"check",on:{click:function(t){e.curBusiness.businessLimit.updateType="INCREMENT"}}},["INCREMENT"!==e.curBusiness.businessLimit.updateType||""===e.curBusiness.businessLimit.updateType?s("i",{staticClass:"maticon",staticStyle:{"line-height":"15px"},domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")]):s("i",{staticClass:"maticon",staticStyle:{"line-height":"15px"},domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")])]),e._v(" "),s("label",{staticClass:"check-label"},[e._v("覆盖")])])]),e._v(" "),"3"==e.typeL?s("div",{staticClass:"select-group",staticStyle:{width:"550px",padding:"10px 20px","text-align":"center"}},[s("button",{staticClass:"btn btn-default ",attrs:{disabled:"3"!==e.curBusiness.business.limitType},on:{click:function(t){return e.updateHand()}}},[e._v("手动更新")])]):e._e()])]),e._v(" "),"3"==e.typeL?s("div",{staticClass:"stus-list"},[e.curBusiness.business.id?s("v-table",{attrs:{url:e.peopleUrlJiekou,pagesize:"5",idField:"id",columns:e.JiekouColumns,order:!0}}):s("span",{staticClass:"table-tip"},[e._v("暂无数据")])],1):e._e()]):s("div",{staticClass:"limit-radios"},[s("div",{staticClass:"radio-item small-item",class:"0"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic?"":"active"},[s("span",{staticClass:"check",class:e.curBusiness.business.isPublic?"disable":"",on:{click:function(t){return e._changeLimitType("0")}}},["0"!==e.curBusiness.business.limitType?s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")]):s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")])]),e._v(" "),e.curApp&&e.curApp.appType&&"3"===e.curApp.appType.userType?s("label",{staticClass:"check-label"},[e._v("所有新生")]):e.curApp&&e.curApp.appType&&"2"===e.curApp.appType.userType?s("label",{staticClass:"check-label"},[e._v("所有教职工")]):s("label",{staticClass:"check-label"},[e._v("所有辅导员")])]),e._v(" "),s("div",{staticClass:"radio-item small-item",class:"2"===e.curBusiness.business.limitType?"active":""},[s("span",{staticClass:"check",class:e.curBusiness.business.isPublic?"disable":"",on:{click:function(t){return e._changeLimitType("2")}}},["2"!==e.curBusiness.business.limitType?s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")]):s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")])]),e._v(" "),s("label",{staticClass:"check-label"},[e._v("上传名单")]),e._v(" "),"2"===e.curBusiness.business.limitType?s("div",{staticClass:"pull-right opt-div"},[s("a",{staticClass:"opt-btn",attrs:{href:"javascript:;"},on:{click:e.showImportPage}},[s("span",[e._v("批量上传")])]),e._v(" "),e.curBusiness.business.isPublic?e._e():s("a",{staticClass:"opt-btn",attrs:{href:"javascript:;"},on:{click:e.exportUserInfo}},[e._v("导出")])]):e._e()]),e._v(" "),"2"===e.curBusiness.business.limitType?s("div",{staticClass:"stus-list"},[e.curBusiness.business.id?s("v-table",{attrs:{url:e.peopleUrl,pagesize:"5",idField:"id",columns:e.appState.columns,order:!0}}):s("span",{staticClass:"table-tip"},[e._v("暂无数据")])],1):e._e()]),e._v(" "),e.showImportModal?s("div",{staticClass:"import-modal"},[s("v-import",e._b({on:{backParentPage:e.backParentPage}},"v-import",e.importParams,!1))],1):e._e()]):e._e(),e._v(" "),e.curBusiness.business.id?s("div",{directives:[{name:"show",rawName:"v-show",value:"timeSet"===e.appState.infoType,expression:"appState.infoType === 'timeSet'"}],staticClass:"info-body"},[s("time-set",{ref:"timeSet",attrs:{data:e.initDataOfChart,height:"300px"},on:{nodeSelected:e._nodeSelected}})],1):e._e(),e._v(" "),e.curBusiness.business.id&&"description"===e.appState.infoType?s("div",{staticClass:"info-body container-fluid"},[!e.curBusiness.business.isPublic||e.isReviseBusiness?s("u-editor",{ref:"description",attrs:{config:e.editorConfig},model:{value:e.curBusiness.business.guide,callback:function(t){e.$set(e.curBusiness.business,"guide",t)},expression:"curBusiness.business.guide"}}):s("div",{domProps:{innerHTML:e._s(e.curBusiness.business.guide)}})],1):e._e(),e._v(" "),e.curBusiness.business.id?s("div",{directives:[{name:"show",rawName:"v-show",value:"records"===e.appState.infoType,expression:"appState.infoType === 'records'"}],staticClass:"info-body"},[s("div",{staticClass:"stus-list"},[s("v-table",{ref:"recordsTable",attrs:{pagesize:"5",idField:"id",url:"/table-data/processEngine/business/"+e.curBusiness.business.id+"/processInstances/pages",columns:e.appState.recordColumns,order:!0,search:!0}},[s("div",{staticClass:"btn-group pull-right",attrs:{slot:"btn-group"},slot:"btn-group"},[s("button",{staticClass:"btn output-btn",attrs:{type:"button"},on:{click:e._showOutPutModal}},[e._v("导出")])])])],1)]):e._e()]):e._e(),e._v(" "),s("v-modal",{attrs:{show:e.outputModalShow,effect:"fade",width:"450"}},[s("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[s("h5",{staticClass:"modal-title"},[e._v("\n        导出——字段选择\n      ")])]),e._v(" "),s("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[s("ul",{staticClass:"list-group"},e._l(e.formFields,function(t,i){return e.notAllowOutput.indexOf(t.componentType)<0?s("li",{staticClass:"list-group-item field-item",class:e.outputList.indexOf(t.name)<0?"":"output-active",on:{click:function(s){return e._changeOutputList(t)}}},[e.outputList.indexOf(t.name)<0?s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")]):s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")]),e._v(" "),s("span",[e._v(e._s(t.title))])]):e._e()}),0)]),e._v(" "),s("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[s("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(t){e.outputModalShow=!1}}},[e._v("取消")]),e._v(" "),s("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:e._sureToOutput}},[e._v("确定")])])]),e._v(" "),e.readonly?e._e():s("v-modal",{attrs:{show:e.appState.showFormModal,effect:"fade",width:"374"}},[s("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[s("h5",{staticClass:"modal-title"},[e._v("\n        选择模板\n      ")])]),e._v(" "),s("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[s("label",[e._v("请选择对应模板初始化表单")]),e._v(" "),s("ul",{staticClass:"list-group"},[s("li",{staticClass:"list-group-item",class:e.appState.modelId===e.blankTemplateId?"active":"",on:{click:function(t){e.appState.modelId=e.blankTemplateId}}},[e._v("\n          空白表单模板\n        ")]),e._v(" "),e._l(e.formList,function(t,i){return s("li",{key:i,staticClass:"list-group-item",class:e.appState.modelId===t.id?"active":"",on:{click:function(s){e.appState.modelId=t.id}}},[e._v("\n          "+e._s(t.name)+"模板\n        ")])})],2)]),e._v(" "),s("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[s("a",{attrs:{href:"javascript:;"},on:{click:function(t){e.appState.showFormModal=!1}}},[e._v("取消")]),e._v(" "),s("a",{staticClass:"sure-btn",attrs:{href:"javascript:;"},on:{click:e._initWithModel}},[e._v("确定")])])]),e._v(" "),s("v-modal",{attrs:{show:e.showIconModal,effect:"fade",width:"446"}},[s("div",{staticClass:"modal-header iconModal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[s("h5",{staticClass:"modal-title"},[e._v("\n        修改图标\n      ")])]),e._v(" "),s("div",{staticClass:"modal-body iconModal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[s("div",{staticClass:"background-container"},e._l(e.backgroundList,function(t,i){return s("span",{key:i,staticClass:"background",style:{background:t.background},on:{click:function(s){return e._selectBackground(t)}}},[e.appState.background===t.background?s("i",{staticClass:"maticon icon-done",domProps:{innerHTML:e._s(e.icons("done"))}},[e._v("done")]):e._e()])}),0),e._v(" "),s("div",{staticClass:"icon-list"},[e._l(e.iconList,function(t,i){return s("i",{key:i,staticClass:"maticon",class:{active:"1"===e.appState.imgType&&e.appState.imgPath===t.name},domProps:{innerHTML:e._s(e.icons(t.name))},on:{click:function(s){return e._selectIcon(t)}}},[e._v(e._s(t.name))])}),e._v(" "),e._l(e.saasIconList,function(t,i){return s("i",{key:i,class:{active:"2"===e.appState.imgType&&e.appState.imgPath===t},on:{click:function(s){return e._selectIcon({name:t},"2")}}},[s("span",{staticClass:"saasicon",class:["saasicon-"+t+"-black"]})])})],2)]),e._v(" "),s("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[s("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(t){return e._cancelPart("icon")}}},[e._v("取消")]),e._v(" "),s("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:e._saveAppIcon}},[e._v("确定")])])]),e._v(" "),s("v-modal",{attrs:{show:e.showTableModal,effect:"fade",width:"748"}},[s("div",{staticClass:"modal-header iconModal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[s("h5",{staticClass:"modal-title"},[e._v("\n        报表设置\n      ")])]),e._v(" "),s("div",{staticClass:"modal-body iconModal-body",staticStyle:{padding:"0",height:"370px"},attrs:{slot:"modal-body"},slot:"modal-body"},[s("tableset",{ref:"tableset",attrs:{appId:e.appId}})],1),e._v(" "),s("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[s("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(t){e.showTableModal=!1}}},[e._v("取消")]),e._v(" "),s("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:e._saveTableSet}},[e._v("确定")])])]),e._v(" "),e.preview?s("div",{staticClass:"preview-container"},[s("preview",{attrs:{data:e.previewObj.formData.components,title:e.previewObj.formData.name,script:e.previewObj.formData.property.script,authorities:e.previewObj.authorities,defaultData:e.previewObj.recordData,log:e.previewObj.log,previewType:"flow",fileServer:e.uploadFile},on:{back:function(t){e.preview=!1}}})],1):e._e()],1)},staticRenderFns:[]};var f=s("VU/8")(m,b,!1,function(e){s("W/ez")},null,null).exports,v=s("7CEZ"),g=s("lh7w"),y={props:{departmentId:{default:"1"},appId:{required:!0,default:""},readonly:{default:!1},curCheckRoutes:{default:""}},created:function(){var e=this,t=localStorage.getItem("lang");Object(c.g)(t)&&(this.lang=t),Object(c.e)({url:"/api/system/dictTypes/1003/dicts?lang=",type:"get",async:!1,success:function(t){e.schoolStatus=t.data}}),Object(c.e)({url:"/api/system/dicts?dictType=培养层次",type:"get",async:!1,success:function(t){e.educationLevel=t.data}}),this._initCurApp(),this._initBusinessList(),this._initPlayersData(),this.curRoute=this.curCheckRoutes,this.nowTime=(new Date).getTime(),this.backgroundList=[{id:0,background:"linear-gradient(-135deg, #3F87E7 0%, #377EEB 100%)"},{id:1,background:"linear-gradient(-135deg, #F4A23F 0%, #F4A441 100%)"},{id:2,background:"linear-gradient(-135deg, #EF5E36 0%, #EF5E36 100%)"},{id:3,background:"linear-gradient(-135deg, #59CAAD 0%, #59C9AC 100%)"},{id:4,background:"linear-gradient(-135deg, #8489D8  0%, #888ACA 100%)"},{id:5,background:"linear-gradient(-135deg, #51B590 0%, #51B590 100%)"},{id:6,background:"linear-gradient(-135deg, #CEA44D 0%, #E0C37A 100%)"}],this.iconList=[{id:0,name:"school"},{id:1,name:"accessibility"},{id:2,name:"account_balance"},{id:3,name:"account_balance_wallet"},{id:4,name:"account_circle"},{id:5,name:"alarm"},{id:6,name:"assignment"},{id:7,name:"book"},{id:8,name:"build"},{id:9,name:"description"},{id:10,name:"explore"},{id:11,name:"extension"},{id:12,name:"face"},{id:13,name:"favorite"},{id:14,name:"flight_land"},{id:15,name:"flight_takeoff"},{id:16,name:"get_app"},{id:17,name:"grade"},{id:18,name:"language"},{id:19,name:"launch"},{id:20,name:"loyalty"},{id:21,name:"perm_contact_calendar"},{id:22,name:"receipt"},{id:23,name:"question_answer"},{id:24,name:"restore"},{id:25,name:"room"},{id:26,name:"schedule"},{id:27,name:"search"},{id:28,name:"shopping_cart"},{id:29,name:"swap_horiz"},{id:30,name:"theaters"},{id:31,name:"update"},{id:32,name:"verified_user"},{id:33,name:"work"},{id:34,name:"visibility"},{id:35,name:"equalizer"},{id:36,name:"business"},{id:37,name:"call"},{id:38,name:"chat"},{id:39,name:"email"},{id:40,name:"create"},{id:41,name:"flag"},{id:42,name:"save"},{id:43,name:"link"},{id:44,name:"send"},{id:45,name:"devices"},{id:46,name:"attach_file"},{id:47,name:"format_quote"},{id:48,name:"cloud"},{id:49,name:"folder"},{id:50,name:"computer"},{id:51,name:"headset"},{id:52,name:"security"},{id:53,name:"sim_card"},{id:54,name:"watch"},{id:55,name:"add_a_photo"},{id:56,name:"camera_alt"},{id:57,name:"directions_railway"},{id:58,name:"directions_bike"},{id:59,name:"local_activity"},{id:60,name:"directions_walk"},{id:61,name:"local_dining"},{id:62,name:"local_hospital"},{id:63,name:"local_library"},{id:64,name:"event_note"},{id:65,name:"map"},{id:66,name:"navigation"},{id:67,name:"wifi"},{id:68,name:"ac_unit"},{id:69,name:"fitness_center"},{id:70,name:"pool"},{id:71,name:"cake"},{id:72,name:"group"},{id:73,name:"location_city"},{id:74,name:"notifications"},{id:75,name:"person"},{id:76,name:"poll"},{id:77,name:"public"},{id:78,name:"share"},{id:79,name:"whatshot"}],this.appState.columns=[{id:"name",title:this.translate.name,width:130,className:"text-left",hidden:!1},{id:"userNo",title:this.numberDesc,width:150,className:"text-left",hidden:!1},{id:"collegeName",title:this.translate.college,width:150,className:"text-left",hidden:!1},{id:"grade",title:this.translate.grade,width:80,className:"text-left",hidden:!1},{id:"studentType",title:this.translate.studentType,width:100,className:"text-left",hidden:!0},{id:"inSchoolValue",title:this.translate.inSchoolStatus,width:100,className:"text-left",hidden:!1},{id:"studentTypeValue",title:this.translate.studentType,width:100,className:"text-left",hidden:!1},{id:"opt",title:"操作",className:"text-left",width:80,hidden:!1,formatter:function(t){return[{tag:"a",text:"删除",callback:function(t,s){confirm("确定要删除吗？")&&Object(c.e)({url:"/api/app/"+e.appId+"/business/"+e.curBusiness.business.id+"/"+t.userId,dataType:"json",type:"delete",success:function(t){t.state?(e.$toast("删除成功"),e.timestamp=new Date):e.$toast(t.message)}})}}]}}],this.JiekouColumns=[{id:"name",title:"姓名",width:130,className:"text-left",hidden:!1},{id:"userNo",title:"学号",width:150,className:"text-left",hidden:!1,formatter:function(t,s){return"3"===e.curApp.appType.userType?t.account:t.userNo}},{id:"collegeName",title:"学院",width:150,className:"text-left",hidden:!1},{id:"grade",title:"年级",width:80,className:"text-left",hidden:!1},{id:"educetionLevel",title:"培养层次",width:100,className:"text-left",hidden:!0},{id:"createTime",title:"更新时间",width:100,className:"text-left",hidden:!1}],this.appState.inSchoolOptions=[{id:0,label:this.translate.unlimited},{id:1,label:this.translate.inSchool},{id:2,label:this.translate.notAtSchool}],this.appState.infoTypes=[{id:"base",name:this.translate.baseInfo},{id:"faceTo",name:this.translate.facePeople},{id:"timeSet",name:this.translate.timeSet},{id:"description",name:this.translate.description}];for(var s=(new Date).getFullYear(),i=s+3;i>s-5;i--)this.appState.gradeOptions.push({id:i+"",label:i+"-"+(i+1)+this.translate.schoolYear});for(var a=s+3;a>s-5;a--)this.appState.gradeOptions2.push({id:a+"",label:a+this.translate.level});Object(c.e)({url:"/api/relationship/getSelectOptions",dataType:"json",type:"get",success:function(t){t.state&&(e.collegeOptions=t.data.colleges||[],e.gradeOptions=t.data.grades||[])}})},data:function(){return{JiekouColumns:[],typeL:"",schoolStatus:[],educationLevel:[],notInSchoolStatus:[],inSchoolStatus:[],showTableModal:!1,iconList:[],saasIconList:["road","book","camera","idcard","tuition","bankcard","list","text","help","layer","package","cap","letter","calendar","menu","menu2","menu3","apply","info","rightcard","drippower","bulb","record","direction","person","envelope","reduce","socialist","star","assets","notebook","location","purse","remark","statisticsbar","building","geography","rotate","manlove","medal","pick","purse2","free","tag","menudone","travel","trophy","medal2","question","excellent","search"],formList:[],curApp:{name:"点击右侧按钮编辑应用名称",imgPath:"",remark:"应用说明"},editorConfig:{initialFrameHeight:520},nameChangeMsg:"",descChangeMsg:"",appState:{editPart:"",showFormModal:!1,showFlowModal:!1,infoType:"base",flowName:"",formName:"",modelId:"",infoTypes:[],columns:[],recordColumns:[],inSchoolOptions:[],gradeOptions:[],gradeOptions2:[],flowData:{id:"",chart:{}},background:"linear-gradient(-135deg, #5067D7 0%, #3F53B8 100%)"},businessList:[],leftIconShow:!1,rightIconShow:!1,curBusiness:null,timeSet:null,errorMsg:"",nowTime:"",defineSearch:{status:"",collegeCode:"",grade:""},collegeOptions:[],gradeOptions:[],preview:!1,previewObj:{formData:null,authorities:null,recordData:[],curBusinessId:"",appId:""},importParams:{parentPageTitle:"人员列表",downloadTemplateUrl:"/app/business/studentExcelTemplate",downloadErrorTemplateUrl:"/app/business/errorBusinessStudentExcel",checkTemplateUrl:"",templateName:"面向人员名单导入模板",importBtnType:null},showImportModal:!1,overriteImport:"覆盖导入",incrementImport:"增量导入",timestamp:"",players:[],timeNodeId:"",timeType:"",curSelectedTime:"",timeSetData:[],releaseAppDisabled:!1,releaseBusinessDisabled:!1,annoreleaseBusinessText:"",formTimeName:"",newName:"",numberDesc:"",showIconModal:!1,backgroundList:[],reviseSetTimeOut:null,clickCount:0,isReviseBusiness:!1,isReviseData:!1,curRoute:"",businessTimer:null,blankTemplateId:"",faceToPeopleType:["2","3","4"],lang:"zh-cn"}},computed:{host:function(){return window.location.host},translate:function(){return Object(c.g)(this.lang).formEngineInfo},businessIsOn:function(){var e=this,t=!1;return this.curBusiness&&this.businessList.forEach(function(s){s.business.id!==e.curBusiness.business.id&&s.business.isPublic&&s.business.isEnable&&(t=!0)}),t},peopleUrl:function(){return"/table-data/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/users/page?timestamp="+this.timestamp},peopleUrlJiekou:function(){return"/table-data/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/api/users/page?timestamp="+this.timestamp},inputStyleWidth:function(){return this.curApp.name.length<=20?34*this.curApp.name.length:27*this.curApp.name.length},rowsNumber:function(){return this.curApp.remark?this.curApp.remark.length>62&&this.curApp.remark.length<=124?2:this.curApp.remark.length>124&&this.curApp.remark.length<=186?3:this.curApp.remark.length>186?4:1:1}},watch:{appId:function(){this._initCurApp()},errorMsg:function(){var e=this;setTimeout(function(){e.errorMsg=""},1500)},curBusiness:function(){this.curBusiness&&this._loadBusinessTime("clickBusiness")},curApp:function(){var e=this,t="";this.curApp&&this.curApp.appType&&("1"===this.curApp.appType.userType?t=this.translate.userNo:"2"===this.curApp.appType.userType?t="教工号":"3"===this.curApp.appType.userType?t=this.translate.freshmanNo:"4"===this.curApp.appType.userType&&(t="学工号")),"4"!==this.curApp.appType.userType?this.appState&&this.appState.columns&&this.appState.columns[1]&&n.a.set(this.appState.columns[1],"title",t):this.appState.columns=[{id:"name",title:this.translate.name,width:130,className:"text-left",hidden:!1},{id:"userNo",title:this.translate.instructorNo,width:150,className:"text-left",hidden:!1},{id:"collegeName",title:this.translate.college,width:150,className:"text-left",hidden:!1},{id:"opt",title:"操作",className:"text-left",width:100,hidden:!1,formatter:function(t){return[{tag:"a",text:"删除",callback:function(t,s){confirm("确定要删除吗？")&&Object(c.e)({url:"/api/app/"+e.appId+"/business/"+e.curBusiness.business.id+"/"+t.userId,dataType:"json",type:"delete",success:function(t){t.state?(e.$toast("删除成功"),e.timestamp=new Date):e.$toast(t.message)}})}}]}}],this.appState&&this.appState.recordColumns&&this.appState.recordColumns[1]&&n.a.set(this.appState.recordColumns[1],"title",t),this.numberDesc=t}},methods:{updateHand:function(){var e=this;Object(c.e)({url:"/api/app/business/updateUserByApi/"+this.curBusiness.business.id,dataType:"json",type:"get",success:function(t){t.state&&(e.$toast("更新成功"),e.timestamp=new Date)}})},_saveTableSet:function(){var e=this;this.$refs.tableset.save().then(function(t){t.state?(e.showTableModal=!1,e.$toast("保存成功")):e.$toast("错误:"+t.message)}).catch(function(t){e.$toast("错误:"+t.message)})},_setTable:function(){this.showTableModal=!0,this.$refs.tableset.onShow()},_initImportTpl:function(){this.curApp&&this.curApp.appType&&"3"===this.curApp.appType.userType&&(this.importParams.downloadTemplateUrl="/app/business/freshmanExcelTemplate")},_changeBusinessGuide:function(e){this.curBusiness.business.guide=e,this.isReviseData=!0},_collegeSearch:function(e){this.defineSearch.collegeCode=e.val},_stateSearch:function(e){this.defineSearch.status=e.val},_tabClick:function(e){var t=this;this.appState.infoType=e.id,this.timeType="",this._loadBusinessTime(),this.importParams.checkTemplateUrl="/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/excel",this.importParams.importBtnType=[{name:this.incrementImport,url:"/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/excel",method:"put",isShowBtn:!0,success:function(e){e.state&&(t.timestamp=new Date)}}]},_changeBusiness:function(e,t){this.typeL=t,this.curBusiness=e,this.showImportModal=!1,this.isReviseBusiness=!1},_back:function(){this.$emit("back"),this.businessTimer&&clearInterval(this.businessTimer)},_initPlayersData:function(){var e=this;Object(c.e)({url:"/api/apps/"+this.appId+"/settings/players",type:"get",success:function(t){t.state?t.data&&(e.players=t.data.players):e.$toast(t.message)}})},_initFormList:function(){var e=this;""!==this.appId?Object(c.e)({type:"get",url:"/api/departments/"+this.departmentId+"/apps/forms?userType="+this.curApp.appType.userType,success:function(t){t.state?e.formList=t.data:e.$toast(t.message)}}):this.formList=[]},_getFormName:function(e){var t=this;Object(c.e)({url:"/api/apps/"+this.appId+"/settings/forms",type:"get",success:function(e){e.state?e.data&&(t.appState.formName=e.data.name):t.$toast(e.message)}})},_initCurApp:function(){var e=this;Object(c.e)({type:"get",url:"/api/app/"+this.appId,success:function(t){t.state?(e.curApp=t.data,e.$set(e.appState,"imgType",e.curApp.imgType),e.curApp&&e.curApp.appType&&("4"===e.curApp.appType.userType||"2"===e.curApp.appType.userType?e.blankTemplateId="5c00b20c72877c31752fc75c":e.blankTemplateId="5ae147c265249c38288e9f00"),e._initFormList(),"formEngine"===e.curRoute&&e._getFormName()):e.$toast(t.message)}})},_initBusinessList:function(){var e=this;Object(c.e)({type:"get",url:"/api/app/"+this.appId+"/business",success:function(t){t.state?(e.businessList=t.data,e.businessList.forEach(function(t,s){t.business.isPublic&&t.business.isEnable&&(e.curBusiness=t,e.typeL=t.business.limitType,e._scrollToBusiness(s),e.businessTimer&&clearInterval(e.businessTimer)),t.business.isPublishing&&(e.releaseBusinessDisabled=!0,e.annoreleaseBusinessText=e.translate.announcing)})):e.$toast(t.message)}})},_releaseBusiness:function(e){var t=this;if("release"===e){if(this.releaseBusinessDisabled)return;if(!confirm("确认发布本业务吗？业务期一旦开启，为保证申请的正常进行，系统将自动锁定该业务期所关联的流程及表单，业务期内将无法再对流程及表单进行编辑"))return;this.releaseBusinessDisabled=!0,this.annoreleaseBusinessText=this.translate.announcing,this._save("business",function(){Object(c.e)({url:"/api/app/"+t.appId+"/business/"+t.curBusiness.business.id+"/publish",type:"put",success:function(e){t.releaseBusinessDisabled=!1,t.annoreleaseBusinessText="",e.state?(e.data.publishing&&!e.data.published&&(t.releaseBusinessDisabled=!0,t.annoreleaseBusinessText=t.translate.announcing,t.$toast("业务期发布中，后台运行"),t.businessTimer=setInterval(function(){t._initBusinessList()},3e4)),e.data.published&&(t.curBusiness.business.isPublic=!0,t.$toast(t.translate.releaseBusinessSuccess))):"31114"===e.code?(t.releaseBusinessDisabled=!0,t.annoreleaseBusinessText=t.translate.announcing,confirm("应用未发布情况下无法发布业务期，确定同时发布应用吗？")?Object(c.e)({url:"/api/app/"+t.appId+"/business/"+t.curBusiness.business.id+"/publish?publishApp=true",type:"put",success:function(e){t.releaseBusinessDisabled=!1,t.annoreleaseBusinessText="",e.state?(t.curBusiness.business.isPublic=!0,t.curApp.isPublished=!t.curApp.isPublished,t.$toast(t.translate.release+t.translate.success)):t.$toast(e.message)}}):(t.releaseBusinessDisabled=!1,t.annoreleaseBusinessText="")):t.$toast(e.message)}})})}else confirm("确定要停止此业务期吗？停止后，此业务期的所有数据将作废且不可恢复")&&this._stopOrRemove("stop")},_removeBusiness:function(e){confirm(this.translate.removeBusinessConfirm)&&this._stopOrRemove("remove",e)},_stopOrRemove:function(e,t){var s=this,i="stop"===e?this.curBusiness.business.id:this.businessList[t].business.id;i?Object(c.e)({url:"/api/app/"+this.appId+"/business/"+i,type:"delete",success:function(a){s.$toast("操作成功"),a.state?"stop"===e?s.curBusiness.business.isEnable=!1:(s.businessList.splice(t,1),s._testIconShow(),s.curBusiness.business.id===i&&(s.curBusiness=null)):s.$toast(a.message)}}):(this.businessList.splice(t,1),this.$toast(this.translate.removeSuccessTip))},_addNewBusiness:function(){if(this.typeL="",this.showImportModal=!1,"formEngine"!==this.curRoute||this.curApp.setting.formId&&this.curApp.setting.playerSettingId){var e,t,s=(new Date).getFullYear();(new Date).getMonth()>=8?(e=s+"-"+(s+1)+"学年"+this.curApp.name,t=s):(e=s-1+"-"+s+"学年"+this.curApp.name,t=s-1);var i=e;this.creatNewName(e,i),this.appState.infoType="base",this.curBusiness={business:{name:this.newName,year:t+"",linkUrl:"",guide:"",settingId:"",businessTimeList:[],limitType:0,beginTime:"",endTime:"",isEnable:!1,isLimit:!1},businessLimit:{inSchool:0,grade:[],studentType:[],schoolStatus:[],educationLevel:[],url:"",updateType:"COVER",cron:""}},this.businessList.push(this.curBusiness),this._scrollToBusiness(this.businessList.length-1),this.timeSetData=[],this._save("business",function(){})}else this.$toast(this.translate.addNewTip)},creatNewName:function(e,t){var s=!1;this.businessList.forEach(function(i){if(i.business.name===e){s=!0;var a=e.split(t);if(a[1]){var n=parseInt(a[1])+1;e=t+n}else e=t+1}}),s?this.creatNewName(e,t):this.newName=e},_editPart:function(e){this.showIconModal=!0,this.appState.editPart=e,this.$set(this.appState,e,this.curApp[e]),this.$set(this.appState,"imgPath",this.curApp.imgPath),this.curApp.background&&this.$set(this.appState,"background",this.curApp.background),this.$set(this.appState,"imgPath",this.curApp.imgPath)},_cancelPart:function(e){this.showIconModal=!1,this.appState.editPart="",this.appState[e]="",this.appState.background=""},_savePart:function(e){this.curApp[e]=this.appState[e],this.appState.editPart="",this.appState[e]=""},_selectIcon:function(e,t){this.appState.imgPath=e.name,this.appState.imgType=t||"1"},_selectBackground:function(e){this.appState.background=e.background},_saveAppIcon:function(){var e=this;Object(c.e)({url:"/api/app/"+this.curApp.id+"/style",type:"put",data:{imgPath:this.appState.imgPath,imgType:this.appState.imgType,background:this.appState.background},success:function(t){t.state?(e._savePart("imgPath"),e._savePart("imgType"),e._savePart("background"),e.$emit("update",e.curApp),e.showIconModal=!1):e.$toast(t.message)}})},_setAppForm:function(){this.curApp.setting.formId?this._initWithModel():(this.$set(this.appState,"form",this.curApp.form),this.appState.showFormModal=!0)},_setJoinRole:function(){this.$emit("setJoinRole",{businessId:""}),this._save("",function(){})},_initWithModel:function(){this.$emit("setForm",{modelId:this.appState.modelId,type:this.curApp.setting.formId?"edit":"create",businessId:""}),this._save("",function(){})},_scrollLeft:function(){o()("#businessDiv").animate({scrollLeft:o()("#businessDiv").scrollLeft()-500},100),this._testIconShow()},_scrollRight:function(){o()("#businessDiv").animate({scrollLeft:o()("#businessDiv").scrollLeft()+500},100),this._testIconShow()},_scrollToBusiness:function(e){var t=this;setTimeout(function(){o()("#businessDiv").animate({scrollLeft:o()("#businessDiv").scrollLeft()+200*e},100),t._testIconShow()},300)},_testIconShow:function(){var e=this;setTimeout(function(){e.leftIconShow=o()("#businessDiv").scrollLeft()>0,e.rightIconShow=o()(".business-scroll").width()-o()("#businessDiv").scrollLeft()>o()("#businessDiv").width()},300)},_compareTime:function(e,t){var s=new Date(e[t].start).getTime(),i=new Date(e[t].end).getTime();return this.nowTime<s?0===t?"left":this.nowTime>new Date(e[t-1].end).getTime()?"left":"":this.nowTime>s&&this.nowTime<i?"center":""},_changeLimitType:function(e){this.curBusiness.business.isPublic||(this.curBusiness.business.limitType=e)},_afterSelectYear:function(e){this.curBusiness.business.year=e.value,this.isReviseData=!0},_afterSelectStuType:function(e){this.curBusiness.businessLimit||this.$set(this.curBusiness,"businessLimit",{}),this.$set(this.curBusiness.businessLimit,"studentType",e.value)},_afterSelectGrade:function(e){this.curBusiness.businessLimit||this.$set(this.curBusiness,"businessLimit",{}),this.$set(this.curBusiness.businessLimit,"grade",e.value)},_afterSelectSchoolStatus:function(e){this.curBusiness.businessLimit||this.$set(this.curBusiness,"businessLimit",{}),n.a.set(this.curBusiness.businessLimit,"schoolStatus",e.val)},_afterSelectEducationLevelStatus:function(e){this.curBusiness.businessLimit||this.$set(this.curBusiness,"businessLimit",{}),n.a.set(this.curBusiness.businessLimit,"educationLevel",e.val)},_afterSelectInSchool:function(e){this.curBusiness.businessLimit||this.$set(this.curBusiness,"businessLimit",{}),this.$set(this.curBusiness.businessLimit,"inSchool",e.value)},_changeLinkUseBusiness:function(e){var t=this;this.curApp.setting.useBusiness="use"===e,Object(c.e)({url:"/api/app/"+this.appId+"/useBusiness",type:"put",data:{useBusiness:this.curApp.setting.useBusiness},success:function(e){e.state?t.$toast(t.translate.modifySuccess):t.$toast(e.message)}})},_saveLink:function(){var e=this;Object(c.e)({url:"/api/app/"+this.appId+"/url",type:"put",data:{linkUrl:this.curApp.setting.linkUrl},success:function(t){t.state?e.$toast(e.translate.modifySuccess):e.$toast(t.message)}})},_linkBusinessTime:function(e){var t=this,s=window.event;this.timeType=e,this.isReviseData=!0,setTimeout(function(){t.$date({dateFormat:"yyyy-MM-dd hh:ii:ss",value:t.curSelectedTime||"",type:"init",event:s,onSelect:function(e){t._linkSelectBusinessTime({value:e})}})},100)},_linkSelectBusinessTime:function(e){if(e.value){if("startTime"===this.timeType){if(this.curBusiness.business.endTime&&this.curBusiness.business.endTime<e.value)return this.errorMsg=this.translate.startTimeTip,this.curBusiness.business.beginTime="",!1;this.curBusiness.business.beginTime=e.value}if("endTime"===this.timeType){if(this.curBusiness.business.beginTime&&this.curBusiness.business.beginTime>e.value)return this.errorMsg=this.translate.endTimeTip,this.curBusiness.business.endTime="",!1;this.curBusiness.business.endTime=e.value}this.errorMsg=""}},_nodeSelected:function(e,t,s,i){var a=this;if(!this.curBusiness.business.isPublic||this.isReviseBusiness){var n=window.event||e;this.timeNodeId=t,this.timeType=s,this.formTimeName=i,this.timeSetData.forEach(function(e){a.timeNodeId===e.nodeId&&(a.curSelectedTime=e[a.timeType])}),this.isReviseData=!0,setTimeout(function(){a.$date({dateFormat:"yyyy-MM-dd hh:ii:ss",value:a.curSelectedTime||"",type:"init",event:n,onSelect:function(e){a._daySelectedOfValue({value:e})}})},100)}},_daySelectedOfValue:function(e){var t=this;e.value&&this.timeSetData.forEach(function(s){if(t.timeNodeId===s.nodeId){if("startDate"===t.timeType&&s.endDate&&s.endDate<e.value)return t.errorMsg=t.formTimeName+t.translate.startTimeTip,!1;if("endDate"===t.timeType&&s.startDate&&s.startDate>e.value)return t.errorMsg=t.formTimeName+t.translate.endTimeTip,!1;t.errorMsg="",s[t.timeType]=e.value}})},timeFormat:function(e,t){if(!e)return"";var s={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(var i in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),s)new RegExp("("+i+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?s[i]:("00"+s[i]).substr((""+s[i]).length)));return t},_loadBusinessTime:function(e){var t=this;this.curBusiness.business.businessTimeList&&0!==this.curBusiness.business.businessTimeList.length?"formEngine"===this.curRoute&&(0!==this.timeSetData.length&&"clickBusiness"!==e||(this.timeSetData=JSON.parse(a()(this.curBusiness.business.businessTimeList))),this.timeSetData.forEach(function(e,s){t.players[s]&&e.nodeId===t.players[s].id&&(t.$set(e,"title",""),e.title=t.players[s].name)})):(this.curBusiness.business.businessTimeList=[],this.players.forEach(function(e){t.curBusiness.business.businessTimeList.push({nodeId:e.id,startDate:"",endDate:"",isLimit:!1})}))},_getDatetimeArr:function(e){var t=[];return e.forEach(function(e){t.push({id:e.nodeId,datetime:e.endDate})}),t},_getBusinessTime:function(){var e=this,t=[],s=[],i=[],n=[];for(var r in this.timeSetData.forEach(function(r,o){if(e.curBusiness.business.businessTimeList[o].nodeId===r.nodeId){if(e.curBusiness.business.businessTimeList[o].startDate=JSON.parse(a()(r.startDate)),e.curBusiness.business.businessTimeList[o].endDate=JSON.parse(a()(r.endDate)),r.startDate){t.push(r.startDate);var c=new Date(r.startDate.replace(/-/g,"/"));i.push(Date.parse(c))}if(r.endDate){s.push(r.endDate);c=new Date(r.endDate.replace(/-/g,"/"));n.push(Date.parse(c))}}}),t){var o=new Date(t[r].replace(/-/g,"/"));Date.parse(o)===Math.min.apply(null,i)&&(this.curBusiness.business.beginTime=t[r])}for(var r in s){o=new Date(s[r].replace(/-/g,"/"));Date.parse(o)===Math.max.apply(null,n)&&(this.curBusiness.business.endTime=s[r])}this.curBusiness.business.beginTime=this.curBusiness.business.beginTime?this.curBusiness.business.beginTime:"",this.curBusiness.business.endTime=this.curBusiness.business.endTime?this.curBusiness.business.endTime:""},_save:function(e,t){var s=this;if(this.curBusiness&&this.curBusiness.businessLimit&&this.curBusiness.businessLimit.schoolStatus&&!(this.curBusiness.businessLimit.schoolStatus instanceof Array))if(""==this.curBusiness.businessLimit.schoolStatus)this.curBusiness.businessLimit.schoolStatus=[];else if(""!==this.curBusiness.businessLimit.schoolStatus&&-1==this.curBusiness.businessLimit.schoolStatus.indexOf(",")){var i=[];i.push(this.curBusiness.businessLimit.schoolStatus),this.curBusiness.businessLimit.schoolStatus=i}else""!==this.curBusiness.businessLimit.schoolStatus&&this.curBusiness.businessLimit.schoolStatus.indexOf(",")>-1&&(this.curBusiness.businessLimit.schoolStatus=this.curBusiness.businessLimit.schoolStatus.split(","));if(this.curBusiness&&this.curBusiness.businessLimit&&this.curBusiness.businessLimit.educationLevel&&!(this.curBusiness.businessLimit.educationLevel instanceof Array))if(""==this.curBusiness.businessLimit.educationLevel)this.curBusiness.businessLimit.educationLevel=[];else if(""!==this.curBusiness.businessLimit.educationLevel&&-1==this.curBusiness.businessLimit.educationLevel.indexOf(",")){var a=[];a.push(this.curBusiness.businessLimit.educationLevel),this.curBusiness.businessLimit.educationLevel=a}else""!==this.curBusiness.businessLimit.educationLevel&&this.curBusiness.businessLimit.educationLevel.indexOf(",")>-1&&(this.curBusiness.businessLimit.educationLevel=this.curBusiness.businessLimit.educationLevel.split(","));if(this.curBusiness&&this.curBusiness.businessLimit&&this.curBusiness.businessLimit.studentType&&!(this.curBusiness.businessLimit.studentType instanceof Array))if(""==this.curBusiness.businessLimit.studentType)this.curBusiness.businessLimit.studentType=[];else if(""!==this.curBusiness.businessLimit.studentType&&-1==this.curBusiness.businessLimit.studentType.indexOf(",")){var n=[];n.push(this.curBusiness.businessLimit.studentType),this.curBusiness.businessLimit.studentType=n}else""!==this.curBusiness.businessLimit.studentType&&this.curBusiness.businessLimit.studentType.indexOf(",")>-1&&(this.curBusiness.businessLimit.studentType=this.curBusiness.businessLimit.studentType.split(","));if(this.curBusiness&&this.curBusiness.businessLimit&&this.curBusiness.businessLimit.grade&&!(this.curBusiness.businessLimit.grade instanceof Array))if(""==this.curBusiness.businessLimit.grade)this.curBusiness.businessLimit.grade=[];else if(""!==this.curBusiness.businessLimit.grade&&-1==this.curBusiness.businessLimit.grade.indexOf(",")){var r=[];r.push(this.curBusiness.businessLimit.grade),this.curBusiness.businessLimit.grade=r}else""!==this.curBusiness.businessLimit.grade&&this.curBusiness.businessLimit.grade.indexOf(",")>-1&&(this.curBusiness.businessLimit.grade=this.curBusiness.businessLimit.grade.split(","));if("3"==this.curBusiness.business.limitType&&(!new RegExp("(((^([0-9]|[0-5][0-9])(\\,|\\-|\\/){1}([0-9]|[0-5][0-9]) )|^([0-9]|[0-5][0-9]) |^(\\* ))((([0-9]|[0-5][0-9])(\\,|\\-|\\/){1}([0-9]|[0-5][0-9]) )|([0-9]|[0-5][0-9]) |(\\* ))((([0-9]|[01][0-9]|2[0-3])(\\,|\\-|\\/){1}([0-9]|[01][0-9]|2[0-3]) )|([0-9]|[01][0-9]|2[0-3]) |(\\* ))((([0-9]|[0-2][0-9]|3[01])(\\,|\\-|\\/){1}([0-9]|[0-2][0-9]|3[01]) )|(([0-9]|[0-2][0-9]|3[01]) )|(\\? )|(\\* )|(([1-9]|[0-2][0-9]|3[01])L )|([1-7]W )|(LW )|([1-7]\\#[1-4] ))((([1-9]|0[1-9]|1[0-2])(\\,|\\-|\\/){1}([1-9]|0[1-9]|1[0-2]) )|([1-9]|0[1-9]|1[0-2]) |(\\* ))(([1-7](\\,|\\-|\\/){1}[1-7])|([1-7])|(\\?)|(\\*)|(([1-7]L)|([1-7]\\#[1-4]))))|(((^([0-9]|[0-5][0-9])(\\,|\\-|\\/){1}([0-9]|[0-5][0-9]) )|^([0-9]|[0-5][0-9]) |^(\\* ))((([0-9]|[0-5][0-9])(\\,|\\-|\\/){1}([0-9]|[0-5][0-9]) )|([0-9]|[0-5][0-9]) |(\\* ))((([0-9]|[01][0-9]|2[0-3])(\\,|\\-|\\/){1}([0-9]|[01][0-9]|2[0-3]) )|([0-9]|[01][0-9]|2[0-3]) |(\\* ))((([0-9]|[0-2][0-9]|3[01])(\\,|\\-|\\/){1}([0-9]|[0-2][0-9]|3[01]) )|(([0-9]|[0-2][0-9]|3[01]) )|(\\? )|(\\* )|(([1-9]|[0-2][0-9]|3[01])L )|([1-7]W )|(LW )|([1-7]\\#[1-4] ))((([1-9]|0[1-9]|1[0-2])(\\,|\\-|\\/){1}([1-9]|0[1-9]|1[0-2]) )|([1-9]|0[1-9]|1[0-2]) |(\\* ))(([1-7](\\,|\\-|\\/){1}[1-7] )|([1-7] )|(\\? )|(\\* )|(([1-7]L )|([1-7]\\#[1-4]) ))((19[789][0-9]|20[0-9][0-9])\\-(19[789][0-9]|20[0-9][0-9])))").test(this.curBusiness.businessLimit.cron)||!this.curBusiness.businessLimit.url))return void this.$toast("请正确输入接口信息!");if("business"===e){if(!this.curBusiness.business.name)return this.$toast(this.translate.nameError),!1;var o=this.curBusiness.business.id?"put":"post",l="/api/app/"+this.appId+"/business"+(this.curBusiness.business.id?"/"+this.curBusiness.business.id:"");"put"===o&&"formEngine"===this.curRoute&&(l+="?formId="+this.curBusiness.formId+"&playerSettingId="+this.curBusiness.playerSettingId),"formEngine"===this.curRoute?this._getBusinessTime():(this.curBusiness.business.beginTime=this.curBusiness.business.beginTime?this.curBusiness.business.beginTime:"",this.curBusiness.business.endTime=this.curBusiness.business.endTime?this.curBusiness.business.endTime:""),Object(c.e)({url:l,type:o,data:this.curBusiness,success:function(e){if(e.state){if(e.data.business.id&&!s.curBusiness.business.id)for(var i in e.data)s.$set(s.curBusiness,i,e.data[i]);t?t():(s.$toast(s.translate.saveBusinessSuccess),"3"==s.curBusiness.business.limitType&&(s.typeL=3))}else s.$toast(e.message)}})}},showImportPage:function(){this._initImportTpl(),this.showImportModal=!0},backParentPage:function(){this.showImportModal=!1},exportUserInfo:function(){window.location.href="/downloads/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/excel?fileName="+this.curBusiness.business.name+".xlsx"},releaseApp:function(e){var t=this;if(this.releaseAppDisabled)return!1;this.releaseAppDisabled=!0;var s="",i="",a="";"release"===e?(s=this.translate.releaseTip,i=this.translate.release,a="post"):(s=this.translate.dropOffTip,i=this.translate.dropOff,a="delete"),confirm(s)?Object(c.e)({url:"/api/app/"+this.appId+"/public",type:a,success:function(e){t.releaseAppDisabled=!1,e.state?(t.$toast(i+t.translate.success),t.curApp.isPublished=!t.curApp.isPublished):t.$toast(e.message)}}):this.releaseAppDisabled=!1},_limitLength:function(e){this.curApp.name=this._getStrByteLimit(e.target.value,50)},_saveAppName:function(){var e=this;if(!this.curApp.name)return this.nameChangeMsg=this.translate.nameError,!1;Object(c.e)({url:"/api/app/"+this.curApp.id+"/name",type:"put",data:{name:this.curApp.name},success:function(t){t.state?(e.$emit("update",e.curApp),e.nameChangeMsg=e.translate.modifySuccess,setTimeout(function(){e.nameChangeMsg=""},2e3)):e.nameChangeMsg=e.translate.error+"："+t.message}})},_saveAppDesc:function(){var e=this;Object(c.e)({url:"/api/app/"+this.curApp.id+"/remark",type:"put",data:{remark:this.curApp.remark},success:function(t){t.state?(e.$emit("update",e.curApp),e.descChangeMsg=e.translate.modifySuccess,setTimeout(function(){e.descChangeMsg=""},2e3)):e.descChangeMsg=e.translate.error+"："+t.message}})},_openReviseBusiness:function(){var e=this;if("link"===this.curRoute)return!1;this.curBusiness.business.isPublic&&(this.clickCount++,this.reviseSetTimeOut||(this.reviseSetTimeOut=setTimeout(function(){e.clickCount>=10&&(e.isReviseBusiness=!0),e.clickCount=0,clearTimeout(e.reviseSetTimeOut),e.reviseSetTimeOut=null},3e3)))},_reviseBusinessData:function(e){this.isReviseBusiness&&(this.isReviseData&&confirm("是否保存修改的数据？不保存会丢失")&&this._reviseBusinessInfo(),"form"===e?this.$emit("setForm",{modelId:this.appState.modelId,type:this.curApp.setting.formId?"edit":"create",businessId:this.curBusiness.business.id}):this.$emit("setJoinRole",{businessId:this.curBusiness.business.id}))},_changeBusinessName:function(){this.isReviseData=!0},_reviseBusinessInfo:function(){var e=this;this._getBusinessTime();var t={name:this.curBusiness.business.name,year:this.curBusiness.business.year,guide:this.curBusiness.business.guide,beginTime:this.curBusiness.business.beginTime,endTime:this.curBusiness.business.endTime,businessTimeList:[]};this.curBusiness.business.businessTimeList.forEach(function(e){t.businessTimeList.push({nodeId:e.nodeId,startDate:e.startDate,endDate:e.endDate})}),Object(c.e)({url:"/api/app/"+this.appId+"/publishBusiness/"+this.curBusiness.business.id,type:"put",data:t,success:function(t){e.isReviseData=!1,t.state?(e.$toast("业务期保存成功"),"3"==e.curBusiness.business.limitType&&(e.typeL=3)):e.$toast(t.message)}})},_export:function(){window.location.href="/downloads/app/"+this.appId+"/export"}},components:{tableset:h}},C={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("GeminiScrollbar",{attrs:{scrollX:!1,id:"formEngineInfo"}},[s("div",{staticClass:"header"},[s("i",{staticClass:"maticon pull-left back-link",domProps:{innerHTML:e._s(e.icons("arrow_back"))},on:{click:e._back}},[e._v("arrow_back")]),e._v(" "),s("div",{staticClass:"pull-right release-app",on:{click:e._setTable}},[e._v("报表设置")]),e._v(" "),e.curApp.isPublished?s("div",{staticClass:"pull-right release-app",class:e.releaseAppDisabled?"release-app-disabled":"",on:{click:function(t){return e.releaseApp("delete")}}},[e._v(e._s(e.translate.dropOff))]):s("div",{staticClass:"pull-right release-app",class:e.releaseAppDisabled?"release-app-disabled":"",on:{click:function(t){return e.releaseApp("release")}}},[e._v(e._s(e.translate.release))]),e._v(" "),s("div",{staticClass:"pull-right release-app",on:{click:e._export}},[e._v(e._s(e.translate.export))]),e._v(" "),s("div",{staticClass:"title-div"},[s("div",{staticClass:"app-icon-div"},[s("i",{staticClass:"maticon edit-icon",domProps:{innerHTML:e._s(e.icons("edit"))},on:{click:function(t){return e._editPart("icon")}}},[e._v("edit")]),e._v(" "),s("div",{style:{"background-image":e.curApp.background}},[e.curApp.imgType&&"1"!==e.curApp.imgType?"2"===e.curApp.imgType?s("i",{staticClass:"app-icon"},[s("span",{staticClass:"saasicon-44px",class:["saasicon-44px-"+e.curApp.imgPath]})]):e._e():s("i",{staticClass:"maticon app-icon",domProps:{innerHTML:e._s(e.icons(e.curApp.imgPath))}},[e._v(e._s(e.curApp.imgPath))])])]),e._v(" "),s("div",{staticClass:"input-group app-name-div info-value",style:{width:e.inputStyleWidth+"px"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.curApp.name,expression:"curApp.name"}],staticClass:"form-control",attrs:{type:"text",placeholder:e.translate.applyNamePlaceholder},domProps:{value:e.curApp.name},on:{input:[function(t){t.target.composing||e.$set(e.curApp,"name",t.target.value)},e._limitLength],change:e._saveAppName}}),e._v(" "),s("div",[s("a",{staticClass:"apartment-link",attrs:{href:"javascript:;"}},[e._v(e._s(e.curApp.department&&e.curApp.department.name))])])]),e._v(" "),e.nameChangeMsg?s("p",{staticClass:"save-tip text-center",class:e.nameChangeMsg.indexOf(e.translate.error)>=0?"error":""},[e._v(e._s(e.nameChangeMsg))]):e._e(),e._v(" "),"formEngine"===e.curRoute?s("div",{staticClass:"form-flow-set"},[s("span",{staticClass:"info-set",on:{click:e._setAppForm}},[e._v(e._s(e.translate.form)+"："+e._s(e.appState.formName||e.translate.pleaseSet))]),e._v(" "),e.appState.formName?s("span",{staticClass:"info-connect"}):e._e(),e._v(" "),e.appState.formName?s("span",{staticClass:"info-set",on:{click:e._setJoinRole}},[e._v(e._s(e.translate.playersSet))]):e._e()]):e._e(),e._v(" "),s("div",{staticClass:"app-desc info-value"},[s("span",{staticClass:"count-limit"},[e._v(e._s(e.curApp.remark?e.curApp.remark.length:0)+"/200")]),e._v(" "),s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.curApp.remark,expression:"curApp.remark"}],staticClass:"desc-part",attrs:{rows:e.rowsNumber,maxlength:"200",placeholder:e.translate.remarkPlaceholder},domProps:{value:e.curApp.remark},on:{change:e._saveAppDesc,input:function(t){t.target.composing||e.$set(e.curApp,"remark",t.target.value)}}})]),e._v(" "),e.descChangeMsg?s("p",{staticClass:"save-tip text-center",class:e.descChangeMsg.indexOf(e.translate.error)>=0?"error":""},[e._v(e._s(e.descChangeMsg))]):e._e(),e._v(" "),s("div",[s("p",[s("strong",[e._v("应用直接访问地址：")]),e._v(" "),s("span",{staticStyle:{"user-select":"text"}},[e._v(e._s("http://"+e.host+"/"+e.$account.schoolId+"/app/"+e.curApp.id))])])])])]),e._v(" "),"link"===e.curRoute?s("div",{staticClass:"middle-link-info"},[s("div",{staticClass:"select-link-manner"},[s("div",{staticClass:"radio-item"},[s("span",{staticClass:"check",on:{click:function(t){return e._changeLinkUseBusiness("noUse")}}},[e.curApp&&e.curApp.setting&&!e.curApp.setting.useBusiness?s("i",{staticClass:"maticon active",domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")]):s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")])]),e._v(" "),s("label",{staticClass:"check-label",class:e.curApp&&e.curApp.setting&&!e.curApp.setting.useBusiness?"active":""},[e._v(e._s(e.translate.directJump))])]),e._v(" "),s("div",{staticClass:"radio-item"},[s("span",{staticClass:"check",on:{click:function(t){return e._changeLinkUseBusiness("use")}}},[e.curApp&&e.curApp.setting&&e.curApp.setting.useBusiness?s("i",{staticClass:"maticon active",domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")]):s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")])]),e._v(" "),s("label",{staticClass:"check-label",class:e.curApp&&e.curApp.setting&&e.curApp.setting.useBusiness?"active":""},[e._v(e._s(e.translate.useBusiness))])])]),e._v(" "),s("div",{staticClass:"set-link input-group info-value"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.curApp&&e.curApp.setting&&e.curApp.setting.linkUrl,expression:"curApp&&curApp.setting&&curApp.setting.linkUrl"}],staticClass:"form-control",attrs:{type:"text",placeholder:e.translate.linkUrlPlaceholder},domProps:{value:e.curApp&&e.curApp.setting&&e.curApp.setting.linkUrl},on:{change:e._saveLink,input:function(t){t.target.composing||e.$set(e.curApp&&e.curApp.setting&&e.curApp.setting,"linkUrl",t.target.value)}}})])]):e._e(),e._v(" "),e.curApp&&e.curApp.setting&&!1!==e.curApp.setting.useBusiness?s("div",{staticClass:"middle"},[s("label",{staticClass:"head-label pull-left",on:{click:e._openReviseBusiness}},[e._v(e._s(e.translate.businessPeriod))]),e._v(" "),s("a",{staticClass:"add-new pull-right",attrs:{href:"javascript:;"},on:{click:e._addNewBusiness}},[e._v(e._s(e.translate.addNew))]),e._v(" "),e.leftIconShow?s("i",{staticClass:"maticon scroll-left",domProps:{innerHTML:e._s(e.icons("chevron_left"))},on:{click:e._scrollLeft}},[e._v("chevron_left")]):e._e(),e._v(" "),e.rightIconShow?s("i",{staticClass:"maticon scroll-right",domProps:{innerHTML:e._s(e.icons("chevron_right"))},on:{click:e._scrollRight}},[e._v("chevron_right")]):e._e(),e._v(" "),s("GeminiScrollbar",{staticClass:"business-div",attrs:{id:"businessDiv",scrollY:!1}},[s("div",{staticClass:"business-scroll"},e._l(e.businessList,function(t,i){return s("div",{key:i,staticStyle:{display:"inline-block",position:"relative"}},[s("div",{staticClass:"mark-div",class:e._compareTime(e.businessList,i)},[s("span")]),e._v(" "),s("div",{staticClass:"business-tab",class:e.curBusiness&&t.business.name===e.curBusiness.business.name?"active":"",attrs:{title:t.business.name},on:{click:function(s){return e._changeBusiness(t,t.business.limitType)}}},[e._v("\n            "+e._s(t.business.name)+"\n            "),t.business.isPublic?e._e():s("i",{staticClass:"maticon remove-icon",domProps:{innerHTML:e._s(e.icons("cancel"))},on:{click:function(t){return t.stopPropagation(),e._removeBusiness(i)}}},[e._v("cancel")])])])}),0)]),e._v(" "),e.curBusiness?s("div",{staticClass:"info-type-tabs"},e._l(e.appState.infoTypes,function(t,i){return e.curBusiness&&e.curBusiness.business.id||"base"===t.id?s("div",{key:i,staticClass:"info-tab text-center",class:t.id===e.appState.infoType?"active":"",on:{click:function(s){return e._tabClick(t)}}},[e._v(e._s(t.name))]):e._e()}),0):e._e()],1):e._e(),e._v(" "),e.curBusiness&&e.curApp.setting&&!1!==e.curApp.setting.useBusiness?s("div",{staticClass:"bottom"},[s("span",[s("a",{staticClass:"release-business",attrs:{href:"javascript:;"}},[e.curBusiness.business.isPublic?e.curBusiness.business.isEnable?s("span",{on:{click:function(t){return e._releaseBusiness("stop")}}},[e._v(e._s(e.translate.stopBusinessPeriod))]):s("span",{staticClass:"disabled"},[e._v(e._s(e.translate.businessPeriodDisabled))]):s("span",{class:e.releaseBusinessDisabled?"disabled":"",on:{click:function(t){return e._releaseBusiness("release")}}},[e._v(e._s(e.annoreleaseBusinessText||e.translate.releaseBusinessPeriod))])])]),e._v(" "),e.curBusiness.business.isPublic?e._e():s("span",{staticClass:"save-business",on:{click:function(t){return e._save("business")}}},[e._v(e._s(e.translate.saveBusinessDeploy))]),e._v(" "),e.isReviseBusiness?s("span",{staticClass:"save-business revise",on:{click:e._reviseBusinessInfo}},[e._v(e._s(e.translate.saveBusinessDeploy))]):e._e(),e._v(" "),s("span",{staticClass:"error-tip",class:e.errorMsg?"active":""},[e._v(e._s(e.errorMsg))]),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:"base"===e.appState.infoType,expression:"appState.infoType === 'base'"}],staticClass:"info-body container-fluid"},[s("div",{staticClass:"col-sm-6 padding-right"},[s("div",{staticClass:"form-group base-item"},[s("label",[e._v(e._s(e.translate.businessName))]),e._v(" "),!e.curBusiness.business.isPublic||e.isReviseBusiness?s("input",{directives:[{name:"model",rawName:"v-model",value:e.curBusiness.business.name,expression:"curBusiness.business.name"}],staticClass:"form-control valid",attrs:{type:"text",placeholder:e.translate.businessNamePlaceholder,maxlength:"30"},domProps:{value:e.curBusiness.business.name},on:{change:e._changeBusinessName,input:function(t){t.target.composing||e.$set(e.curBusiness.business,"name",t.target.value)}}}):s("input",{staticClass:"form-control",attrs:{type:"text",readonly:""},domProps:{value:e.curBusiness.business.name}})])]),e._v(" "),s("div",{staticClass:"col-sm-6 padding-left"},[s("div",{staticClass:"form-group base-item"},[s("label",[e._v(e._s(e.translate.schoolYear))]),e._v(" "),s("v-select",{staticClass:"info-value btn-block",attrs:{options:e.appState.gradeOptions,value:e.curBusiness.business.year||(new Date).getFullYear()+"_0","options-value":"id","options-label":"label","close-on-select":"",disabled:!(!e.curBusiness.business.isPublic||e.isReviseBusiness),search:""},on:{afterSelected:e._afterSelectYear}})],1)]),e._v(" "),"formEngine"===e.curRoute?s("div",{staticClass:"col-sm-6 padding-right"},[s("div",{staticClass:"form-group base-item",class:e.isReviseBusiness?"active":"",on:{click:function(t){return e._reviseBusinessData("form")}}},[s("label",{class:e.isReviseBusiness?"active":""},[e._v(e._s(e.translate.form)+"("+e._s(e.translate.basicInfoTip)+")")]),e._v(" "),s("input",{staticClass:"form-control",class:e.isReviseBusiness?"active":"",attrs:{readonly:""},domProps:{value:e.appState.formName||e.translate.unboundForm}})])]):e._e(),e._v(" "),"formEngine"===e.curRoute?s("div",{staticClass:"col-sm-6 padding-left"},[s("div",{staticClass:"form-group base-item",class:e.isReviseBusiness?"active":"",on:{click:function(t){return e._reviseBusinessData("players")}}},[s("label",{class:e.isReviseBusiness?"active":""},[e._v(e._s(e.translate.playersSet)+"("+e._s(e.translate.basicInfoTip)+")")]),e._v(" "),s("input",{staticClass:"form-control",class:e.isReviseBusiness?"active":"",attrs:{readonly:""}})])]):e._e()]),e._v(" "),e.curBusiness.business.id?s("div",{directives:[{name:"show",rawName:"v-show",value:"faceTo"===e.appState.infoType,expression:"appState.infoType === 'faceTo'"}],staticClass:"info-body container-fluid outer-container"},[e.faceToPeopleType.indexOf(e.curApp&&e.curApp.appType&&e.curApp.appType.userType)<0?s("div",{staticClass:"limit-radios"},[s("div",{staticClass:"radio-item small-item",class:"0"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic?"":"active"},[s("span",{staticClass:"check",class:e.curBusiness.business.isPublic?"disable":"",on:{click:function(t){return e._changeLimitType("0")}}},["0"!==e.curBusiness.business.limitType?s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")]):s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")])]),e._v(" "),s("label",{staticClass:"check-label"},[e._v(e._s(e.translate.unlimited))])]),e._v(" "),s("div",{staticClass:"radio-item large-item",class:"1"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic?"":"active"},[s("div",{staticClass:"large-check-part"},[s("span",{staticClass:"check",class:e.curBusiness.business.isPublic?"disable":"",on:{click:function(t){return e._changeLimitType("1")}}},["1"!==e.curBusiness.business.limitType?s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")]):s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")])]),e._v(" "),s("label",{staticClass:"check-label"},[e._v(e._s(e.translate.filterByCondition))])]),e._v(" "),s("div",{staticClass:"large-select-part"},[s("div",{staticClass:"select-group"},[s("label",[e._v(e._s(e.translate.studentType))]),e._v(" "),s("v-select",{staticClass:"info-value btn-block",attrs:{url:"/api/system/dictTypes/1004/dicts",multiple:!0,value:e.curBusiness.businessLimit?e.curBusiness.businessLimit.studentType:"","options-value":"value","options-label":"label","close-on-select":"",justified:"",disabled:"1"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic},on:{afterSelected:e._afterSelectStuType}})],1)]),e._v(" "),s("div",{staticClass:"large-select-part"},[s("div",{staticClass:"select-group"},[s("label",[e._v(e._s(e.translate.studentGrade))]),e._v(" "),s("v-select",{staticClass:"info-value btn-block",attrs:{options:e.appState.gradeOptions2,multiple:!0,value:e.curBusiness.businessLimit?e.curBusiness.businessLimit.grade:"","options-value":"id","options-label":"label","close-on-select":"",justified:"",disabled:"1"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic},on:{afterSelected:e._afterSelectGrade}})],1)]),e._v(" "),s("div",{staticClass:"large-select-part"},[s("div",{staticClass:"select-group"},[s("label",[e._v(e._s(e.translate.inSchoolStatus))]),e._v(" "),s("v-select",{staticClass:"info-value btn-block",attrs:{options:e.appState.inSchoolOptions,value:e.curBusiness.businessLimit?parseInt(e.curBusiness.businessLimit.inSchool):"","options-value":"id","options-label":"label","close-on-select":"",justified:"",disabled:"1"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic},on:{afterSelected:e._afterSelectInSchool}})],1)]),e._v(" "),s("div",{staticClass:"large-select-part"},[s("div",{staticClass:"select-group"},[s("label",[e._v("当前状态")]),e._v(" "),s("v-select",{staticClass:"info-value btn-block",attrs:{options:e.schoolStatus,multiple:!0,value:e.curBusiness.businessLimit?e.curBusiness.businessLimit.schoolStatus:"","options-value":"value","options-label":"label","close-on-select":"",justified:"",disabled:"1"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic},on:{afterSelected:e._afterSelectSchoolStatus}})],1)]),e._v(" "),s("div",{staticClass:"large-select-part"},[s("div",{staticClass:"select-group"},[s("label",[e._v("培养层次")]),e._v(" "),s("v-select",{staticClass:"info-value btn-block",attrs:{options:e.educationLevel,multiple:!0,value:e.curBusiness.businessLimit?e.curBusiness.businessLimit.educationLevel:"","options-value":"value","options-label":"label","close-on-select":"",justified:"",disabled:"1"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic},on:{afterSelected:e._afterSelectEducationLevelStatus}})],1)])]),e._v(" "),s("div",{staticClass:"radio-item small-item",class:"2"===e.curBusiness.business.limitType?"active":""},[s("span",{staticClass:"check",class:e.curBusiness.business.isPublic?"disable":"",on:{click:function(t){return e._changeLimitType("2")}}},["2"!==e.curBusiness.business.limitType?s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")]):s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")])]),e._v(" "),s("label",{staticClass:"check-label"},[e._v(e._s(e.translate.uploadList))]),e._v(" "),"2"===e.curBusiness.business.limitType?s("div",{staticClass:"pull-right opt-div"},[s("a",{staticClass:"opt-btn",attrs:{href:"javascript:;"},on:{click:e.showImportPage}},[s("span",[e._v(e._s(e.translate.batchUpload))])]),e._v(" "),e.curBusiness.business.isPublic?e._e():s("a",{staticClass:"opt-btn",attrs:{href:"javascript:;"},on:{click:e.exportUserInfo}},[e._v(e._s(e.translate.export))])]):e._e()]),e._v(" "),"2"===e.curBusiness.business.limitType?s("div",{staticClass:"stus-list"},[e.curBusiness.business.id?s("v-table",{attrs:{url:e.peopleUrl,pagesize:"5",idField:"id",columns:e.appState.columns,order:!0}}):s("span",{staticClass:"table-tip"},[e._v(e._s(e.translate.noData))])],1):e._e(),e._v(" "),s("div",{staticClass:"radio-item large-item",class:"3"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic?"":"active",staticStyle:{height:"198px"}},[s("div",{staticClass:"large-check-part"},[s("span",{staticClass:"check",class:e.curBusiness.business.isPublic?"disable":"",on:{click:function(t){return e._changeLimitType("3")}}},["3"!==e.curBusiness.business.limitType?s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")]):s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")])]),e._v(" "),s("label",{staticClass:"check-label"},[e._v("接口对接")])]),e._v(" "),s("div",{staticClass:"large-select-part"},[s("div",{staticClass:"select-group",staticStyle:{width:"550px",padding:"20px 20px 5px 20px"}},[s("label",{staticStyle:{color:"#000"}},[e._v("接口地址：")]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.curBusiness.businessLimit.url,expression:"curBusiness.businessLimit.url"}],staticClass:"form-control",staticStyle:{display:"inline-block",width:"400px"},attrs:{type:"text",disabled:"3"!==e.curBusiness.business.limitType,placeholder:"请提供接口地址",name:"",id:""},domProps:{value:e.curBusiness.businessLimit.url},on:{input:function(t){t.target.composing||e.$set(e.curBusiness.businessLimit,"url",t.target.value)}}})]),e._v(" "),s("div",{staticClass:"select-group",staticStyle:{width:"550px",padding:"5px 20px"}},[s("label",{staticStyle:{color:"#000"}},[e._v("更新频率：")]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.curBusiness.businessLimit.cron,expression:"curBusiness.businessLimit.cron"}],staticClass:"form-control",staticStyle:{display:"inline-block",width:"400px"},attrs:{type:"text",disabled:"3"!==e.curBusiness.business.limitType,placeholder:"CRON表达式",name:"",id:""},domProps:{value:e.curBusiness.businessLimit.cron},on:{input:function(t){t.target.composing||e.$set(e.curBusiness.businessLimit,"cron",t.target.value)}}})]),e._v(" "),s("div",{staticClass:"select-group",staticStyle:{width:"550px",padding:"5px 20px"}},[s("label",{staticStyle:{color:"#000"}},[e._v("更新方式：")]),e._v(" "),s("p",{staticStyle:{display:"inline-block","vertical-align":"bottom",margin:"0","margin-top":"5px"}},[s("span",{staticClass:"check",on:{click:function(t){e.curBusiness.businessLimit.updateType="COVER"}}},["COVER"!==e.curBusiness.businessLimit.updateType||""===e.curBusiness.businessLimit.updateType?s("i",{staticClass:"maticon",staticStyle:{"line-height":"15px"},attrs:{disabled:"3"!==e.curBusiness.business.limitType},domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")]):s("i",{staticClass:"maticon",staticStyle:{"line-height":"15px"},attrs:{disabled:"3"!==e.curBusiness.business.limitType},domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")])]),e._v(" "),s("label",{staticClass:"check-label",attrs:{disabled:"3"===e.curBusiness.business.limitType}},[e._v("增量")])]),e._v(" "),s("p",{staticStyle:{display:"inline-block","vertical-align":"bottom",margin:"0","margin-top":"5px"}},[s("span",{staticClass:"check",on:{click:function(t){e.curBusiness.businessLimit.updateType="INCREMENT"}}},["INCREMENT"!==e.curBusiness.businessLimit.updateType||""===e.curBusiness.businessLimit.updateType?s("i",{staticClass:"maticon",staticStyle:{"line-height":"15px"},domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")]):s("i",{staticClass:"maticon",staticStyle:{"line-height":"15px"},domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")])]),e._v(" "),s("label",{staticClass:"check-label"},[e._v("覆盖")])])]),e._v(" "),"3"==e.typeL?s("div",{staticClass:"select-group",staticStyle:{width:"550px",padding:"10px 20px","text-align":"center"}},[s("button",{staticClass:"btn btn-default ",attrs:{disabled:"3"!==e.curBusiness.business.limitType},on:{click:function(t){return e.updateHand()}}},[e._v("手动更新")])]):e._e()])]),e._v(" "),"3"==e.typeL?s("div",{staticClass:"stus-list"},[e.curBusiness.business.id?s("v-table",{attrs:{url:e.peopleUrlJiekou,pagesize:"5",idField:"id",columns:e.JiekouColumns,order:!0}}):s("span",{staticClass:"table-tip"},[e._v(e._s(e.translate.noData))])],1):e._e()]):s("div",{staticClass:"limit-radios"},[s("div",{staticClass:"radio-item small-item",class:"0"!==e.curBusiness.business.limitType||e.curBusiness.business.isPublic?"":"active"},[s("span",{staticClass:"check",class:e.curBusiness.business.isPublic?"disable":"",on:{click:function(t){return e._changeLimitType("0")}}},["0"!==e.curBusiness.business.limitType?s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")]):s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")])]),e._v(" "),e.curApp&&e.curApp.appType&&"3"===e.curApp.appType.userType?s("label",{staticClass:"check-label"},[e._v(e._s(e.translate.allFreshmen))]):e.curApp&&e.curApp.appType&&"2"===e.curApp.appType.userType?s("label",{staticClass:"check-label"},[e._v("所有教职工")]):s("label",{staticClass:"check-label"},[e._v(e._s(e.translate.allInstructor))])]),e._v(" "),s("div",{staticClass:"radio-item small-item",class:"2"===e.curBusiness.business.limitType?"active":""},[s("span",{staticClass:"check",class:e.curBusiness.business.isPublic?"disable":"",on:{click:function(t){return e._changeLimitType("2")}}},["2"!==e.curBusiness.business.limitType?s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_unchecked"))}},[e._v("radio_button_unchecked")]):s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("radio_button_checked"))}},[e._v("radio_button_checked")])]),e._v(" "),s("label",{staticClass:"check-label"},[e._v(e._s(e.translate.uploadList))]),e._v(" "),"2"===e.curBusiness.business.limitType?s("div",{staticClass:"pull-right opt-div"},[s("a",{staticClass:"opt-btn",attrs:{href:"javascript:;"},on:{click:e.showImportPage}},[s("span",[e._v(e._s(e.translate.batchUpload))])]),e._v(" "),e.curBusiness.business.isPublic?e._e():s("a",{staticClass:"opt-btn",attrs:{href:"javascript:;"},on:{click:e.exportUserInfo}},[e._v(e._s(e.translate.export))])]):e._e()]),e._v(" "),"2"===e.curBusiness.business.limitType?s("div",{staticClass:"stus-list"},[e.curBusiness.business.id?s("v-table",{attrs:{url:e.peopleUrl,pagesize:"5",idField:"id",columns:e.appState.columns,order:!0}}):s("span",{staticClass:"table-tip"},[e._v(e._s(e.translate.noData))])],1):e._e()]),e._v(" "),e.showImportModal?s("div",{staticClass:"import-modal"},[s("v-import",e._b({on:{backParentPage:e.backParentPage}},"v-import",e.importParams,!1))],1):e._e()]):e._e(),e._v(" "),e.curBusiness.business.id?s("div",{directives:[{name:"show",rawName:"v-show",value:"timeSet"===e.appState.infoType,expression:"appState.infoType === 'timeSet'"}],staticClass:"info-body"},["formEngine"===e.curRoute?s("div",{staticClass:"time-set-info"},e._l(e.timeSetData,function(t,i){return s("div",{key:i,staticClass:"time-set-group"},[s("div",{staticClass:"start-time-group",class:e.timeNodeId===t.nodeId&&"startDate"===e.timeType?"active":"",on:{click:function(s){return e._nodeSelected(s,t.nodeId,"startDate",t.title)}}},[s("label",{staticClass:"role-name"},[s("span",{staticClass:"role-title"},[e._v(e._s(t.title))]),e._v(" "),s("span",{staticClass:"time-tip"},[e._v(e._s(e.translate.startTime))])]),e._v(" "),s("p",{staticClass:"time-info"},[e._v(e._s(t.startDate||e.translate.noSet))])]),e._v(" "),s("div",{staticClass:"end-time-group",class:e.timeNodeId===t.nodeId&&"endDate"===e.timeType?"active":"",on:{click:function(s){return e._nodeSelected(s,t.nodeId,"endDate",t.title)}}},[s("label",{staticClass:"role-name"},[s("span",{staticClass:"role-title"},[e._v(e._s(t.title))]),e._v(" "),s("span",{staticClass:"time-tip"},[e._v(e._s(e.translate.endTime))])]),e._v(" "),s("p",{staticClass:"time-info"},[e._v(e._s(t.endDate||e.translate.noSet))])])])}),0):s("div",{staticClass:"time-set-info"},[s("div",{staticClass:"start-time-group",class:"startTime"===e.timeType?"active":"",on:{click:function(t){return e._linkBusinessTime("startTime")}}},[s("label",{staticClass:"role-name"},[s("span",{staticClass:"time-tip"},[e._v(e._s(e.translate.startTime))])]),e._v(" "),s("p",{staticClass:"time-info"},[e._v(e._s(e.curBusiness.business.beginTime||e.translate.noSet))])]),e._v(" "),s("div",{staticClass:"end-time-group",class:"endTime"===e.timeType?"active":"",on:{click:function(t){return e._linkBusinessTime("endTime")}}},[s("label",{staticClass:"role-name"},[s("span",{staticClass:"time-tip"},[e._v(e._s(e.translate.endTime))])]),e._v(" "),s("p",{staticClass:"time-info"},[e._v(e._s(e.curBusiness.business.endTime||e.translate.noSet))])])])]):e._e(),e._v(" "),e.curBusiness.business.id&&"description"===e.appState.infoType?s("div",{staticClass:"info-body container-fluid"},[!e.curBusiness.business.isPublic||e.isReviseBusiness?s("u-editor",{ref:"description",attrs:{config:e.editorConfig},model:{value:e.curBusiness.business.guide,callback:function(t){e.$set(e.curBusiness.business,"guide",t)},expression:"curBusiness.business.guide"}}):s("div",{domProps:{innerHTML:e._s(e.curBusiness.business.guide)}})],1):e._e()]):e._e(),e._v(" "),e.readonly?e._e():s("v-modal",{attrs:{show:e.appState.showFormModal,effect:"fade",width:"374"}},[s("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[s("h5",{staticClass:"modal-title"},[e._v(e._s(e.translate.selectModal))])]),e._v(" "),s("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[s("label",[e._v(e._s(e.translate.modalTip))]),e._v(" "),s("ul",{staticClass:"list-group"},[s("li",{staticClass:"list-group-item",class:e.appState.modelId===e.blankTemplateId?"active":"",on:{click:function(t){e.appState.modelId=e.blankTemplateId}}},[e._v(e._s(e.translate.blankFormTemplate))]),e._v(" "),e._l(e.formList,function(t,i){return s("li",{key:i,staticClass:"list-group-item",class:e.appState.modelId===t.id?"active":"",on:{click:function(s){e.appState.modelId=t.id}}},[e._v(e._s(t.name)+e._s(e.translate.modal))])})],2)]),e._v(" "),s("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[s("a",{attrs:{href:"javascript:;"},on:{click:function(t){e.appState.showFormModal=!1}}},[e._v(e._s(e.translate.cancel))]),e._v(" "),s("a",{staticClass:"sure-btn",attrs:{href:"javascript:;"},on:{click:e._initWithModel}},[e._v(e._s(e.translate.confirm))])])]),e._v(" "),s("v-modal",{attrs:{show:e.showIconModal,effect:"fade",width:"446"}},[s("div",{staticClass:"modal-header iconModal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[s("h5",{staticClass:"modal-title"},[e._v(e._s(e.translate.editIcon))])]),e._v(" "),s("div",{staticClass:"modal-body iconModal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[s("div",{staticClass:"background-container"},e._l(e.backgroundList,function(t,i){return s("span",{key:i,staticClass:"background",style:{background:t.background},on:{click:function(s){return e._selectBackground(t)}}},[e.appState.background===t.background?s("i",{staticClass:"maticon icon-done",domProps:{innerHTML:e._s(e.icons("done"))}},[e._v("done")]):e._e()])}),0),e._v(" "),s("div",{staticClass:"icon-list"},[e._l(e.iconList,function(t,i){return s("i",{key:i,staticClass:"maticon",class:{active:"1"===e.appState.imgType&&e.appState.imgPath===t.name},domProps:{innerHTML:e._s(e.icons(t.name))},on:{click:function(s){return e._selectIcon(t)}}},[e._v(e._s(t.name))])}),e._v(" "),e._l(e.saasIconList,function(t,i){return s("i",{key:i,class:{active:"2"===e.appState.imgType&&e.appState.imgPath===t},on:{click:function(s){return e._selectIcon({name:t},"2")}}},[s("span",{staticClass:"saasicon",class:["saasicon-"+t+"-black"]})])})],2)]),e._v(" "),s("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[s("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(t){return e._cancelPart("icon")}}},[e._v(e._s(e.translate.cancel))]),e._v(" "),s("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:e._saveAppIcon}},[e._v(e._s(e.translate.confirm))])])]),e._v(" "),s("v-modal",{attrs:{show:e.showTableModal,effect:"fade",width:"748"}},[s("div",{staticClass:"modal-header iconModal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[s("h5",{staticClass:"modal-title"},[e._v("报表设置")])]),e._v(" "),s("div",{staticClass:"modal-body iconModal-body",staticStyle:{padding:"0",height:"370px"},attrs:{slot:"modal-body"},slot:"modal-body"},[s("tableset",{ref:"tableset",attrs:{appId:e.appId}})],1),e._v(" "),s("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[s("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(t){e.showTableModal=!1}}},[e._v("取消")]),e._v(" "),s("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:e._saveTableSet}},[e._v("确定")])])])],1)},staticRenderFns:[]};var T=s("VU/8")(y,C,!1,function(e){s("BlTJ")},null,null).exports,B=(s("wvr1"),s("Gvie")),k={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container-fluid",attrs:{id:"joinRolePage",tabindex:"1"}},[s("div",{staticClass:"head text-center"},[s("div",{staticClass:"pull-left back-div"},[s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("arrow_back"))},on:{click:e._back}},[e._v("arrow_back")])]),e._v(" "),s("div",{staticClass:"flow-title"},[e._m(0),e._v(" "),s("a",{attrs:{href:"javascript:;"}},[e.curForm.formSettingId?s("span",[e._v("关联表单："+e._s(e.curForm.formSettingName))]):s("span",[e._v(e._s(e.translate.relevanceTip))])])]),e._v(" "),s("div",{staticClass:"pull-right opt-div"},[s("a",{staticClass:"opt-btn",attrs:{href:"javascript:;"},on:{click:e._back}},[e._v("取消")]),e._v(" "),s("button",{staticClass:"btn save",on:{click:e._saveJoinSet}},[e._v("保存")])])]),e._v(" "),s("div",{staticClass:"join-set-content"},[s("GeminiScrollbar",{staticClass:"info-container",style:e.setColStyle,attrs:{scrollY:!1,autoshow:!0}},[s("div",{staticClass:"col first-col"},[s("div",{staticClass:"owner-header"},[s("div",{staticClass:"form-group clear-bord-bottom"},[s("i",{staticClass:"maticon pull-left app-icon white-color",domProps:{innerHTML:e._s(e.icons("label"))}},[e._v("label")]),e._v(" "),s("div",{staticClass:"form-group-input pull-left"},[s("label",{staticClass:"name-label light-white-color"},[e._v("表单所属人名称")]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.ownerData.name,expression:"ownerData.name"}],staticClass:"form-control name-input white-color border-bottom-white",attrs:{type:"text",disabled:e.isConfig,maxlength:"25"},domProps:{value:e.ownerData.name},on:{change:e._changeNameInput,input:function(t){t.target.composing||e.$set(e.ownerData,"name",t.target.value)}}}),e._v(" "),e.nameChangeMsg?s("p",{staticClass:"name-error-tip text-center"},[e._v(e._s(e.nameChangeMsg))]):e._e()])]),e._v(" "),e.isConfig?e._e():s("div",{staticClass:"input-group allow-write-multiple-form"},[s("span",{on:{click:e._allowWriteMultipleForm}},[e.multiForm?s("i",{staticClass:"maticon role-icon white-color",domProps:{innerHTML:e._s(e.icons("check_box"))}},[e._v("check_box")]):s("i",{staticClass:"maticon role-icon white-color",domProps:{innerHTML:e._s(e.icons("check_box_outline_blank"))}},[e._v("check_box_outline_blank")])]),e._v(" "),s("span",{staticClass:"role-name white-color"},[e._v("允许填写多个表单")])])]),e._v(" "),s("div",{staticClass:"form-group clear-bord-bottom"},[s("div",{staticClass:"owner-read-write-header",style:{height:e.isConfig?"85px":"50px"}},[s("i",{staticClass:"maticon app-icon white-color",domProps:{innerHTML:e._s(e.icons("visibility"))}},[e._v("visibility")]),e._v(" "),s("label",{staticClass:"read-write-label light-white-color"},[e._v("读写权限3")]),e._v(" "),e.isConfig?s("div",{staticClass:"form-group-input pull-right",staticStyle:{"margin-right":"16px"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.owenrSearchName,expression:"owenrSearchName"}],staticClass:"form-control search-input white-color border-bottom-white",attrs:{type:"text",placeholder:"请输入需要设置权限的字段名称"},domProps:{value:e.owenrSearchName},on:{input:function(t){t.target.composing||(e.owenrSearchName=t.target.value)}}})]):e._e()]),e._v(" "),e.componentsCheckAllCount>0?s("div",{staticClass:"batch-head owner-batch-head"},[s("span",{staticClass:"batch-tip light-white-color"},[e._v("已选 "+e._s(e.componentsCheckAllCount)+" 项，设置为")]),e._v(" "),s("v-select",{attrs:{options:e.operatorData,"options-value":"id","options-label":"name"},on:{afterSelected:e._afterSelectedOwner}}),e._v(" "),s("button",{staticClass:"btn pull-right sure clearBtnBorder white-color",on:{click:function(t){return e._batchSure("owner")}}},[e._v("确定")])],1):e._e(),e._v(" "),s("div",{staticClass:"owner-read-write-content",style:"max-height:"+e.ownerContentHeight+"px"},[e.componentsCheckAllCount>0?s("div",{staticClass:"batch-head"},[s("span",{staticClass:"batch-tip light-white-color"},[e._v("已选 "+e._s(e.componentsCheckAllCount)+" 项，设置为")]),e._v(" "),s("v-select",{attrs:{options:e.operatorData,"options-value":"id","options-label":"name"},on:{afterSelected:e._afterSelectedOwner}}),e._v(" "),s("button",{staticClass:"btn pull-right sure clearBtnBorder white-color",on:{click:function(t){return e._batchSure("owner")}}},[e._v("确定")])],1):e._e(),e._v(" "),s("div",{staticClass:"role-list",style:{"padding-top":e.isConfig?"15px":""}},[s("div",{staticClass:"role-list-item margin-bottom-5px"},[s("div",{staticClass:"margin-left-70px box_flex box_between"},[s("div",{staticClass:"input-group half"},[s("span",{on:{click:function(t){return e._changeCheckState(e.components,e.componentsCheckAllCount,"owner")}}},[0===e.componentsCheckAllCount?s("i",{staticClass:"maticon role-icon white-color",domProps:{innerHTML:e._s(e.icons("check_box_outline_blank"))}},[e._v("check_box_outline_blank")]):e.componentsCheckAllCount===e.components.length?s("i",{staticClass:"maticon role-icon white-color",domProps:{innerHTML:e._s(e.icons("check_box"))}},[e._v("check_box")]):s("i",{staticClass:"maticon role-icon white-color",domProps:{innerHTML:e._s(e.icons("indeterminate_check_box"))}},[e._v("indeterminate_check_box")])]),e._v(" "),s("span",{staticClass:"role-name white-color"},[e._v("全选")])]),e._v(" "),e.roleSetting&&"STUDENT"===e.roleSetting.type?e._e():s("div",{staticClass:"input-group half"},[s("span",{on:{click:function(t){return e._changeExportAll(e.ownerData)}}},[0===e.ownerData.exportNum?s("i",{staticClass:"maticon role-icon white-color",domProps:{innerHTML:e._s(e.icons("check_box_outline_blank"))}},[e._v("check_box_outline_blank")]):e.ownerData.exportNum===e.ownerData.dataAuthorities.length?s("i",{staticClass:"maticon role-icon white-color",domProps:{innerHTML:e._s(e.icons("check_box"))}},[e._v("check_box")]):s("i",{staticClass:"maticon role-icon white-color",domProps:{innerHTML:e._s(e.icons("indeterminate_check_box"))}},[e._v("indeterminate_check_box")])]),e._v(" "),s("span",{staticClass:"role-name white-color"},[e._v("全部允许导出")])])])]),e._v(" "),e._l(e.components,function(t,i){return t.title.indexOf(e.owenrSearchName)>=0?s("div",{key:i,staticClass:"role-list-item"},[s("div",{staticClass:"margin-left-70px"},[s("div",{staticClass:"col-xs-5"},[s("div",{staticClass:"input-group"},[s("span",{on:{click:function(e){t.checked=!t.checked}}},[t.checked?s("i",{staticClass:"maticon role-icon white-color",domProps:{innerHTML:e._s(e.icons("check_box"))}},[e._v("check_box")]):s("i",{staticClass:"maticon role-icon white-color",domProps:{innerHTML:e._s(e.icons("check_box_outline_blank"))}},[e._v("check_box_outline_blank")])]),e._v(" "),s("span",{staticClass:"data-authorities-name white-color",attrs:{title:t.title}},[e._v(e._s(t.title))])])]),e._v(" "),0===e.componentsCheckAllCount?s("div",{staticClass:"col-xs-7"},[e._l(e.operatorData,function(i,a){return i.coms.indexOf(t.componentType)>=0?s("span",{key:a,staticClass:"operator",class:e._getAuthorityOf(t,e.ownerData)===i.id?"active":"",on:{click:function(s){return e._setAuthorityOf(t,i.id,e.ownerData)}}},[e._v(e._s(i.name))]):s("span",{staticClass:"operator disabled"},[e._v(e._s(i.name))])}),e._v(" "),e.roleSetting&&"STUDENT"===e.roleSetting.type?e._e():s("span",{staticClass:"operator",class:e.ownerData.dataAuthorities[i].exportable?"active":"",on:{click:function(t){return e._setCanExport(e.ownerData,i)}}},[e._v("允许导出")])],2):e._e()])]):e._e()})],2)])])]),e._v(" "),e._l(e.palyers,function(t,i){return s("div",{key:i,staticClass:"col other-col"},[s("div",{staticClass:"form-group"},[s("i",{staticClass:"maticon pull-left app-icon black-color",domProps:{innerHTML:e._s(e.icons("label"))}},[e._v("label")]),e._v(" "),s("div",{staticClass:"form-group-input pull-left"},[s("label",{staticClass:"name-label light-black-color"},[e._v("参与者名称")]),e._v(" "),e.isConfig?e._e():s("i",{staticClass:"maticon pull-right more-icon black-color dropdown-toggle",attrs:{"data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"true"},domProps:{innerHTML:e._s(e.icons("more_vert"))}},[e._v("more_vert")]),e._v(" "),s("ul",{staticClass:"dropdown-menu more-opt-menu"},[s("li",{on:{click:function(t){return e._deletePlayers(i)}}},[s("a",{attrs:{href:"#"}},[e._v("删除")])])]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.palyers[i].palyerForm.name,expression:"palyers[i].palyerForm.name"}],staticClass:"form-control name-input border-bottom-blue black-color",attrs:{type:"text",disabled:e.isConfig,maxlength:"25"},domProps:{value:e.palyers[i].palyerForm.name},on:{change:e._changeNameInput,input:function(t){t.target.composing||e.$set(e.palyers[i].palyerForm,"name",t.target.value)}}}),e._v(" "),e.palyers[i].playerName?s("p",{staticClass:"name-error-tip text-center"},[e._v(e._s(e.palyers[i].playerName))]):e._e()])]),e._v(" "),s("div",{staticClass:"form-group"},[s("i",{staticClass:"maticon pull-left app-icon black-color",domProps:{innerHTML:e._s(e.icons("call_split"))}},[e._v("call_split")]),e._v(" "),s("div",{staticClass:"form-group-input pull-left"},[s("label",{staticClass:"name-label light-black-color"},[e._v("分配方式")]),e._v(" "),s("div",{staticClass:"distribution-select"},[s("v-select",{attrs:{autoSelect:!1,options:e.distributaryData,"options-value":"id","options-label":"name","data-index":i,disabled:e.isConfig},on:{afterSelected:e._afterSelectedDis},model:{value:e.palyers[i].palyerForm.distributary,callback:function(t){e.$set(e.palyers[i].palyerForm,"distributary",t)},expression:"palyers[i].palyerForm.distributary"}})],1)])]),e._v(" "),"byTeacher"===e.palyers[i].palyerForm.distributary||"byTutor"==e.palyers[i].palyerForm.distributary||""==e.palyers[i].palyerForm.distributary||e.isConfig?e._e():s("div",{staticClass:"form-group clear-padding-bottom clear-bord-bottom"},[s("div",{staticClass:"role-set-head"},[s("i",{staticClass:"maticon pull-left app-icon black-color",domProps:{innerHTML:e._s(e.icons("people"))}},[e._v("people")]),e._v(" "),s("div",{staticClass:"form-group-input pull-left",staticStyle:{height:"35px"}},[s("label",{staticClass:"name-label light-black-color"},[e._v("角色设置")]),e._v(" "),"byClass"===e.palyers[i].palyerForm.distributary||e.palyers[i].roleEditing||"byBuilding"===e.palyers[i].palyerForm.distributary||"byParty"===e.palyers[i].palyerForm.distributary?e._e():s("span",{staticClass:"creat-new-role blue-color",on:{click:function(t){return e._creatNewRole(i)}}},[e._v("创建新的角色")])])])]),e._v(" "),s("div",{staticClass:"form-group clear-padding-bottom clear-bord-bottom fiexd-header"},[s("div",{staticClass:"participant-read-write-header",style:{height:e.isConfig?"85px":"50px"}},[s("i",{staticClass:"maticon app-icon black-color",domProps:{innerHTML:e._s(e.icons("visibility"))}},[e._v("visibility")]),e._v(" "),s("label",{staticClass:"read-write-label light-black-color"},[e._v("读写权限1")])])]),e._v(" "),s("div",{staticClass:"form-group clear-padding-bottom clear-bord-bottom fiexd-batch-head"},[s("div",{staticClass:"participant-read-write-header",style:{height:e.isConfig?"85px":"50px"}},[s("i",{staticClass:"maticon app-icon black-color",domProps:{innerHTML:e._s(e.icons("cloud"))}},[e._v("cloud")]),e._v(" "),s("label",{staticClass:"read-write-label light-black-color"},[e._v("列表默认显示的控件")])]),e._v(" "),e.palyers[i].curComponentsCount>0?s("div",{staticClass:"batch-head"},[s("span",{staticClass:"batch-tip light-black-color"},[e._v("已选 "+e._s(e.palyers[i].curComponentsCount)+" 项，设置为")]),e._v(" "),s("v-select",{attrs:{options:e.operatorData,"options-value":"id","options-label":"name","data-index":i},on:{afterSelected:e._afterSelectedOperator}}),e._v(" "),s("button",{staticClass:"btn pull-right sure clearBtnBorder blue-color",on:{click:function(t){return e._batchSure("participant",i)}}},[e._v("确定")])],1):e._e()]),e._v(" "),s("div",{staticClass:"join-role-scroll-area",staticStyle:{"padding-bottom":"220px"},style:{height:"byTutor"!==e.palyers[i].palyerForm.distributary&&"byTeacher"!==e.palyers[i].palyerForm.distributary&&""!=e.palyers[i].palyerForm.distributary?e.joinRoleScrollAreaHeight+"px":e.noRoleSetAfaterHeight+"px"},attrs:{id:"joinRoleScrollArea"+i,"data-id":i}},["byTutor"!==e.palyers[i].palyerForm.distributary&&"byTeacher"!==e.palyers[i].palyerForm.distributary&&""!=e.palyers[i].palyerForm.distributary?s("div",{staticClass:"form-group clear-padding-bottom",staticStyle:{"z-index":"2 !important"}},[s("div",{staticClass:"role-set-content",style:"max-height:"+e.roleSetContentHeight+"px",attrs:{id:"roleContent"+i}},[e.palyers[i].roleEditing?s("div",{staticClass:"creat-role-input"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.palyers[i].newRoleName,expression:"palyers[i].newRoleName"},{name:"focus",rawName:"v-focus"}],staticClass:"form-control name-input border-bottom-blue black-color padding-right-70px",attrs:{type:"text",maxlength:"25",placeholder:"应用名称+参与者名称+管理员"},domProps:{value:e.palyers[i].newRoleName},on:{focus:function(t){return e._newRowInputFocus(i)},input:function(t){t.target.composing||e.$set(e.palyers[i],"newRoleName",t.target.value)}}}),e._v(" "),s("div",{staticClass:"pull-right creat-btn-group"},[s("button",{staticClass:"btn creat-cancle clearBtnBorder",on:{click:function(t){e.palyers[i].roleEditing=!1}}},[e._v("取消")]),e._v(" "),s("button",{staticClass:"btn creat-sure blue-color clearBtnBorder",on:{click:function(t){return e._saveNewRole(e.palyers[i].newRoleName,i)}}},[e._v("确定")])]),e._v(" "),e.palyers[i].roleEditing?s("p",{staticClass:"errorMsg",class:e.palyers[i].roleAddErrorMsg?"show":""},[e._v(e._s(e.palyers[i].roleAddErrorMsg))]):e._e()]):s("div",{directives:[{name:"show",rawName:"v-show",value:!e.isConfig,expression:"!isConfig"}],staticClass:"form-group-input",staticStyle:{margin:"0 0 15px 72px"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.palyers[i].roleSetSearchName,expression:"palyers[i].roleSetSearchName"}],staticClass:"form-control search-input border-bottom-blue black-color",attrs:{type:"text",placeholder:"搜索角色名称"},domProps:{value:e.palyers[i].roleSetSearchName},on:{input:function(t){t.target.composing||e.$set(e.palyers[i],"roleSetSearchName",t.target.value)}}})]),e._v(" "),e.isConfig?e._e():s("div",{staticClass:"role-list",attrs:{id:"roleList"+i}},[s("div",{staticClass:"role-list-item margin-bottom-5px"},[s("div",{staticClass:"margin-left-70px"},[s("div",{staticClass:"input-group"},[s("span",{on:{click:function(t){return e._changeCheckState(e.palyers[i].roleSetData,e.palyers[i].curPlayerCount,"operators",i)}}},[0===e.palyers[i].curPlayerCount?s("i",{staticClass:"maticon role-icon light-black-color",domProps:{innerHTML:e._s(e.icons("check_box_outline_blank"))}},[e._v("check_box_outline_blank")]):e.palyers[i].curPlayerCount===e.palyers[i].roleSetData.length?s("i",{staticClass:"maticon role-icon active light-black-color",domProps:{innerHTML:e._s(e.icons("check_box"))}},[e._v("check_box")]):s("i",{staticClass:"maticon role-icon light-black-color",domProps:{innerHTML:e._s(e.icons("indeterminate_check_box"))}},[e._v("indeterminate_check_box")])]),e._v(" "),s("span",{staticClass:"role-name light-black-color"},[e._v("全选")])])])]),e._v(" "),e._l(e.palyers[i].roleSetData,function(t,a){return t.name.indexOf(e.palyers[i].roleSetSearchName)>=0?s("div",{key:a,staticClass:"role-list-item"},[s("div",{staticClass:"margin-left-70px"},[s("div",{staticClass:"input-group"},[s("span",{on:{click:function(s){return e._checkOperators(t,i)}}},[e.palyers[i].palyerForm.operators.indexOf(parseInt(t.id))>=0?s("i",{staticClass:"maticon role-icon active light-black-color",domProps:{innerHTML:e._s(e.icons("check_box"))}},[e._v("check_box")]):s("i",{staticClass:"maticon role-icon light-black-color",domProps:{innerHTML:e._s(e.icons("check_box_outline_blank"))}},[e._v("check_box_outline_blank")])]),e._v(" "),s("span",{staticClass:"role-name",class:e.palyers[i].palyerForm.operators.indexOf(parseInt(t.id))>=0?"black-color":"light-black-color",attrs:{title:t.name}},[e._v(e._s(t.name))])])])]):e._e()})],2)])]):e._e(),e._v(" "),s("div",{staticClass:"form-group clear-bord-bottom clear-padding-bottom"},[s("div",{staticClass:"participant-read-write-header",style:{height:e.isConfig?"85px":"50px"}},[s("i",{staticClass:"maticon app-icon black-color",domProps:{innerHTML:e._s(e.icons("visibility"))}},[e._v("visibility")]),e._v(" "),s("label",{staticClass:"read-write-label light-black-color"},[e._v("读写权限2")]),e._v(" "),e.isConfig?s("div",{staticClass:"form-group-input pull-right",staticStyle:{"margin-right":"16px"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.palyers[i].searchName,expression:"palyers[i].searchName"}],staticClass:"form-control search-input border-bottom-blue black-color",attrs:{type:"text",placeholder:"请输入需要设置权限的字段名称"},domProps:{value:e.palyers[i].searchName},on:{input:function(t){t.target.composing||e.$set(e.palyers[i],"searchName",t.target.value)}}})]):e._e(),e._v(" "),e.isConfig?e._e():s("div",{staticClass:"dividing-line"})]),e._v(" "),s("div",{staticClass:"participant-read-write-content",style:{"max-height":e.getContentHeight(i)},attrs:{id:"read-write-content"+i}},[e.isConfig?e._e():s("div",{staticClass:"role-list role-list-batch"},[s("div",{staticClass:"role-list-item margin-bottom-5px"},[s("div",{staticClass:"margin-left-70px"},[s("div",{staticClass:"input-group"},[s("span",{on:{click:function(t){return e._changeBatchSet(i)}}},[e.palyers[i].palyerForm.batch?s("i",{staticClass:"maticon role-icon active light-black-color",domProps:{innerHTML:e._s(e.icons("check_box"))}},[e._v("check_box")]):s("i",{staticClass:"maticon role-icon light-black-color",domProps:{innerHTML:e._s(e.icons("check_box_outline_blank"))}},[e._v("check_box_outline_blank")])]),e._v(" "),s("span",{staticClass:"role-name light-black-color"},[e._v("允许批量操作")])])])]),e._v(" "),s("div",{staticClass:"batch-dividing-line"})]),e._v(" "),e.palyers[i].curComponentsCount>0?s("div",{staticClass:"batch-head"},[s("span",{staticClass:"batch-tip light-black-color"},[e._v("已选 "+e._s(e.palyers[i].curComponentsCount)+" 项，设置为")]),e._v(" "),s("v-select",{attrs:{options:e.operatorData,"options-value":"id","options-label":"name","data-index":i},on:{afterSelected:e._afterSelectedOperator}}),e._v(" "),s("button",{staticClass:"btn pull-right sure clearBtnBorder blue-color",on:{click:function(t){return e._batchSure("participant",i)}}},[e._v("确定")])],1):e._e(),e._v(" "),s("div",{staticClass:"role-list set-margin-top-15px"},[s("div",{staticClass:"role-list-item margin-bottom-5px"},[s("div",{staticClass:"margin-left-70px box_flex box_between"},[s("div",{staticClass:"input-group half"},[s("span",{on:{click:function(t){return e._changeCheckState(e.palyers[i].AllComponents,e.palyers[i].curComponentsCount,"dataAuthorities",i)}}},[0===e.palyers[i].curComponentsCount?s("i",{staticClass:"maticon role-icon light-black-color",domProps:{innerHTML:e._s(e.icons("check_box_outline_blank"))}},[e._v("check_box_outline_blank")]):e.palyers[i].curComponentsCount===e.palyers[i].AllComponents.length?s("i",{staticClass:"maticon role-icon active light-black-color",domProps:{innerHTML:e._s(e.icons("check_box"))}},[e._v("check_box")]):s("i",{staticClass:"maticon role-icon light-black-color",domProps:{innerHTML:e._s(e.icons("indeterminate_check_box"))}},[e._v("indeterminate_check_box")])]),e._v(" "),s("span",{staticClass:"role-name light-black-color"},[e._v("全选")])]),e._v(" "),e.roleSetting&&"STUDENT"===e.roleSetting.type?e._e():s("div",{staticClass:"input-group half"},[s("span",{on:{click:function(t){return e._changeExportAll(e.palyers[i].palyerForm)}}},[0===e.palyers[i].palyerForm.exportNum?s("i",{staticClass:"maticon role-icon light-black-color",domProps:{innerHTML:e._s(e.icons("check_box_outline_blank"))}},[e._v("check_box_outline_blank")]):e.palyers[i].palyerForm.exportNum===e.palyers[i].palyerForm.dataAuthorities.length?s("i",{staticClass:"maticon role-icon active light-black-color",domProps:{innerHTML:e._s(e.icons("check_box"))}},[e._v("check_box")]):s("i",{staticClass:"maticon role-icon light-black-color",domProps:{innerHTML:e._s(e.icons("indeterminate_check_box"))}},[e._v("indeterminate_check_box")])]),e._v(" "),s("span",{staticClass:"role-name light-black-color"},[e._v("全部允许导出")])])])]),e._v(" "),e._l(e.palyers[i].AllComponents,function(t,a){return t.title.indexOf(e.palyers[i].searchName)>=0?s("div",{key:a,staticClass:"role-list-item"},[s("div",{staticClass:"margin-left-70px"},[s("div",{staticClass:"col-xs-5"},[s("div",{staticClass:"input-group"},[s("span",{on:{click:function(s){return e._changeComSelect(t,i)}}},[t.checked?s("i",{staticClass:"maticon role-icon active light-black-color",domProps:{innerHTML:e._s(e.icons("check_box"))}},[e._v("check_box")]):s("i",{staticClass:"maticon role-icon light-black-color",domProps:{innerHTML:e._s(e.icons("check_box_outline_blank"))}},[e._v("check_box_outline_blank")])]),e._v(" "),s("span",{staticClass:"data-authorities-name",class:t.checked?"black-color":"light-black-color",attrs:{title:t.title}},[e._v(e._s(t.title))])])]),e._v(" "),0===e.palyers[i].curComponentsCount?s("div",{staticClass:"col-xs-7"},[e._l(e.operatorData,function(a,n){return a.coms.indexOf(t.componentType)>=0?s("span",{key:n,staticClass:"operator",class:e._getAuthorityOf(t,e.palyers[i].palyerForm)===a.id?"active":"",on:{click:function(s){return e._setAuthorityOf(t,a.id,e.palyers[i].palyerForm)}}},[e._v(e._s(a.name))]):s("span",{staticClass:"operator disabled"},[e._v(e._s(a.name))])}),e._v(" "),e.roleSetting&&"STUDENT"===e.roleSetting.type?e._e():s("span",{staticClass:"operator",class:e.palyers[i].palyerForm.dataAuthorities[a].exportable?"active":"",on:{click:function(t){return e._setCanExport(e.palyers[i].palyerForm,a)}}},[e._v("允许导出")])],2):e._e()])]):e._e()})],2)])]),e._v(" "),s("div",{staticClass:"form-group clear-bord-bottom clear-padding-bottom"},[s("div",{},[s("i",{staticClass:"maticon app-icon black-color",domProps:{innerHTML:e._s(e.icons("cloud"))}},[e._v("cloud")]),e._v(" "),s("label",{staticClass:"read-write-label light-black-color"},[e._v("列表默认显示的控件")]),e._v(" "),s("div",{staticClass:"form-group-input pull-right",staticStyle:{"margin-right":"16px"}})]),e._v(" "),s("div",{staticClass:"participant-read-write-content",style:{"max-height":e.getContentHeight(i)},attrs:{id:"read-write-content"+i}},[s("div",{staticClass:"role-list "},e._l(e.palyers[i].AllComponents,function(t,a){return t.title.indexOf(e.palyers[i].searchName)>=0?s("div",{key:a,staticClass:"role-list-item"},[s("div",{staticClass:"margin-left-70px"},[s("div",{staticClass:"col-xs-5"},[s("div",{staticClass:"input-group"},[s("span",{on:{click:function(s){e._changeComSelectXian(t,i),e._changeCheckStateXian(e.palyers[i].AllComponents,e.palyers[i].curComponentsCountXian,"defaultVisibleTableColumns",i)}}},[t.checkedXian?s("i",{staticClass:"maticon role-icon active light-black-color",domProps:{innerHTML:e._s(e.icons("check_box"))}},[e._v("check_box")]):s("i",{staticClass:"maticon role-icon light-black-color",domProps:{innerHTML:e._s(e.icons("check_box_outline_blank"))}},[e._v("check_box_outline_blank")])]),e._v(" "),s("span",{staticClass:"data-authorities-name",class:t.checkedXian?"black-color":"light-black-color",attrs:{title:t.title}},[e._v(e._s(t.title))])])])])]):e._e()}),0)])])])])}),e._v(" "),e.isConfig?e._e():s("div",{staticClass:"add-role"},[s("button",{staticClass:"add-btn clearBtnBorder",on:{click:e._addRole}},[e._v("添加参与者")])])],2)],1)])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"input-group"},[t("label",{staticClass:"page-name"},[this._v("参与者设置")])])}]};var w=function(e){s("1m23")},E=s("VU/8")(B.a,k,!1,w,null,null).exports;n.a.component("app-info",f),n.a.component("FormSetManage",v.default),n.a.component("FlowSetManage",g.default),n.a.component("FormEngineInfo",T),n.a.component("JoinRoleSetManage",E);n.a.component("app-info",f),n.a.component("FormSetManage",v.default),n.a.component("FlowSetManage",g.default),n.a.component("FormEngineInfo",T),n.a.component("JoinRoleSetManage",E);var L={props:{role:""},created:function(){var e=localStorage.getItem("lang");Object(c.g)(e)&&(this.lang=e),this._initDepartmentList()},data:function(){return{studentBie:!1,departmentList:[],departmentId:0,appList:[],typeList:{student:{userType:"1",bigType:"student",dragging:!1,types:[]},teacher:{userType:"2",bigType:"teacher",dragging:!1,types:[]},freshman:{userType:"3",bigType:"freshman",dragging:!1,types:[]},instructor:{userType:"4",bigType:"instructor",dragging:!1,types:[]}},dragData:{name:"",icon:""},dragType:{},appInfo:{w:0,h:0},newType:{name:"",userType:""},miniRoutes:"appManage",curCheckRoutes:"",dragContainer:null,dragTarget:null,dropTarget:null,editType:"",newApp:{name:"",imgPath:"school",imgType:1,remark:"",settingType:"",appTypeId:"",departmentId:"",sort:0},appCats:[{appTypeId:"1",settingType:"WORKFLOW",name:"workflow"},{appTypeId:"2",settingType:"LINK",name:"link"},{appTypeId:"3",settingType:"FORM",name:"form"}],newAppName:"",curApp:null,modelId:"",initWay:"create",showTypeModal:!1,showAddModal:!1,selectAppType:"1",addAppType:"",parentPage:"",searchName:"",businessId:null,appName:"",showImportModal:!1,clearInputShow:!0,selectFileName:"",fileData:"",formData:null,appUserType:"",lang:"zh-cn"}},computed:{translate:function(){return Object(c.g)(this.lang).appManage}},mounted:function(){var e=this;this.$dragging.$on("dragged",function(t){var s=t.draged;t.value;e.dragType=s})},methods:{_saveTypeOrder:function(e){var t=this;e.types.forEach(function(e,t){e.sort=t}),e.dragging?Object(c.e)({url:"/api/app/type/sort",type:"put",data:e.types,success:function(s){e.dragging=!1,s.state?t.$toast("排序成功！"):t.$toast(s.message)}}):e.dragging=!0},_containsSearchName:function(e){var t=this,s=!1;return e.forEach(function(e){(e.name&&e.name.indexOf(t.searchName)>=0||e.app&&e.app.name.indexOf(t.searchName)>=0)&&(s=!0)}),s},_updateApp:function(e){this.curApp.name=e.name,this.curApp.imgPath=e.imgPath,this.curApp.background=e.background},_initDepartmentList:function(){if("manager"===this.role)this.departmentId="",this._initPopular(),this._initTypes("1"),this._initTypes("2"),this._initTypes("3"),this._initTypes("4");else{var e=this;Object(c.e)({url:"/api/currentUser/approverDepartment?rule=应用管理",type:"get",success:function(t){t.state?(e.departmentList=t.data,e.departmentId=t.data[0]?t.data[0].id:""):e.$toast(t.message)}})}},_changeDepartment:function(e){this.departmentId&&(this._initTypes("1"),this._initTypes("2"),this._initTypes("3"),this._initTypes("4"))},_initPopular:function(){var e=this;Object(c.e)({url:"/api/app/popular",type:"get",success:function(t){t.state?e.appList=t.data:e.$toast(t.message)}})},_initTypes:function(e){var t=this,s=[];"1"===e?s=t.typeList.student:"2"===e?s=t.typeList.teacher:"3"===e?s=t.typeList.freshman:"4"===e&&(s=t.typeList.instructor),s.types=[],Object(c.e)({url:"/api/app/type",type:"get",data:{userType:e},success:function(i){i.state?(i.data.forEach(function(e,t){var i={};for(var a in e)n.a.set(i,a,e[a]);n.a.set(i,"appList",[]),s.types.push(i)}),s.types=t._resort(s.types),t._initAppList(t.departmentId,e)):t.$toast(i.message)}})},_resort:function(e){var t=[];return e.forEach(function(e){(e.sort||0)>=t.length?t.splice(t.length,0,e):t.splice(e.sort,0,e)}),t.forEach(function(e,t){e.sort=t}),t},_initAppList:function(e,t){var s=this,i=null;"1"===t?i=s.typeList.student:"2"===t?i=s.typeList.teacher:"3"===t?i=s.typeList.freshman:"4"===t&&(i=s.typeList.instructor),Object(c.e)({url:"/api/app",type:"get",data:{departmentId:e,userType:t},success:function(e){e.state?e.data.forEach(function(e,t){i.types.forEach(function(t,s){t.id===e.appType.id&&t.appList.push(e)})}):s.$toast(e.message)}})},_draggable:function(){return!(!this.dropTarget||!this.dragTarget||"manager"!==this.role)&&((!this.dragTarget.attr("data-bigtype")||!this.dropTarget.attr("data-bigtype")||this.dropTarget.attr("data-bigtype")===this.dragTarget.attr("data-bigtype"))&&("total"===this.dropTarget.attr("data-type")||"total"!==this.dragTarget.attr("data-type")))},_dragStart:function(e){this.dragTarget=o()(e.target).parents(".app"),this.dragTarget.addClass("dragging");var t=0;if("total"===this.dragTarget.attr("data-type"))t=this.dragTarget.attr("data-key"),this.dragData=this.appList[t];else{var s=this.dragTarget.attr("data-bigtype"),i=this.dragTarget.attr("data-index");t=this.dragTarget.attr("data-key"),this.dragData=this.typeList[s].types[i].appList[t]}},_dragEnd:function(e){var t=this;if(this._draggable()){var s,i,n,r,c,l="",u="";if("total"===this.dropTarget.attr("data-type"))if(s=this.dragTarget.attr("data-key"),i=this.dropTarget.attr("data-key"),l=parseInt(this.dragTarget.attr("data-id")),c=JSON.parse(a()(this.dragData)),"total"===this.dragTarget.attr("data-type"))this.appList.splice(s,1),this.appList.splice(i,0,c),this._saveOrder(this,"popular");else{var p=!1;this.appList.forEach(function(e,t){e.app.id===l&&(p=!0)}),p||this._addPopular(i||this.appList.length,function(e){t.appList.splice(i,0,e)})}else s=parseInt(this.dragTarget.attr("data-key")),n=parseInt(this.dragTarget.attr("data-index")),i=parseInt(this.dropTarget.attr("data-key")),r=parseInt(this.dropTarget.attr("data-index")),u=this.dragTarget.attr("data-bigtype"),c=JSON.parse(a()(this.dragData)),this.typeList[u].types[n].appList.splice(s,1),this.typeList[u].types[r].appList.splice(i,0,c),this._saveOrder(this.typeList[u].types[n]),n!==r&&this._saveOrder(this.typeList[u].types[r])}this.dragTarget.removeClass("dragging"),o()(".drag.active").removeClass("active"),this.dragTarget=null,this.dropTarget=null},_dragOver:function(e){this._draggable()&&e.preventDefault()},_dragEnter:function(e){o()(e.target).is(".drag")?this.dropTarget=o()(e.target):this.dropTarget=o()(e.target).parents(".drag"),o()(".drag.active").removeClass("active"),this._draggable()&&(o()(".drag.active").removeClass("active"),this.dropTarget.addClass("active"))},_dragLeave:function(e){this.dropTarget.removeClass("active")},_saveOrder:function(e,t){var s=this;e.appList.forEach(function(s,i){s.sort=i,"popular"!==t&&(s.appType={id:e.id,name:e.name,sort:e.sort,userType:e.userType})});var i="";i="popular"===t?"/api/app/popular/sort":"/api/app/sort",Object(c.e)({url:i,type:"put",data:e.appList,success:function(e){e.state||s.$toast(e.message)}})},_editAppType:function(e){this.editType=e.id,this.newAppName=e.name},_saveAppType:function(e,t){var s=this;Object(c.e)({url:"/api/app/type/"+e.id,type:"put",data:{id:e.id,name:this.newAppName,userType:e.userType,sort:e.sort},success:function(t){t.state?(s.editType="",e.name=s.newAppName):s.$toast(t.message)}})},_removeAppType:function(e,t,s){var i=this;e.appList.length>0?this.$toast(this.translate.appExistTip):confirm(this.translate.appTypeRemoveConfirm)&&(this.$waiting.show(),Object(c.e)({url:"/api/app/type/"+e.id,type:"delete",success:function(e){e.state?(s.types.splice(t,1),i.$toast("",0,"check")):i.$toast(e.message)}}).always(function(){i.$waiting.close()}))},_createAppType:function(){var e=this;if(""!==this.newType.name)if(""!==this.newType.userType){var t=null;for(var s in this.typeList)this.typeList[s].userType===this.newType.userType&&(t=this.typeList[s]);this.$waiting.show(),Object(c.e)({url:"/api/app/type",type:"post",data:{name:this.newType.name,userType:this.newType.userType,sort:t.types.length},success:function(s){s.state?(e.showTypeModal=!1,t.types.push({id:s.data.id,name:e.newType.name,appList:[],userType:e.newType.userType,sort:0}),e.$toast("",0,"check")):e.$toast(s.message)}}).always(function(){e.$waiting.close()})}else this.$toast(this.translate.appAddTip2);else this.$toast(this.translate.appAddTip1)},_removeApp:function(e,t,s){var i=this,a="";a=s?"/api/app/popular/"+e[t].id:"/api/app/"+e[t].id,confirm(this.translate.appRemoveConfirm)&&Object(c.e)({url:a,type:"delete",success:function(s){s.state?(e.splice(t,1),i._initPopular(),i.$toast("",0,"check")):i.$toast(s.message)}})},_editApp:function(e,t){var s=this;if("department"===this.role)if(e)this.$waiting.show(),this.curApp=e,this.appName=this.curApp.name,e.appType&&e.appType.userType&&(this.appUserType=e.appType.userType),"WORKFLOW"===e.setting.type?this.miniRoutes="appInfo":"LINK"===e.setting.type?(this.miniRoutes="link",this.curCheckRoutes="link"):(this.miniRoutes="formEngine",this.curCheckRoutes="formEngine"),this.$waiting.close();else{if(""===this.newApp.name||!this.newApp.settingType||!this.newApp.appTypeId)return void this.$toast(this.translate.editTip2);this.$waiting.show(),this.appName=this.newApp.name,this.newApp.departmentId=this.departmentId,this.newApp.sort=t.appList.length,this.showAddModal=!1,Object(c.e)({url:"/api/app",type:"post",data:this.newApp,success:function(e){e.state?(s.appUserType=e.data.appType.userType,s.curApp={id:e.data.id,name:e.data.name,imgPath:e.data.imgPath,setting:{type:e.data.setting.type}},setTimeout(function(){"WORKFLOW"===e.data.setting.type?s.miniRoutes="appInfo":"LINK"===e.data.setting.type?(s.miniRoutes="link",s.curCheckRoutes="link"):(s.miniRoutes="formEngine",s.curCheckRoutes="formEngine")},600),t.appList.push(s.curApp),s.$toast("",0,"check")):s.$toast(e.message)}}).always(function(){s.$waiting.close()}),this.curApp=null}},_addPopular:function(e,t){var s=this;Object(c.e)({url:"/api/app/popular",type:"post",data:{app:this.dragData,sort:e},success:function(e){e.state?t(e.data):s.$toast(s.translate.appAddTip3)}})},_saveFormInfo:function(e){var t=this,s="";s=this.businessId?"/api/app/"+this.curApp.id+"/publishBusiness/"+this.businessId+"/formSetting":"/api/apps/"+this.curApp.id+"/settings/forms",this.$waiting.show(),Object(c.e)({url:s,type:"put",data:e,success:function(e){e.state?(t.$toast(t.translate.saveSuccessTip1,0,"check"),t._backToPage(t.parentPage)):t.$toast(e.message)}}).always(function(){t.$waiting.close()})},_saveFlowInfo:function(e){var t=this,s="";s=this.businessId?"/api/app/"+this.curApp.id+"/publishBusiness/"+this.businessId+"/flowSetting":"/api/apps/"+this.curApp.id+"/settings/flows",this.$waiting.show(),Object(c.e)({url:s,type:"put",data:e,success:function(e){e.state?(t.$toast(t.translate.saveSuccessTip2,0,"check"),t._backToPage("appInfo")):t.$toast(e.message)}}).always(function(){t.$waiting.close()})},_savePlayers:function(e){var t=this,s="";s=this.businessId?"/api/app/"+this.curApp.id+"/publishBusiness/"+this.businessId+"/playerSetting":"/api/apps/"+this.curApp.id+"/settings/players",this.$waiting.show(),Object(c.e)({url:s,type:"put",data:e,success:function(e){e.state?(t.$toast(t.translate.saveSuccessTip3,0,"check"),t._backToPage("formEngine")):t.$toast(e.message)}}).always(function(){t.$waiting.close()})},_setForm:function(e,t){this.miniRoutes="formSetManage",this.parentPage=t,this.modelId=e.modelId,this.initWay=e.type,this.businessId=e.businessId,this.$emit("fullScreen",!0)},_setFlow:function(e){this.miniRoutes="flowSetManage",this.modelId=e.modelId,this.businessId=e.businessId,this.$emit("fullScreen",!0)},_setJoinRole:function(e){this.miniRoutes="joinRoleSet",this.businessId=e.businessId,this.$emit("fullScreen",!0)},_backToPage:function(e){this.miniRoutes=e,this.$emit("fullScreen",!1)},_createApp:function(){this.showAddModal=!0,o()(".app-type-content").animate({scrollTop:"0px"},100),this.newApp.name="",this.newApp.settingType="",this.newApp.appTypeId=""},_showImportModal:function(){this.showImportModal=!0,o()(".app-type-content").animate({scrollTop:"0px"},100),this.newApp.appTypeId="",this.selectFileName=this.translate.selectFile},getFile:function(e){this.formData=new FormData,this.fileData=null,this.fileData=e.target.files[0],this.formData.append("file",this.fileData),this.clearInputShow=!1,this.fileData&&(this.selectFileName=this.fileData.name,this.clearInputShow=!0)},_importApp:function(e){var t=this;if(!this.fileData)return this.$toast("请选择文件");this.newApp.appTypeId?(this.formData.append("appTypeId",this.newApp.appTypeId),this.formData.append("departmentId",this.departmentId),this.$waiting.show(),Object(c.e)({url:"/upload/app/import",dataType:"json",data:this.formData,processData:!1,contentType:!1,type:"post",success:function(s){t.showImportModal=!1,"88888"===s.code?(t.curApp={id:s.data.id,name:s.data.name,imgPath:s.data.imgPath,setting:{type:s.data.setting.type}},setTimeout(function(){"WORKFLOW"===s.data.setting.type?t.miniRoutes="appInfo":"LINK"===s.data.setting.type?(t.miniRoutes="link",t.curCheckRoutes="link"):(t.miniRoutes="formEngine",t.curCheckRoutes="formEngine")},600),e.appList.push(t.curApp),t.$toast("",0,"check")):t.$toast(s.message)}}).always(function(){t.$waiting.close()})):this.$toast(this.translate.editTip2)}},beforeDestroy:function(){this.$dragging.$off("dragged")}},A={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"app-page",class:{"container-fluid":["formSetManage","flowSetManage","joinRoleSet"].indexOf(e.miniRoutes)<0,"layout-manage":"department"!==e.role}},[s("div",{directives:[{name:"show",rawName:"v-show",value:"appManage"===e.miniRoutes,expression:"miniRoutes === 'appManage'"}],staticClass:"row",attrs:{id:"appManage"}},[s("div",{staticClass:"head"},[s("h3",{staticClass:"pull-left"},[e._v(e._s(e.translate.appManage)+"\n        "),"department"===e.role&&e.departmentId?s("v-select",{staticClass:"info-value",attrs:{options:e.departmentList,required:!0,"options-value":"id","options-label":"name","close-on-select":""},on:{afterSelected:e._changeDepartment},model:{value:e.departmentId,callback:function(t){e.departmentId=t},expression:"departmentId"}}):e._e()],1),e._v(" "),s("button",{staticClass:"btn pull-right import-file-btn",on:{click:e._showImportModal}},[e._v(e._s(e.translate.import))]),e._v(" "),"department"===e.role?s("button",{staticClass:"btn pull-right",on:{click:e._createApp}},[s("i",{staticClass:"maticon pull-left",domProps:{innerHTML:e._s(e.icons("create"))}}),e._v(e._s(e.translate.createApp))]):s("button",{staticClass:"btn pull-right",on:{click:function(t){e.showTypeModal=!0}}},[s("i",{staticClass:"maticon pull-left",domProps:{innerHTML:e._s(e.icons("playlist_add"))}}),e._v(e._s(e.translate.createAppType))]),e._v(" "),"department"===e.role?s("input",{directives:[{name:"model",rawName:"v-model",value:e.searchName,expression:"searchName"}],staticClass:"form-control pull-right app-search",attrs:{type:"text",placeholder:"搜索..."},domProps:{value:e.searchName},on:{input:function(t){t.target.composing||(e.searchName=t.target.value)}}}):e._e()]),e._v(" "),s("GeminiScrollbar",{staticClass:"body",attrs:{scrollX:!1}},["department"!==e.role?s("div",{staticClass:"container-fluid type-group"},[s("label",{staticClass:"pull-left type-head"},[e._v(e._s(e.translate.hot))]),e._v(" "),s("div",{staticClass:"apps-container"},[e._l(e.appList,function(t,i){return t.app.name.indexOf(e.searchName)>=0?s("div",{key:i,staticClass:"app drag",attrs:{"data-key":i,"data-id":t.id,"data-type":"total"},on:{dragover:e._dragOver,dragenter:e._dragEnter,click:function(s){return e._editApp(t)}}},[s("div",{staticClass:"active-show"}),e._v(" "),"department"!==e.role?s("i",{staticClass:"maticon remove-app",domProps:{innerHTML:e._s(e.icons("cancel"))},on:{click:function(t){return t.stopPropagation(),e._removeApp(e.appList,i,"popular")}}},[e._v("cancel")]):e._e(),e._v(" "),s("div",{staticClass:"app-icon-div",style:{background:t.app.background}},[t.app.imgType&&"1"!==t.app.imgType?"2"===t.app.imgType?s("i",{staticClass:"maticon app-icon-style theme-icon-application",class:t.app.isPublished?"":"disabled",attrs:{draggable:""},on:{dragstart:e._dragStart,dragenter:e._dragEnter,dragend:e._dragEnd}},[s("span",{staticClass:"saasicon-44px",class:["saasicon-44px-"+t.app.imgPath]})]):e._e():s("i",{staticClass:"maticon app-icon-style theme-icon-application",class:t.app.isPublished?"":"disabled",attrs:{draggable:""},domProps:{innerHTML:e._s(e.icons(t.app.imgPath||"school"))},on:{dragstart:e._dragStart,dragenter:e._dragEnter,dragend:e._dragEnd}},[e._v(e._s(t.app.imgPath||"school"))])]),e._v(" "),s("p",{staticClass:"text-center"},[e._v(e._s(t.app.name))])]):e._e()}),e._v(" "),s("div",{staticClass:"app drag add",attrs:{"data-type":"total"},on:{dragover:e._dragOver,dragenter:e._dragEnter}},[s("div",{staticClass:"active-show",staticStyle:{left:"0"}})])],2)]):e._e(),e._v(" "),e._l(e.typeList,function(t,i){return"department"===e.role&&e.departmentId||"department"!==e.role?s("div",{key:i,staticClass:"bigtype"},[s("div",{staticClass:"bigtype-header"},[s("span",{staticClass:"pull-left",staticStyle:{"margin-right":"8px"}},[s("i",{staticClass:"maticon pull-left",domProps:{innerHTML:e._s(e.icons("list"))}},[e._v("list")]),e._v(e._s(e.translate[t.bigType]))]),e._v(" "),"department"!==e.role?s("span",{staticClass:"pull-right move-icon",class:{active:t.dragging},on:{click:function(s){return e._saveTypeOrder(t)}}},[s("i",{staticClass:"maticon pull-left",staticStyle:{"margin-right":"0"},domProps:{innerHTML:e._s(e.icons("swap_vert"))}},[e._v("swap_vert")]),e._v("\n            "+e._s(t.dragging?"完成":"排序")+"\n          ")]):e._e()]),e._v(" "),e._l(t.types,function(i,a){return e._containsSearchName(i.appList)||"department"!==e.role?s("div",{directives:[{name:"show",rawName:"v-show",value:!t.dragging,expression:"!bigtype.dragging"}],key:a,staticClass:"container-fluid type-group"},[e.editType!==i.id?s("label",{staticClass:"pull-left type-head"},[e._v("\n            "+e._s(i.name)+"\n            "),"department"!==e.role?s("i",{staticClass:"maticon pull-right",domProps:{innerHTML:e._s(e.icons("cancel"))},on:{click:function(s){return s.stopPropagation(),e._removeAppType(i,a,t)}}},[e._v("cancel")]):e._e(),e._v(" "),"department"!==e.role?s("i",{staticClass:"maticon pull-right",domProps:{innerHTML:e._s(e.icons("edit"))},on:{click:function(t){return e._editAppType(i)}}},[e._v("edit")]):e._e()]):s("div",{staticClass:"pull-left type-head type-edit"},[s("div",{staticClass:"input-group"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.newAppName,expression:"newAppName"}],staticClass:"form-control type-name",attrs:{type:"text",maxlength:"16",placeholder:"请输入16字内的应用分类名称"},domProps:{value:e.newAppName},on:{input:function(t){t.target.composing||(e.newAppName=t.target.value)}}}),e._v(" "),s("span",{staticClass:"input-group-addon",on:{click:function(t){e.editType=""}}},[e._v(e._s(e.translate.cancel))]),e._v(" "),s("span",{staticClass:"input-group-addon sure",on:{click:function(t){return e._saveAppType(i,a)}}},[e._v(e._s(e.translate.sure))])])]),e._v(" "),s("div",{staticClass:"apps-container"},e._l(i.appList,function(n,r){return n.name.indexOf(e.searchName)>=0?s("div",{key:r,staticClass:"app",class:{drag:"department"!==e.role},attrs:{"data-key":r,"data-type":"type","data-index":a,"data-id":n.id,"data-bigtype":t.bigType,title:n.name},on:{dragover:e._dragOver,dragenter:e._dragEnter,click:function(t){return e._editApp(n)}}},[s("div",{staticClass:"active-show"}),e._v(" "),"department"===e.role?s("i",{staticClass:"maticon remove-app",domProps:{innerHTML:e._s(e.icons("cancel"))},on:{click:function(t){return t.stopPropagation(),e._removeApp(i.appList,r)}}},[e._v("cancel")]):e._e(),e._v(" "),s("div",{staticClass:"app-icon-div",style:{background:n.background}},[n.imgType&&"1"!==n.imgType?"2"===n.imgType?s("i",{staticClass:"maticon app-icon-style theme-icon-application",class:n.isPublished?"":"disabled",attrs:{draggable:""},on:{dragstart:e._dragStart,dragenter:e._dragEnter,dragend:e._dragEnd}},[s("span",{staticClass:"saasicon-44px",class:["saasicon-44px-"+n.imgPath]})]):e._e():s("i",{staticClass:"maticon app-icon-style theme-icon-application",class:n.isPublished?"":"disabled",attrs:{draggable:""},domProps:{innerHTML:e._s(e.icons(n.imgPath||"school"))},on:{dragstart:e._dragStart,dragenter:e._dragEnter,dragend:e._dragEnd}},[e._v(e._s(n.imgPath||"school"))])]),e._v(" "),s("p",{staticClass:"text-center"},[e._v(e._s(n.name))])]):e._e()}),0)]):e._e()}),e._v(" "),e._l(t.types,function(a,n){return"department"!==e.role?s("div",{directives:[{name:"dragging",rawName:"v-dragging",value:{item:a,list:t.types,group:i},expression:"{ item: moveType, list: bigtype.types, group: bIndex }"},{name:"show",rawName:"v-show",value:t.dragging,expression:"bigtype.dragging"}],key:n,staticClass:"container-fluid type-group dragging-div",class:{active:a.id===e.dragType.id}},[s("label",{staticClass:"pull-left type-head"},[e._v("\n            "+e._s(a.name)+"\n          ")])]):e._e()})],2):e._e()})],2),e._v(" "),s("v-modal",{attrs:{show:e.showAddModal,width:"400"}},[s("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[s("h5",{staticClass:"modal-title"},[e._v("\n          "+e._s(e.translate.createApp)+"\n        ")])]),e._v(" "),s("div",{staticClass:"modal-body container-fluid creat-app-body",staticStyle:{"max-height":"300px"},attrs:{slot:"modal-body"},slot:"modal-body"},[s("div",{staticClass:"form-group"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.newApp.name,expression:"newApp.name"}],staticClass:"form-control modal-input",attrs:{type:"text",maxlength:"25",placeholder:e.translate.createAppPlaceholder},domProps:{value:e.newApp.name},on:{input:function(t){t.target.composing||e.$set(e.newApp,"name",t.target.value)}}})]),e._v(" "),s("div",{staticClass:"type-div row"},e._l(e.appCats,function(t,i){return s("span",{key:i,staticClass:"type-span",class:e.newApp.settingType===t.settingType?"active":"",on:{click:function(s){e.newApp.settingType=t.settingType}}},[s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("done"))}}),e._v("\n            "+e._s(e.translate[t.name])+"\n          ")])}),0),e._v(" "),s("div",{staticClass:"type-div row"},[s("div",{staticClass:"app-type-text"},[e._v(e._s(e.translate.selectAppType))]),e._v(" "),s("div",{staticClass:"app-type-content"},e._l(e.typeList,function(t,i){return s("div",{key:i},e._l(t.types,function(t,i){return s("p",{key:i,staticClass:"type-p",class:e.newApp.appTypeId===t.id?"active":"",on:{click:function(s){e.newApp.appTypeId=t.id,e.addAppType=t}}},[s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("done"))}}),e._v("\n                "+e._s(t.name)+"\n              ")])}),0)}),0)])]),e._v(" "),s("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[s("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(t){e.showAddModal=!1}}},[e._v(e._s(e.translate.cancel))]),e._v(" "),s("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(t){return e._editApp(null,e.addAppType)}}},[e._v(e._s(e.translate.sure))])])]),e._v(" "),s("v-modal",{attrs:{show:e.showTypeModal,width:"460"}},[s("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[s("h5",{staticClass:"modal-title"},[e._v("\n          "+e._s(e.translate.createAppType)+"\n        ")])]),e._v(" "),s("div",{staticClass:"modal-body container-fluid",attrs:{slot:"modal-body"},slot:"modal-body"},[s("div",{staticClass:"form-group"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.newType.name,expression:"newType.name"}],staticClass:"form-control modal-input",attrs:{type:"text",maxlength:"16",placeholder:e.translate.createAppTypePlaceholder},domProps:{value:e.newType.name},on:{input:function(t){t.target.composing||e.$set(e.newType,"name",t.target.value)}}})]),e._v(" "),s("div",{staticClass:"type-div row"},e._l(e.typeList,function(t,i){return s("span",{key:i,staticClass:"type-span",class:e.newType.userType===t.userType?"active":"",on:{click:function(s){e.newType.userType=t.userType}}},[s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("done"))}}),e._v("\n            "+e._s(e.translate[t.bigType])+"\n          ")])}),0)]),e._v(" "),s("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[s("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(t){e.showTypeModal=!1}}},[e._v(e._s(e.translate.cancel))]),e._v(" "),s("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:e._createAppType}},[e._v(e._s(e.translate.sure))])])]),e._v(" "),s("v-modal",{attrs:{show:e.showImportModal,width:"400"}},[s("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[s("h5",{staticClass:"modal-title"},[e._v("\n          "+e._s(e.translate.importApp)+"\n        ")])]),e._v(" "),s("div",{staticClass:"modal-body container-fluid creat-app-body",staticStyle:{"max-height":"300px"},attrs:{slot:"modal-body"},slot:"modal-body"},[s("div",{staticClass:"button-group"},[s("button",{staticClass:"btn clearBtnBorder import-btn",attrs:{type:"button"}},[s("label",{staticClass:"upload-text",attrs:{for:"upload-file",title:e.selectFileName}},[e._v(e._s(e.selectFileName))])]),e._v(" "),e.clearInputShow?s("input",{staticClass:"upload-template",attrs:{type:"file",id:"upload-file"},on:{change:e.getFile}}):e._e()]),e._v(" "),s("div",{staticClass:"type-div row"},[s("div",{staticClass:"app-type-text"},[e._v(e._s(e.translate.selectAppType))]),e._v(" "),s("div",{staticClass:"app-type-content"},e._l(e.typeList,function(t,i){return s("div",{key:i},e._l(t.types,function(t,i){return s("p",{key:i,staticClass:"type-p",class:e.newApp.appTypeId===t.id?"active":"",on:{click:function(s){e.newApp.appTypeId=t.id,e.addAppType=t}}},[s("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("done"))}}),e._v("\n                "+e._s(t.name)+"\n              ")])}),0)}),0)])]),e._v(" "),s("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[s("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(t){e.showImportModal=!1}}},[e._v(e._s(e.translate.cancel))]),e._v(" "),s("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(t){return e._importApp(e.addAppType)}}},[e._v(e._s(e.translate.sure))])])])],1),e._v(" "),e.curApp&&"appInfo"===e.miniRoutes?s("app-info",{staticClass:"row",attrs:{departmentId:e.departmentId,appId:e.curApp?e.curApp.id:"",readonly:"manager"===e.role},on:{setForm:function(t){return e._setForm(t,"appInfo")},setFlow:e._setFlow,update:e._updateApp,back:function(t){e.miniRoutes="appManage"}}}):e._e(),e._v(" "),e.curApp&&e.miniRoutes===e.curCheckRoutes?s("FormEngineInfo",{staticClass:"row",attrs:{departmentId:e.departmentId,curCheckRoutes:e.curCheckRoutes,appId:e.curApp?e.curApp.id:"",readonly:"manager"===e.role},on:{setForm:function(t){return e._setForm(t,"formEngine")},setJoinRole:e._setJoinRole,update:e._updateApp,back:function(t){e.miniRoutes="appManage"}}}):e._e(),e._v(" "),"formSetManage"===e.miniRoutes&&e.curApp&&e.curApp.id?s("FormSetManage",{attrs:{student:e.studentBie,departmentId:e.departmentId,appId:e.curApp?e.curApp.id:"",app:e.curApp,readonly:"manager"===e.role,initWay:e.initWay,formId:e.modelId,businessId:e.businessId},on:{back:function(t){return e._backToPage(e.parentPage)},submit:e._saveFormInfo}}):e._e(),e._v(" "),"flowSetManage"===e.miniRoutes&&e.curApp&&e.curApp.id?s("FlowSetManage",{attrs:{departmentId:e.departmentId,userType:e.appUserType,appName:e.appName,appId:e.curApp?e.curApp.id:"",readonly:"manager"===e.role,flowId:e.modelId,businessId:e.businessId},on:{back:function(t){return e._backToPage("appInfo")},submit:e._saveFlowInfo}}):e._e(),e._v(" "),"joinRoleSet"===e.miniRoutes&&e.curApp&&e.curApp.id?s("JoinRoleSetManage",{attrs:{departmentId:e.departmentId,userType:e.appUserType,appName:e.appName,appId:e.curApp?e.curApp.id:"",readonly:"manager"===e.role,businessId:e.businessId},on:{back:function(t){return e._backToPage("formEngine")},submit:e._savePlayers}}):e._e()],1)},staticRenderFns:[]};var S=s("VU/8")(L,A,!1,function(e){s("WTLC")},null,null);t.default=S.exports},BsgA:function(e,t){},Gvie:function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_defineProperty__=__webpack_require__("bOdI"),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_defineProperty___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_defineProperty__),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify__=__webpack_require__("mvHQ"),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify__),__WEBPACK_IMPORTED_MODULE_2_vue__=__webpack_require__("7+uW"),__WEBPACK_IMPORTED_MODULE_3_jquery__=__webpack_require__("7t+N"),__WEBPACK_IMPORTED_MODULE_3_jquery___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_jquery__),__WEBPACK_IMPORTED_MODULE_4__assets_utils_utils_js__=__webpack_require__("C331"),__WEBPACK_IMPORTED_MODULE_5__components_VFlow_vue__=__webpack_require__("bTp3"),__WEBPACK_IMPORTED_MODULE_6_timers__=__webpack_require__("162o"),__WEBPACK_IMPORTED_MODULE_6_timers___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_6_timers__),_methods;__WEBPACK_IMPORTED_MODULE_2_vue__.a.component("v-flow",__WEBPACK_IMPORTED_MODULE_5__components_VFlow_vue__.a),__webpack_exports__.a={inject:{windowObj:{default:null}},props:{departmentId:{default:"1"},appId:{default:"1"},readonly:{default:!1},businessId:{default:null},appName:{default:null},roleSetting:{default:null},userType:{default:null}},created:function created(){var _this=this,la=localStorage.getItem("lang");Object(__WEBPACK_IMPORTED_MODULE_4__assets_utils_utils_js__.g)(la)&&(this.lang=la),this.roleSetting&&(this.isConfig=!0),"4"!==this.userType&&"2"!==this.userType||this.distributaryData.splice(1,2),this.isConfig?(this.$waiting.show(),Object(__WEBPACK_IMPORTED_MODULE_4__assets_utils_utils_js__.e)({url:"/api/information/components/"+this.roleSetting.type,type:"get",data:{educationLevel:this.roleSetting.educationLevel},success:function(e){e.state?(e.data.forEach(function(e,t){e.components.forEach(function(t,s){_this.components.push({name:t.name,title:t.title+"("+e.name+")",componentType:t.componentType,checked:!1,checkedXian:!1}),_this.ownerData.dataAuthorities.push({componentName:t.name,authority:"readonly"})})}),_this.copyDataAuthorities=JSON.parse(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(_this.ownerData.dataAuthorities)),Object(__WEBPACK_IMPORTED_MODULE_4__assets_utils_utils_js__.e)({url:"/api/information/player/"+_this.roleSetting.type,type:"get",data:{educationLevel:_this.roleSetting.educationLevel},success:function(e){e.state?(e.data&&e.data.players.forEach(function(e,t){if("owner"===e.category){_this.ownerData=e;var s=0;(a=JSON.parse(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(_this.copyDataAuthorities))).forEach(function(e,t){_this.ownerData.dataAuthorities.forEach(function(t,s){e.componentName===t.componentName&&(e.authority=t.authority,e.exportable=t.exportable)}),e.exportable&&s++}),_this.ownerData.exportNum=s,_this.ownerData.dataAuthorities=a}else{var i={};_this.$set(i,"palyerForm",{}),i.palyerForm=e;var a,n=0;(a=JSON.parse(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(_this.copyDataAuthorities))).forEach(function(e,t){i.palyerForm.dataAuthorities.forEach(function(t,s){e.componentName===t.componentName&&(e.authority=t.authority,e.exportable=t.exportable)}),e.exportable&&n++}),i.palyerForm.exportNum=n,i.palyerForm.dataAuthorities=a,_this.$set(i,"roleEditing",!1),_this.$set(i,"newRoleName",""),_this.$set(i,"roleAddErrorMsg",""),_this.$set(i,"curComponentsCount",0),_this.$set(i,"curComponentsCountXian",0),_this.$set(i,"curPlayerCount",0),_this.$set(i,"AllComponents",[]),_this.$set(i,"roleSetData",[]),_this.$set(i,"batchCheck",""),_this.$set(i,"playerName",""),_this.$set(i,"searchName",""),i.curPlayerCount=e.operators.length,i.AllComponents=JSON.parse(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(_this.components)),_this.palyers.push(i)}}),Object(__WEBPACK_IMPORTED_MODULE_6_timers__.setTimeout)(function(){var e=__WEBPACK_IMPORTED_MODULE_3_jquery___default()(".col").height();_this.ownerContentHeight=e-190},300),_this.monitorScroll()):_this.$toast(e.message)}}).always(function(){_this.$waiting.close()})):_this.$toast(e.message)}}).always(function(){_this.$waiting.close()})):(this.businessId?(this.formUrl="/api/app/"+this.appId+"/publishBusiness/"+this.businessId+"/formSetting",this.playersUrl="/api/app/"+this.appId+"/publishBusiness/"+this.businessId+"/playerSetting"):(this.formUrl="/api/apps/"+this.appId+"/settings/forms",this.playersUrl="/api/apps/"+this.appId+"/settings/players"),Object(__WEBPACK_IMPORTED_MODULE_4__assets_utils_utils_js__.e)({url:this.formUrl,type:"get",success:function success(data){if(data.state){var patch=function patch(s,re){return re=eval("/"+re+"/ig"),s.match(re)?s.match(re).length:0};_this.components=data.data.components;var curAuthority="",newCom=JSON.parse(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(_this.components)),initLength=0,m=[],num=0;_this.components.forEach(function(e,t){var s=patch(e.name,"_"),i=patch(e.name,"table");s<2&&i>=1&&(num+=1,m.push(t),num>1&&(initLength+=_this.components[m[num-2]].properties.basic.tableFields.length),e.properties.basic.tableFields.forEach(function(s,i){var a=t+1+initLength;s.title=e.title+s.title,newCom.splice(a,0,s)}))}),_this.components=newCom,_this.components.forEach(function(e,t){_this.$set(e,"checked",!1),_this.$set(e,"checkedXian",!1),_this.ownerData.dataAuthorities.push({componentName:e.name,authority:"readonly",exportable:!0})}),_this.copyDataAuthorities=JSON.parse(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(_this.ownerData.dataAuthorities)),_this.$set(_this.curForm,"formSettingName",data.data.name),_this.$set(_this.curForm,"formSettingId",data.data.id),Object(__WEBPACK_IMPORTED_MODULE_4__assets_utils_utils_js__.e)({url:_this.playersUrl,type:"get",success:function(e){e.state?(e.data&&(_this.playersId=e.data.id,_this.multiForm=!!e.data.multiForm,e.data.players.forEach(function(e,t){if(_this.components.forEach(function(e){e.checkedXian=!1}),e.defaultVisibleTableColumns.forEach(function(e){_this.components=_this.components.map(function(t){return e==t.name&&(t.checkedXian=!0),t})}),"owner"===e.category){_this.ownerData=e;var s=0;(a=JSON.parse(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(_this.copyDataAuthorities))).forEach(function(e,t){_this.ownerData.dataAuthorities.forEach(function(t,s){e.componentName===t.componentName&&(e.authority=t.authority,e.exportable=t.exportable)}),e.exportable&&s++}),_this.ownerData.dataAuthorities=a,_this.ownerData.exportNum=s}else{var i={};_this.$set(i,"palyerForm",{}),i.palyerForm=e;var a,n=0;(a=JSON.parse(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(_this.copyDataAuthorities))).forEach(function(e,t){i.palyerForm.dataAuthorities.forEach(function(t,s){e.componentName===t.componentName&&(e.authority=t.authority,e.exportable=t.exportable)}),e.exportable&&n++}),i.palyerForm.dataAuthorities=a,i.palyerForm.exportNum=n,_this.$set(i,"roleEditing",!1),_this.$set(i,"newRoleName",""),_this.$set(i,"roleAddErrorMsg",""),_this.$set(i,"curComponentsCount",0),_this.$set(i,"curComponentsCountXian",0),_this.$set(i,"curPlayerCount",0),_this.$set(i,"AllComponents",[]),_this.$set(i,"roleSetData",[]),_this.$set(i,"batchCheck",""),_this.$set(i,"playerName",""),_this.$set(i,"searchName",""),_this.$set(i,"roleSetSearchName",""),i.curPlayerCount=e.operators.length,i.AllComponents=JSON.parse(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(_this.components)),_this.palyers.push(i),_this._initRoleList(t-1)}})),Object(__WEBPACK_IMPORTED_MODULE_6_timers__.setTimeout)(function(){var e=__WEBPACK_IMPORTED_MODULE_3_jquery___default()(".col").height().toFixed(1);_this.ownerContentHeight=e-190},300),_this.monitorScroll()):_this.$toast(e.message)}})}else _this.$toast(data.message)}})),this.operatorData.forEach(function(e,t){e.name=_this.translate.operatorData[e.id]})},data:function(){return{positionLeft:null,newDistributaryData:[],distributaryData:[{id:"bySchool",name:"全校统一汇总"},{id:"byClass",name:"以班级关系分配"},{id:"byTeacher",name:"以带生关系分配"},{id:"byCollege",name:"以学院关系分配"},{id:"byTutor",name:"以导师分配"},{id:"byBuilding",name:"公寓按楼栋分配"},{id:"byParty",name:"以党组织关系分配"}],roleList:[],components:[],operatorData:[{id:"required",name:"必填",coms:["input","number","select","checkbox","radio","datetime","address","table","attachment","image","signature","map"]},{id:"optional",name:"选填",coms:["input","number","select","checkbox","radio","datetime","address","table","attachment","image","signature","map"]},{id:"readonly",name:"只读",coms:["input","number","select","checkbox","radio","datetime","address","table","attachment","image","signature","splitLine","label","map"]},{id:"hide",name:"隐藏",coms:["input","number","select","checkbox","radio","datetime","address","table","attachment","image","signature","splitLine","label","map"]}],permission:{reject:{usable:!1,properties:{rejectTo:"lastNode",rejectBackTo:"flowWay"}},revocation:{usable:!1},deliverTo:{usable:!1},sendTo:{usable:!1},batch:{usable:!1},cancelByUser:{usable:!1}},batchCheck:"",roleEditing:!1,curNode:{distributary:"",operators:[],dataAuthorities:[{authority:null}]},curLink:{},otherLink:{nextNodeId:""},curForm:{formSettingId:"",formSettingName:""},isApplyNode:!1,isChange:!1,isSelectBatchSet:!1,palyers:[],ownerData:{id:"owner",name:"",category:"owner",distributary:"",operators:[],dataAuthorities:[],batch:!1},copyDataAuthorities:[],curComponentsCount:{},curComponentsCountXian:{},nameIsNull:!0,roleNameArray:[],nameChangeMsg:"",noRoleSetAfaterHeight:"",joinRoleScrollAreaHeight:"",newAuthorityMaxHeight:"",roleSetContentHeight:"",headerIsFixed:"",batchHeadIsFixed:"",ownerHeaderIsFixed:"",ownerContentHeight:0,scrollIndex:0,formUrl:"",playersUrl:"",playersId:"",configurationArray:["infoConfig"],isConfig:!1,owenrSearchName:"",multiForm:!1,lang:"zh-cn"}},computed:{translate:function(){return Object(__WEBPACK_IMPORTED_MODULE_4__assets_utils_utils_js__.g)(this.lang).joinRoleSetManage},componentsCheckAllCount:function(){var e=0;return this.components.forEach(function(t){t.checked&&e++}),e},setColStyle:function(){return this.palyers.length<=1?{"text-align":"center","padding-left":"105px"}:{"text-align":"left","padding-left":"0"}}},watch:{headerIsFixed:{handler:function(){this.headerIsFixed||__WEBPACK_IMPORTED_MODULE_3_jquery___default()("#read-write-content"+this.scrollIndex).css("padding-bottom","0")},deep:!0},batchHeadIsFixed:{handler:function(){this.batchHeadIsFixed?__WEBPACK_IMPORTED_MODULE_3_jquery___default()("#read-write-content"+this.scrollIndex).css("padding-bottom","100px"):__WEBPACK_IMPORTED_MODULE_3_jquery___default()("#read-write-content"+this.scrollIndex).css("padding-bottom","0")},deep:!0},ownerHeaderIsFixed:{handler:function(){this.ownerHeaderIsFixed?this.ownerContentHeight=this.ownerContentHeight-60:this.ownerContentHeight=this.ownerContentHeight+60},deep:!0},windowObj:{deep:!0,handler:function(e){var t=__WEBPACK_IMPORTED_MODULE_3_jquery___default()(".col").height();this.roleSetContentHeight=t-268,this.ownerContentHeight=t-190,this.joinRoleScrollAreaHeight=t-238,this.noRoleSetAfaterHeight=t-190,this.newAuthorityMaxHeight=t-83}}},mounted:function(){var e=this;Object(__WEBPACK_IMPORTED_MODULE_6_timers__.setTimeout)(function(){var t=__WEBPACK_IMPORTED_MODULE_3_jquery___default()(".col").height().toFixed(1);e.isConfig?e.newAuthorityMaxHeight=t-263:e.newAuthorityMaxHeight=t-228},300),__WEBPACK_IMPORTED_MODULE_3_jquery___default()("#joinRolePage").keydown(function(t){return 1!=t.ctrlKey||83!=t.keyCode||(e._saveJoinSet(),e.$emit("back"),t.preventDefault(),!1)})},methods:(_methods={_setCanExport:function(e,t){e.dataAuthorities[t].exportable?e.exportNum--:e.exportNum++,e.dataAuthorities[t].exportable=!e.dataAuthorities[t].exportable},_changeExportAll:function(e){0===e.exportNum?(e.dataAuthorities.forEach(function(e){e.exportable=!0}),e.exportNum=e.dataAuthorities.length):(e.dataAuthorities.forEach(function(e){e.exportable=!1}),e.exportNum=0)},getContentHeight:function(e){return this.isConfig?this.newAuthorityMaxHeight+"px":"byTeacher"!==this.palyers[e].palyerForm.distributary&&""!=this.palyers[e].palyerForm.distributary&&"byTutor"!=this.palyers[e].palyerForm.distributary?"":this.newAuthorityMaxHeight+"px"},monitorScroll:function(){var e=this,t=!1,s=!1,i=!1;this.isConfig||Object(__WEBPACK_IMPORTED_MODULE_6_timers__.setTimeout)(function(){__WEBPACK_IMPORTED_MODULE_3_jquery___default()(".join-role-scroll-area").scroll(function(){var i=__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).attr("data-id");e.scrollIndex=i;var a=__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).children().find(".participant-read-write-content").position().top,n=__WEBPACK_IMPORTED_MODULE_3_jquery___default()(".col").height().toFixed(1);a<=50?(__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).children().find(".participant-read-write-header").css("display","none"),__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).siblings(".fiexd-header").css("display","block"),__WEBPACK_IMPORTED_MODULE_3_jquery___default()("#joinRoleScrollArea"+i).css("height",n-288),e.headerIsFixed=!0,t=!0):(__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).children().find(".participant-read-write-header").css("display","block"),__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).siblings(".fiexd-header").css("display","none"),__WEBPACK_IMPORTED_MODULE_3_jquery___default()("#joinRoleScrollArea"+i).css("height",n-238),t&&(e.headerIsFixed=!1)),a<=-488?(__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).children(".participant-read-write-content").find(".batch-head").css("display","none"),__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).siblings(".fiexd-batch-head").css("display","block"),e.palyers[i].curComponentsCount>0&&(__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).siblings(".fiexd-header").children(".participant-read-write-header").css("box-shadow","none"),__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).siblings(".fiexd-batch-head").children(".batch-head").css("box-shadow","0 0 0 0 rgba(0,0,0,0.12), 0 4px 4px 0 rgba(0,0,0,0.12)"),e.batchHeadIsFixed=!0,s=!0)):(__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).children(".participant-read-write-content").find(".batch-head").css("display","block"),__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).siblings(".fiexd-batch-head").css("display","none"),__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).siblings(".fiexd-header").children(".participant-read-write-header").css("box-shadow"," 0 0 0 0 rgba(0,0,0,0.12), 0 4px 4px 0 rgba(0,0,0,0.12)"),__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).siblings(".fiexd-batch-head").children(".batch-head").css("box-shadow","none"),s&&(e.batchHeadIsFixed=!1))}),__WEBPACK_IMPORTED_MODULE_3_jquery___default()(".owner-read-write-content").scroll(function(){var t=__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).children(".role-list").position().top;e.componentsCheckAllCount>0&&(t<=-4?(__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).children(".batch-head").css("display","none"),__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).siblings(".owner-batch-head").css("display","block"),e.ownerHeaderIsFixed=!0,i=!0):(__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).children(".batch-head").css("display","block"),__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).siblings(".owner-batch-head").css("display","none"),i&&(e.ownerHeaderIsFixed=!1)))})},300)},_allowWriteMultipleForm:function(){this.multiForm=!this.multiForm},_back:function(){if(this.isChange&&confirm(this.translate.backTip)&&this._saveJoinSet(),!this.nameIsNull)return!1;this.$emit("back")},_saveJoinSet:function(){var e=this,t=[];if(t.push(this.ownerData),this.palyers.forEach(function(e,s){t.push(e.palyerForm)}),t.forEach(function(t,s){"owner"===t.category?t.name?e.nameIsNull=!0:(e.$toast("表单所属人名称不能为空"),e.nameIsNull=!1):t.name?e.nameIsNull=!0:(e.$toast("参与者名称不能为空"),e.nameIsNull=!1)}),!this.nameIsNull)return!1;this.isConfig?this.$emit("submit",{players:t,educationLevel:this.roleSetting.educationLevel,type:this.roleSetting.type}):this.businessId?this.$emit("submit",{id:this.playersId,multiForm:this.multiForm,players:t}):this.$emit("submit",{multiForm:this.multiForm,players:t})},_addRole:function(){this.isChange=!0;(new Date).getTime();var e={};this.$set(e,"palyerForm",{}),this.$set(e,"roleEditing",!1),this.$set(e,"newRoleName",""),this.$set(e,"roleAddErrorMsg",""),this.$set(e,"curComponentsCount",0),this.$set(e,"curComponentsCountXian",0),this.$set(e,"AllComponents",[]),this.$set(e,"roleSetData",[]),this.$set(e,"batchCheck",""),this.$set(e,"curPlayerCount",0),this.$set(e,"playerName",""),this.$set(e,"searchName",""),this.$set(e,"roleSetSearchName",""),this.$set(e.palyerForm,"id",""),this.$set(e.palyerForm,"name",""),this.$set(e.palyerForm,"category","participant"),this.$set(e.palyerForm,"distributary",""),this.$set(e.palyerForm,"operators",[]),this.$set(e.palyerForm,"dataAuthorities",[]),this.$set(e.palyerForm,"batch",!1),e.palyerForm.id="player_"+(new Date).getTime();this.components.forEach(function(t,s){e.palyerForm.dataAuthorities.push({componentName:t.name,authority:"readonly",exportable:!0})}),e.palyerForm.exportNum=e.palyerForm.dataAuthorities.length,e.AllComponents=JSON.parse(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(this.components)),this.palyers.push(e)},_deletePlayers:function(e){this.palyers.splice(e,1)},_getAuthorityOf:function(e,t){var s="";return t.dataAuthorities&&t.dataAuthorities.forEach(function(t){e.name===t.componentName&&(s=t.authority)}),s},_setAuthorityOf:function(e,t,s){var i=this,a=!1;s.dataAuthorities&&s.dataAuthorities.forEach(function(s){e.name===s.componentName&&(a=!0,i.$set(s,"authority",t))}),a||s.dataAuthorities.push({componentName:e.name,authority:t})},_batchSure:function(e,t){var s=this;this.isChange=!0,"participant"===e?(this.palyers[t].AllComponents.forEach(function(e,i){e.checked&&(s._getAuthorityOf(e,s.palyers[t].palyerForm)?s._setAuthorityOf(e,s._verifyBatch(e,s.palyers[t].batchCheck),s.palyers[t].palyerForm):s.palyers[t].palyerForm.dataAuthorities.push({authority:s._verifyBatch(e,s.palyers[t].batchCheck),componentName:e.name}),e.checked=!1)}),this.palyers[t].batchCheck="",this._componentsCheckAllCount(t)):(this.components.forEach(function(e,t){e.checked&&(s._getAuthorityOf(e,s.ownerData)?s._setAuthorityOf(e,s._verifyBatch(e,s.batchCheck),s.ownerData):s.ownerData.dataAuthorities.push({authority:s._verifyBatch(e,s.batchCheck),componentName:e.name}),e.checked=!1)}),this.batchCheck="")},_verifyBatch:function(e,t){var s=!1;return this.operatorData.forEach(function(i){i.id===t&&i.coms.indexOf(e.componentType)>=0&&(s=!0)}),s?t:""},_afterSelectedDis:function(e){var t=parseInt(e.target.$attrs["data-index"]);this.isChange=!0,this.palyers[t].roleEditing=!1,this.palyers[t].palyerForm.operators=[],this.palyers[t].curPlayerCount=0,this.isConfig||this._initRoleList(t)},_initRoleList:function(e){var t=this;"bySchool"===this.palyers[e].palyerForm.distributary||"byCollege"===this.palyers[e].palyerForm.distributary?Object(__WEBPACK_IMPORTED_MODULE_4__assets_utils_utils_js__.e)({url:"/api/approveRoles",type:"get",data:{level:"bySchool"===this.palyers[e].palyerForm.distributary?"SCHOOL":"COLLEGE",departmentId:this.departmentId},success:function(s){if(s.state){t.palyers[e].roleSetData=s.data.reverse();var i=null;i&&clearTimeout(i),i=Object(__WEBPACK_IMPORTED_MODULE_6_timers__.setTimeout)(function(){var e=__WEBPACK_IMPORTED_MODULE_3_jquery___default()(".col").height().toFixed(1);t.roleSetContentHeight=e-268,t.joinRoleScrollAreaHeight=e-238,t.noRoleSetAfaterHeight=e-170,t.newAuthorityMaxHeight=e-83},300)}else t.$toast(s.message)}}):"byClass"===this.palyers[e].palyerForm.distributary?Object(__WEBPACK_IMPORTED_MODULE_4__assets_utils_utils_js__.e)({url:"/api/relClass/classCommittees",type:"get",success:function(s){if(s.state){s.data.forEach(function(e){e.name=e.text}),t.palyers[e].roleSetData=s.data.reverse();var i=null;i&&clearTimeout(i),i=Object(__WEBPACK_IMPORTED_MODULE_6_timers__.setTimeout)(function(){var e=__WEBPACK_IMPORTED_MODULE_3_jquery___default()(".col").height().toFixed(1);t.roleSetContentHeight=e-268,t.joinRoleScrollAreaHeight=e-238,t.noRoleSetAfaterHeight=e-170,t.newAuthorityMaxHeight=e-83},300)}else t.$toast(s.message)}}):"byBuilding"===this.palyers[e].palyerForm.distributary?Object(__WEBPACK_IMPORTED_MODULE_4__assets_utils_utils_js__.e)({url:"/api/apartment/roles",type:"get",success:function(s){if(s.state){s.data.forEach(function(e){e.name=e.name}),t.palyers[e].roleSetData=s.data.reverse();var i=null;i&&clearTimeout(i),i=Object(__WEBPACK_IMPORTED_MODULE_6_timers__.setTimeout)(function(){var e=__WEBPACK_IMPORTED_MODULE_3_jquery___default()(".col").height().toFixed(1);t.roleSetContentHeight=e-268,t.joinRoleScrollAreaHeight=e-238,t.noRoleSetAfaterHeight=e-170,t.newAuthorityMaxHeight=e-83},300)}else t.$toast(s.message)}}):"byParty"===this.palyers[e].palyerForm.distributary&&Object(__WEBPACK_IMPORTED_MODULE_4__assets_utils_utils_js__.e)({url:"/api/partyBuild/organizations/personInChargeRole",type:"get",success:function(s){if(s.state){s.data.forEach(function(e){e.name=e.name}),t.palyers[e].roleSetData=s.data.reverse();var i=null;i&&clearTimeout(i),i=Object(__WEBPACK_IMPORTED_MODULE_6_timers__.setTimeout)(function(){var e=__WEBPACK_IMPORTED_MODULE_3_jquery___default()(".col").height().toFixed(1);t.roleSetContentHeight=e-268,t.joinRoleScrollAreaHeight=e-238,t.noRoleSetAfaterHeight=e-170,t.newAuthorityMaxHeight=e-83},300)}else t.$toast(s.message)}})},_checkOperators:function(e,t){this.isChange=!0;var s=this.palyers[t].palyerForm.operators.indexOf(parseInt(e.id));s>=0?this.palyers[t].palyerForm.operators.splice(s,1):this.palyers[t].palyerForm.operators.push(parseInt(e.id)),this._roleCheckAllCount(t)},_changeCheckState:function(e,t,s,i){var a=this;this.isChange=!0;var n=!1;0===t&&(n=!0),this.isConfig?("dataAuthorities"===s&&e.forEach(function(e){e.title.indexOf(a.palyers[i].searchName)>=0&&(e.checked=n)}),"owner"===s&&e.forEach(function(e){e.title.indexOf(a.owenrSearchName)>=0&&(e.checked=n)})):"operators"===s?e.forEach(function(e){e.name.indexOf(a.palyers[i].roleSetSearchName)>=0&&(e.checked=n)}):e.forEach(function(e){e.checked=n}),"operators"===s?(this.palyers[i].palyerForm[s]=[],e.forEach(function(e){e.checked&&a.palyers[i].palyerForm[s].push(parseInt(e.id))}),this._roleCheckAllCount(i)):"dataAuthorities"===s&&this._componentsCheckAllCount(i)},_changeCheckStateXian:function(e,t,s,i,a){var n=this;this.palyers[i].palyerForm[s]=[],e.forEach(function(e){1==e.checkedXian&&n.palyers[i].palyerForm[s].push(e.name)})},_afterSelectedOperator:function(e){var t=parseInt(e.target.$attrs["data-index"]);this.isChange=!0,this.palyers[t].batchCheck=e.val,this._componentsCheckAllCount(t)},_afterSelectedOwner:function(e){this.isChange=!0,this.batchCheck=e.val},_creatNewRole:function(e){this.palyers[e].roleEditing=!0,__WEBPACK_IMPORTED_MODULE_3_jquery___default()("#roleContent"+e).animate({scrollTop:"0px"},300)},_saveNewRole:function(e,t){var s=this;this.isChange=!0;__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this);if(!e)return this.palyers[t].roleAddErrorMsg="角色名不能为空",Object(__WEBPACK_IMPORTED_MODULE_6_timers__.setTimeout)(function(){s.palyers[t].roleAddErrorMsg=""},1500),!1;""===e.replace(/\s/g,"")&&(this.palyers[t].roleAddErrorMsg=this.roleEmptyTip),this.palyers[t].roleSetData.forEach(function(i){e===i.name&&(s.palyers[t].roleAddErrorMsg&&(s.palyers[t].roleAddErrorMsg+=","),s.palyers[t].roleAddErrorMsg+=s.translate.roleExistTip)}),this.palyers[t].roleAddErrorMsg?Object(__WEBPACK_IMPORTED_MODULE_6_timers__.setTimeout)(function(){s.palyers[t].roleAddErrorMsg=""},1500):Object(__WEBPACK_IMPORTED_MODULE_4__assets_utils_utils_js__.e)({url:"/api/approveRoles",type:"post",data:{name:e,level:"bySchool"===this.palyers[t].palyerForm.distributary?"SCHOOL":"COLLEGE",departmentId:this.departmentId},success:function(i){i.state?(s.palyers[t].roleSetData.unshift({id:i.data,name:e}),s.palyers[t].palyerForm.operators.push(parseInt(i.data)),s.palyers[t].roleEditing=!1):s.$toast(i.message)}})},_changeBatchSet:function(e){this.palyers[e].palyerForm.batch?this.palyers[e].palyerForm.batch=!1:this.palyers[e].palyerForm.batch=!0},_roleCheckAllCount:function(e){var t=this;return this.palyers[e].curPlayerCount=0,this.palyers[e].palyerForm&&this.palyers[e].palyerForm.operators&&this.palyers[e].roleSetData.forEach(function(s){t.palyers[e].palyerForm.operators.indexOf(parseInt(s.id))>=0&&t.palyers[e].curPlayerCount++}),this.palyers[e].curPlayerCount},_componentsCheckAllCount:function(e){var t=this;return this.palyers[e].curComponentsCount=0,this.palyers[e].AllComponents.forEach(function(s){s.checked&&t.palyers[e].curComponentsCount++}),this.palyers[e].curComponentsCount},_componentsCheckAllCountXian:function(e){var t=this;return this.palyers[e].curComponentsCountXian=0,this.palyers[e].AllComponents.forEach(function(s){s.checkedXian&&t.palyers[e].curComponentsCountXian++}),this.palyers[e].curComponentsCountXian}},__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_defineProperty___default()(_methods,"_componentsCheckAllCountXian",function(e){var t=this;return this.palyers[e].curComponentsCountXian=0,this.palyers[e].AllComponents.forEach(function(s){s.checkedXian&&t.palyers[e].curComponentsCountXian++}),this.palyers[e].curComponentsCount}),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_defineProperty___default()(_methods,"_changeComSelectXian",function(e,t){e.checkedXian=!e.checkedXian,this._componentsCheckAllCountXian(t)}),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_defineProperty___default()(_methods,"_changeComSelect",function(e,t){e.checked=!e.checked,this._componentsCheckAllCount(t)}),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_defineProperty___default()(_methods,"_changeNameInput",function(){this.isChange=!0}),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_defineProperty___default()(_methods,"_newRowInputFocus",function(e){this.palyers[e].newRoleName=this.appName+this.palyers[e].palyerForm.name+"管理员"}),_methods),destroyed:function(){__WEBPACK_IMPORTED_MODULE_3_jquery___default()(window).off("keydown")}}},Rmvn:function(e,t){},"W/ez":function(e,t){},WTLC:function(e,t){},b50i:function(e,t){},wvr1:function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_defineProperty__=__webpack_require__("bOdI"),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_defineProperty___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_defineProperty__),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify__=__webpack_require__("mvHQ"),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify__),__WEBPACK_IMPORTED_MODULE_2_vue__=__webpack_require__("7+uW"),__WEBPACK_IMPORTED_MODULE_3_jquery__=__webpack_require__("7t+N"),__WEBPACK_IMPORTED_MODULE_3_jquery___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_jquery__),__WEBPACK_IMPORTED_MODULE_4__assets_utils_utils_js__=__webpack_require__("C331"),__WEBPACK_IMPORTED_MODULE_5__components_VFlow_vue__=__webpack_require__("bTp3"),__WEBPACK_IMPORTED_MODULE_6_timers__=__webpack_require__("162o"),__WEBPACK_IMPORTED_MODULE_6_timers___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_6_timers__),_methods;__WEBPACK_IMPORTED_MODULE_2_vue__.a.component("v-flow",__WEBPACK_IMPORTED_MODULE_5__components_VFlow_vue__.a);var _unused_webpack_default_export={inject:{windowObj:{default:null}},props:{departmentId:{default:"1"},appId:{default:"1"},readonly:{default:!1},businessId:{default:null},appName:{default:null},roleSetting:{default:null},userType:{default:null}},created:function created(){var _this=this,la=localStorage.getItem("lang");Object(__WEBPACK_IMPORTED_MODULE_4__assets_utils_utils_js__.g)(la)&&(this.lang=la),this.roleSetting&&(this.isConfig=!0),"4"!==this.userType&&"2"!==this.userType||this.distributaryData.splice(1,2),this.isConfig?(this.$waiting.show(),Object(__WEBPACK_IMPORTED_MODULE_4__assets_utils_utils_js__.e)({url:"/api/information/components/"+this.roleSetting.type,type:"get",data:{educationLevel:this.roleSetting.educationLevel},success:function(e){e.state?(e.data.forEach(function(e,t){e.components.forEach(function(t,s){_this.components.push({name:t.name,title:t.title+"("+e.name+")",componentType:t.componentType,checked:!1,checkedXian:!1}),_this.ownerData.dataAuthorities.push({componentName:t.name,authority:"readonly"})})}),_this.copyDataAuthorities=JSON.parse(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(_this.ownerData.dataAuthorities)),Object(__WEBPACK_IMPORTED_MODULE_4__assets_utils_utils_js__.e)({url:"/api/information/player/"+_this.roleSetting.type,type:"get",data:{educationLevel:_this.roleSetting.educationLevel},success:function(e){e.state?(e.data&&e.data.players.forEach(function(e,t){if("owner"===e.category){_this.ownerData=e;var s=0;(a=JSON.parse(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(_this.copyDataAuthorities))).forEach(function(e,t){_this.ownerData.dataAuthorities.forEach(function(t,s){e.componentName===t.componentName&&(e.authority=t.authority,e.exportable=t.exportable)}),e.exportable&&s++}),_this.ownerData.exportNum=s,_this.ownerData.dataAuthorities=a}else{var i={};_this.$set(i,"palyerForm",{}),i.palyerForm=e;var a,n=0;(a=JSON.parse(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(_this.copyDataAuthorities))).forEach(function(e,t){i.palyerForm.dataAuthorities.forEach(function(t,s){e.componentName===t.componentName&&(e.authority=t.authority,e.exportable=t.exportable)}),e.exportable&&n++}),i.palyerForm.exportNum=n,i.palyerForm.dataAuthorities=a,_this.$set(i,"roleEditing",!1),_this.$set(i,"newRoleName",""),_this.$set(i,"roleAddErrorMsg",""),_this.$set(i,"curComponentsCount",0),_this.$set(i,"curComponentsCountXian",0),_this.$set(i,"curPlayerCount",0),_this.$set(i,"AllComponents",[]),_this.$set(i,"roleSetData",[]),_this.$set(i,"batchCheck",""),_this.$set(i,"playerName",""),_this.$set(i,"searchName",""),i.curPlayerCount=e.operators.length,i.AllComponents=JSON.parse(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(_this.components)),_this.palyers.push(i)}}),Object(__WEBPACK_IMPORTED_MODULE_6_timers__.setTimeout)(function(){var e=__WEBPACK_IMPORTED_MODULE_3_jquery___default()(".col").height();_this.ownerContentHeight=e-190},300),_this.monitorScroll()):_this.$toast(e.message)}}).always(function(){_this.$waiting.close()})):_this.$toast(e.message)}}).always(function(){_this.$waiting.close()})):(this.businessId?(this.formUrl="/api/app/"+this.appId+"/publishBusiness/"+this.businessId+"/formSetting",this.playersUrl="/api/app/"+this.appId+"/publishBusiness/"+this.businessId+"/playerSetting"):(this.formUrl="/api/apps/"+this.appId+"/settings/forms",this.playersUrl="/api/apps/"+this.appId+"/settings/players"),Object(__WEBPACK_IMPORTED_MODULE_4__assets_utils_utils_js__.e)({url:this.formUrl,type:"get",success:function success(data){if(data.state){var patch=function patch(s,re){return re=eval("/"+re+"/ig"),s.match(re)?s.match(re).length:0};_this.components=data.data.components;var curAuthority="",newCom=JSON.parse(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(_this.components)),initLength=0,m=[],num=0;_this.components.forEach(function(e,t){var s=patch(e.name,"_"),i=patch(e.name,"table");s<2&&i>=1&&(num+=1,m.push(t),num>1&&(initLength+=_this.components[m[num-2]].properties.basic.tableFields.length),e.properties.basic.tableFields.forEach(function(s,i){var a=t+1+initLength;s.title=e.title+s.title,newCom.splice(a,0,s)}))}),_this.components=newCom,_this.components.forEach(function(e,t){_this.$set(e,"checked",!1),_this.$set(e,"checkedXian",!1),_this.ownerData.dataAuthorities.push({componentName:e.name,authority:"readonly",exportable:!0})}),_this.copyDataAuthorities=JSON.parse(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(_this.ownerData.dataAuthorities)),_this.$set(_this.curForm,"formSettingName",data.data.name),_this.$set(_this.curForm,"formSettingId",data.data.id),Object(__WEBPACK_IMPORTED_MODULE_4__assets_utils_utils_js__.e)({url:_this.playersUrl,type:"get",success:function(e){e.state?(e.data&&(_this.playersId=e.data.id,_this.multiForm=!!e.data.multiForm,e.data.players.forEach(function(e,t){if(_this.components.forEach(function(e){e.checkedXian=!1}),e.defaultVisibleTableColumns.forEach(function(e){_this.components=_this.components.map(function(t){return e==t.name&&(t.checkedXian=!0),t})}),"owner"===e.category){_this.ownerData=e;var s=0;(a=JSON.parse(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(_this.copyDataAuthorities))).forEach(function(e,t){_this.ownerData.dataAuthorities.forEach(function(t,s){e.componentName===t.componentName&&(e.authority=t.authority,e.exportable=t.exportable)}),e.exportable&&s++}),_this.ownerData.dataAuthorities=a,_this.ownerData.exportNum=s}else{var i={};_this.$set(i,"palyerForm",{}),i.palyerForm=e;var a,n=0;(a=JSON.parse(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(_this.copyDataAuthorities))).forEach(function(e,t){i.palyerForm.dataAuthorities.forEach(function(t,s){e.componentName===t.componentName&&(e.authority=t.authority,e.exportable=t.exportable)}),e.exportable&&n++}),i.palyerForm.dataAuthorities=a,i.palyerForm.exportNum=n,_this.$set(i,"roleEditing",!1),_this.$set(i,"newRoleName",""),_this.$set(i,"roleAddErrorMsg",""),_this.$set(i,"curComponentsCount",0),_this.$set(i,"curComponentsCountXian",0),_this.$set(i,"curPlayerCount",0),_this.$set(i,"AllComponents",[]),_this.$set(i,"roleSetData",[]),_this.$set(i,"batchCheck",""),_this.$set(i,"playerName",""),_this.$set(i,"searchName",""),_this.$set(i,"roleSetSearchName",""),i.curPlayerCount=e.operators.length,i.AllComponents=JSON.parse(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(_this.components)),_this.palyers.push(i),_this._initRoleList(t-1)}})),Object(__WEBPACK_IMPORTED_MODULE_6_timers__.setTimeout)(function(){var e=__WEBPACK_IMPORTED_MODULE_3_jquery___default()(".col").height().toFixed(1);_this.ownerContentHeight=e-190},300),_this.monitorScroll()):_this.$toast(e.message)}})}else _this.$toast(data.message)}})),this.operatorData.forEach(function(e,t){e.name=_this.translate.operatorData[e.id]})},data:function(){return{positionLeft:null,newDistributaryData:[],distributaryData:[{id:"bySchool",name:"全校统一汇总"},{id:"byClass",name:"以班级关系分配"},{id:"byTeacher",name:"以带生关系分配"},{id:"byCollege",name:"以学院关系分配"},{id:"byTutor",name:"以导师分配"},{id:"byBuilding",name:"公寓按楼栋分配"},{id:"byParty",name:"以党组织关系分配"}],roleList:[],components:[],operatorData:[{id:"required",name:"必填",coms:["input","number","select","checkbox","radio","datetime","address","table","attachment","image","signature","map"]},{id:"optional",name:"选填",coms:["input","number","select","checkbox","radio","datetime","address","table","attachment","image","signature","map"]},{id:"readonly",name:"只读",coms:["input","number","select","checkbox","radio","datetime","address","table","attachment","image","signature","splitLine","label","map"]},{id:"hide",name:"隐藏",coms:["input","number","select","checkbox","radio","datetime","address","table","attachment","image","signature","splitLine","label","map"]}],permission:{reject:{usable:!1,properties:{rejectTo:"lastNode",rejectBackTo:"flowWay"}},revocation:{usable:!1},deliverTo:{usable:!1},sendTo:{usable:!1},batch:{usable:!1},cancelByUser:{usable:!1}},batchCheck:"",roleEditing:!1,curNode:{distributary:"",operators:[],dataAuthorities:[{authority:null}]},curLink:{},otherLink:{nextNodeId:""},curForm:{formSettingId:"",formSettingName:""},isApplyNode:!1,isChange:!1,isSelectBatchSet:!1,palyers:[],ownerData:{id:"owner",name:"",category:"owner",distributary:"",operators:[],dataAuthorities:[],batch:!1},copyDataAuthorities:[],curComponentsCount:{},curComponentsCountXian:{},nameIsNull:!0,roleNameArray:[],nameChangeMsg:"",noRoleSetAfaterHeight:"",joinRoleScrollAreaHeight:"",newAuthorityMaxHeight:"",roleSetContentHeight:"",headerIsFixed:"",batchHeadIsFixed:"",ownerHeaderIsFixed:"",ownerContentHeight:0,scrollIndex:0,formUrl:"",playersUrl:"",playersId:"",configurationArray:["infoConfig"],isConfig:!1,owenrSearchName:"",multiForm:!1,lang:"zh-cn"}},computed:{translate:function(){return Object(__WEBPACK_IMPORTED_MODULE_4__assets_utils_utils_js__.g)(this.lang).joinRoleSetManage},componentsCheckAllCount:function(){var e=0;return this.components.forEach(function(t){t.checked&&e++}),e},setColStyle:function(){return this.palyers.length<=1?{"text-align":"center","padding-left":"105px"}:{"text-align":"left","padding-left":"0"}}},watch:{headerIsFixed:{handler:function(){this.headerIsFixed||__WEBPACK_IMPORTED_MODULE_3_jquery___default()("#read-write-content"+this.scrollIndex).css("padding-bottom","0")},deep:!0},batchHeadIsFixed:{handler:function(){this.batchHeadIsFixed?__WEBPACK_IMPORTED_MODULE_3_jquery___default()("#read-write-content"+this.scrollIndex).css("padding-bottom","100px"):__WEBPACK_IMPORTED_MODULE_3_jquery___default()("#read-write-content"+this.scrollIndex).css("padding-bottom","0")},deep:!0},ownerHeaderIsFixed:{handler:function(){this.ownerHeaderIsFixed?this.ownerContentHeight=this.ownerContentHeight-60:this.ownerContentHeight=this.ownerContentHeight+60},deep:!0},windowObj:{deep:!0,handler:function(e){var t=__WEBPACK_IMPORTED_MODULE_3_jquery___default()(".col").height();this.roleSetContentHeight=t-268,this.ownerContentHeight=t-190,this.joinRoleScrollAreaHeight=t-238,this.noRoleSetAfaterHeight=t-190,this.newAuthorityMaxHeight=t-83}}},mounted:function(){var e=this;Object(__WEBPACK_IMPORTED_MODULE_6_timers__.setTimeout)(function(){var t=__WEBPACK_IMPORTED_MODULE_3_jquery___default()(".col").height().toFixed(1);e.isConfig?e.newAuthorityMaxHeight=t-263:e.newAuthorityMaxHeight=t-228},300),__WEBPACK_IMPORTED_MODULE_3_jquery___default()("#joinRolePage").keydown(function(t){return 1!=t.ctrlKey||83!=t.keyCode||(e._saveJoinSet(),e.$emit("back"),t.preventDefault(),!1)})},methods:(_methods={_setCanExport:function(e,t){e.dataAuthorities[t].exportable?e.exportNum--:e.exportNum++,e.dataAuthorities[t].exportable=!e.dataAuthorities[t].exportable},_changeExportAll:function(e){0===e.exportNum?(e.dataAuthorities.forEach(function(e){e.exportable=!0}),e.exportNum=e.dataAuthorities.length):(e.dataAuthorities.forEach(function(e){e.exportable=!1}),e.exportNum=0)},getContentHeight:function(e){return this.isConfig?this.newAuthorityMaxHeight+"px":"byTeacher"!==this.palyers[e].palyerForm.distributary&&""!=this.palyers[e].palyerForm.distributary&&"byTutor"!=this.palyers[e].palyerForm.distributary?"":this.newAuthorityMaxHeight+"px"},monitorScroll:function(){var e=this,t=!1,s=!1,i=!1;this.isConfig||Object(__WEBPACK_IMPORTED_MODULE_6_timers__.setTimeout)(function(){__WEBPACK_IMPORTED_MODULE_3_jquery___default()(".join-role-scroll-area").scroll(function(){var i=__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).attr("data-id");e.scrollIndex=i;var a=__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).children().find(".participant-read-write-content").position().top,n=__WEBPACK_IMPORTED_MODULE_3_jquery___default()(".col").height().toFixed(1);a<=50?(__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).children().find(".participant-read-write-header").css("display","none"),__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).siblings(".fiexd-header").css("display","block"),__WEBPACK_IMPORTED_MODULE_3_jquery___default()("#joinRoleScrollArea"+i).css("height",n-288),e.headerIsFixed=!0,t=!0):(__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).children().find(".participant-read-write-header").css("display","block"),__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).siblings(".fiexd-header").css("display","none"),__WEBPACK_IMPORTED_MODULE_3_jquery___default()("#joinRoleScrollArea"+i).css("height",n-238),t&&(e.headerIsFixed=!1)),a<=-488?(__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).children(".participant-read-write-content").find(".batch-head").css("display","none"),__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).siblings(".fiexd-batch-head").css("display","block"),e.palyers[i].curComponentsCount>0&&(__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).siblings(".fiexd-header").children(".participant-read-write-header").css("box-shadow","none"),__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).siblings(".fiexd-batch-head").children(".batch-head").css("box-shadow","0 0 0 0 rgba(0,0,0,0.12), 0 4px 4px 0 rgba(0,0,0,0.12)"),e.batchHeadIsFixed=!0,s=!0)):(__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).children(".participant-read-write-content").find(".batch-head").css("display","block"),__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).siblings(".fiexd-batch-head").css("display","none"),__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).siblings(".fiexd-header").children(".participant-read-write-header").css("box-shadow"," 0 0 0 0 rgba(0,0,0,0.12), 0 4px 4px 0 rgba(0,0,0,0.12)"),__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).siblings(".fiexd-batch-head").children(".batch-head").css("box-shadow","none"),s&&(e.batchHeadIsFixed=!1))}),__WEBPACK_IMPORTED_MODULE_3_jquery___default()(".owner-read-write-content").scroll(function(){var t=__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).children(".role-list").position().top;e.componentsCheckAllCount>0&&(t<=-4?(__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).children(".batch-head").css("display","none"),__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).siblings(".owner-batch-head").css("display","block"),e.ownerHeaderIsFixed=!0,i=!0):(__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).children(".batch-head").css("display","block"),__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this).siblings(".owner-batch-head").css("display","none"),i&&(e.ownerHeaderIsFixed=!1)))})},300)},_allowWriteMultipleForm:function(){this.multiForm=!this.multiForm},_back:function(){if(this.isChange&&confirm(this.translate.backTip)&&this._saveJoinSet(),!this.nameIsNull)return!1;this.$emit("back")},_saveJoinSet:function(){var e=this,t=[];if(t.push(this.ownerData),this.palyers.forEach(function(e,s){t.push(e.palyerForm)}),t.forEach(function(t,s){"owner"===t.category?t.name?e.nameIsNull=!0:(e.$toast("表单所属人名称不能为空"),e.nameIsNull=!1):t.name?e.nameIsNull=!0:(e.$toast("参与者名称不能为空"),e.nameIsNull=!1)}),!this.nameIsNull)return!1;this.isConfig?this.$emit("submit",{players:t,educationLevel:this.roleSetting.educationLevel,type:this.roleSetting.type}):this.businessId?this.$emit("submit",{id:this.playersId,multiForm:this.multiForm,players:t}):this.$emit("submit",{multiForm:this.multiForm,players:t})},_addRole:function(){this.isChange=!0;(new Date).getTime();var e={};this.$set(e,"palyerForm",{}),this.$set(e,"roleEditing",!1),this.$set(e,"newRoleName",""),this.$set(e,"roleAddErrorMsg",""),this.$set(e,"curComponentsCount",0),this.$set(e,"curComponentsCountXian",0),this.$set(e,"AllComponents",[]),this.$set(e,"roleSetData",[]),this.$set(e,"batchCheck",""),this.$set(e,"curPlayerCount",0),this.$set(e,"playerName",""),this.$set(e,"searchName",""),this.$set(e,"roleSetSearchName",""),this.$set(e.palyerForm,"id",""),this.$set(e.palyerForm,"name",""),this.$set(e.palyerForm,"category","participant"),this.$set(e.palyerForm,"distributary",""),this.$set(e.palyerForm,"operators",[]),this.$set(e.palyerForm,"dataAuthorities",[]),this.$set(e.palyerForm,"batch",!1),e.palyerForm.id="player_"+(new Date).getTime();this.components.forEach(function(t,s){e.palyerForm.dataAuthorities.push({componentName:t.name,authority:"readonly",exportable:!0})}),e.palyerForm.exportNum=e.palyerForm.dataAuthorities.length,e.AllComponents=JSON.parse(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(this.components)),this.palyers.push(e)},_deletePlayers:function(e){this.palyers.splice(e,1)},_getAuthorityOf:function(e,t){var s="";return t.dataAuthorities&&t.dataAuthorities.forEach(function(t){e.name===t.componentName&&(s=t.authority)}),s},_setAuthorityOf:function(e,t,s){var i=this,a=!1;s.dataAuthorities&&s.dataAuthorities.forEach(function(s){e.name===s.componentName&&(a=!0,i.$set(s,"authority",t))}),a||s.dataAuthorities.push({componentName:e.name,authority:t})},_batchSure:function(e,t){var s=this;this.isChange=!0,"participant"===e?(this.palyers[t].AllComponents.forEach(function(e,i){e.checked&&(s._getAuthorityOf(e,s.palyers[t].palyerForm)?s._setAuthorityOf(e,s._verifyBatch(e,s.palyers[t].batchCheck),s.palyers[t].palyerForm):s.palyers[t].palyerForm.dataAuthorities.push({authority:s._verifyBatch(e,s.palyers[t].batchCheck),componentName:e.name}),e.checked=!1)}),this.palyers[t].batchCheck="",this._componentsCheckAllCount(t)):(this.components.forEach(function(e,t){e.checked&&(s._getAuthorityOf(e,s.ownerData)?s._setAuthorityOf(e,s._verifyBatch(e,s.batchCheck),s.ownerData):s.ownerData.dataAuthorities.push({authority:s._verifyBatch(e,s.batchCheck),componentName:e.name}),e.checked=!1)}),this.batchCheck="")},_verifyBatch:function(e,t){var s=!1;return this.operatorData.forEach(function(i){i.id===t&&i.coms.indexOf(e.componentType)>=0&&(s=!0)}),s?t:""},_afterSelectedDis:function(e){var t=parseInt(e.target.$attrs["data-index"]);this.isChange=!0,this.palyers[t].roleEditing=!1,this.palyers[t].palyerForm.operators=[],this.palyers[t].curPlayerCount=0,this.isConfig||this._initRoleList(t)},_initRoleList:function(e){var t=this;"bySchool"===this.palyers[e].palyerForm.distributary||"byCollege"===this.palyers[e].palyerForm.distributary?Object(__WEBPACK_IMPORTED_MODULE_4__assets_utils_utils_js__.e)({url:"/api/approveRoles",type:"get",data:{level:"bySchool"===this.palyers[e].palyerForm.distributary?"SCHOOL":"COLLEGE",departmentId:this.departmentId},success:function(s){if(s.state){t.palyers[e].roleSetData=s.data.reverse();var i=null;i&&clearTimeout(i),i=Object(__WEBPACK_IMPORTED_MODULE_6_timers__.setTimeout)(function(){var e=__WEBPACK_IMPORTED_MODULE_3_jquery___default()(".col").height().toFixed(1);t.roleSetContentHeight=e-268,t.joinRoleScrollAreaHeight=e-238,t.noRoleSetAfaterHeight=e-170,t.newAuthorityMaxHeight=e-83},300)}else t.$toast(s.message)}}):"byClass"===this.palyers[e].palyerForm.distributary?Object(__WEBPACK_IMPORTED_MODULE_4__assets_utils_utils_js__.e)({url:"/api/relClass/classCommittees",type:"get",success:function(s){if(s.state){s.data.forEach(function(e){e.name=e.text}),t.palyers[e].roleSetData=s.data.reverse();var i=null;i&&clearTimeout(i),i=Object(__WEBPACK_IMPORTED_MODULE_6_timers__.setTimeout)(function(){var e=__WEBPACK_IMPORTED_MODULE_3_jquery___default()(".col").height().toFixed(1);t.roleSetContentHeight=e-268,t.joinRoleScrollAreaHeight=e-238,t.noRoleSetAfaterHeight=e-170,t.newAuthorityMaxHeight=e-83},300)}else t.$toast(s.message)}}):"byBuilding"===this.palyers[e].palyerForm.distributary?Object(__WEBPACK_IMPORTED_MODULE_4__assets_utils_utils_js__.e)({url:"/api/apartment/roles",type:"get",success:function(s){if(s.state){s.data.forEach(function(e){e.name=e.name}),t.palyers[e].roleSetData=s.data.reverse();var i=null;i&&clearTimeout(i),i=Object(__WEBPACK_IMPORTED_MODULE_6_timers__.setTimeout)(function(){var e=__WEBPACK_IMPORTED_MODULE_3_jquery___default()(".col").height().toFixed(1);t.roleSetContentHeight=e-268,t.joinRoleScrollAreaHeight=e-238,t.noRoleSetAfaterHeight=e-170,t.newAuthorityMaxHeight=e-83},300)}else t.$toast(s.message)}}):"byParty"===this.palyers[e].palyerForm.distributary&&Object(__WEBPACK_IMPORTED_MODULE_4__assets_utils_utils_js__.e)({url:"/api/partyBuild/organizations/personInChargeRole",type:"get",success:function(s){if(s.state){s.data.forEach(function(e){e.name=e.name}),t.palyers[e].roleSetData=s.data.reverse();var i=null;i&&clearTimeout(i),i=Object(__WEBPACK_IMPORTED_MODULE_6_timers__.setTimeout)(function(){var e=__WEBPACK_IMPORTED_MODULE_3_jquery___default()(".col").height().toFixed(1);t.roleSetContentHeight=e-268,t.joinRoleScrollAreaHeight=e-238,t.noRoleSetAfaterHeight=e-170,t.newAuthorityMaxHeight=e-83},300)}else t.$toast(s.message)}})},_checkOperators:function(e,t){this.isChange=!0;var s=this.palyers[t].palyerForm.operators.indexOf(parseInt(e.id));s>=0?this.palyers[t].palyerForm.operators.splice(s,1):this.palyers[t].palyerForm.operators.push(parseInt(e.id)),this._roleCheckAllCount(t)},_changeCheckState:function(e,t,s,i){var a=this;this.isChange=!0;var n=!1;0===t&&(n=!0),this.isConfig?("dataAuthorities"===s&&e.forEach(function(e){e.title.indexOf(a.palyers[i].searchName)>=0&&(e.checked=n)}),"owner"===s&&e.forEach(function(e){e.title.indexOf(a.owenrSearchName)>=0&&(e.checked=n)})):"operators"===s?e.forEach(function(e){e.name.indexOf(a.palyers[i].roleSetSearchName)>=0&&(e.checked=n)}):e.forEach(function(e){e.checked=n}),"operators"===s?(this.palyers[i].palyerForm[s]=[],e.forEach(function(e){e.checked&&a.palyers[i].palyerForm[s].push(parseInt(e.id))}),this._roleCheckAllCount(i)):"dataAuthorities"===s&&this._componentsCheckAllCount(i)},_changeCheckStateXian:function(e,t,s,i,a){var n=this;this.palyers[i].palyerForm[s]=[],e.forEach(function(e){1==e.checkedXian&&n.palyers[i].palyerForm[s].push(e.name)})},_afterSelectedOperator:function(e){var t=parseInt(e.target.$attrs["data-index"]);this.isChange=!0,this.palyers[t].batchCheck=e.val,this._componentsCheckAllCount(t)},_afterSelectedOwner:function(e){this.isChange=!0,this.batchCheck=e.val},_creatNewRole:function(e){this.palyers[e].roleEditing=!0,__WEBPACK_IMPORTED_MODULE_3_jquery___default()("#roleContent"+e).animate({scrollTop:"0px"},300)},_saveNewRole:function(e,t){var s=this;this.isChange=!0;__WEBPACK_IMPORTED_MODULE_3_jquery___default()(this);if(!e)return this.palyers[t].roleAddErrorMsg="角色名不能为空",Object(__WEBPACK_IMPORTED_MODULE_6_timers__.setTimeout)(function(){s.palyers[t].roleAddErrorMsg=""},1500),!1;""===e.replace(/\s/g,"")&&(this.palyers[t].roleAddErrorMsg=this.roleEmptyTip),this.palyers[t].roleSetData.forEach(function(i){e===i.name&&(s.palyers[t].roleAddErrorMsg&&(s.palyers[t].roleAddErrorMsg+=","),s.palyers[t].roleAddErrorMsg+=s.translate.roleExistTip)}),this.palyers[t].roleAddErrorMsg?Object(__WEBPACK_IMPORTED_MODULE_6_timers__.setTimeout)(function(){s.palyers[t].roleAddErrorMsg=""},1500):Object(__WEBPACK_IMPORTED_MODULE_4__assets_utils_utils_js__.e)({url:"/api/approveRoles",type:"post",data:{name:e,level:"bySchool"===this.palyers[t].palyerForm.distributary?"SCHOOL":"COLLEGE",departmentId:this.departmentId},success:function(i){i.state?(s.palyers[t].roleSetData.unshift({id:i.data,name:e}),s.palyers[t].palyerForm.operators.push(parseInt(i.data)),s.palyers[t].roleEditing=!1):s.$toast(i.message)}})},_changeBatchSet:function(e){this.palyers[e].palyerForm.batch?this.palyers[e].palyerForm.batch=!1:this.palyers[e].palyerForm.batch=!0},_roleCheckAllCount:function(e){var t=this;return this.palyers[e].curPlayerCount=0,this.palyers[e].palyerForm&&this.palyers[e].palyerForm.operators&&this.palyers[e].roleSetData.forEach(function(s){t.palyers[e].palyerForm.operators.indexOf(parseInt(s.id))>=0&&t.palyers[e].curPlayerCount++}),this.palyers[e].curPlayerCount},_componentsCheckAllCount:function(e){var t=this;return this.palyers[e].curComponentsCount=0,this.palyers[e].AllComponents.forEach(function(s){s.checked&&t.palyers[e].curComponentsCount++}),this.palyers[e].curComponentsCount},_componentsCheckAllCountXian:function(e){var t=this;return this.palyers[e].curComponentsCountXian=0,this.palyers[e].AllComponents.forEach(function(s){s.checkedXian&&t.palyers[e].curComponentsCountXian++}),this.palyers[e].curComponentsCountXian}},__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_defineProperty___default()(_methods,"_componentsCheckAllCountXian",function(e){var t=this;return this.palyers[e].curComponentsCountXian=0,this.palyers[e].AllComponents.forEach(function(s){s.checkedXian&&t.palyers[e].curComponentsCountXian++}),this.palyers[e].curComponentsCount}),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_defineProperty___default()(_methods,"_changeComSelectXian",function(e,t){e.checkedXian=!e.checkedXian,this._componentsCheckAllCountXian(t)}),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_defineProperty___default()(_methods,"_changeComSelect",function(e,t){e.checked=!e.checked,this._componentsCheckAllCount(t)}),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_defineProperty___default()(_methods,"_changeNameInput",function(){this.isChange=!0}),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_defineProperty___default()(_methods,"_newRowInputFocus",function(e){this.palyers[e].newRoleName=this.appName+this.palyers[e].palyerForm.name+"管理员"}),_methods),destroyed:function(){__WEBPACK_IMPORTED_MODULE_3_jquery___default()(window).off("keydown")}}}});