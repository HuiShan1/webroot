webpackJsonp([112],{"7tuL":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("C331"),r={name:"authManage",data:function(){return{setUserFrom:{name:"",loading:!1},setUserRules:{name:[{required:!0,message:"请输入姓名或者学工号",trigger:"blur"}]},roleId:"",addedUsertable:"",setUserDialog:!1,studentName:"",curType:"school",columns:[],searchParams:{},tableData:[]}},created:function(){this.getRole("SCHOOL","tableData")},methods:{onDeleteUser:function(e){var t=this;window.confirm("是否删除")&&Object(a.e)({url:"/api/employment/role/deleteRole?roleId="+this.roleId+"&userId="+e.userId,type:"DELETE",success:function(e){e.state?(t.$message.success("删除成功"),t.getUserByRole(t.roleId)):t.$message.error(e.message)}})},onSetUserAdd:function(e){var t=this;this.$refs[e].validate(function(s){if(!s)return!1;t.setUserFrom.loading=!0,Object(a.e)({url:"/api/employment/role/addRole?roleId="+t.roleId+"&name="+t.setUserFrom.name,type:"post",success:function(s){s.state?(t.$message.success("添加成功"),t.getUserByRole(t.roleId),t.resetForm(e)):t.$message.error(s.message)}}).always(function(){t.setUserFrom.loading=!1})})},resetForm:function(e){this.$refs[e].resetFields()},onSetUser:function(e){this.roleId=e.roleId,this.addedUsertable=[],this.getUserByRole(e.roleId)},getUserByRole:function(e){var t=this;Object(a.e)({url:"/api/employment/role/getUserByRole?roleId="+e,type:"get",success:function(e){e.state?(t.addedUsertable=e.data,t.setUserDialog=!0):t.$message.error(e.message)}})},getRole:function(e,t){var s=this,r=this;Object(a.e)({url:"/api/employment/role/getRole?level="+e,type:"get",success:function(e){e.state?r[t]=e.data:s.$message.error(e.message)}})},changeType:function(e){this.curType!=e&&(this.curType=e,this.tableData=[],"school"==e?this.getRole("SCHOOL","tableData"):this.getRole("COLLEGE","tableData"))}}},l={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"authManage"}},[e._m(0),e._v(" "),s("div",{staticClass:"content"},[s("div",{staticClass:"tabs"},[s("div",{staticClass:"tabsTitle"},[s("a",{class:{active:"school"==e.curType},on:{click:function(t){return e.changeType("school")}}},[e._v("校级权限")]),e._v(" "),s("a",{class:{active:"college"==e.curType},on:{click:function(t){return e.changeType("college")}}},[e._v("院级权限")])]),e._v(" "),s("div",{staticClass:"tabsContent"},[s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[s("el-table-column",{attrs:{type:"index",width:"50"}}),e._v(" "),s("el-table-column",{attrs:{prop:"name",label:"角色名",width:"180"}}),e._v(" "),s("el-table-column",{attrs:{prop:"remarks",label:"角色说明",width:"180"}}),e._v(" "),s("el-table-column",{attrs:{label:"用户"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-popover",{attrs:{trigger:"hover",placement:"top"}},[e._l(t.row.users,function(t,a){return s("span",{key:a,staticStyle:{"padding-right":"10px"}},[e._v(e._s(t.name))])}),e._v(" "),s("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},e._l(t.row.users.length>3?t.row.users.slice(0,2):t.row.users,function(t,a){return s("el-tag",{key:a,staticStyle:{"padding-right":"10px"}},[e._v(e._s(t.name))])}),1)],2)]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text",size:"small"},on:{click:function(s){return e.onSetUser(t.row)}}},[e._v("设置用户")])]}}])})],1)],1)])]),e._v(" "),s("el-dialog",{attrs:{title:"设置用户",visible:e.setUserDialog},on:{"update:visible":function(t){e.setUserDialog=t}}},[s("el-form",{ref:"setUserFromRules",staticClass:"unit-manager-form",attrs:{model:e.setUserFrom,rules:e.setUserRules}},[s("el-form-item",{staticStyle:{"line-height":"45px"},attrs:{prop:"name"}},[s("el-input",{attrs:{placeholder:"搜索姓名或学工号",clearable:""},model:{value:e.setUserFrom.name,callback:function(t){e.$set(e.setUserFrom,"name",t)},expression:"setUserFrom.name"}})],1)],1),e._v(" "),s("div",{staticClass:"add-user"},[e._v("已添加用户")]),e._v(" "),s("el-table",{attrs:{data:e.addedUsertable}},[s("el-table-column",{attrs:{prop:"name",label:"姓名"}}),e._v(" "),s("el-table-column",{attrs:{prop:"userId",label:"学号"}}),e._v(" "),s("el-table-column",{attrs:{label:"操作",width:"50"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text",size:"small"},on:{click:function(s){return e.onDeleteUser(t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{plain:""},on:{click:function(t){e.setUserDialog=!1}}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{type:"primary",loading:e.setUserFrom.loading},on:{click:function(t){return e.onSetUserAdd("setUserFromRules")}}},[e._v("添加")])],1)],1)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"top"},[t("h1",[this._v("系统管理权限")])])}]};var o=s("VU/8")(r,l,!1,function(e){s("hH04")},"data-v-a731e170",null);t.default=o.exports},hH04:function(e,t){}});